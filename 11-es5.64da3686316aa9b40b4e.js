!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return l=e.done,e},e:function(e){r=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(r)throw o}}}}function c(e,t){if(e){if("string"==typeof e)return n(e,t);var c=Object.prototype.toString.call(e).slice(8,-1);return"Object"===c&&e.constructor&&(c=e.constructor.name),"Map"===c||"Set"===c?Array.from(e):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var c=0,n=new Array(t);c<t;c++)n[c]=e[c];return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var c=0;c<t.length;c++){var n=t[c];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,c){return t&&a(e.prototype,t),c&&a(e,c),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{XljO:function(c,n,a){"use strict";a.r(n),a.d(n,"HomebrewModule",(function(){return Lt}));var l=a("ofXK"),r=a("YUcS"),s=a("3Pt+"),u=a("lR5k"),d=a("hctd"),m=a("WVau"),p=a("bVJ3"),g=a("6B8D"),f=a("tyNb"),h=a("97Gz"),b=a("AytR"),v=a("LRne"),j=a("2xJ4"),k=a("JIr8"),w=a("fXoL"),y=a("tk/3"),C=b.a.apiURL+"/homebrew/items",M=b.a.apiURL+"/homebrew/spells",O=function(){function e(t){i(this,e),this.http=t}return o(e,[{key:"getUserPacks",value:function(){return this.http.get(C+"/me",Object(j.b)())}},{key:"newPack",value:function(e){return this.http.post(""+C,e,Object(j.b)()).pipe(Object(k.a)(this.handleError("newPack")))}},{key:"getPack",value:function(e){return this.http.get("".concat(C,"/").concat(e),Object(j.b)())}},{key:"putPack",value:function(e){return this.http.put("".concat(C,"/").concat(e._id.$oid),e,Object(j.c)()).pipe(Object(k.a)(this.handleError("putPack")))}},{key:"deletePack",value:function(e){return this.http.delete("".concat(C,"/").concat(e._id.$oid),Object(j.c)()).pipe(Object(k.a)(this.handleError("deletePack")))}},{key:"getPackEditors",value:function(e){return this.http.get("".concat(C,"/").concat(e,"/editors"),Object(j.b)())}},{key:"getTemplateItems",value:function(){return this.http.get(C+"/srd",Object(j.b)())}},{key:"getUserTomes",value:function(){return this.http.get(M+"/me",Object(j.b)())}},{key:"newTome",value:function(e){return this.http.post(""+M,e,Object(j.b)()).pipe(Object(k.a)(this.handleError("newTome")))}},{key:"getTome",value:function(e){return this.http.get("".concat(M,"/").concat(e),Object(j.b)())}},{key:"putTome",value:function(e){return this.http.put("".concat(M,"/").concat(e._id.$oid),e,Object(j.c)()).pipe(Object(k.a)(this.handleError("putTome")))}},{key:"deleteTome",value:function(e){return this.http.delete("".concat(M,"/").concat(e._id.$oid),Object(j.c)()).pipe(Object(k.a)(this.handleError("deleteTome")))}},{key:"getTomeEditors",value:function(e){return this.http.get("".concat(M,"/").concat(e,"/editors"),Object(j.b)())}},{key:"getTemplateSpells",value:function(){return this.http.get(M+"/srd",Object(j.b)())}},{key:"validateSpellJSON",value:function(e){return this.http.post(M+"/validate",e,Object(j.b)()).pipe(Object(k.a)((function(e){return Object(v.a)({success:!1,result:e.error})})))}},{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"operation";return function(t){return console.error(t),Object(v.a)({error:"".concat(e," failed: ").concat(t.error),success:!1})}}}]),e}();O.\u0275fac=function(e){return new(e||O)(w.nc(y.b))},O.\u0275prov=w.Zb({token:O,factory:O.\u0275fac,providedIn:"root"});var S=a("0IaG"),L=a("kmnG"),W=a("qFsG"),x=a("1jcm"),I=a("bTqV"),R=function(e,t,c,n){return{name:e,public:t,image:c,desc:n}},z=function(){function e(){i(this,e),this.public=!1,this.desc="",this.image=""}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();z.\u0275fac=function(e){return new(e||z)},z.\u0275cmp=w.Xb({type:z,selectors:[["avr-new-pack-dialog"]],decls:19,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],[1,"mat-small"],["mat-button","","mat-dialog-close","","tabindex","1"],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(e,t){1&e&&(w.jc(0,"h2",0),w.Wc(1,"New Pack..."),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"div",2),w.jc(4,"mat-form-field"),w.jc(5,"input",3),w.qc("ngModelChange",(function(e){return t.name=e})),w.ic(),w.ic(),w.jc(6,"mat-slide-toggle",4),w.qc("ngModelChange",(function(e){return t.public=e})),w.Wc(7,"Allow public to view"),w.ic(),w.jc(8,"mat-form-field"),w.jc(9,"input",5),w.qc("ngModelChange",(function(e){return t.image=e})),w.ic(),w.ic(),w.jc(10,"mat-form-field"),w.jc(11,"textarea",6),w.qc("ngModelChange",(function(e){return t.desc=e})),w.ic(),w.ic(),w.ic(),w.jc(12,"p",7),w.Wc(13," These settings can be changed at any time. "),w.ic(),w.ic(),w.jc(14,"mat-dialog-actions"),w.jc(15,"button",8),w.Wc(16,"Cancel"),w.ic(),w.jc(17,"button",9),w.Wc(18," Create "),w.ic(),w.ic()),2&e&&(w.Rb(5),w.zc("ngModel",t.name),w.Rb(1),w.zc("ngModel",t.public),w.Rb(3),w.zc("ngModel",t.image),w.Rb(2),w.zc("ngModel",t.desc),w.Rb(6),w.zc("mat-dialog-close",w.Gc(6,R,t.name,t.public,t.image,t.desc))("disabled",!t.name))},directives:[S.i,S.f,L.c,W.a,s.c,s.n,s.q,x.a,S.c,I.b,S.d],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var _=["name"],q=function e(){i(this,e),this.name="New Item",this.meta="",this.desc=""},P=a("hMdP"),E=a("Qu3c"),D=a("NFeN"),T=function(){function e(t){i(this,e),this.data=t,this.generateMD(this.data.data)}return o(e,[{key:"ngOnInit",value:function(){}},{key:"generateMD",value:function(e){var c="";c+="".concat("# "+e.name,"\n").concat(e.desc||"","\n\n");var n,i=t(e.items);try{for(i.s();!(n=i.n()).done;){var a=n.value;c+="".concat("#### "+a.name,"\n").concat(a.meta,"\n___\n").concat(a.desc,"\n\n")}}catch(o){i.e(o)}finally{i.f()}c=c.replace("\n","\n  "),this.mdData=c}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}}]),e}();T.\u0275fac=function(e){return new(e||T)(w.dc(S.a))},T.\u0275cmp=w.Xb({type:T,selectors:[["avr-pack-markdown-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","readonly","","placeholder","Markdown","rows","10",3,"value"],["mdElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(e,t){if(1&e){var c=w.kc();w.jc(0,"h2",0),w.Wc(1),w.ic(),w.Wc(2,"\n"),w.jc(3,"mat-dialog-content",1),w.Wc(4,"\n  "),w.jc(5,"div",2),w.Wc(6,"\n    "),w.jc(7,"mat-form-field"),w.Wc(8,"\n      "),w.ec(9,"textarea",3,4),w.Wc(11,"\n      "),w.jc(12,"button",5),w.qc("click",(function(){w.Lc(c);var e=w.Ic(10);return t.copy(e)})),w.Wc(13,"\n        "),w.jc(14,"mat-icon"),w.Wc(15,"file_copy"),w.ic(),w.Wc(16,"\n      "),w.ic(),w.Wc(17,"\n    "),w.ic(),w.Wc(18,"\n  "),w.ic(),w.Wc(19,"\n"),w.ic(),w.Wc(20,"\n"),w.jc(21,"mat-dialog-actions"),w.Wc(22,"\n  "),w.jc(23,"button",6),w.Wc(24,"Done"),w.ic(),w.Wc(25,"\n"),w.ic(),w.Wc(26,"\n")}2&e&&(w.Rb(1),w.Yc("Markdown - ",t.data.name,""),w.Rb(8),w.zc("value",t.mdData))},directives:[S.i,S.f,L.c,W.a,I.b,L.j,E.a,D.a,S.c,S.d],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var N=a("7EHt"),F=a("MutI"),V=a("Xa2L");function U(e,t){if(1&e){var c=w.kc();w.jc(0,"mat-form-field"),w.ec(1,"input",9,10),w.jc(3,"button",11),w.qc("click",(function(){w.Lc(c);var e=w.Ic(2);return w.uc().copy(e)})),w.jc(4,"mat-icon"),w.Wc(5,"file_copy"),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(1),w.zc("value",n.shareLink)}}function A(e,t){if(1&e&&(w.jc(0,"mat-list-item"),w.Wc(1),w.vc(2,"async"),w.ic()),2&e){var c,n=t.$implicit;w.Rb(1),w.Xc(null==(c=w.wc(2,1,n))?null:c.username)}}function J(e,t){if(1&e&&(w.jc(0,"mat-list"),w.Vc(1,A,3,3,"mat-list-item",12),w.ic()),2&e){var c=w.uc();w.Rb(1),w.zc("ngForOf",c.editors)}}function X(e,t){if(1&e){var c=w.kc();w.jc(0,"div",13),w.jc(1,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().beginJSONExport()})),w.Wc(2,"Export to JSON "),w.ic(),w.jc(3,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().beginMDExport()})),w.Wc(4,"Export to Homebrewery "),w.ic(),w.ic()}}function $(e,t){1&e&&(w.jc(0,"div"),w.ec(1,"mat-spinner",15),w.ic()),2&e&&(w.Rb(1),w.zc("diameter",24))}var Y=function(e){return{public:e}},B=function(){function e(t,c,n,a){i(this,e),this.data=t,this.dialog=c,this.hbService=n,this.discord=a,this.public=t.public,this.shareLink="https://avrae.io/homebrew/items/"+t._id.$oid,this.loaded=void 0!==t.items}return o(e,[{key:"ngOnInit",value:function(){this.owner=this.discord.getUser(this.data.owner),this.loadEditors(),this.loaded||this.loadItems()}},{key:"loadItems",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getPack(t).subscribe((function(t){e.data=t,e.loaded=!0}))}},{key:"loadEditors",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getPackEditors(t).subscribe((function(t){var c=[];t.forEach((function(t){return c.push(e.discord.getUser(t))})),e.editors=c}))}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}},{key:"beginJSONExport",value:function(){this.dialog.open(P.a,{data:{name:this.data.name,data:this.data.items},width:"60%"})}},{key:"beginMDExport",value:function(){this.dialog.open(T,{data:{name:this.data.name,data:this.data},width:"60%"})}}]),e}();B.\u0275fac=function(e){return new(e||B)(w.dc(S.a),w.dc(S.b),w.dc(O),w.dc(h.a))},B.\u0275cmp=w.Xb({type:B,selectors:[["avr-pack-share-dialog"]],decls:31,vars:12,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],[3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"mat-elevation-z0"],["class","button-row",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["matInput","","readonly","","placeholder","View Link",3,"value"],["shareLinkElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],[4,"ngFor","ngForOf"],[1,"button-row"],["mat-raised-button","","color","primary",3,"click"],[3,"diameter"]],template:function(e,t){var c;(1&e&&(w.jc(0,"h2",0),w.Wc(1),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"div",2),w.jc(4,"p"),w.Wc(5),w.vc(6,"async"),w.ic(),w.jc(7,"mat-slide-toggle",3),w.qc("ngModelChange",(function(e){return t.public=e})),w.Wc(8,"Allow public to view"),w.ic(),w.Vc(9,U,6,1,"mat-form-field",4),w.jc(10,"mat-expansion-panel",5),w.jc(11,"mat-expansion-panel-header"),w.jc(12,"mat-panel-title"),w.Wc(13," Editors "),w.ic(),w.ic(),w.jc(14,"p"),w.Wc(15,"To add or remove an editor, run the command "),w.jc(16,"kbd"),w.Wc(17,"!pack editor @user"),w.ic(),w.Wc(18," in Discord!"),w.ic(),w.Vc(19,J,2,1,"mat-list",4),w.ic(),w.jc(20,"mat-expansion-panel",5),w.jc(21,"mat-expansion-panel-header"),w.jc(22,"mat-panel-title"),w.Wc(23," Export "),w.ic(),w.ic(),w.Vc(24,X,5,0,"div",6),w.Vc(25,$,2,1,"div",4),w.ic(),w.ic(),w.ic(),w.jc(26,"mat-dialog-actions"),w.jc(27,"button",7),w.Wc(28,"Cancel"),w.ic(),w.jc(29,"button",8),w.Wc(30," Done "),w.ic(),w.ic()),2&e)&&(w.Rb(1),w.Yc("Share ",t.data.name,""),w.Rb(4),w.Yc(" Owner: ",null==(c=w.wc(6,8,t.owner))?null:c.username," "),w.Rb(2),w.zc("ngModel",t.public),w.Rb(2),w.zc("ngIf",t.public),w.Rb(10),w.zc("ngIf",null==t.editors?null:t.editors.length),w.Rb(5),w.zc("ngIf",t.loaded),w.Rb(1),w.zc("ngIf",!t.loaded),w.Rb(4),w.zc("mat-dialog-close",w.Dc(10,Y,t.public)))},directives:[S.i,S.f,x.a,s.n,s.q,l.t,N.c,N.g,N.h,S.c,I.b,S.d,L.c,W.a,L.j,E.a,D.a,F.a,l.s,F.d,V.c],pipes:[l.b],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.button-row[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:4px}"]});var G=a("/t3+"),H=a("XiUz"),Z=a("Wp6s");function K(e,t){if(1&e&&(w.jc(0,"mat-card-content"),w.jc(1,"p"),w.Wc(2),w.ic(),w.ic()),2&e){var c=w.uc().$implicit;w.Rb(2),w.Yc(" ",c.desc," ")}}function Q(e,t){if(1&e){var c=w.kc();w.jc(0,"div",8),w.jc(1,"mat-card"),w.jc(2,"mat-card-header"),w.jc(3,"mat-card-title"),w.Wc(4),w.ic(),w.jc(5,"mat-card-subtitle"),w.Wc(6),w.ic(),w.ic(),w.ec(7,"img",9),w.Vc(8,K,3,1,"mat-card-content",10),w.jc(9,"mat-card-actions"),w.jc(10,"a",11),w.Wc(11,"EDIT"),w.ic(),w.jc(12,"button",12),w.qc("click",(function(){w.Lc(c);var e=t.$implicit;return w.uc(2).beginShare(e)})),w.Wc(13,"SHARE"),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n,i=t.$implicit,a=w.uc(2);w.Rb(4),w.Xc(i.name),w.Rb(2),w.Zc("By ",(null==(n=a.owners.get(i.owner))?null:n.username)||"loading..."," - ",i.numItems," items "),w.Rb(1),w.zc("src",i.image||"../../../../assets/img/pack.png",w.Nc),w.Rb(1),w.zc("ngIf",i.desc),w.Rb(2),w.Ac("routerLink",i._id.$oid)}}function ee(e,t){if(1&e&&(w.jc(0,"div",6),w.Vc(1,Q,14,6,"div",7),w.ic()),2&e){var c=w.uc();w.Rb(1),w.zc("ngForOf",c.packs)}}function te(e,t){if(1&e){var c=w.kc();w.jc(0,"div",13),w.jc(1,"mat-card"),w.jc(2,"p"),w.Wc(3,"Looks like you don't have any packs yet."),w.ic(),w.jc(4,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().beginNew()})),w.Wc(5,"Create One"),w.ic(),w.ic(),w.ic()}}var ce=function(){function e(t,c,n,a,o){i(this,e),this.homebrewService=t,this.discord=c,this.dialog=n,this.router=a,this.route=o,this.owners=new Map}return o(e,[{key:"ngOnInit",value:function(){this.getPacks()}},{key:"getPacks",value:function(){var e=this;this.homebrewService.getUserPacks().subscribe((function(c){e.packs=c;var n,i=new Set,a=t(c);try{var o=function(){var t=n.value;i.has(t.owner)||(i.add(t.owner),e.discord.getUser(t.owner).subscribe((function(c){return e.owners.set(t.owner,c)})))};for(a.s();!(n=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}}))}},{key:"beginNew",value:function(){var e=this;this.dialog.open(z,{width:"60%",disableClose:!0}).afterClosed().subscribe((function(t){if(t){var c={name:t.name,public:t.public,desc:t.desc,image:t.image};e.new(c)}}))}},{key:"beginShare",value:function(e){var t=this;this.dialog.open(B,{data:e,width:"40%",disableClose:!0}).afterClosed().subscribe((function(c){c&&(console.log(c),e=Object.assign(e,c),t.commit(e))}))}},{key:"new",value:function(e){var t=this;this.homebrewService.newPack(e).subscribe((function(e){e.success&&t.router.navigate([e.packId],{relativeTo:t.route})}))}},{key:"commit",value:function(e){this.homebrewService.putPack(e).subscribe((function(e){console.log(e)}))}}]),e}();ce.\u0275fac=function(e){return new(e||ce)(w.dc(O),w.dc(h.a),w.dc(S.b),w.dc(f.b),w.dc(f.a))},ce.\u0275cmp=w.Xb({type:ce,selectors:[["avr-items"]],decls:10,vars:2,consts:[["color","primary",1,"mat-elevation-z2"],[1,"toolbar-spacer"],["mat-icon-button","",3,"click"],["aria-label","New Pack"],["class","container","fxLayout","row wrap","fxLayoutAlign","space-around",4,"ngIf"],["class","container",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","space-around",1,"container"],["class","pack-tile","fxFlex","32%",4,"ngFor","ngForOf"],["fxFlex","32%",1,"pack-tile"],["mat-card-image","","alt","Pack Image",3,"src"],[4,"ngIf"],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],[1,"container"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(w.jc(0,"mat-toolbar",0),w.jc(1,"span"),w.Wc(2,"Your Packs"),w.ic(),w.ec(3,"span",1),w.jc(4,"span"),w.jc(5,"button",2),w.qc("click",(function(){return t.beginNew()})),w.jc(6,"mat-icon",3),w.Wc(7,"add"),w.ic(),w.ic(),w.ic(),w.ic(),w.Vc(8,ee,2,1,"div",4),w.Vc(9,te,6,0,"div",5)),2&e&&(w.Rb(8),w.zc("ngIf",t.packs&&t.packs.length),w.Rb(1),w.zc("ngIf",t.packs&&!t.packs.length))},directives:[G.a,I.b,D.a,l.t,H.f,H.e,l.s,H.b,Z.a,Z.f,Z.m,Z.l,Z.g,Z.b,I.a,f.c,Z.d],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%], .pack-tile[_ngcontent-%COMP%]{margin:4px}"]});var ne=a("5+WD"),ie=a("9qBq"),ae=a("XwxW"),oe=a("QAUA"),le=function(){function e(t){i(this,e),this.data=t}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();function re(e,t){if(1&e){var c=w.kc();w.jc(0,"button",9),w.qc("click",(function(){return w.Lc(c),w.uc().beginDelete()})),w.Wc(1,"Delete"),w.ic()}}le.\u0275fac=function(e){return new(e||le)(w.dc(S.a))},le.\u0275cmp=w.Xb({type:le,selectors:[["avr-pack-delete-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["mat-button","","mat-dialog-close",""],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(e,t){1&e&&(w.jc(0,"h2",0),w.Wc(1),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"p"),w.Wc(4),w.jc(5,"b"),w.Wc(6,"This cannot be undone."),w.ic(),w.ic(),w.ic(),w.jc(7,"mat-dialog-actions"),w.jc(8,"button",2),w.Wc(9,"Cancel"),w.ic(),w.jc(10,"button",3),w.Wc(11," Delete "),w.ic(),w.ic()),2&e&&(w.Rb(1),w.Yc("Deleting ",t.data.name,"..."),w.Rb(3),w.Yc(" Are you sure you want to delete ",t.data.name,"? This will remove the pack from all editors' libraries, and invalidate any sharing links. "),w.Rb(6),w.zc("mat-dialog-close",!0))},directives:[S.i,S.f,S.c,I.b,S.d],styles:[""]});var se=function(e,t,c){return{name:e,image:t,desc:c}},ue=function(){function e(t,c,n){i(this,e),this.data=t,this.dialog=c,this.dialogRef=n,this.name=t.name,this.image=t.image,this.desc=t.desc,this.isOwner=Object(j.d)().id===t.owner}return o(e,[{key:"ngOnInit",value:function(){}},{key:"beginDelete",value:function(){var e=this;this.dialog.open(le,{data:this.data,width:"40%"}).afterClosed().subscribe((function(t){t&&e.dialogRef.close({delete:!0})}))}}]),e}();ue.\u0275fac=function(e){return new(e||ue)(w.dc(S.a),w.dc(S.b),w.dc(S.h))},ue.\u0275cmp=w.Xb({type:ue,selectors:[["avr-pack-options-dialog"]],decls:16,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(w.jc(0,"h2",0),w.Wc(1),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"div",2),w.jc(4,"mat-form-field"),w.jc(5,"input",3),w.qc("ngModelChange",(function(e){return t.name=e})),w.ic(),w.ic(),w.jc(6,"mat-form-field"),w.jc(7,"input",4),w.qc("ngModelChange",(function(e){return t.image=e})),w.ic(),w.ic(),w.jc(8,"mat-form-field"),w.jc(9,"textarea",5),w.qc("ngModelChange",(function(e){return t.desc=e})),w.ic(),w.ic(),w.ic(),w.ic(),w.jc(10,"mat-dialog-actions"),w.jc(11,"button",6),w.Wc(12,"Cancel"),w.ic(),w.jc(13,"button",7),w.Wc(14," Save "),w.ic(),w.Vc(15,re,2,0,"button",8),w.ic()),2&e&&(w.Rb(1),w.Xc(t.data.name),w.Rb(4),w.zc("ngModel",t.name),w.Rb(2),w.zc("ngModel",t.image),w.Rb(2),w.zc("ngModel",t.desc),w.Rb(4),w.zc("mat-dialog-close",w.Fc(7,se,t.name,t.image,t.desc))("disabled",!t.name),w.Rb(2),w.zc("ngIf",t.isOwner))},directives:[S.i,S.f,L.c,W.a,s.c,s.n,s.q,S.c,I.b,S.d,l.t],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var de=a("dNgK");function me(e,t){if(1&e){var c=w.kc();w.jc(0,"mat-form-field",5),w.jc(1,"input",16),w.qc("change",(function(){return w.Lc(c),w.uc(2).emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc(2).item.image=e})),w.ic(),w.ic()}if(2&e){var n=w.uc(2);w.Rb(1),w.zc("ngModel",n.item.image)}}function pe(e,t){if(1&e){var c=w.kc();w.jc(0,"span",5),w.jc(1,"button",17),w.qc("click",(function(){w.Lc(c);var e=w.uc(2);return e.item.image="",e.emitChange()})),w.jc(2,"mat-icon",18),w.Wc(3,"add_photo_alternate"),w.ic(),w.ic(),w.ic()}}function ge(e,t){if(1&e){var c=w.kc();w.jc(0,"span",5),w.jc(1,"button",19),w.qc("click",(function(){return w.Lc(c),w.uc(2).moveUp.emit()})),w.jc(2,"mat-icon",20),w.Wc(3,"arrow_upward"),w.ic(),w.ic(),w.ic()}}function fe(e,t){if(1&e){var c=w.kc();w.jc(0,"span",5),w.jc(1,"button",21),w.qc("click",(function(){return w.Lc(c),w.uc(2).moveDown.emit()})),w.jc(2,"mat-icon",22),w.Wc(3,"arrow_downward"),w.ic(),w.ic(),w.ic()}}function he(e,t){if(1&e){var c=w.kc();w.jc(0,"div",3),w.jc(1,"div",4),w.jc(2,"mat-form-field",5),w.jc(3,"input",6),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().item.name=e})),w.ic(),w.ic(),w.Vc(4,me,2,1,"mat-form-field",7),w.ic(),w.jc(5,"mat-form-field"),w.jc(6,"textarea",8),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().item.meta=e})),w.ic(),w.ic(),w.jc(7,"mat-form-field"),w.jc(8,"textarea",9),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().item.desc=e})),w.ic(),w.ic(),w.ic(),w.jc(9,"div",10),w.Vc(10,pe,4,0,"span",7),w.jc(11,"span",5),w.jc(12,"button",11),w.qc("click",(function(){return w.Lc(c),w.uc().beginJSONExport()})),w.jc(13,"mat-icon",12),w.Wc(14,"vertical_align_top"),w.ic(),w.ic(),w.ic(),w.Vc(15,ge,4,0,"span",7),w.Vc(16,fe,4,0,"span",7),w.ec(17,"span",13),w.jc(18,"span",5),w.jc(19,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().delete.emit()})),w.jc(20,"mat-icon",15),w.Wc(21,"delete"),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(3),w.zc("ngModel",n.item.name),w.Rb(1),w.zc("ngIf",null!=n.item.image),w.Rb(2),w.zc("ngModel",n.item.meta),w.Rb(2),w.zc("ngModel",n.item.desc),w.Rb(2),w.zc("ngIf",void 0===n.item.image),w.Rb(5),w.zc("ngIf",!n.isFirst),w.Rb(1),w.zc("ngIf",!n.isLast)}}var be=function(){function e(t){i(this,e),this.dialog=t,this.moveUp=new w.u,this.moveDown=new w.u,this.changed=new w.u,this.opened=new w.u,this.delete=new w.u}return o(e,[{key:"ngOnInit",value:function(){}},{key:"emitChange",value:function(){this.changed.emit()}},{key:"beginJSONExport",value:function(){this.dialog.open(P.a,{data:{name:this.item.name,data:this.item},width:"60%"})}}]),e}();be.\u0275fac=function(e){return new(e||be)(w.dc(S.b))},be.\u0275cmp=w.Xb({type:be,selectors:[["avr-item-detail"]],inputs:{item:"item",isFirst:"isFirst",isLast:"isLast"},outputs:{moveUp:"moveUp",moveDown:"moveDown",changed:"changed",opened:"opened",delete:"delete"},decls:7,vars:2,consts:[[3,"opened"],["markdown","",3,"data"],["matExpansionPanelContent",""],[1,"form-container"],["fxLayout","row","fxLayoutGap","4px"],["fxFlex",""],["matInput","","placeholder","Name",3,"ngModel","change","ngModelChange"],["fxFlex","",4,"ngIf"],["matInput","","placeholder","Meta","rows","3",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Description","rows","7",3,"ngModel","change","ngModelChange"],["fxLayout","row",1,"actions"],["mat-icon-button","","matTooltip","Export to JSON",3,"click"],["aria-label","Export to JSON"],["fxFlex","grow"],["mat-icon-button","","color","warn",3,"click"],["aria-label","Delete"],["matInput","","placeholder","Image URL",3,"ngModel","change","ngModelChange"],["mat-icon-button","","matTooltip","Add image",3,"click"],["aria-label","Add image"],["mat-icon-button","","matTooltip","Move Up",3,"click"],["aria-label","Move Up"],["mat-icon-button","","matTooltip","Move Down",3,"click"],["aria-label","Move Down"]],template:function(e,t){1&e&&(w.jc(0,"mat-expansion-panel",0),w.qc("opened",(function(){return t.opened.emit()})),w.jc(1,"mat-expansion-panel-header"),w.jc(2,"mat-panel-title"),w.jc(3,"div"),w.Wc(4),w.ic(),w.ic(),w.ec(5,"mat-panel-description",1),w.ic(),w.Vc(6,he,22,7,"ng-template",2),w.ic()),2&e&&(w.Rb(4),w.Yc(" ",t.item.name," "),w.Rb(1),w.zc("data",t.item.meta.split("\n")[0]))},directives:[N.c,N.g,N.h,N.f,u.a,N.e,H.f,H.g,L.c,H.b,W.a,s.c,s.n,s.q,l.t,I.b,E.a,D.a],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}mat-panel-title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:auto 0}"]});var ve=a("WJbf");function je(e,t){if(1&e){var c=w.kc();w.jc(0,"avr-item-detail",22),w.qc("moveUp",(function(){w.Lc(c);var e=t.$implicit;return w.uc(3).moveUp(e)}))("moveDown",(function(){w.Lc(c);var e=t.$implicit;return w.uc(3).moveDown(e)}))("changed",(function(){return w.Lc(c),w.uc(3).ensureChangesNotif()}))("opened",(function(){w.Lc(c);var e=t.$implicit;return w.uc(3).selectedItem=e}))("delete",(function(){w.Lc(c);var e=t.$implicit;return w.uc(3).deleteItem(e)})),w.ic()}if(2&e){var n=t.$implicit,i=t.first,a=t.last;w.zc("item",n)("isFirst",i)("isLast",a)}}function ke(e,t){if(1&e){var c=w.kc();w.jc(0,"div",13),w.jc(1,"mat-accordion"),w.Vc(2,je,1,3,"avr-item-detail",14),w.jc(3,"mat-card",15),w.jc(4,"span",16),w.Wc(5,"New..."),w.ic(),w.ec(6,"span",4),w.jc(7,"span"),w.jc(8,"button",17),w.qc("click",(function(){return w.Lc(c),w.uc(2).beginNewFromJSON()})),w.jc(9,"mat-icon",18),w.Wc(10,"vertical_align_bottom"),w.ic(),w.ic(),w.jc(11,"button",19),w.qc("click",(function(){return w.Lc(c),w.uc(2).beginNewFromSRD()})),w.jc(12,"mat-icon",20),w.Wc(13,"scanner"),w.ic(),w.ic(),w.jc(14,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc(2).newLooseItem()})),w.jc(15,"mat-icon",21),w.Wc(16,"add"),w.ic(),w.ic(),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc(2);w.Rb(2),w.zc("ngForOf",n.pack.items)}}function we(e,t){if(1&e){var c=w.kc();w.jc(0,"div",13),w.jc(1,"mat-card"),w.jc(2,"p"),w.Wc(3,"Looks like this pack is empty."),w.ic(),w.jc(4,"button",23),w.qc("click",(function(){return w.Lc(c),w.uc(2).newLooseItem()})),w.Wc(5,"Make an Item"),w.ic(),w.jc(6,"button",17),w.qc("click",(function(){return w.Lc(c),w.uc(2).beginNewFromJSON()})),w.jc(7,"mat-icon",18),w.Wc(8,"vertical_align_bottom"),w.ic(),w.ic(),w.jc(9,"button",19),w.qc("click",(function(){return w.Lc(c),w.uc(2).beginNewFromSRD()})),w.jc(10,"mat-icon",20),w.Wc(11,"scanner"),w.ic(),w.ic(),w.ic(),w.ic()}}var ye=function(e,t){return{name:e,icon_url:t}},Ce=function(e){return{name:"Description",value:e}},Me=function(e){return[e]},Oe=function(){return{text:"Homebrew content.",icon_url:"../../../../assets/img/homebrew.png"}};function Se(e,t){if(1&e&&w.ec(0,"avr-discord-embed",24),2&e){var c=w.uc(2);w.zc("author",w.Ec(6,ye,c.user.username,c.user.avatarUrl))("title",c.selectedItem.name)("description",c.selectedItem.meta)("fields",w.Dc(11,Me,w.Dc(9,Ce,c.selectedItem.desc)))("thumbnail",c.selectedItem.image)("footer",w.Cc(13,Oe))}}function Le(e,t){if(1&e&&w.ec(0,"avr-discord-embed",25),2&e){var c=w.uc(2);w.zc("author",w.Ec(2,ye,c.user.username,c.user.avatarUrl))("footer",w.Cc(5,Oe))}}function We(e,t){if(1&e){var c=w.kc();w.jc(0,"div"),w.jc(1,"mat-toolbar",1),w.jc(2,"span"),w.jc(3,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().back()})),w.jc(4,"mat-icon",3),w.Wc(5,"arrow_back"),w.ic(),w.ic(),w.ic(),w.jc(6,"span"),w.Wc(7),w.ic(),w.ec(8,"span",4),w.jc(9,"span"),w.jc(10,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().commit()})),w.jc(11,"mat-icon",5),w.Wc(12,"save"),w.ic(),w.ic(),w.jc(13,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().beginSettings()})),w.jc(14,"mat-icon",6),w.Wc(15,"settings"),w.ic(),w.ic(),w.jc(16,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().beginShare()})),w.jc(17,"mat-icon",7),w.Wc(18,"launch"),w.ic(),w.ic(),w.ic(),w.ic(),w.jc(19,"div",8),w.Vc(20,ke,17,1,"div",9),w.Vc(21,we,12,0,"div",9),w.jc(22,"div",10),w.Vc(23,Se,1,14,"avr-discord-embed",11),w.Vc(24,Le,1,6,"avr-discord-embed",12),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(7),w.Yc(" ",n.pack.name," "),w.Rb(13),w.zc("ngIf",n.pack.items.length),w.Rb(1),w.zc("ngIf",!n.pack.items.length),w.Rb(2),w.zc("ngIf",n.selectedItem),w.Rb(1),w.zc("ngIf",!n.selectedItem)}}function xe(e,t){1&e&&(w.jc(0,"div"),w.jc(1,"div",26),w.jc(2,"mat-card"),w.ec(3,"mat-spinner",27),w.ic(),w.ic(),w.ic()),2&e&&(w.Rb(3),w.zc("diameter",24))}function Ie(e,t){if(1&e){var c=w.kc();w.jc(0,"div"),w.jc(1,"div",26),w.jc(2,"mat-card"),w.jc(3,"p"),w.Wc(4,"You do not have permission to edit this pack."),w.ic(),w.jc(5,"button",23),w.qc("click",(function(){return w.Lc(c),w.uc().back()})),w.Wc(6,"Go Back"),w.ic(),w.ic(),w.ic(),w.ic()}}var Re=function(){function t(e,c,n,a,o,l,r){i(this,t),this.route=e,this.homebrewService=c,this.dashboardService=n,this.location=a,this.dialog=o,this.router=l,this.snackBar=r,this.user=Object(j.d)(),this.changesOpen=!1}return o(t,[{key:"ngOnInit",value:function(){this.getPack()}},{key:"ngOnDestroy",value:function(){this.snackBar.dismiss()}},{key:"getPack",value:function(){var e=this,t=this.route.snapshot.paramMap.get("pack");this.homebrewService.getPack(t).subscribe((function(t){e.pack=t,e.calcCanEdit()}))}},{key:"calcCanEdit",value:function(){var e=this;if(this.pack&&this.user)if(this.isOwner=this.user.id===this.pack.owner,this.isOwner)this.canEdit=!0;else{var t=this.pack._id.$oid;this.homebrewService.getPackEditors(t).subscribe((function(t){return e.canEdit=t.some((function(t){return t===e.user.id}))}))}}},{key:"newLooseItem",value:function(){this.pack.items.push(new q),this.ensureChangesNotif()}},{key:"deleteItem",value:function(e){this.pack.items=this.pack.items.filter((function(t){return t!==e})),this.ensureChangesNotif()}},{key:"ensureChangesNotif",value:function(){var e=this;this.changesOpen||(this.changesOpen=!0,this.snackBar.open("You have unsaved changes!","Save",{duration:-1,horizontalPosition:"right"}).onAction().subscribe((function(){e.commit()})))}},{key:"beginShare",value:function(){var e=this;this.dialog.open(B,{data:this.pack,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),e.pack=Object.assign(e.pack,t),e.commit())}))}},{key:"beginSettings",value:function(){var e=this;this.dialog.open(ue,{data:this.pack,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),t.delete?e.delete():(e.pack=Object.assign(e.pack,t),e.commit()))}))}},{key:"beginNewFromJSON",value:function(){var t=this,c=this.dialog.open(ie.a,{width:"60%",disableClose:!0,data:{validator:function(e){return t.validatePackJSON(c,e)}}});c.afterClosed().subscribe((function(c){if(c){var n,i=c;console.log(i),i instanceof Array?(n=t.pack.items).push.apply(n,e(i)):t.pack.items.push(i),t.ensureChangesNotif()}}))}},{key:"beginNewFromSRD",value:function(){var e=this;this.dialog.open(ae.a,{width:"60%",disableClose:!0,data:{getter:function(){return e.homebrewService.getTemplateItems()},namer:function(e){return e.name}}}).afterClosed().subscribe((function(t){t&&(e.pack.items.push(t),e.ensureChangesNotif())}))}},{key:"packIsValid",value:function(e){var t=this;return e instanceof Array?Boolean(e.length)&&e.every((function(e){return t.objectIsItem(e)})):!!e&&this.objectIsItem(e)}},{key:"validatePackJSON",value:function(e,t){e.componentInstance.loading=!1,this.packIsValid(t)?e.close(JSON.parse(e.componentInstance.data)):e.componentInstance.error="Invalid pack data"}},{key:"objectIsItem",value:function(e){return _.every((function(t){return t in e}))}},{key:"commit",value:function(){var e=this;this.homebrewService.putPack(this.pack).subscribe((function(t){console.log(t),e.changesOpen=!1,e.snackBar.open("".concat(t,' Use "!pack ').concat(e.pack.name,'" to activate the pack in Discord!'),null,{horizontalPosition:"right"})}))}},{key:"delete",value:function(){var e=this;this.homebrewService.deletePack(this.pack).subscribe((function(t){console.log(t),e.router.navigate(["../"],{relativeTo:e.route})}))}},{key:"back",value:function(){this.location.back()}},{key:"moveUp",value:function(e){var t=this.pack.items.indexOf(e),c=t-1;c>-1&&(Object(ne.a)(this.pack.items,t,c),this.ensureChangesNotif())}},{key:"moveDown",value:function(e){var t=this.pack.items.indexOf(e),c=t+1;c<this.pack.items.length&&(Object(ne.a)(this.pack.items,t,c),this.ensureChangesNotif())}}]),t}();Re.\u0275fac=function(e){return new(e||Re)(w.dc(f.a),w.dc(O),w.dc(oe.a),w.dc(l.n),w.dc(S.b),w.dc(f.b),w.dc(de.b))},Re.\u0275cmp=w.Xb({type:Re,selectors:[["avr-pack-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["color","primary",1,"pack-toolbar"],["mat-icon-button","",3,"click"],["aria-label","Back"],[1,"toolbar-spacer"],["aria-label","Save"],["aria-label","Settings"],["aria-label","Share"],["fxLayout","row","fxLayoutGap","8px",1,"container"],["class","item-list","fxFlex","grow",4,"ngIf"],["fxFlex","grow",1,"item-preview","mat-typography","mat-elevation-z3"],[3,"author","title","description","fields","thumbnail","footer",4,"ngIf"],["title","No item selected.","description","Click on an item on the left to see a preview!",3,"author","footer",4,"ngIf"],["fxFlex","grow",1,"item-list"],[3,"item","isFirst","isLast","moveUp","moveDown","changed","opened","delete",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"new-item-card"],[1,"no-text-cursor"],["mat-icon-button","","matTooltip","Import from JSON",3,"click"],["aria-label","Import from JSON"],["mat-icon-button","","matTooltip","Copy SRD item",3,"click"],["aria-label","From existing item"],["aria-label","New"],[3,"item","isFirst","isLast","moveUp","moveDown","changed","opened","delete"],["mat-raised-button","","color","accent",3,"click"],[3,"author","title","description","fields","thumbnail","footer"],["title","No item selected.","description","Click on an item on the left to see a preview!",3,"author","footer"],[1,"container"],[3,"diameter"]],template:function(e,t){1&e&&(w.Vc(0,We,25,5,"div",0),w.Vc(1,xe,4,1,"div",0),w.Vc(2,Ie,7,0,"div",0)),2&e&&(w.zc("ngIf",t.pack&&null!=t.canEdit),w.Rb(1),w.zc("ngIf",!t.pack),w.Rb(1),w.zc("ngIf",t.pack&&!t.canEdit))},directives:[l.t,G.a,I.b,D.a,H.f,H.g,H.b,N.a,l.s,Z.a,H.e,E.a,be,ve.a,V.c],styles:[".pack-toolbar[_ngcontent-%COMP%]{height:64px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.item-list[_ngcontent-%COMP%], .item-preview[_ngcontent-%COMP%]{max-height:calc(100vh - 192px);overflow-y:auto}.container[_ngcontent-%COMP%]{margin:8px}.new-item-card[_ngcontent-%COMP%]{height:48px;padding:0 24px}.no-text-cursor[_ngcontent-%COMP%]{cursor:default}"]});var ze=function(e,t,c,n){return{name:e,public:t,image:c,desc:n}},_e=function(){function e(){i(this,e),this.public=!1,this.desc="",this.image=""}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();_e.\u0275fac=function(e){return new(e||_e)},_e.\u0275cmp=w.Xb({type:_e,selectors:[["avr-new-pack-dialog"]],decls:19,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],[1,"mat-small"],["mat-button","","mat-dialog-close","","tabindex","1"],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(e,t){1&e&&(w.jc(0,"h2",0),w.Wc(1,"New Tome..."),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"div",2),w.jc(4,"mat-form-field"),w.jc(5,"input",3),w.qc("ngModelChange",(function(e){return t.name=e})),w.ic(),w.ic(),w.jc(6,"mat-slide-toggle",4),w.qc("ngModelChange",(function(e){return t.public=e})),w.Wc(7,"Allow public to view"),w.ic(),w.jc(8,"mat-form-field"),w.jc(9,"input",5),w.qc("ngModelChange",(function(e){return t.image=e})),w.ic(),w.ic(),w.jc(10,"mat-form-field"),w.jc(11,"textarea",6),w.qc("ngModelChange",(function(e){return t.desc=e})),w.ic(),w.ic(),w.ic(),w.jc(12,"p",7),w.Wc(13," These settings can be changed at any time. "),w.ic(),w.ic(),w.jc(14,"mat-dialog-actions"),w.jc(15,"button",8),w.Wc(16,"Cancel"),w.ic(),w.jc(17,"button",9),w.Wc(18," Create "),w.ic(),w.ic()),2&e&&(w.Rb(5),w.zc("ngModel",t.name),w.Rb(1),w.zc("ngModel",t.public),w.Rb(3),w.zc("ngModel",t.image),w.Rb(2),w.zc("ngModel",t.desc),w.Rb(6),w.zc("mat-dialog-close",w.Gc(6,ze,t.name,t.public,t.image,t.desc))("disabled",!t.name))},directives:[S.i,S.f,L.c,W.a,s.c,s.n,s.q,x.a,S.c,I.b,S.d],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var qe=a("jgxE"),Pe=function(){function e(t){i(this,e),this.data=t,this.generateMD(this.data.data)}return o(e,[{key:"ngOnInit",value:function(){}},{key:"generateMD",value:function(e){var c="";c+="".concat("# "+e.name,"\n").concat(e.desc||"","\n\n");var n,i=t(e.spells);try{for(i.s();!(n=i.n()).done;){var a=n.value;c+=this.generateSpellMD(a)}}catch(o){i.e(o)}finally{i.f()}c=c.replace("\n","\n  "),this.mdData=c}},{key:"generateSpellMD",value:function(e){var t="#### "+e.name,c=e.level?"".concat(Object(qe.d)(e.level)," ").concat(Object(qe.e)(e.school)):"".concat(Object(qe.e)(e.school)," ").concat(Object(qe.d)(e.level)),n="- **Casting Time:** ".concat(e.casttime+(e.ritual?" (ritual)":""),"\n- **Range:** ").concat(e.range,"\n- **Components:** ").concat(Object(qe.c)(e),"\n- **Duration:** ").concat((e.concentration?"Concentration, up to ":"")+e.duration),i=e.description;return e.higherlevels&&(i="".concat(i,"\n\n**At Higher Levels:** ").concat(e.higherlevels)),"".concat(t,"\n*").concat(c,"*\n___\n").concat(n,"\n\n").concat(i,"\n\n")}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}}]),e}();function Ee(e,t){if(1&e){var c=w.kc();w.jc(0,"mat-form-field"),w.ec(1,"input",9,10),w.jc(3,"button",11),w.qc("click",(function(){w.Lc(c);var e=w.Ic(2);return w.uc().copy(e)})),w.jc(4,"mat-icon"),w.Wc(5,"file_copy"),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(1),w.zc("value",n.shareLink)}}function De(e,t){if(1&e&&(w.jc(0,"mat-list-item"),w.Wc(1),w.vc(2,"async"),w.ic()),2&e){var c,n=t.$implicit;w.Rb(1),w.Xc(null==(c=w.wc(2,1,n))?null:c.username)}}function Te(e,t){if(1&e&&(w.jc(0,"mat-list"),w.Vc(1,De,3,3,"mat-list-item",12),w.ic()),2&e){var c=w.uc();w.Rb(1),w.zc("ngForOf",c.editors)}}function Ne(e,t){if(1&e){var c=w.kc();w.jc(0,"div",13),w.jc(1,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().beginJSONExport()})),w.Wc(2,"Export to JSON "),w.ic(),w.jc(3,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().beginMDExport()})),w.Wc(4,"Export to Homebrewery "),w.ic(),w.ic()}}function Fe(e,t){1&e&&(w.jc(0,"div"),w.ec(1,"mat-spinner",15),w.ic()),2&e&&(w.Rb(1),w.zc("diameter",24))}Pe.\u0275fac=function(e){return new(e||Pe)(w.dc(S.a))},Pe.\u0275cmp=w.Xb({type:Pe,selectors:[["avr-tome-markdown-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","readonly","","placeholder","Markdown","rows","10",3,"value"],["mdElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(e,t){if(1&e){var c=w.kc();w.jc(0,"h2",0),w.Wc(1),w.ic(),w.Wc(2,"\n"),w.jc(3,"mat-dialog-content",1),w.Wc(4,"\n  "),w.jc(5,"div",2),w.Wc(6,"\n    "),w.jc(7,"mat-form-field"),w.Wc(8,"\n      "),w.ec(9,"textarea",3,4),w.Wc(11,"\n      "),w.jc(12,"button",5),w.qc("click",(function(){w.Lc(c);var e=w.Ic(10);return t.copy(e)})),w.Wc(13,"\n        "),w.jc(14,"mat-icon"),w.Wc(15,"file_copy"),w.ic(),w.Wc(16,"\n      "),w.ic(),w.Wc(17,"\n    "),w.ic(),w.Wc(18,"\n  "),w.ic(),w.Wc(19,"\n"),w.ic(),w.Wc(20,"\n"),w.jc(21,"mat-dialog-actions"),w.Wc(22,"\n  "),w.jc(23,"button",6),w.Wc(24,"Done"),w.ic(),w.Wc(25,"\n"),w.ic(),w.Wc(26,"\n")}2&e&&(w.Rb(1),w.Yc("Markdown - ",t.data.name,""),w.Rb(8),w.zc("value",t.mdData))},directives:[S.i,S.f,L.c,W.a,I.b,L.j,E.a,D.a,S.c,S.d],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var Ve=function(e){return{public:e}},Ue=function(){function e(t,c,n,a){i(this,e),this.data=t,this.dialog=c,this.hbService=n,this.discord=a,this.public=t.public,this.shareLink="https://avrae.io/homebrew/spells/"+t._id.$oid,this.loaded=void 0!==t.spells}return o(e,[{key:"ngOnInit",value:function(){this.owner=this.discord.getUser(this.data.owner),this.loadEditors(),this.loaded||this.loadSpells()}},{key:"loadEditors",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getTomeEditors(t).subscribe((function(t){var c=[];t.forEach((function(t){return c.push(e.discord.getUser(t))})),e.editors=c}))}},{key:"loadSpells",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getTome(t).subscribe((function(t){e.data=t,e.loaded=!0}))}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}},{key:"beginJSONExport",value:function(){this.dialog.open(P.a,{data:{name:this.data.name,data:this.data.spells},width:"60%"})}},{key:"beginMDExport",value:function(){this.dialog.open(Pe,{data:{name:this.data.name,data:this.data},width:"60%"})}}]),e}();function Ae(e,t){if(1&e&&(w.jc(0,"mat-card-content"),w.jc(1,"p"),w.Wc(2),w.ic(),w.ic()),2&e){var c=w.uc().$implicit;w.Rb(2),w.Yc(" ",c.desc," ")}}function Je(e,t){if(1&e){var c=w.kc();w.jc(0,"div",8),w.jc(1,"mat-card"),w.jc(2,"mat-card-header"),w.jc(3,"mat-card-title"),w.Wc(4),w.ic(),w.jc(5,"mat-card-subtitle"),w.Wc(6),w.ic(),w.ic(),w.ec(7,"img",9),w.Vc(8,Ae,3,1,"mat-card-content",10),w.jc(9,"mat-card-actions"),w.jc(10,"a",11),w.Wc(11,"EDIT"),w.ic(),w.jc(12,"button",12),w.qc("click",(function(){w.Lc(c);var e=t.$implicit;return w.uc(2).beginShare(e)})),w.Wc(13,"SHARE"),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n,i=t.$implicit,a=w.uc(2);w.Rb(4),w.Xc(i.name),w.Rb(2),w.Zc("By ",(null==(n=a.owners.get(i.owner))?null:n.username)||"loading..."," - ",i.numSpells," spells "),w.Rb(1),w.zc("src",i.image||"../../../../assets/img/tome.png",w.Nc),w.Rb(1),w.zc("ngIf",i.desc),w.Rb(2),w.Ac("routerLink",i._id.$oid)}}function Xe(e,t){if(1&e&&(w.jc(0,"div",6),w.Vc(1,Je,14,6,"div",7),w.ic()),2&e){var c=w.uc();w.Rb(1),w.zc("ngForOf",c.tomes)}}function $e(e,t){if(1&e){var c=w.kc();w.jc(0,"div",13),w.jc(1,"mat-card"),w.jc(2,"p"),w.Wc(3,"Looks like you don't have any tomes yet."),w.ic(),w.jc(4,"button",14),w.qc("click",(function(){return w.Lc(c),w.uc().beginNew()})),w.Wc(5,"Create One"),w.ic(),w.ic(),w.ic()}}Ue.\u0275fac=function(e){return new(e||Ue)(w.dc(S.a),w.dc(S.b),w.dc(O),w.dc(h.a))},Ue.\u0275cmp=w.Xb({type:Ue,selectors:[["avr-pack-share-dialog"]],decls:31,vars:12,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],[3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"mat-elevation-z0"],["class","button-row",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["matInput","","readonly","","placeholder","View Link",3,"value"],["shareLinkElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],[4,"ngFor","ngForOf"],[1,"button-row"],["mat-raised-button","","color","primary",3,"click"],[3,"diameter"]],template:function(e,t){var c;(1&e&&(w.jc(0,"h2",0),w.Wc(1),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"div",2),w.jc(4,"p"),w.Wc(5),w.vc(6,"async"),w.ic(),w.jc(7,"mat-slide-toggle",3),w.qc("ngModelChange",(function(e){return t.public=e})),w.Wc(8,"Allow public to view"),w.ic(),w.Vc(9,Ee,6,1,"mat-form-field",4),w.jc(10,"mat-expansion-panel",5),w.jc(11,"mat-expansion-panel-header"),w.jc(12,"mat-panel-title"),w.Wc(13," Editors "),w.ic(),w.ic(),w.jc(14,"p"),w.Wc(15,"To add or remove an editor, run the command "),w.jc(16,"kbd"),w.Wc(17,"!tome editor @user"),w.ic(),w.Wc(18," in Discord!"),w.ic(),w.Vc(19,Te,2,1,"mat-list",4),w.ic(),w.jc(20,"mat-expansion-panel",5),w.jc(21,"mat-expansion-panel-header"),w.jc(22,"mat-panel-title"),w.Wc(23," Export "),w.ic(),w.ic(),w.Vc(24,Ne,5,0,"div",6),w.Vc(25,Fe,2,1,"div",4),w.ic(),w.ic(),w.ic(),w.jc(26,"mat-dialog-actions"),w.jc(27,"button",7),w.Wc(28,"Cancel"),w.ic(),w.jc(29,"button",8),w.Wc(30," Done "),w.ic(),w.ic()),2&e)&&(w.Rb(1),w.Yc("Share ",t.data.name,""),w.Rb(4),w.Yc(" Owner: ",null==(c=w.wc(6,8,t.owner))?null:c.username," "),w.Rb(2),w.zc("ngModel",t.public),w.Rb(2),w.zc("ngIf",t.public),w.Rb(10),w.zc("ngIf",null==t.editors?null:t.editors.length),w.Rb(5),w.zc("ngIf",t.loaded),w.Rb(1),w.zc("ngIf",!t.loaded),w.Rb(4),w.zc("mat-dialog-close",w.Dc(10,Ve,t.public)))},directives:[S.i,S.f,x.a,s.n,s.q,l.t,N.c,N.g,N.h,S.c,I.b,S.d,L.c,W.a,L.j,E.a,D.a,F.a,l.s,F.d,V.c],pipes:[l.b],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.button-row[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:4px}"]});var Ye=function(){function e(t,c,n,a,o){i(this,e),this.homebrewService=t,this.discord=c,this.dialog=n,this.router=a,this.route=o,this.owners=new Map}return o(e,[{key:"ngOnInit",value:function(){this.getTomes()}},{key:"getTomes",value:function(){var e=this;this.homebrewService.getUserTomes().subscribe((function(c){e.tomes=c;var n,i=new Set,a=t(c);try{var o=function(){var t=n.value;i.has(t.owner)||(i.add(t.owner),e.discord.getUser(t.owner).subscribe((function(c){return e.owners.set(t.owner,c)})))};for(a.s();!(n=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}}))}},{key:"beginNew",value:function(){var e=this;this.dialog.open(_e,{width:"60%",disableClose:!0}).afterClosed().subscribe((function(t){if(t){var c={name:t.name,public:t.public,desc:t.desc,image:t.image};e.new(c)}}))}},{key:"beginShare",value:function(e){var t=this;this.dialog.open(Ue,{data:e,width:"40%",disableClose:!0}).afterClosed().subscribe((function(c){c&&(console.log(c),e=Object.assign(e,c),t.commit(e))}))}},{key:"new",value:function(e){var t=this;this.homebrewService.newTome(e).subscribe((function(e){e.success&&t.router.navigate([e.tomeId],{relativeTo:t.route})}))}},{key:"commit",value:function(e){this.homebrewService.putTome(e).subscribe((function(e){console.log(e)}))}}]),e}();Ye.\u0275fac=function(e){return new(e||Ye)(w.dc(O),w.dc(h.a),w.dc(S.b),w.dc(f.b),w.dc(f.a))},Ye.\u0275cmp=w.Xb({type:Ye,selectors:[["avr-spells"]],decls:10,vars:2,consts:[["color","primary",1,"mat-elevation-z2"],[1,"toolbar-spacer"],["mat-icon-button","",3,"click"],["aria-label","New Tome"],["class","container","fxLayout","row wrap","fxLayoutAlign","space-around",4,"ngIf"],["class","container",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","space-around",1,"container"],["class","tome-tile","fxFlex","32%",4,"ngFor","ngForOf"],["fxFlex","32%",1,"tome-tile"],["mat-card-image","","alt","Tome Image",3,"src"],[4,"ngIf"],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],[1,"container"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(w.jc(0,"mat-toolbar",0),w.jc(1,"span"),w.Wc(2,"Your Tomes"),w.ic(),w.ec(3,"span",1),w.jc(4,"span"),w.jc(5,"button",2),w.qc("click",(function(){return t.beginNew()})),w.jc(6,"mat-icon",3),w.Wc(7,"add"),w.ic(),w.ic(),w.ic(),w.ic(),w.Vc(8,Xe,2,1,"div",4),w.Vc(9,$e,6,0,"div",5)),2&e&&(w.Rb(8),w.zc("ngIf",t.tomes&&t.tomes.length),w.Rb(1),w.zc("ngIf",t.tomes&&!t.tomes.length))},directives:[G.a,I.b,D.a,l.t,H.f,H.e,l.s,H.b,Z.a,Z.f,Z.m,Z.l,Z.g,Z.b,I.a,f.c,Z.d],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%], .pack-tile[_ngcontent-%COMP%]{margin:4px}"]});var Be=function(){function e(t){i(this,e),this.data=t}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();function Ge(e,t){if(1&e){var c=w.kc();w.jc(0,"button",9),w.qc("click",(function(){return w.Lc(c),w.uc().beginDelete()})),w.Wc(1,"Delete"),w.ic()}}Be.\u0275fac=function(e){return new(e||Be)(w.dc(S.a))},Be.\u0275cmp=w.Xb({type:Be,selectors:[["avr-tome-delete-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["mat-button","","mat-dialog-close",""],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(e,t){1&e&&(w.jc(0,"h2",0),w.Wc(1),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"p"),w.Wc(4),w.jc(5,"b"),w.Wc(6,"This cannot be undone."),w.ic(),w.ic(),w.ic(),w.jc(7,"mat-dialog-actions"),w.jc(8,"button",2),w.Wc(9,"Cancel"),w.ic(),w.jc(10,"button",3),w.Wc(11," Delete "),w.ic(),w.ic()),2&e&&(w.Rb(1),w.Yc("Deleting ",t.data.name,"..."),w.Rb(3),w.Yc(" Are you sure you want to delete ",t.data.name,"? This will remove the tome from all editors' libraries, and invalidate any sharing links. "),w.Rb(6),w.zc("mat-dialog-close",!0))},directives:[S.i,S.f,S.c,I.b,S.d],encapsulation:2});var He=function(e,t,c){return{name:e,image:t,desc:c}},Ze=function(){function e(t,c,n){i(this,e),this.data=t,this.dialog=c,this.dialogRef=n,this.name=t.name,this.image=t.image,this.desc=t.desc,this.isOwner=Object(j.d)().id===t.owner}return o(e,[{key:"ngOnInit",value:function(){}},{key:"beginDelete",value:function(){var e=this;this.dialog.open(Be,{data:this.data,width:"40%"}).afterClosed().subscribe((function(t){t&&e.dialogRef.close({delete:!0})}))}}]),e}();Ze.\u0275fac=function(e){return new(e||Ze)(w.dc(S.a),w.dc(S.b),w.dc(S.h))},Ze.\u0275cmp=w.Xb({type:Ze,selectors:[["avr-tome-options-dialog"]],decls:16,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(w.jc(0,"h2",0),w.Wc(1),w.ic(),w.jc(2,"mat-dialog-content",1),w.jc(3,"div",2),w.jc(4,"mat-form-field"),w.jc(5,"input",3),w.qc("ngModelChange",(function(e){return t.name=e})),w.ic(),w.ic(),w.jc(6,"mat-form-field"),w.jc(7,"input",4),w.qc("ngModelChange",(function(e){return t.image=e})),w.ic(),w.ic(),w.jc(8,"mat-form-field"),w.jc(9,"textarea",5),w.qc("ngModelChange",(function(e){return t.desc=e})),w.ic(),w.ic(),w.ic(),w.ic(),w.jc(10,"mat-dialog-actions"),w.jc(11,"button",6),w.Wc(12,"Cancel"),w.ic(),w.jc(13,"button",7),w.Wc(14," Save "),w.ic(),w.Vc(15,Ge,2,0,"button",8),w.ic()),2&e&&(w.Rb(1),w.Xc(t.data.name),w.Rb(4),w.zc("ngModel",t.name),w.Rb(2),w.zc("ngModel",t.image),w.Rb(2),w.zc("ngModel",t.desc),w.Rb(4),w.zc("mat-dialog-close",w.Fc(7,He,t.name,t.image,t.desc))("disabled",!t.name),w.Rb(2),w.zc("ngIf",t.isOwner))},directives:[S.i,S.f,L.c,W.a,s.c,s.n,s.q,S.c,I.b,S.d,l.t],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var Ke=a("wZkO"),Qe=(a("rHON"),a("5w/X")),et=function(){function e(){i(this,e)}return o(e,[{key:"genDesc",value:function(){this.description=this.level?"".concat(Object(qe.d)(this.level)," ").concat(Object(qe.e)(this.school)):"".concat(Object(qe.e)(this.school)," ").concat(Object(qe.d)(this.level))}},{key:"ngOnInit",value:function(){this.genDesc()}},{key:"ngOnChanges",value:function(e){this.genDesc()}}]),e}();et.\u0275fac=function(e){return new(e||et)},et.\u0275cmp=w.Xb({type:et,selectors:[["avr-spell-panel-description"]],inputs:{level:"level",school:"school"},features:[w.Pb],decls:2,vars:1,template:function(e,t){1&e&&(w.jc(0,"mat-panel-description"),w.Wc(1),w.ic()),2&e&&(w.Rb(1),w.Xc(t.description))},directives:[N.f],encapsulation:2});var tt=a("d3UM"),ct=a("FKr1"),nt=a("bSwM");function it(e,t){if(1&e){var c=w.kc();w.jc(0,"mat-form-field",5),w.jc(1,"input",34),w.qc("change",(function(){return w.Lc(c),w.uc(2).emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc(2).spell.image=e})),w.ic(),w.ic()}if(2&e){var n=w.uc(2);w.Rb(1),w.zc("ngModel",n.spell.image)}}function at(e,t){if(1&e){var c=w.kc();w.jc(0,"mat-select",9),w.qc("valueChange",(function(e){return w.Lc(c),w.uc(2).spell.school=e}))("selectionChange",(function(){return w.Lc(c),w.uc(2).emitChange()})),w.jc(1,"mat-option",35),w.Wc(2,"Abjuration"),w.ic(),w.jc(3,"mat-option",36),w.Wc(4,"Conjuration"),w.ic(),w.jc(5,"mat-option",37),w.Wc(6,"Divination"),w.ic(),w.jc(7,"mat-option",38),w.Wc(8,"Enchantment"),w.ic(),w.jc(9,"mat-option",39),w.Wc(10,"Evocation"),w.ic(),w.jc(11,"mat-option",40),w.Wc(12,"Illusion"),w.ic(),w.jc(13,"mat-option",41),w.Wc(14,"Necromancy"),w.ic(),w.jc(15,"mat-option",42),w.Wc(16,"Transmutation"),w.ic(),w.jc(17,"mat-option",43),w.qc("click",(function(){return w.Lc(c),w.uc(2).customSpellSchool=!0})),w.Wc(18,"Custom"),w.ic(),w.ic()}if(2&e){var n=w.uc(2);w.zc("value",n.spell.school)}}function ot(e,t){if(1&e){var c=w.kc();w.jc(0,"input",44),w.qc("change",(function(){return w.Lc(c),w.uc(2).emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc(2).spell.school=e})),w.ic()}if(2&e){var n=w.uc(2);w.zc("ngModel",n.spell.school)}}function lt(e,t){if(1&e){var c=w.kc();w.jc(0,"button",45),w.qc("click",(function(){return w.Lc(c),w.uc(2).customSpellSchool=!1})),w.jc(1,"mat-icon"),w.Wc(2,"remove_circle_outline"),w.ic(),w.ic()}}function rt(e,t){if(1&e){var c=w.kc();w.jc(0,"span",5),w.jc(1,"button",46),w.qc("click",(function(){w.Lc(c);var e=w.uc(2);return e.spell.image="",e.emitChange()})),w.jc(2,"mat-icon",47),w.Wc(3,"add_photo_alternate"),w.ic(),w.ic(),w.ic()}}function st(e,t){if(1&e){var c=w.kc();w.jc(0,"span",5),w.jc(1,"button",48),w.qc("click",(function(){return w.Lc(c),w.uc(2).moveUp.emit()})),w.jc(2,"mat-icon",49),w.Wc(3,"arrow_upward"),w.ic(),w.ic(),w.ic()}}function ut(e,t){if(1&e){var c=w.kc();w.jc(0,"span",5),w.jc(1,"button",50),w.qc("click",(function(){return w.Lc(c),w.uc(2).moveDown.emit()})),w.jc(2,"mat-icon",51),w.Wc(3,"arrow_downward"),w.ic(),w.ic(),w.ic()}}function dt(e,t){if(1&e){var c=w.kc();w.jc(0,"div",3),w.jc(1,"div",4),w.jc(2,"mat-form-field",5),w.jc(3,"input",6),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.name=e})),w.ic(),w.ic(),w.Vc(4,it,2,1,"mat-form-field",7),w.ic(),w.jc(5,"div",8),w.jc(6,"mat-form-field",5),w.jc(7,"mat-label"),w.Wc(8,"Level"),w.ic(),w.jc(9,"mat-select",9),w.qc("valueChange",(function(e){return w.Lc(c),w.uc().spell.level=e}))("selectionChange",(function(){return w.Lc(c),w.uc().emitChange()})),w.jc(10,"mat-option",10),w.Wc(11,"Cantrip"),w.ic(),w.jc(12,"mat-option",10),w.Wc(13,"1st Level"),w.ic(),w.jc(14,"mat-option",10),w.Wc(15,"2nd Level"),w.ic(),w.jc(16,"mat-option",10),w.Wc(17,"3rd Level"),w.ic(),w.jc(18,"mat-option",10),w.Wc(19,"4th Level"),w.ic(),w.jc(20,"mat-option",10),w.Wc(21,"5th Level"),w.ic(),w.jc(22,"mat-option",10),w.Wc(23,"6th Level"),w.ic(),w.jc(24,"mat-option",10),w.Wc(25,"7th Level"),w.ic(),w.jc(26,"mat-option",10),w.Wc(27,"8th Level"),w.ic(),w.jc(28,"mat-option",10),w.Wc(29,"9th Level"),w.ic(),w.ic(),w.ic(),w.jc(30,"mat-form-field",5),w.jc(31,"mat-label"),w.Wc(32,"School"),w.ic(),w.Vc(33,at,19,1,"mat-select",11),w.Vc(34,ot,1,1,"input",12),w.Vc(35,lt,3,0,"button",13),w.ic(),w.jc(36,"mat-checkbox",14),w.qc("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.ritual=e}))("change",(function(){return w.Lc(c),w.uc().emitChange()})),w.Wc(37,"Ritual"),w.ic(),w.ic(),w.jc(38,"div",15),w.jc(39,"mat-form-field",5),w.jc(40,"input",16),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.casttime=e})),w.ic(),w.ic(),w.jc(41,"mat-form-field",5),w.jc(42,"input",17),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.range=e})),w.ic(),w.ic(),w.ic(),w.jc(43,"div",8),w.jc(44,"mat-checkbox",14),w.qc("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.components.verbal=e}))("change",(function(){return w.Lc(c),w.uc().emitChange()})),w.Wc(45," Verbal "),w.ic(),w.jc(46,"mat-checkbox",14),w.qc("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.components.somatic=e}))("change",(function(){return w.Lc(c),w.uc().emitChange()})),w.Wc(47," Somatic "),w.ic(),w.jc(48,"mat-form-field",5),w.jc(49,"input",18),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.components.material=e})),w.ic(),w.ic(),w.ic(),w.jc(50,"div",8),w.jc(51,"mat-form-field",5),w.jc(52,"input",19),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.duration=e})),w.ic(),w.ic(),w.jc(53,"mat-checkbox",14),w.qc("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.concentration=e}))("change",(function(){return w.Lc(c),w.uc().emitChange()})),w.Wc(54," Concentration "),w.ic(),w.ic(),w.jc(55,"mat-form-field"),w.jc(56,"textarea",20),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.description=e})),w.ic(),w.ic(),w.jc(57,"mat-form-field"),w.jc(58,"textarea",21),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.higherlevels=e})),w.ic(),w.ic(),w.jc(59,"div",15),w.jc(60,"mat-form-field",22),w.jc(61,"input",23),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.classes=e})),w.ic(),w.ic(),w.jc(62,"mat-form-field",24),w.jc(63,"input",25),w.qc("change",(function(){return w.Lc(c),w.uc().emitChange()}))("ngModelChange",(function(e){return w.Lc(c),w.uc().spell.subclasses=e})),w.ic(),w.ic(),w.ic(),w.ic(),w.jc(64,"div",26),w.Vc(65,rt,4,0,"span",7),w.jc(66,"span",5),w.jc(67,"button",27),w.qc("click",(function(){return w.Lc(c),w.uc().beginJSONExport()})),w.jc(68,"mat-icon",28),w.Wc(69,"vertical_align_top"),w.ic(),w.ic(),w.ic(),w.jc(70,"span",5),w.jc(71,"button",29),w.qc("click",(function(){return w.Lc(c),w.uc().moveToEditor.emit()})),w.jc(72,"mat-icon",30),w.Wc(73,"build"),w.ic(),w.ic(),w.ic(),w.Vc(74,st,4,0,"span",7),w.Vc(75,ut,4,0,"span",7),w.ec(76,"span",31),w.jc(77,"span",5),w.jc(78,"button",32),w.qc("click",(function(){return w.Lc(c),w.uc().delete.emit()})),w.jc(79,"mat-icon",33),w.Wc(80,"delete"),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(3),w.zc("ngModel",n.spell.name),w.Rb(1),w.zc("ngIf",null!=n.spell.image),w.Rb(5),w.zc("value",n.spell.level),w.Rb(1),w.zc("value",0),w.Rb(2),w.zc("value",1),w.Rb(2),w.zc("value",2),w.Rb(2),w.zc("value",3),w.Rb(2),w.zc("value",4),w.Rb(2),w.zc("value",5),w.Rb(2),w.zc("value",6),w.Rb(2),w.zc("value",7),w.Rb(2),w.zc("value",8),w.Rb(2),w.zc("value",9),w.Rb(5),w.zc("ngIf",!n.customSpellSchool),w.Rb(1),w.zc("ngIf",n.customSpellSchool),w.Rb(1),w.zc("ngIf",n.customSpellSchool),w.Rb(1),w.zc("ngModel",n.spell.ritual),w.Rb(4),w.zc("ngModel",n.spell.casttime),w.Rb(2),w.zc("ngModel",n.spell.range),w.Rb(2),w.zc("ngModel",n.spell.components.verbal),w.Rb(2),w.zc("ngModel",n.spell.components.somatic),w.Rb(3),w.zc("ngModel",n.spell.components.material),w.Rb(3),w.zc("ngModel",n.spell.duration),w.Rb(1),w.zc("ngModel",n.spell.concentration),w.Rb(3),w.zc("ngModel",n.spell.description),w.Rb(2),w.zc("ngModel",n.spell.higherlevels),w.Rb(3),w.zc("ngModel",n.spell.classes),w.Rb(2),w.zc("ngModel",n.spell.subclasses),w.Rb(2),w.zc("ngIf",void 0===n.spell.image),w.Rb(9),w.zc("ngIf",!n.isFirst),w.Rb(1),w.zc("ngIf",!n.isLast)}}var mt=function(){function e(t){i(this,e),this.dialog=t,this.moveUp=new w.u,this.moveDown=new w.u,this.changed=new w.u,this.opened=new w.u,this.delete=new w.u,this.moveToEditor=new w.u}return o(e,[{key:"ngOnInit",value:function(){this.customSpellSchool=!qe.a.includes(this.spell.school)}},{key:"emitChange",value:function(){this.changed.emit()}},{key:"beginJSONExport",value:function(){this.dialog.open(P.a,{data:{name:this.spell.name,data:this.spell},width:"60%"})}}]),e}();function pt(e,t){if(1&e){var c=w.kc();w.jc(0,"avr-spell-detail",15),w.qc("moveUp",(function(){w.Lc(c);var e=t.$implicit;return w.uc(2).moveUp(e)}))("moveDown",(function(){w.Lc(c);var e=t.$implicit;return w.uc(2).moveDown(e)}))("changed",(function(){return w.Lc(c),w.uc(2).changed.emit()}))("opened",(function(){w.Lc(c);var e=t.$implicit,n=w.uc(2);return n.selectedSpell=e,n.selected.emit(e)}))("delete",(function(){w.Lc(c);var e=t.$implicit;return w.uc(2).deleteSpell(e)}))("moveToEditor",(function(){return w.Lc(c),w.uc(2).moveToEditor.emit()})),w.ic()}if(2&e){var n=t.$implicit,i=t.first,a=t.last;w.zc("spell",n)("isFirst",i)("isLast",a)}}function gt(e,t){if(1&e){var c=w.kc();w.jc(0,"div",4),w.jc(1,"mat-accordion"),w.Vc(2,pt,1,3,"avr-spell-detail",5),w.jc(3,"mat-card",6),w.jc(4,"span",7),w.Wc(5,"New..."),w.ic(),w.ec(6,"span",8),w.jc(7,"span"),w.jc(8,"button",9),w.qc("click",(function(){return w.Lc(c),w.uc().newFromJSON()})),w.jc(9,"mat-icon",10),w.Wc(10,"vertical_align_bottom"),w.ic(),w.ic(),w.jc(11,"button",11),w.qc("click",(function(){return w.Lc(c),w.uc().newFromSRD()})),w.jc(12,"mat-icon",12),w.Wc(13,"scanner"),w.ic(),w.ic(),w.jc(14,"button",13),w.qc("click",(function(){return w.Lc(c),w.uc().newSpell()})),w.jc(15,"mat-icon",14),w.Wc(16,"add"),w.ic(),w.ic(),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(2),w.zc("ngForOf",n.tome.spells)}}function ft(e,t){if(1&e){var c=w.kc();w.jc(0,"div",4),w.jc(1,"mat-card"),w.jc(2,"p"),w.Wc(3,"Looks like this tome is empty."),w.ic(),w.jc(4,"button",16),w.qc("click",(function(){return w.Lc(c),w.uc().newSpell()})),w.Wc(5,"Make a Spell"),w.ic(),w.jc(6,"button",9),w.qc("click",(function(){return w.Lc(c),w.uc().newFromJSON()})),w.jc(7,"mat-icon",10),w.Wc(8,"vertical_align_bottom"),w.ic(),w.ic(),w.jc(9,"button",11),w.qc("click",(function(){return w.Lc(c),w.uc().newFromSRD()})),w.jc(10,"mat-icon",12),w.Wc(11,"scanner"),w.ic(),w.ic(),w.ic(),w.ic()}}mt.\u0275fac=function(e){return new(e||mt)(w.dc(S.b))},mt.\u0275cmp=w.Xb({type:mt,selectors:[["avr-spell-detail"]],inputs:{spell:"spell",isFirst:"isFirst",isLast:"isLast"},outputs:{moveUp:"moveUp",moveDown:"moveDown",changed:"changed",opened:"opened",delete:"delete",moveToEditor:"moveToEditor"},decls:7,vars:3,consts:[[3,"opened"],[3,"level","school"],["matExpansionPanelContent",""],[1,"form-container"],["fxLayout","row","fxLayoutGap","4px"],["fxFlex",""],["matInput","","placeholder","Name",3,"ngModel","change","ngModelChange"],["fxFlex","",4,"ngIf"],["fxLayout","row","fxLayoutGap","6px","fxLayoutAlign","center center"],[3,"value","valueChange","selectionChange"],[3,"value"],[3,"value","valueChange","selectionChange",4,"ngIf"],["matInput","","placeholder","School",3,"ngModel","change","ngModelChange",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltip","Delete custom school",3,"click",4,"ngIf"],["fxFlex","nogrow",3,"ngModel","ngModelChange","change"],["fxLayout","row","fxLayoutGap","6px"],["matInput","","placeholder","Casting Time",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Range",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Material",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Duration",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Description","rows","7",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","At Higher Levels","rows","3",3,"ngModel","change","ngModelChange"],["fxFlex","","matTooltip","Separate classes with commas."],["matInput","","placeholder","Classes",3,"ngModel","change","ngModelChange"],["fxFlex","","matTooltip","Separate subclasses with commas."],["matInput","","placeholder","Subclasses",3,"ngModel","change","ngModelChange"],["fxLayout","row",1,"actions"],["mat-icon-button","","matTooltip","Export to JSON",3,"click"],["aria-label","Export to JSON"],["mat-icon-button","","matTooltip","Edit Automation",3,"click"],["aria-label","Edit Automation"],["fxFlex","grow"],["mat-icon-button","","color","warn",3,"click"],["aria-label","Delete"],["matInput","","placeholder","Image URL",3,"ngModel","change","ngModelChange"],["value","A"],["value","C"],["value","D"],["value","E"],["value","V"],["value","I"],["value","N"],["value","T"],["value","Custom",3,"click"],["matInput","","placeholder","School",3,"ngModel","change","ngModelChange"],["mat-icon-button","","matSuffix","","matTooltip","Delete custom school",3,"click"],["mat-icon-button","","matTooltip","Add image",3,"click"],["aria-label","Add image"],["mat-icon-button","","matTooltip","Move Up",3,"click"],["aria-label","Move Up"],["mat-icon-button","","matTooltip","Move Down",3,"click"],["aria-label","Move Down"]],template:function(e,t){1&e&&(w.jc(0,"mat-expansion-panel",0),w.qc("opened",(function(){return t.opened.emit()})),w.jc(1,"mat-expansion-panel-header"),w.jc(2,"mat-panel-title"),w.jc(3,"div"),w.Wc(4),w.ic(),w.ic(),w.ec(5,"avr-spell-panel-description",1),w.ic(),w.Vc(6,dt,81,31,"ng-template",2),w.ic()),2&e&&(w.Rb(4),w.Yc(" ",t.spell.name," "),w.Rb(1),w.zc("level",t.spell.level)("school",t.spell.school))},directives:[N.c,N.g,N.h,et,N.e,H.f,H.g,L.c,H.b,W.a,s.c,s.n,s.q,l.t,H.e,L.g,tt.a,ct.j,nt.a,E.a,I.b,D.a,L.j],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}mat-panel-title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:auto 0}"]});var ht=function(){function t(e,c){i(this,t),this.dialog=e,this.hbService=c,this.selected=new w.u,this.changed=new w.u,this.moveToEditor=new w.u}return o(t,[{key:"ngOnInit",value:function(){}},{key:"newSpell",value:function(){this.tome.spells.push(new qe.b),this.changed.emit()}},{key:"newFromJSON",value:function(){var t=this,c=this.dialog.open(ie.a,{width:"60%",disableClose:!0,data:{validator:function(e){return t.validateSpellJSON(c,e)}}});c.afterClosed().subscribe((function(c){if(c){var n,i=c;console.log(i),i instanceof Array?(n=t.tome.spells).push.apply(n,e(i)):t.tome.spells.push(i),t.changed.emit()}}))}},{key:"newFromSRD",value:function(){var e=this;this.dialog.open(ae.a,{width:"60%",disableClose:!0,data:{getter:function(){return e.hbService.getTemplateSpells()},namer:function(e){return e.name}}}).afterClosed().subscribe((function(t){t&&(e.tome.spells.push(t),e.changed.emit())}))}},{key:"deleteSpell",value:function(e){this.tome.spells=this.tome.spells.filter((function(t){return t!==e})),this.changed.emit()}},{key:"validateSpellJSON",value:function(e,t){var c=this;this.hbService.validateSpellJSON(t).subscribe((function(t){return c.onValidationReply(e,t)}))}},{key:"onValidationReply",value:function(e,t){console.log(t),e.componentInstance.loading=!1,t.success?e.close(JSON.parse(e.componentInstance.data)):e.componentInstance.error=t.result}},{key:"moveUp",value:function(e){var t=this.tome.spells.indexOf(e),c=t-1;c>-1&&(Object(ne.a)(this.tome.spells,t,c),this.changed.emit())}},{key:"moveDown",value:function(e){var t=this.tome.spells.indexOf(e),c=t+1;c<this.tome.spells.length&&(Object(ne.a)(this.tome.spells,t,c),this.changed.emit())}}]),t}();ht.\u0275fac=function(e){return new(e||ht)(w.dc(S.b),w.dc(O))},ht.\u0275cmp=w.Xb({type:ht,selectors:[["avr-spell-list"]],inputs:{tome:"tome",user:"user"},outputs:{selected:"selected",changed:"changed",moveToEditor:"moveToEditor"},decls:5,vars:19,consts:[["fxLayout","row","fxLayoutGap","8px",1,"container"],["class","spell-list","fxFlex","grow",4,"ngIf"],["fxFlex","grow",1,"spell-preview","mat-typography","mat-elevation-z3"],[3,"name","image","level","school","classes","subclasses","verbal","somatic","material","time","ritual","range","concentration","duration","description","higherlevels","user"],["fxFlex","grow",1,"spell-list"],[3,"spell","isFirst","isLast","moveUp","moveDown","changed","opened","delete","moveToEditor",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"new-spell-card"],[1,"no-text-cursor"],[1,"toolbar-spacer"],["mat-icon-button","","matTooltip","Import from JSON",3,"click"],["aria-label","Import from JSON"],["mat-icon-button","","matTooltip","Copy SRD spell",3,"click"],["aria-label","From existing spell"],["mat-icon-button","",3,"click"],["aria-label","New"],[3,"spell","isFirst","isLast","moveUp","moveDown","changed","opened","delete","moveToEditor"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(w.jc(0,"div",0),w.Vc(1,gt,17,1,"div",1),w.Vc(2,ft,12,0,"div",1),w.jc(3,"div",2),w.ec(4,"avr-spell-embed",3),w.ic(),w.ic()),2&e&&(w.Rb(1),w.zc("ngIf",t.tome.spells.length),w.Rb(1),w.zc("ngIf",!t.tome.spells.length),w.Rb(2),w.zc("name",null==t.selectedSpell?null:t.selectedSpell.name)("image",null==t.selectedSpell?null:t.selectedSpell.image)("level",null==t.selectedSpell?null:t.selectedSpell.level)("school",null==t.selectedSpell?null:t.selectedSpell.school)("classes",null==t.selectedSpell?null:t.selectedSpell.classes)("subclasses",null==t.selectedSpell?null:t.selectedSpell.subclasses)("verbal",null==t.selectedSpell?null:t.selectedSpell.components.verbal)("somatic",null==t.selectedSpell?null:t.selectedSpell.components.somatic)("material",null==t.selectedSpell?null:t.selectedSpell.components.material)("time",null==t.selectedSpell?null:t.selectedSpell.casttime)("ritual",null==t.selectedSpell?null:t.selectedSpell.ritual)("range",null==t.selectedSpell?null:t.selectedSpell.range)("concentration",null==t.selectedSpell?null:t.selectedSpell.concentration)("duration",null==t.selectedSpell?null:t.selectedSpell.duration)("description",null==t.selectedSpell?null:t.selectedSpell.description)("higherlevels",null==t.selectedSpell?null:t.selectedSpell.higherlevels)("user",t.user))},directives:[H.f,H.g,l.t,H.b,Qe.a,N.a,l.s,Z.a,H.e,I.b,E.a,D.a,mt],styles:[".container[_ngcontent-%COMP%]{margin:8px}.spell-list[_ngcontent-%COMP%], .spell-preview[_ngcontent-%COMP%]{max-height:calc(100vh - 240px);overflow-y:auto}.new-spell-card[_ngcontent-%COMP%]{height:48px;padding:0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]});var bt=a("UgTo");function vt(e,t){if(1&e){var c=w.kc();w.jc(0,"div",1),w.jc(1,"mat-card"),w.jc(2,"p"),w.Wc(3),w.ic(),w.jc(4,"p"),w.Wc(5,"You can find help on how to use the spell editor "),w.jc(6,"a",2),w.Wc(7,"here"),w.ic(),w.Wc(8,"."),w.ic(),w.jc(9,"avr-automation-editor",3),w.qc("changed",(function(){return w.Lc(c),w.uc().changed.emit()})),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(3),w.Yc("Editing ",n.spell.name,"..."),w.Rb(6),w.zc("automation",n.getAutomation(n.spell))("spell",n.spell)}}function jt(e,t){1&e&&(w.jc(0,"div",1),w.jc(1,"mat-card"),w.jc(2,"p"),w.Wc(3," No spell selected. "),w.ic(),w.ic(),w.ic())}var kt=function(){function e(){i(this,e),this.changed=new w.u}return o(e,[{key:"ngOnInit",value:function(){}},{key:"getAutomation",value:function(e){return null===e.automation&&(e.automation=[]),e.automation}}]),e}();function wt(e,t){if(1&e){var c=w.kc();w.jc(0,"div"),w.jc(1,"mat-toolbar",1),w.jc(2,"span"),w.jc(3,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().back()})),w.jc(4,"mat-icon",3),w.Wc(5,"arrow_back"),w.ic(),w.ic(),w.ic(),w.jc(6,"span"),w.Wc(7),w.ic(),w.ec(8,"span",4),w.jc(9,"span"),w.jc(10,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().commit()})),w.jc(11,"mat-icon",5),w.Wc(12,"save"),w.ic(),w.ic(),w.jc(13,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().beginSettings()})),w.jc(14,"mat-icon",6),w.Wc(15,"settings"),w.ic(),w.ic(),w.jc(16,"button",2),w.qc("click",(function(){return w.Lc(c),w.uc().beginShare()})),w.jc(17,"mat-icon",7),w.Wc(18,"launch"),w.ic(),w.ic(),w.ic(),w.ic(),w.jc(19,"mat-tab-group",8,9),w.jc(21,"mat-tab",10),w.jc(22,"avr-spell-list",11),w.qc("selected",(function(e){return w.Lc(c),w.uc().selectedSpell=e}))("changed",(function(){return w.Lc(c),w.uc().ensureChangesNotif()}))("moveToEditor",(function(){return w.Lc(c),w.Ic(20).selectedIndex=1})),w.ic(),w.ic(),w.jc(23,"mat-tab",12),w.jc(24,"avr-spell-editor",13),w.qc("changed",(function(){return w.Lc(c),w.uc().ensureChangesNotif()})),w.ic(),w.ic(),w.ic(),w.ic()}if(2&e){var n=w.uc();w.Rb(7),w.Yc(" ",n.tome.name," "),w.Rb(15),w.zc("tome",n.tome)("user",n.user),w.Rb(2),w.zc("spell",n.selectedSpell)}}function yt(e,t){1&e&&(w.jc(0,"div"),w.jc(1,"div",14),w.jc(2,"mat-card"),w.ec(3,"mat-spinner",15),w.ic(),w.ic(),w.ic()),2&e&&(w.Rb(3),w.zc("diameter",24))}function Ct(e,t){if(1&e){var c=w.kc();w.jc(0,"div"),w.jc(1,"div",14),w.jc(2,"mat-card"),w.jc(3,"p"),w.Wc(4,"You do not have permission to edit this tome."),w.ic(),w.jc(5,"button",16),w.qc("click",(function(){return w.Lc(c),w.uc().back()})),w.Wc(6,"Go Back"),w.ic(),w.ic(),w.ic(),w.ic()}}kt.\u0275fac=function(e){return new(e||kt)},kt.\u0275cmp=w.Xb({type:kt,selectors:[["avr-spell-editor"]],inputs:{spell:"spell"},outputs:{changed:"changed"},decls:2,vars:2,consts:[["class","container",4,"ngIf"],[1,"container"],["target","_blank","href","https://avrae.readthedocs.io/en/latest/automation_ref.html"],[3,"automation","spell","changed"]],template:function(e,t){1&e&&(w.Vc(0,vt,10,3,"div",0),w.Vc(1,jt,4,0,"div",0)),2&e&&(w.zc("ngIf",t.spell),w.Rb(1),w.zc("ngIf",!t.spell))},directives:[l.t,Z.a,bt.a],styles:[".container[_ngcontent-%COMP%]{margin:8px}"]});var Mt=function(){function e(t,c,n,a,o,l,r){i(this,e),this.route=t,this.homebrewService=c,this.dashboardService=n,this.location=a,this.dialog=o,this.router=l,this.snackBar=r,this.user=Object(j.d)(),this.changesOpen=!1}return o(e,[{key:"ngOnInit",value:function(){this.getTome()}},{key:"ngOnDestroy",value:function(){this.snackBar.dismiss()}},{key:"getTome",value:function(){var e=this,t=this.route.snapshot.paramMap.get("tome");this.homebrewService.getTome(t).subscribe((function(t){e.tome=t,e.calcCanEdit()}))}},{key:"calcCanEdit",value:function(){var e=this;if(this.tome&&this.user)if(this.isOwner=this.user.id===this.tome.owner,this.isOwner)this.canEdit=!0;else{var t=this.tome._id.$oid;this.homebrewService.getTomeEditors(t).subscribe((function(t){return e.canEdit=t.some((function(t){return t===e.user.id}))}))}}},{key:"ensureChangesNotif",value:function(){var e=this;this.changesOpen||(this.changesOpen=!0,this.snackBar.open("You have unsaved changes!","Save",{duration:-1,horizontalPosition:"right"}).onAction().subscribe((function(){e.commit()})))}},{key:"beginShare",value:function(){var e=this;this.dialog.open(Ue,{data:this.tome,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),e.tome=Object.assign(e.tome,t),e.commit())}))}},{key:"beginSettings",value:function(){var e=this;this.dialog.open(Ze,{data:this.tome,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),t.delete?e.delete():(e.tome=Object.assign(e.tome,t),e.commit()))}))}},{key:"commit",value:function(){var e=this;this.homebrewService.putTome(this.tome).subscribe((function(t){console.log(t),e.changesOpen=!1,e.snackBar.open("".concat(t,' Use "!tome ').concat(e.tome.name,'" to activate the tome in Discord!'),null,{horizontalPosition:"right"})}))}},{key:"delete",value:function(){var e=this;this.homebrewService.deleteTome(this.tome).subscribe((function(t){console.log(t),e.router.navigate(["../"],{relativeTo:e.route})}))}},{key:"back",value:function(){this.location.back()}}]),e}();Mt.\u0275fac=function(e){return new(e||Mt)(w.dc(f.a),w.dc(O),w.dc(oe.a),w.dc(l.n),w.dc(S.b),w.dc(f.b),w.dc(de.b))},Mt.\u0275cmp=w.Xb({type:Mt,selectors:[["avr-tome-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["color","primary",1,"tome-toolbar"],["mat-icon-button","",3,"click"],["aria-label","Back"],[1,"toolbar-spacer"],["aria-label","Save"],["aria-label","Settings"],["aria-label","Share"],["backgroundColor","primary"],["tabGroup",""],["label","Spells"],[3,"tome","user","selected","changed","moveToEditor"],["label","Editor"],[3,"spell","changed"],[1,"container"],[3,"diameter"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(w.Vc(0,wt,25,4,"div",0),w.Vc(1,yt,4,1,"div",0),w.Vc(2,Ct,7,0,"div",0)),2&e&&(w.zc("ngIf",t.tome&&null!=t.canEdit),w.Rb(1),w.zc("ngIf",!t.tome),w.Rb(1),w.zc("ngIf",t.tome&&!t.canEdit))},directives:[l.t,G.a,I.b,D.a,Ke.c,Ke.a,ht,kt,Z.a,V.c],styles:[".tome-toolbar[_ngcontent-%COMP%]{height:64px}mat-tab-header[_ngcontent-%COMP%]{height:48px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.no-text-cursor[_ngcontent-%COMP%]{cursor:default}"]});var Ot=[{path:"",children:[{path:"items",component:ce},{path:"items/:pack",component:Re},{path:"spells",component:Ye},{path:"spells/:tome",component:Mt}]}],St=function e(){i(this,e)};St.\u0275mod=w.bc({type:St}),St.\u0275inj=w.ac({factory:function(e){return new(e||St)},imports:[[f.d.forChild(Ot)],f.d]});var Lt=function e(){i(this,e)};Lt.\u0275mod=w.bc({type:Lt}),Lt.\u0275inj=w.ac({factory:function(e){return new(e||Lt)},imports:[[l.c,d.a,s.h,r.a,u.b.forChild(),p.a,m.a,g.a,St]]})}}])}();
//# sourceMappingURL=11-es5.64da3686316aa9b40b4e.js.map