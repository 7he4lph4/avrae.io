!function(){function e(e){return function(e){if(Array.isArray(e))return n(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||c(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=c(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,r=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return l=e.done,e},e:function(e){r=!0,o=e},f:function(){try{l||null==n.return||n.return()}finally{if(r)throw o}}}}function c(e,t){if(e){if("string"==typeof e)return n(e,t);var c=Object.prototype.toString.call(e).slice(8,-1);return"Object"===c&&e.constructor&&(c=e.constructor.name),"Map"===c||"Set"===c?Array.from(e):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?n(e,t):void 0}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var c=0,n=new Array(t);c<t;c++)n[c]=e[c];return n}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var c=0;c<t.length;c++){var n=t[c];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,c){return t&&a(e.prototype,t),c&&a(e,c),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{XljO:function(c,n,a){"use strict";a.r(n),a.d(n,"HomebrewModule",(function(){return St}));var l=a("ofXK"),r=a("YUcS"),s=a("3Pt+"),u=a("lR5k"),d=a("hctd"),m=a("WVau"),p=a("bVJ3"),g=a("6B8D"),f=a("tyNb"),h=a("97Gz"),v=a("AytR"),b=a("LRne"),j=a("2xJ4"),k=a("JIr8"),M=a("fXoL"),w=a("tk/3"),y=v.a.apiURL+"/homebrew/items",C=v.a.apiURL+"/homebrew/spells",X=function(){function e(t){i(this,e),this.http=t}return o(e,[{key:"getUserPacks",value:function(){return this.http.get(y+"/me",Object(j.b)())}},{key:"newPack",value:function(e){return this.http.post(""+y,e,Object(j.b)()).pipe(Object(k.a)(this.handleError("newPack")))}},{key:"getPack",value:function(e){return this.http.get("".concat(y,"/").concat(e),Object(j.b)())}},{key:"putPack",value:function(e){return this.http.put("".concat(y,"/").concat(e._id.$oid),e,Object(j.c)()).pipe(Object(k.a)(this.handleError("putPack")))}},{key:"deletePack",value:function(e){return this.http.delete("".concat(y,"/").concat(e._id.$oid),Object(j.c)()).pipe(Object(k.a)(this.handleError("deletePack")))}},{key:"getPackEditors",value:function(e){return this.http.get("".concat(y,"/").concat(e,"/editors"),Object(j.b)())}},{key:"getTemplateItems",value:function(){return this.http.get(y+"/srd",Object(j.b)())}},{key:"getUserTomes",value:function(){return this.http.get(C+"/me",Object(j.b)())}},{key:"newTome",value:function(e){return this.http.post(""+C,e,Object(j.b)()).pipe(Object(k.a)(this.handleError("newTome")))}},{key:"getTome",value:function(e){return this.http.get("".concat(C,"/").concat(e),Object(j.b)())}},{key:"putTome",value:function(e){return this.http.put("".concat(C,"/").concat(e._id.$oid),e,Object(j.c)()).pipe(Object(k.a)(this.handleError("putTome")))}},{key:"deleteTome",value:function(e){return this.http.delete("".concat(C,"/").concat(e._id.$oid),Object(j.c)()).pipe(Object(k.a)(this.handleError("deleteTome")))}},{key:"getTomeEditors",value:function(e){return this.http.get("".concat(C,"/").concat(e,"/editors"),Object(j.b)())}},{key:"getTemplateSpells",value:function(){return this.http.get(C+"/srd",Object(j.b)())}},{key:"validateSpellJSON",value:function(e){return this.http.post(C+"/validate",e,Object(j.b)()).pipe(Object(k.a)((function(e){return Object(b.a)({success:!1,result:e.error})})))}},{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"operation";return function(t){return console.error(t),Object(b.a)({error:"".concat(e," failed: ").concat(t.error),success:!1})}}}]),e}();X.\u0275fac=function(e){return new(e||X)(M.nc(w.b))},X.\u0275prov=M.Zb({token:X,factory:X.\u0275fac,providedIn:"root"});var O=a("0IaG"),S=a("kmnG"),x=a("qFsG"),I=a("1jcm"),R=a("bTqV"),A=function(e,t,c,n){return{name:e,public:t,image:c,desc:n}},_=function(){function e(){i(this,e),this.public=!1,this.desc="",this.image=""}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();_.\u0275fac=function(e){return new(e||_)},_.\u0275cmp=M.Xb({type:_,selectors:[["avr-new-pack-dialog"]],decls:19,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],[1,"mat-small"],["mat-button","","mat-dialog-close","","tabindex","1"],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(e,t){1&e&&(M.jc(0,"h2",0),M.Xc(1,"New Pack..."),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"div",2),M.jc(4,"mat-form-field"),M.jc(5,"input",3),M.rc("ngModelChange",(function(e){return t.name=e})),M.ic(),M.ic(),M.jc(6,"mat-slide-toggle",4),M.rc("ngModelChange",(function(e){return t.public=e})),M.Xc(7,"Allow public to view"),M.ic(),M.jc(8,"mat-form-field"),M.jc(9,"input",5),M.rc("ngModelChange",(function(e){return t.image=e})),M.ic(),M.ic(),M.jc(10,"mat-form-field"),M.jc(11,"textarea",6),M.rc("ngModelChange",(function(e){return t.desc=e})),M.ic(),M.ic(),M.ic(),M.jc(12,"p",7),M.Xc(13," These settings can be changed at any time. "),M.ic(),M.ic(),M.jc(14,"mat-dialog-actions"),M.jc(15,"button",8),M.Xc(16,"Cancel"),M.ic(),M.jc(17,"button",9),M.Xc(18," Create "),M.ic(),M.ic()),2&e&&(M.Rb(5),M.Ac("ngModel",t.name),M.Rb(1),M.Ac("ngModel",t.public),M.Rb(3),M.Ac("ngModel",t.image),M.Rb(2),M.Ac("ngModel",t.desc),M.Rb(6),M.Ac("mat-dialog-close",M.Hc(6,A,t.name,t.public,t.image,t.desc))("disabled",!t.name))},directives:[O.i,O.f,S.c,x.a,s.c,s.n,s.q,I.a,O.c,R.b,O.d],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var P=["name"],E=function e(){i(this,e),this.name="New Item",this.meta="",this.desc=""},D=a("hMdP"),T=a("Qu3c"),L=a("NFeN"),N=function(){function e(t){i(this,e),this.data=t,this.generateMD(this.data.data)}return o(e,[{key:"ngOnInit",value:function(){}},{key:"generateMD",value:function(e){var c="";c+="".concat("# "+e.name,"\n").concat(e.desc||"","\n\n");var n,i=t(e.items);try{for(i.s();!(n=i.n()).done;){var a=n.value;c+="".concat("#### "+a.name,"\n").concat(a.meta,"\n___\n").concat(a.desc,"\n\n")}}catch(o){i.e(o)}finally{i.f()}c=c.replace("\n","\n  "),this.mdData=c}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}}]),e}();N.\u0275fac=function(e){return new(e||N)(M.dc(O.a))},N.\u0275cmp=M.Xb({type:N,selectors:[["avr-pack-markdown-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","readonly","","placeholder","Markdown","rows","10",3,"value"],["mdElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(e,t){if(1&e){var c=M.kc();M.jc(0,"h2",0),M.Xc(1),M.ic(),M.Xc(2,"\n"),M.jc(3,"mat-dialog-content",1),M.Xc(4,"\n  "),M.jc(5,"div",2),M.Xc(6,"\n    "),M.jc(7,"mat-form-field"),M.Xc(8,"\n      "),M.ec(9,"textarea",3,4),M.Xc(11,"\n      "),M.jc(12,"button",5),M.rc("click",(function(){M.Mc(c);var e=M.Jc(10);return t.copy(e)})),M.Xc(13,"\n        "),M.jc(14,"mat-icon"),M.Xc(15,"file_copy"),M.ic(),M.Xc(16,"\n      "),M.ic(),M.Xc(17,"\n    "),M.ic(),M.Xc(18,"\n  "),M.ic(),M.Xc(19,"\n"),M.ic(),M.Xc(20,"\n"),M.jc(21,"mat-dialog-actions"),M.Xc(22,"\n  "),M.jc(23,"button",6),M.Xc(24,"Done"),M.ic(),M.Xc(25,"\n"),M.ic(),M.Xc(26,"\n")}2&e&&(M.Rb(1),M.Zc("Markdown - ",t.data.name,""),M.Rb(8),M.Ac("value",t.mdData))},directives:[O.i,O.f,S.c,x.a,R.b,S.j,T.a,L.a,O.c,O.d],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var F=a("7EHt"),W=a("MutI"),U=a("Xa2L");function J(e,t){if(1&e){var c=M.kc();M.jc(0,"mat-form-field"),M.ec(1,"input",9,10),M.jc(3,"button",11),M.rc("click",(function(){M.Mc(c);var e=M.Jc(2);return M.vc().copy(e)})),M.jc(4,"mat-icon"),M.Xc(5,"file_copy"),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(1),M.Ac("value",n.shareLink)}}function $(e,t){if(1&e&&(M.jc(0,"mat-list-item"),M.Xc(1),M.wc(2,"async"),M.ic()),2&e){var c,n=t.$implicit;M.Rb(1),M.Yc(null==(c=M.xc(2,1,n))?null:c.username)}}function B(e,t){if(1&e&&(M.jc(0,"mat-list"),M.Wc(1,$,3,3,"mat-list-item",12),M.ic()),2&e){var c=M.vc();M.Rb(1),M.Ac("ngForOf",c.editors)}}function Z(e,t){if(1&e){var c=M.kc();M.jc(0,"div",13),M.jc(1,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().beginJSONExport()})),M.Xc(2,"Export to JSON "),M.ic(),M.jc(3,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().beginMDExport()})),M.Xc(4,"Export to Homebrewery "),M.ic(),M.ic()}}function G(e,t){1&e&&(M.jc(0,"div"),M.ec(1,"mat-spinner",15),M.ic()),2&e&&(M.Rb(1),M.Ac("diameter",24))}var Y=function(e){return{public:e}},q=function(){function e(t,c,n,a){i(this,e),this.data=t,this.dialog=c,this.hbService=n,this.discord=a,this.public=t.public,this.shareLink="https://avrae.io/homebrew/items/"+t._id.$oid,this.loaded=void 0!==t.items}return o(e,[{key:"ngOnInit",value:function(){this.owner=this.discord.getUser(this.data.owner),this.loadEditors(),this.loaded||this.loadItems()}},{key:"loadItems",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getPack(t).subscribe((function(t){e.data=t,e.loaded=!0}))}},{key:"loadEditors",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getPackEditors(t).subscribe((function(t){var c=[];t.forEach((function(t){return c.push(e.discord.getUser(t))})),e.editors=c}))}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}},{key:"beginJSONExport",value:function(){this.dialog.open(D.a,{data:{name:this.data.name,data:this.data.items},width:"60%"})}},{key:"beginMDExport",value:function(){this.dialog.open(N,{data:{name:this.data.name,data:this.data},width:"60%"})}}]),e}();q.\u0275fac=function(e){return new(e||q)(M.dc(O.a),M.dc(O.b),M.dc(X),M.dc(h.a))},q.\u0275cmp=M.Xb({type:q,selectors:[["avr-pack-share-dialog"]],decls:31,vars:12,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],[3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"mat-elevation-z0"],["class","button-row",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["matInput","","readonly","","placeholder","View Link",3,"value"],["shareLinkElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],[4,"ngFor","ngForOf"],[1,"button-row"],["mat-raised-button","","color","primary",3,"click"],[3,"diameter"]],template:function(e,t){var c;(1&e&&(M.jc(0,"h2",0),M.Xc(1),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"div",2),M.jc(4,"p"),M.Xc(5),M.wc(6,"async"),M.ic(),M.jc(7,"mat-slide-toggle",3),M.rc("ngModelChange",(function(e){return t.public=e})),M.Xc(8,"Allow public to view"),M.ic(),M.Wc(9,J,6,1,"mat-form-field",4),M.jc(10,"mat-expansion-panel",5),M.jc(11,"mat-expansion-panel-header"),M.jc(12,"mat-panel-title"),M.Xc(13," Editors "),M.ic(),M.ic(),M.jc(14,"p"),M.Xc(15,"To add or remove an editor, run the command "),M.jc(16,"kbd"),M.Xc(17,"!pack editor @user"),M.ic(),M.Xc(18," in Discord!"),M.ic(),M.Wc(19,B,2,1,"mat-list",4),M.ic(),M.jc(20,"mat-expansion-panel",5),M.jc(21,"mat-expansion-panel-header"),M.jc(22,"mat-panel-title"),M.Xc(23," Export "),M.ic(),M.ic(),M.Wc(24,Z,5,0,"div",6),M.Wc(25,G,2,1,"div",4),M.ic(),M.ic(),M.ic(),M.jc(26,"mat-dialog-actions"),M.jc(27,"button",7),M.Xc(28,"Cancel"),M.ic(),M.jc(29,"button",8),M.Xc(30," Done "),M.ic(),M.ic()),2&e)&&(M.Rb(1),M.Zc("Share ",t.data.name,""),M.Rb(4),M.Zc(" Owner: ",null==(c=M.xc(6,8,t.owner))?null:c.username," "),M.Rb(2),M.Ac("ngModel",t.public),M.Rb(2),M.Ac("ngIf",t.public),M.Rb(10),M.Ac("ngIf",null==t.editors?null:t.editors.length),M.Rb(5),M.Ac("ngIf",t.loaded),M.Rb(1),M.Ac("ngIf",!t.loaded),M.Rb(4),M.Ac("mat-dialog-close",M.Ec(10,Y,t.public)))},directives:[O.i,O.f,I.a,s.n,s.q,l.t,F.c,F.g,F.h,O.c,R.b,O.d,S.c,x.a,S.j,T.a,L.a,W.a,l.s,W.d,U.c],pipes:[l.b],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.button-row[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:4px}"]});var z=a("/t3+"),H=a("XiUz"),V=a("Wp6s");function K(e,t){if(1&e&&(M.jc(0,"mat-card-content"),M.jc(1,"p"),M.Xc(2),M.ic(),M.ic()),2&e){var c=M.vc().$implicit;M.Rb(2),M.Zc(" ",c.desc," ")}}function Q(e,t){if(1&e){var c=M.kc();M.jc(0,"div",8),M.jc(1,"mat-card"),M.jc(2,"mat-card-header"),M.jc(3,"mat-card-title"),M.Xc(4),M.ic(),M.jc(5,"mat-card-subtitle"),M.Xc(6),M.ic(),M.ic(),M.ec(7,"img",9),M.Wc(8,K,3,1,"mat-card-content",10),M.jc(9,"mat-card-actions"),M.jc(10,"a",11),M.Xc(11,"EDIT"),M.ic(),M.jc(12,"button",12),M.rc("click",(function(){M.Mc(c);var e=t.$implicit;return M.vc(2).beginShare(e)})),M.Xc(13,"SHARE"),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n,i=t.$implicit,a=M.vc(2);M.Rb(4),M.Yc(i.name),M.Rb(2),M.ad("By ",(null==(n=a.owners.get(i.owner))?null:n.username)||"loading..."," - ",i.numItems," items "),M.Rb(1),M.Ac("src",i.image||"../../../../assets/img/pack.png",M.Oc),M.Rb(1),M.Ac("ngIf",i.desc),M.Rb(2),M.Bc("routerLink",i._id.$oid)}}function ee(e,t){if(1&e&&(M.jc(0,"div",6),M.Wc(1,Q,14,6,"div",7),M.ic()),2&e){var c=M.vc();M.Rb(1),M.Ac("ngForOf",c.packs)}}function te(e,t){if(1&e){var c=M.kc();M.jc(0,"div",13),M.jc(1,"mat-card"),M.jc(2,"p"),M.Xc(3,"Looks like you don't have any packs yet."),M.ic(),M.jc(4,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().beginNew()})),M.Xc(5,"Create One"),M.ic(),M.ic(),M.ic()}}var ce=function(){function e(t,c,n,a,o){i(this,e),this.homebrewService=t,this.discord=c,this.dialog=n,this.router=a,this.route=o,this.owners=new Map}return o(e,[{key:"ngOnInit",value:function(){this.getPacks()}},{key:"getPacks",value:function(){var e=this;this.homebrewService.getUserPacks().subscribe((function(c){e.packs=c;var n,i=new Set,a=t(c);try{var o=function(){var t=n.value;i.has(t.owner)||(i.add(t.owner),e.discord.getUser(t.owner).subscribe((function(c){return e.owners.set(t.owner,c)})))};for(a.s();!(n=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}}))}},{key:"beginNew",value:function(){var e=this;this.dialog.open(_,{width:"60%",disableClose:!0}).afterClosed().subscribe((function(t){if(t){var c={name:t.name,public:t.public,desc:t.desc,image:t.image};e.new(c)}}))}},{key:"beginShare",value:function(e){var t=this;this.dialog.open(q,{data:e,width:"40%",disableClose:!0}).afterClosed().subscribe((function(c){c&&(console.log(c),e=Object.assign(e,c),t.commit(e))}))}},{key:"new",value:function(e){var t=this;this.homebrewService.newPack(e).subscribe((function(e){e.success&&t.router.navigate([e.packId],{relativeTo:t.route})}))}},{key:"commit",value:function(e){this.homebrewService.putPack(e).subscribe((function(e){console.log(e)}))}}]),e}();ce.\u0275fac=function(e){return new(e||ce)(M.dc(X),M.dc(h.a),M.dc(O.b),M.dc(f.b),M.dc(f.a))},ce.\u0275cmp=M.Xb({type:ce,selectors:[["avr-items"]],decls:10,vars:2,consts:[["color","primary",1,"mat-elevation-z2"],[1,"toolbar-spacer"],["mat-icon-button","",3,"click"],["aria-label","New Pack"],["class","container","fxLayout","row wrap","fxLayoutAlign","space-around",4,"ngIf"],["class","container",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","space-around",1,"container"],["class","pack-tile","fxFlex","32%",4,"ngFor","ngForOf"],["fxFlex","32%",1,"pack-tile"],["mat-card-image","","alt","Pack Image",3,"src"],[4,"ngIf"],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],[1,"container"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(M.jc(0,"mat-toolbar",0),M.jc(1,"span"),M.Xc(2,"Your Packs"),M.ic(),M.ec(3,"span",1),M.jc(4,"span"),M.jc(5,"button",2),M.rc("click",(function(){return t.beginNew()})),M.jc(6,"mat-icon",3),M.Xc(7,"add"),M.ic(),M.ic(),M.ic(),M.ic(),M.Wc(8,ee,2,1,"div",4),M.Wc(9,te,6,0,"div",5)),2&e&&(M.Rb(8),M.Ac("ngIf",t.packs&&t.packs.length),M.Rb(1),M.Ac("ngIf",t.packs&&!t.packs.length))},directives:[z.a,R.b,L.a,l.t,H.f,H.e,l.s,H.b,V.a,V.f,V.m,V.l,V.g,V.b,R.a,f.c,V.d],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%], .pack-tile[_ngcontent-%COMP%]{margin:4px}"]});var ne=a("5+WD"),ie=a("9qBq"),ae=a("XwxW"),oe=a("QAUA"),le=function(){function e(t){i(this,e),this.data=t}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();function re(e,t){if(1&e){var c=M.kc();M.jc(0,"button",9),M.rc("click",(function(){return M.Mc(c),M.vc().beginDelete()})),M.Xc(1,"Delete"),M.ic()}}le.\u0275fac=function(e){return new(e||le)(M.dc(O.a))},le.\u0275cmp=M.Xb({type:le,selectors:[["avr-pack-delete-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["mat-button","","mat-dialog-close",""],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(e,t){1&e&&(M.jc(0,"h2",0),M.Xc(1),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"p"),M.Xc(4),M.jc(5,"b"),M.Xc(6,"This cannot be undone."),M.ic(),M.ic(),M.ic(),M.jc(7,"mat-dialog-actions"),M.jc(8,"button",2),M.Xc(9,"Cancel"),M.ic(),M.jc(10,"button",3),M.Xc(11," Delete "),M.ic(),M.ic()),2&e&&(M.Rb(1),M.Zc("Deleting ",t.data.name,"..."),M.Rb(3),M.Zc(" Are you sure you want to delete ",t.data.name,"? This will remove the pack from all editors' libraries, and invalidate any sharing links. "),M.Rb(6),M.Ac("mat-dialog-close",!0))},directives:[O.i,O.f,O.c,R.b,O.d],styles:[""]});var se=function(e,t,c){return{name:e,image:t,desc:c}},ue=function(){function e(t,c,n){i(this,e),this.data=t,this.dialog=c,this.dialogRef=n,this.name=t.name,this.image=t.image,this.desc=t.desc,this.isOwner=Object(j.d)().id===t.owner}return o(e,[{key:"ngOnInit",value:function(){}},{key:"beginDelete",value:function(){var e=this;this.dialog.open(le,{data:this.data,width:"40%"}).afterClosed().subscribe((function(t){t&&e.dialogRef.close({delete:!0})}))}}]),e}();ue.\u0275fac=function(e){return new(e||ue)(M.dc(O.a),M.dc(O.b),M.dc(O.h))},ue.\u0275cmp=M.Xb({type:ue,selectors:[["avr-pack-options-dialog"]],decls:16,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(M.jc(0,"h2",0),M.Xc(1),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"div",2),M.jc(4,"mat-form-field"),M.jc(5,"input",3),M.rc("ngModelChange",(function(e){return t.name=e})),M.ic(),M.ic(),M.jc(6,"mat-form-field"),M.jc(7,"input",4),M.rc("ngModelChange",(function(e){return t.image=e})),M.ic(),M.ic(),M.jc(8,"mat-form-field"),M.jc(9,"textarea",5),M.rc("ngModelChange",(function(e){return t.desc=e})),M.ic(),M.ic(),M.ic(),M.ic(),M.jc(10,"mat-dialog-actions"),M.jc(11,"button",6),M.Xc(12,"Cancel"),M.ic(),M.jc(13,"button",7),M.Xc(14," Save "),M.ic(),M.Wc(15,re,2,0,"button",8),M.ic()),2&e&&(M.Rb(1),M.Yc(t.data.name),M.Rb(4),M.Ac("ngModel",t.name),M.Rb(2),M.Ac("ngModel",t.image),M.Rb(2),M.Ac("ngModel",t.desc),M.Rb(4),M.Ac("mat-dialog-close",M.Gc(7,se,t.name,t.image,t.desc))("disabled",!t.name),M.Rb(2),M.Ac("ngIf",t.isOwner))},directives:[O.i,O.f,S.c,x.a,s.c,s.n,s.q,O.c,R.b,O.d,l.t],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var de=a("dNgK");function me(e,t){if(1&e){var c=M.kc();M.jc(0,"mat-form-field",5),M.jc(1,"input",16),M.rc("change",(function(){return M.Mc(c),M.vc(2).emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc(2).item.image=e})),M.ic(),M.ic()}if(2&e){var n=M.vc(2);M.Rb(1),M.Ac("ngModel",n.item.image)}}function pe(e,t){if(1&e){var c=M.kc();M.jc(0,"span",5),M.jc(1,"button",17),M.rc("click",(function(){M.Mc(c);var e=M.vc(2);return e.item.image="",e.emitChange()})),M.jc(2,"mat-icon",18),M.Xc(3,"add_photo_alternate"),M.ic(),M.ic(),M.ic()}}function ge(e,t){if(1&e){var c=M.kc();M.jc(0,"span",5),M.jc(1,"button",19),M.rc("click",(function(){return M.Mc(c),M.vc(2).moveUp.emit()})),M.jc(2,"mat-icon",20),M.Xc(3,"arrow_upward"),M.ic(),M.ic(),M.ic()}}function fe(e,t){if(1&e){var c=M.kc();M.jc(0,"span",5),M.jc(1,"button",21),M.rc("click",(function(){return M.Mc(c),M.vc(2).moveDown.emit()})),M.jc(2,"mat-icon",22),M.Xc(3,"arrow_downward"),M.ic(),M.ic(),M.ic()}}function he(e,t){if(1&e){var c=M.kc();M.jc(0,"div",3),M.jc(1,"div",4),M.jc(2,"mat-form-field",5),M.jc(3,"input",6),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().item.name=e})),M.ic(),M.ic(),M.Wc(4,me,2,1,"mat-form-field",7),M.ic(),M.jc(5,"mat-form-field"),M.jc(6,"textarea",8),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().item.meta=e})),M.ic(),M.ic(),M.jc(7,"mat-form-field"),M.jc(8,"textarea",9),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().item.desc=e})),M.ic(),M.ic(),M.ic(),M.jc(9,"div",10),M.Wc(10,pe,4,0,"span",7),M.jc(11,"span",5),M.jc(12,"button",11),M.rc("click",(function(){return M.Mc(c),M.vc().beginJSONExport()})),M.jc(13,"mat-icon",12),M.Xc(14,"vertical_align_top"),M.ic(),M.ic(),M.ic(),M.Wc(15,ge,4,0,"span",7),M.Wc(16,fe,4,0,"span",7),M.ec(17,"span",13),M.jc(18,"span",5),M.jc(19,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().delete.emit()})),M.jc(20,"mat-icon",15),M.Xc(21,"delete"),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(3),M.Ac("ngModel",n.item.name),M.Rb(1),M.Ac("ngIf",null!=n.item.image),M.Rb(2),M.Ac("ngModel",n.item.meta),M.Rb(2),M.Ac("ngModel",n.item.desc),M.Rb(2),M.Ac("ngIf",void 0===n.item.image),M.Rb(5),M.Ac("ngIf",!n.isFirst),M.Rb(1),M.Ac("ngIf",!n.isLast)}}var ve=function(){function e(t){i(this,e),this.dialog=t,this.moveUp=new M.u,this.moveDown=new M.u,this.changed=new M.u,this.opened=new M.u,this.delete=new M.u}return o(e,[{key:"ngOnInit",value:function(){}},{key:"emitChange",value:function(){this.changed.emit()}},{key:"beginJSONExport",value:function(){this.dialog.open(D.a,{data:{name:this.item.name,data:this.item},width:"60%"})}}]),e}();ve.\u0275fac=function(e){return new(e||ve)(M.dc(O.b))},ve.\u0275cmp=M.Xb({type:ve,selectors:[["avr-item-detail"]],inputs:{item:"item",isFirst:"isFirst",isLast:"isLast"},outputs:{moveUp:"moveUp",moveDown:"moveDown",changed:"changed",opened:"opened",delete:"delete"},decls:7,vars:2,consts:[[3,"opened"],["markdown","",3,"data"],["matExpansionPanelContent",""],[1,"form-container"],["fxLayout","row","fxLayoutGap","4px"],["fxFlex",""],["matInput","","placeholder","Name",3,"ngModel","change","ngModelChange"],["fxFlex","",4,"ngIf"],["matInput","","placeholder","Meta","rows","3",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Description","rows","7",3,"ngModel","change","ngModelChange"],["fxLayout","row",1,"actions"],["mat-icon-button","","matTooltip","Export to JSON",3,"click"],["aria-label","Export to JSON"],["fxFlex","grow"],["mat-icon-button","","color","warn",3,"click"],["aria-label","Delete"],["matInput","","placeholder","Image URL",3,"ngModel","change","ngModelChange"],["mat-icon-button","","matTooltip","Add image",3,"click"],["aria-label","Add image"],["mat-icon-button","","matTooltip","Move Up",3,"click"],["aria-label","Move Up"],["mat-icon-button","","matTooltip","Move Down",3,"click"],["aria-label","Move Down"]],template:function(e,t){1&e&&(M.jc(0,"mat-expansion-panel",0),M.rc("opened",(function(){return t.opened.emit()})),M.jc(1,"mat-expansion-panel-header"),M.jc(2,"mat-panel-title"),M.jc(3,"div"),M.Xc(4),M.ic(),M.ic(),M.ec(5,"mat-panel-description",1),M.ic(),M.Wc(6,he,22,7,"ng-template",2),M.ic()),2&e&&(M.Rb(4),M.Zc(" ",t.item.name," "),M.Rb(1),M.Ac("data",t.item.meta.split("\n")[0]))},directives:[F.c,F.g,F.h,F.f,u.a,F.e,H.f,H.g,S.c,H.b,x.a,s.c,s.n,s.q,l.t,R.b,T.a,L.a],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}mat-panel-title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:auto 0}"]});var be=a("WJbf");function je(e,t){if(1&e){var c=M.kc();M.jc(0,"avr-item-detail",22),M.rc("moveUp",(function(){M.Mc(c);var e=t.$implicit;return M.vc(3).moveUp(e)}))("moveDown",(function(){M.Mc(c);var e=t.$implicit;return M.vc(3).moveDown(e)}))("changed",(function(){return M.Mc(c),M.vc(3).ensureChangesNotif()}))("opened",(function(){M.Mc(c);var e=t.$implicit;return M.vc(3).selectedItem=e}))("delete",(function(){M.Mc(c);var e=t.$implicit;return M.vc(3).deleteItem(e)})),M.ic()}if(2&e){var n=t.$implicit,i=t.first,a=t.last;M.Ac("item",n)("isFirst",i)("isLast",a)}}function ke(e,t){if(1&e){var c=M.kc();M.jc(0,"div",13),M.jc(1,"mat-accordion"),M.Wc(2,je,1,3,"avr-item-detail",14),M.jc(3,"mat-card",15),M.jc(4,"span",16),M.Xc(5,"New..."),M.ic(),M.ec(6,"span",4),M.jc(7,"span"),M.jc(8,"button",17),M.rc("click",(function(){return M.Mc(c),M.vc(2).beginNewFromJSON()})),M.jc(9,"mat-icon",18),M.Xc(10,"vertical_align_bottom"),M.ic(),M.ic(),M.jc(11,"button",19),M.rc("click",(function(){return M.Mc(c),M.vc(2).beginNewFromSRD()})),M.jc(12,"mat-icon",20),M.Xc(13,"scanner"),M.ic(),M.ic(),M.jc(14,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc(2).newLooseItem()})),M.jc(15,"mat-icon",21),M.Xc(16,"add"),M.ic(),M.ic(),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc(2);M.Rb(2),M.Ac("ngForOf",n.pack.items)}}function Me(e,t){if(1&e){var c=M.kc();M.jc(0,"div",13),M.jc(1,"mat-card"),M.jc(2,"p"),M.Xc(3,"Looks like this pack is empty."),M.ic(),M.jc(4,"button",23),M.rc("click",(function(){return M.Mc(c),M.vc(2).newLooseItem()})),M.Xc(5,"Make an Item"),M.ic(),M.jc(6,"button",17),M.rc("click",(function(){return M.Mc(c),M.vc(2).beginNewFromJSON()})),M.jc(7,"mat-icon",18),M.Xc(8,"vertical_align_bottom"),M.ic(),M.ic(),M.jc(9,"button",19),M.rc("click",(function(){return M.Mc(c),M.vc(2).beginNewFromSRD()})),M.jc(10,"mat-icon",20),M.Xc(11,"scanner"),M.ic(),M.ic(),M.ic(),M.ic()}}var we=function(e,t){return{name:e,icon_url:t}},ye=function(e){return{name:"Description",value:e}},Ce=function(e){return[e]},Xe=function(){return{text:"Homebrew content.",icon_url:"../../../../assets/img/homebrew.png"}};function Oe(e,t){if(1&e&&M.ec(0,"avr-discord-embed",24),2&e){var c=M.vc(2);M.Ac("author",M.Fc(6,we,c.user.username,c.user.avatarUrl))("title",c.selectedItem.name)("description",c.selectedItem.meta)("fields",M.Ec(11,Ce,M.Ec(9,ye,c.selectedItem.desc)))("thumbnail",c.selectedItem.image)("footer",M.Dc(13,Xe))}}function Se(e,t){if(1&e&&M.ec(0,"avr-discord-embed",25),2&e){var c=M.vc(2);M.Ac("author",M.Fc(2,we,c.user.username,c.user.avatarUrl))("footer",M.Dc(5,Xe))}}function xe(e,t){if(1&e){var c=M.kc();M.jc(0,"div"),M.jc(1,"mat-toolbar",1),M.jc(2,"span"),M.jc(3,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().back()})),M.jc(4,"mat-icon",3),M.Xc(5,"arrow_back"),M.ic(),M.ic(),M.ic(),M.jc(6,"span"),M.Xc(7),M.ic(),M.ec(8,"span",4),M.jc(9,"span"),M.jc(10,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().commit()})),M.jc(11,"mat-icon",5),M.Xc(12,"save"),M.ic(),M.ic(),M.jc(13,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().beginSettings()})),M.jc(14,"mat-icon",6),M.Xc(15,"settings"),M.ic(),M.ic(),M.jc(16,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().beginShare()})),M.jc(17,"mat-icon",7),M.Xc(18,"launch"),M.ic(),M.ic(),M.ic(),M.ic(),M.jc(19,"div",8),M.Wc(20,ke,17,1,"div",9),M.Wc(21,Me,12,0,"div",9),M.jc(22,"div",10),M.Wc(23,Oe,1,14,"avr-discord-embed",11),M.Wc(24,Se,1,6,"avr-discord-embed",12),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(7),M.Zc(" ",n.pack.name," "),M.Rb(13),M.Ac("ngIf",n.pack.items.length),M.Rb(1),M.Ac("ngIf",!n.pack.items.length),M.Rb(2),M.Ac("ngIf",n.selectedItem),M.Rb(1),M.Ac("ngIf",!n.selectedItem)}}function Ie(e,t){1&e&&(M.jc(0,"div"),M.jc(1,"div",26),M.jc(2,"mat-card"),M.ec(3,"mat-spinner",27),M.ic(),M.ic(),M.ic()),2&e&&(M.Rb(3),M.Ac("diameter",24))}function Re(e,t){if(1&e){var c=M.kc();M.jc(0,"div"),M.jc(1,"div",26),M.jc(2,"mat-card"),M.jc(3,"p"),M.Xc(4,"You do not have permission to edit this pack."),M.ic(),M.jc(5,"button",23),M.rc("click",(function(){return M.Mc(c),M.vc().back()})),M.Xc(6,"Go Back"),M.ic(),M.ic(),M.ic(),M.ic()}}var Ae=function(){function t(e,c,n,a,o,l,r){i(this,t),this.route=e,this.homebrewService=c,this.dashboardService=n,this.location=a,this.dialog=o,this.router=l,this.snackBar=r,this.user=Object(j.d)(),this.changesOpen=!1}return o(t,[{key:"ngOnInit",value:function(){this.getPack()}},{key:"ngOnDestroy",value:function(){this.snackBar.dismiss()}},{key:"getPack",value:function(){var e=this,t=this.route.snapshot.paramMap.get("pack");this.homebrewService.getPack(t).subscribe((function(t){e.pack=t,e.calcCanEdit()}))}},{key:"calcCanEdit",value:function(){var e=this;if(this.pack&&this.user)if(this.isOwner=this.user.id===this.pack.owner,this.isOwner)this.canEdit=!0;else{var t=this.pack._id.$oid;this.homebrewService.getPackEditors(t).subscribe((function(t){return e.canEdit=t.some((function(t){return t===e.user.id}))}))}}},{key:"newLooseItem",value:function(){this.pack.items.push(new E),this.ensureChangesNotif()}},{key:"deleteItem",value:function(e){this.pack.items=this.pack.items.filter((function(t){return t!==e})),this.ensureChangesNotif()}},{key:"ensureChangesNotif",value:function(){var e=this;this.changesOpen||(this.changesOpen=!0,this.snackBar.open("You have unsaved changes!","Save",{duration:-1,horizontalPosition:"right"}).onAction().subscribe((function(){e.commit()})))}},{key:"beginShare",value:function(){var e=this;this.dialog.open(q,{data:this.pack,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),e.pack=Object.assign(e.pack,t),e.commit())}))}},{key:"beginSettings",value:function(){var e=this;this.dialog.open(ue,{data:this.pack,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),t.delete?e.delete():(e.pack=Object.assign(e.pack,t),e.commit()))}))}},{key:"beginNewFromJSON",value:function(){var t=this,c=this.dialog.open(ie.a,{width:"60%",disableClose:!0,data:{validator:function(e){return t.validatePackJSON(c,e)}}});c.afterClosed().subscribe((function(c){if(c){var n,i=c;console.log(i),i instanceof Array?(n=t.pack.items).push.apply(n,e(i)):t.pack.items.push(i),t.ensureChangesNotif()}}))}},{key:"beginNewFromSRD",value:function(){var e=this;this.dialog.open(ae.a,{width:"60%",disableClose:!0,data:{getter:function(){return e.homebrewService.getTemplateItems()},namer:function(e){return e.name}}}).afterClosed().subscribe((function(t){t&&(e.pack.items.push(t),e.ensureChangesNotif())}))}},{key:"packIsValid",value:function(e){var t=this;return e instanceof Array?Boolean(e.length)&&e.every((function(e){return t.objectIsItem(e)})):!!e&&this.objectIsItem(e)}},{key:"validatePackJSON",value:function(e,t){e.componentInstance.loading=!1,this.packIsValid(t)?e.close(JSON.parse(e.componentInstance.data)):e.componentInstance.error="Invalid pack data"}},{key:"objectIsItem",value:function(e){return P.every((function(t){return t in e}))}},{key:"commit",value:function(){var e=this;this.homebrewService.putPack(this.pack).subscribe((function(t){console.log(t),e.changesOpen=!1,e.snackBar.open("".concat(t,' Use "!pack ').concat(e.pack.name,'" to activate the pack in Discord!'),null,{horizontalPosition:"right"})}))}},{key:"delete",value:function(){var e=this;this.homebrewService.deletePack(this.pack).subscribe((function(t){console.log(t),e.router.navigate(["../"],{relativeTo:e.route})}))}},{key:"back",value:function(){this.location.back()}},{key:"moveUp",value:function(e){var t=this.pack.items.indexOf(e),c=t-1;c>-1&&(Object(ne.a)(this.pack.items,t,c),this.ensureChangesNotif())}},{key:"moveDown",value:function(e){var t=this.pack.items.indexOf(e),c=t+1;c<this.pack.items.length&&(Object(ne.a)(this.pack.items,t,c),this.ensureChangesNotif())}}]),t}();Ae.\u0275fac=function(e){return new(e||Ae)(M.dc(f.a),M.dc(X),M.dc(oe.a),M.dc(l.n),M.dc(O.b),M.dc(f.b),M.dc(de.b))},Ae.\u0275cmp=M.Xb({type:Ae,selectors:[["avr-pack-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["color","primary",1,"pack-toolbar"],["mat-icon-button","",3,"click"],["aria-label","Back"],[1,"toolbar-spacer"],["aria-label","Save"],["aria-label","Settings"],["aria-label","Share"],["fxLayout","row","fxLayoutGap","8px",1,"container"],["class","item-list","fxFlex","grow",4,"ngIf"],["fxFlex","grow",1,"item-preview","mat-typography","mat-elevation-z3"],[3,"author","title","description","fields","thumbnail","footer",4,"ngIf"],["title","No item selected.","description","Click on an item on the left to see a preview!",3,"author","footer",4,"ngIf"],["fxFlex","grow",1,"item-list"],[3,"item","isFirst","isLast","moveUp","moveDown","changed","opened","delete",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"new-item-card"],[1,"no-text-cursor"],["mat-icon-button","","matTooltip","Import from JSON",3,"click"],["aria-label","Import from JSON"],["mat-icon-button","","matTooltip","Copy SRD item",3,"click"],["aria-label","From existing item"],["aria-label","New"],[3,"item","isFirst","isLast","moveUp","moveDown","changed","opened","delete"],["mat-raised-button","","color","accent",3,"click"],[3,"author","title","description","fields","thumbnail","footer"],["title","No item selected.","description","Click on an item on the left to see a preview!",3,"author","footer"],[1,"container"],[3,"diameter"]],template:function(e,t){1&e&&(M.Wc(0,xe,25,5,"div",0),M.Wc(1,Ie,4,1,"div",0),M.Wc(2,Re,7,0,"div",0)),2&e&&(M.Ac("ngIf",t.pack&&null!=t.canEdit),M.Rb(1),M.Ac("ngIf",!t.pack),M.Rb(1),M.Ac("ngIf",t.pack&&!t.canEdit))},directives:[l.t,z.a,R.b,L.a,H.f,H.g,H.b,F.a,l.s,V.a,H.e,T.a,ve,be.a,U.c],styles:[".pack-toolbar[_ngcontent-%COMP%]{height:64px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.item-list[_ngcontent-%COMP%], .item-preview[_ngcontent-%COMP%]{max-height:calc(100vh - 192px);overflow-y:auto}.container[_ngcontent-%COMP%]{margin:8px}.new-item-card[_ngcontent-%COMP%]{height:48px;padding:0 24px}.no-text-cursor[_ngcontent-%COMP%]{cursor:default}"]});var _e=function(e,t,c,n){return{name:e,public:t,image:c,desc:n}},Pe=function(){function e(){i(this,e),this.public=!1,this.desc="",this.image=""}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();Pe.\u0275fac=function(e){return new(e||Pe)},Pe.\u0275cmp=M.Xb({type:Pe,selectors:[["avr-new-pack-dialog"]],decls:19,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],[1,"mat-small"],["mat-button","","mat-dialog-close","","tabindex","1"],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(e,t){1&e&&(M.jc(0,"h2",0),M.Xc(1,"New Tome..."),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"div",2),M.jc(4,"mat-form-field"),M.jc(5,"input",3),M.rc("ngModelChange",(function(e){return t.name=e})),M.ic(),M.ic(),M.jc(6,"mat-slide-toggle",4),M.rc("ngModelChange",(function(e){return t.public=e})),M.Xc(7,"Allow public to view"),M.ic(),M.jc(8,"mat-form-field"),M.jc(9,"input",5),M.rc("ngModelChange",(function(e){return t.image=e})),M.ic(),M.ic(),M.jc(10,"mat-form-field"),M.jc(11,"textarea",6),M.rc("ngModelChange",(function(e){return t.desc=e})),M.ic(),M.ic(),M.ic(),M.jc(12,"p",7),M.Xc(13," These settings can be changed at any time. "),M.ic(),M.ic(),M.jc(14,"mat-dialog-actions"),M.jc(15,"button",8),M.Xc(16,"Cancel"),M.ic(),M.jc(17,"button",9),M.Xc(18," Create "),M.ic(),M.ic()),2&e&&(M.Rb(5),M.Ac("ngModel",t.name),M.Rb(1),M.Ac("ngModel",t.public),M.Rb(3),M.Ac("ngModel",t.image),M.Rb(2),M.Ac("ngModel",t.desc),M.Rb(6),M.Ac("mat-dialog-close",M.Hc(6,_e,t.name,t.public,t.image,t.desc))("disabled",!t.name))},directives:[O.i,O.f,S.c,x.a,s.c,s.n,s.q,I.a,O.c,R.b,O.d],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var Ee=a("jgxE"),De=function(){function e(t){i(this,e),this.data=t,this.generateMD(this.data.data)}return o(e,[{key:"ngOnInit",value:function(){}},{key:"generateMD",value:function(e){var c="";c+="".concat("# "+e.name,"\n").concat(e.desc||"","\n\n");var n,i=t(e.spells);try{for(i.s();!(n=i.n()).done;){var a=n.value;c+=this.generateSpellMD(a)}}catch(o){i.e(o)}finally{i.f()}c=c.replace("\n","\n  "),this.mdData=c}},{key:"generateSpellMD",value:function(e){var t="#### "+e.name,c=e.level?"".concat(Object(Ee.d)(e.level)," ").concat(Object(Ee.e)(e.school)):"".concat(Object(Ee.e)(e.school)," ").concat(Object(Ee.d)(e.level)),n="- **Casting Time:** ".concat(e.casttime+(e.ritual?" (ritual)":""),"\n- **Range:** ").concat(e.range,"\n- **Components:** ").concat(Object(Ee.c)(e),"\n- **Duration:** ").concat((e.concentration?"Concentration, up to ":"")+e.duration),i=e.description;return e.higherlevels&&(i="".concat(i,"\n\n**At Higher Levels:** ").concat(e.higherlevels)),"".concat(t,"\n*").concat(c,"*\n___\n").concat(n,"\n\n").concat(i,"\n\n")}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}}]),e}();function Te(e,t){if(1&e){var c=M.kc();M.jc(0,"mat-form-field"),M.ec(1,"input",9,10),M.jc(3,"button",11),M.rc("click",(function(){M.Mc(c);var e=M.Jc(2);return M.vc().copy(e)})),M.jc(4,"mat-icon"),M.Xc(5,"file_copy"),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(1),M.Ac("value",n.shareLink)}}function Le(e,t){if(1&e&&(M.jc(0,"mat-list-item"),M.Xc(1),M.wc(2,"async"),M.ic()),2&e){var c,n=t.$implicit;M.Rb(1),M.Yc(null==(c=M.xc(2,1,n))?null:c.username)}}function Ne(e,t){if(1&e&&(M.jc(0,"mat-list"),M.Wc(1,Le,3,3,"mat-list-item",12),M.ic()),2&e){var c=M.vc();M.Rb(1),M.Ac("ngForOf",c.editors)}}function Fe(e,t){if(1&e){var c=M.kc();M.jc(0,"div",13),M.jc(1,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().beginJSONExport()})),M.Xc(2,"Export to JSON "),M.ic(),M.jc(3,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().beginMDExport()})),M.Xc(4,"Export to Homebrewery "),M.ic(),M.ic()}}function We(e,t){1&e&&(M.jc(0,"div"),M.ec(1,"mat-spinner",15),M.ic()),2&e&&(M.Rb(1),M.Ac("diameter",24))}De.\u0275fac=function(e){return new(e||De)(M.dc(O.a))},De.\u0275cmp=M.Xb({type:De,selectors:[["avr-tome-markdown-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","readonly","","placeholder","Markdown","rows","10",3,"value"],["mdElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(e,t){if(1&e){var c=M.kc();M.jc(0,"h2",0),M.Xc(1),M.ic(),M.Xc(2,"\n"),M.jc(3,"mat-dialog-content",1),M.Xc(4,"\n  "),M.jc(5,"div",2),M.Xc(6,"\n    "),M.jc(7,"mat-form-field"),M.Xc(8,"\n      "),M.ec(9,"textarea",3,4),M.Xc(11,"\n      "),M.jc(12,"button",5),M.rc("click",(function(){M.Mc(c);var e=M.Jc(10);return t.copy(e)})),M.Xc(13,"\n        "),M.jc(14,"mat-icon"),M.Xc(15,"file_copy"),M.ic(),M.Xc(16,"\n      "),M.ic(),M.Xc(17,"\n    "),M.ic(),M.Xc(18,"\n  "),M.ic(),M.Xc(19,"\n"),M.ic(),M.Xc(20,"\n"),M.jc(21,"mat-dialog-actions"),M.Xc(22,"\n  "),M.jc(23,"button",6),M.Xc(24,"Done"),M.ic(),M.Xc(25,"\n"),M.ic(),M.Xc(26,"\n")}2&e&&(M.Rb(1),M.Zc("Markdown - ",t.data.name,""),M.Rb(8),M.Ac("value",t.mdData))},directives:[O.i,O.f,S.c,x.a,R.b,S.j,T.a,L.a,O.c,O.d],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var Ue=function(e){return{public:e}},Je=function(){function e(t,c,n,a){i(this,e),this.data=t,this.dialog=c,this.hbService=n,this.discord=a,this.public=t.public,this.shareLink="https://avrae.io/homebrew/spells/"+t._id.$oid,this.loaded=void 0!==t.spells}return o(e,[{key:"ngOnInit",value:function(){this.owner=this.discord.getUser(this.data.owner),this.loadEditors(),this.loaded||this.loadSpells()}},{key:"loadEditors",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getTomeEditors(t).subscribe((function(t){var c=[];t.forEach((function(t){return c.push(e.discord.getUser(t))})),e.editors=c}))}},{key:"loadSpells",value:function(){var e=this,t=this.data._id.$oid;this.hbService.getTome(t).subscribe((function(t){e.data=t,e.loaded=!0}))}},{key:"copy",value:function(e){e.select(),document.execCommand("copy"),e.setSelectionRange(0,0)}},{key:"beginJSONExport",value:function(){this.dialog.open(D.a,{data:{name:this.data.name,data:this.data.spells},width:"60%"})}},{key:"beginMDExport",value:function(){this.dialog.open(De,{data:{name:this.data.name,data:this.data},width:"60%"})}}]),e}();function $e(e,t){if(1&e&&(M.jc(0,"mat-card-content"),M.jc(1,"p"),M.Xc(2),M.ic(),M.ic()),2&e){var c=M.vc().$implicit;M.Rb(2),M.Zc(" ",c.desc," ")}}function Be(e,t){if(1&e){var c=M.kc();M.jc(0,"div",8),M.jc(1,"mat-card"),M.jc(2,"mat-card-header"),M.jc(3,"mat-card-title"),M.Xc(4),M.ic(),M.jc(5,"mat-card-subtitle"),M.Xc(6),M.ic(),M.ic(),M.ec(7,"img",9),M.Wc(8,$e,3,1,"mat-card-content",10),M.jc(9,"mat-card-actions"),M.jc(10,"a",11),M.Xc(11,"EDIT"),M.ic(),M.jc(12,"button",12),M.rc("click",(function(){M.Mc(c);var e=t.$implicit;return M.vc(2).beginShare(e)})),M.Xc(13,"SHARE"),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n,i=t.$implicit,a=M.vc(2);M.Rb(4),M.Yc(i.name),M.Rb(2),M.ad("By ",(null==(n=a.owners.get(i.owner))?null:n.username)||"loading..."," - ",i.numSpells," spells "),M.Rb(1),M.Ac("src",i.image||"../../../../assets/img/tome.png",M.Oc),M.Rb(1),M.Ac("ngIf",i.desc),M.Rb(2),M.Bc("routerLink",i._id.$oid)}}function Ze(e,t){if(1&e&&(M.jc(0,"div",6),M.Wc(1,Be,14,6,"div",7),M.ic()),2&e){var c=M.vc();M.Rb(1),M.Ac("ngForOf",c.tomes)}}function Ge(e,t){if(1&e){var c=M.kc();M.jc(0,"div",13),M.jc(1,"mat-card"),M.jc(2,"p"),M.Xc(3,"Looks like you don't have any tomes yet."),M.ic(),M.jc(4,"button",14),M.rc("click",(function(){return M.Mc(c),M.vc().beginNew()})),M.Xc(5,"Create One"),M.ic(),M.ic(),M.ic()}}Je.\u0275fac=function(e){return new(e||Je)(M.dc(O.a),M.dc(O.b),M.dc(X),M.dc(h.a))},Je.\u0275cmp=M.Xb({type:Je,selectors:[["avr-pack-share-dialog"]],decls:31,vars:12,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],[3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"mat-elevation-z0"],["class","button-row",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["matInput","","readonly","","placeholder","View Link",3,"value"],["shareLinkElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],[4,"ngFor","ngForOf"],[1,"button-row"],["mat-raised-button","","color","primary",3,"click"],[3,"diameter"]],template:function(e,t){var c;(1&e&&(M.jc(0,"h2",0),M.Xc(1),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"div",2),M.jc(4,"p"),M.Xc(5),M.wc(6,"async"),M.ic(),M.jc(7,"mat-slide-toggle",3),M.rc("ngModelChange",(function(e){return t.public=e})),M.Xc(8,"Allow public to view"),M.ic(),M.Wc(9,Te,6,1,"mat-form-field",4),M.jc(10,"mat-expansion-panel",5),M.jc(11,"mat-expansion-panel-header"),M.jc(12,"mat-panel-title"),M.Xc(13," Editors "),M.ic(),M.ic(),M.jc(14,"p"),M.Xc(15,"To add or remove an editor, run the command "),M.jc(16,"kbd"),M.Xc(17,"!tome editor @user"),M.ic(),M.Xc(18," in Discord!"),M.ic(),M.Wc(19,Ne,2,1,"mat-list",4),M.ic(),M.jc(20,"mat-expansion-panel",5),M.jc(21,"mat-expansion-panel-header"),M.jc(22,"mat-panel-title"),M.Xc(23," Export "),M.ic(),M.ic(),M.Wc(24,Fe,5,0,"div",6),M.Wc(25,We,2,1,"div",4),M.ic(),M.ic(),M.ic(),M.jc(26,"mat-dialog-actions"),M.jc(27,"button",7),M.Xc(28,"Cancel"),M.ic(),M.jc(29,"button",8),M.Xc(30," Done "),M.ic(),M.ic()),2&e)&&(M.Rb(1),M.Zc("Share ",t.data.name,""),M.Rb(4),M.Zc(" Owner: ",null==(c=M.xc(6,8,t.owner))?null:c.username," "),M.Rb(2),M.Ac("ngModel",t.public),M.Rb(2),M.Ac("ngIf",t.public),M.Rb(10),M.Ac("ngIf",null==t.editors?null:t.editors.length),M.Rb(5),M.Ac("ngIf",t.loaded),M.Rb(1),M.Ac("ngIf",!t.loaded),M.Rb(4),M.Ac("mat-dialog-close",M.Ec(10,Ue,t.public)))},directives:[O.i,O.f,I.a,s.n,s.q,l.t,F.c,F.g,F.h,O.c,R.b,O.d,S.c,x.a,S.j,T.a,L.a,W.a,l.s,W.d,U.c],pipes:[l.b],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.button-row[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:4px}"]});var Ye=function(){function e(t,c,n,a,o){i(this,e),this.homebrewService=t,this.discord=c,this.dialog=n,this.router=a,this.route=o,this.owners=new Map}return o(e,[{key:"ngOnInit",value:function(){this.getTomes()}},{key:"getTomes",value:function(){var e=this;this.homebrewService.getUserTomes().subscribe((function(c){e.tomes=c;var n,i=new Set,a=t(c);try{var o=function(){var t=n.value;i.has(t.owner)||(i.add(t.owner),e.discord.getUser(t.owner).subscribe((function(c){return e.owners.set(t.owner,c)})))};for(a.s();!(n=a.n()).done;)o()}catch(l){a.e(l)}finally{a.f()}}))}},{key:"beginNew",value:function(){var e=this;this.dialog.open(Pe,{width:"60%",disableClose:!0}).afterClosed().subscribe((function(t){if(t){var c={name:t.name,public:t.public,desc:t.desc,image:t.image};e.new(c)}}))}},{key:"beginShare",value:function(e){var t=this;this.dialog.open(Je,{data:e,width:"40%",disableClose:!0}).afterClosed().subscribe((function(c){c&&(console.log(c),e=Object.assign(e,c),t.commit(e))}))}},{key:"new",value:function(e){var t=this;this.homebrewService.newTome(e).subscribe((function(e){e.success&&t.router.navigate([e.tomeId],{relativeTo:t.route})}))}},{key:"commit",value:function(e){this.homebrewService.putTome(e).subscribe((function(e){console.log(e)}))}}]),e}();Ye.\u0275fac=function(e){return new(e||Ye)(M.dc(X),M.dc(h.a),M.dc(O.b),M.dc(f.b),M.dc(f.a))},Ye.\u0275cmp=M.Xb({type:Ye,selectors:[["avr-spells"]],decls:10,vars:2,consts:[["color","primary",1,"mat-elevation-z2"],[1,"toolbar-spacer"],["mat-icon-button","",3,"click"],["aria-label","New Tome"],["class","container","fxLayout","row wrap","fxLayoutAlign","space-around",4,"ngIf"],["class","container",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","space-around",1,"container"],["class","tome-tile","fxFlex","32%",4,"ngFor","ngForOf"],["fxFlex","32%",1,"tome-tile"],["mat-card-image","","alt","Tome Image",3,"src"],[4,"ngIf"],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],[1,"container"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(M.jc(0,"mat-toolbar",0),M.jc(1,"span"),M.Xc(2,"Your Tomes"),M.ic(),M.ec(3,"span",1),M.jc(4,"span"),M.jc(5,"button",2),M.rc("click",(function(){return t.beginNew()})),M.jc(6,"mat-icon",3),M.Xc(7,"add"),M.ic(),M.ic(),M.ic(),M.ic(),M.Wc(8,Ze,2,1,"div",4),M.Wc(9,Ge,6,0,"div",5)),2&e&&(M.Rb(8),M.Ac("ngIf",t.tomes&&t.tomes.length),M.Rb(1),M.Ac("ngIf",t.tomes&&!t.tomes.length))},directives:[z.a,R.b,L.a,l.t,H.f,H.e,l.s,H.b,V.a,V.f,V.m,V.l,V.g,V.b,R.a,f.c,V.d],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%], .pack-tile[_ngcontent-%COMP%]{margin:4px}"]});var qe=function(){function e(t){i(this,e),this.data=t}return o(e,[{key:"ngOnInit",value:function(){}}]),e}();function ze(e,t){if(1&e){var c=M.kc();M.jc(0,"button",9),M.rc("click",(function(){return M.Mc(c),M.vc().beginDelete()})),M.Xc(1,"Delete"),M.ic()}}qe.\u0275fac=function(e){return new(e||qe)(M.dc(O.a))},qe.\u0275cmp=M.Xb({type:qe,selectors:[["avr-tome-delete-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["mat-button","","mat-dialog-close",""],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(e,t){1&e&&(M.jc(0,"h2",0),M.Xc(1),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"p"),M.Xc(4),M.jc(5,"b"),M.Xc(6,"This cannot be undone."),M.ic(),M.ic(),M.ic(),M.jc(7,"mat-dialog-actions"),M.jc(8,"button",2),M.Xc(9,"Cancel"),M.ic(),M.jc(10,"button",3),M.Xc(11," Delete "),M.ic(),M.ic()),2&e&&(M.Rb(1),M.Zc("Deleting ",t.data.name,"..."),M.Rb(3),M.Zc(" Are you sure you want to delete ",t.data.name,"? This will remove the tome from all editors' libraries, and invalidate any sharing links. "),M.Rb(6),M.Ac("mat-dialog-close",!0))},directives:[O.i,O.f,O.c,R.b,O.d],encapsulation:2});var He=function(e,t,c){return{name:e,image:t,desc:c}},Ve=function(){function e(t,c,n){i(this,e),this.data=t,this.dialog=c,this.dialogRef=n,this.name=t.name,this.image=t.image,this.desc=t.desc,this.isOwner=Object(j.d)().id===t.owner}return o(e,[{key:"ngOnInit",value:function(){}},{key:"beginDelete",value:function(){var e=this;this.dialog.open(qe,{data:this.data,width:"40%"}).afterClosed().subscribe((function(t){t&&e.dialogRef.close({delete:!0})}))}}]),e}();Ve.\u0275fac=function(e){return new(e||Ve)(M.dc(O.a),M.dc(O.b),M.dc(O.h))},Ve.\u0275cmp=M.Xb({type:Ve,selectors:[["avr-tome-options-dialog"]],decls:16,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(e,t){1&e&&(M.jc(0,"h2",0),M.Xc(1),M.ic(),M.jc(2,"mat-dialog-content",1),M.jc(3,"div",2),M.jc(4,"mat-form-field"),M.jc(5,"input",3),M.rc("ngModelChange",(function(e){return t.name=e})),M.ic(),M.ic(),M.jc(6,"mat-form-field"),M.jc(7,"input",4),M.rc("ngModelChange",(function(e){return t.image=e})),M.ic(),M.ic(),M.jc(8,"mat-form-field"),M.jc(9,"textarea",5),M.rc("ngModelChange",(function(e){return t.desc=e})),M.ic(),M.ic(),M.ic(),M.ic(),M.jc(10,"mat-dialog-actions"),M.jc(11,"button",6),M.Xc(12,"Cancel"),M.ic(),M.jc(13,"button",7),M.Xc(14," Save "),M.ic(),M.Wc(15,ze,2,0,"button",8),M.ic()),2&e&&(M.Rb(1),M.Yc(t.data.name),M.Rb(4),M.Ac("ngModel",t.name),M.Rb(2),M.Ac("ngModel",t.image),M.Rb(2),M.Ac("ngModel",t.desc),M.Rb(4),M.Ac("mat-dialog-close",M.Gc(7,He,t.name,t.image,t.desc))("disabled",!t.name),M.Rb(2),M.Ac("ngIf",t.isOwner))},directives:[O.i,O.f,S.c,x.a,s.c,s.n,s.q,O.c,R.b,O.d,l.t],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}"]});var Ke=a("wZkO"),Qe=(a("rHON"),a("5w/X")),et=function(){function e(){i(this,e)}return o(e,[{key:"genDesc",value:function(){this.description=this.level?"".concat(Object(Ee.d)(this.level)," ").concat(Object(Ee.e)(this.school)):"".concat(Object(Ee.e)(this.school)," ").concat(Object(Ee.d)(this.level))}},{key:"ngOnInit",value:function(){this.genDesc()}},{key:"ngOnChanges",value:function(e){this.genDesc()}}]),e}();et.\u0275fac=function(e){return new(e||et)},et.\u0275cmp=M.Xb({type:et,selectors:[["avr-spell-panel-description"]],inputs:{level:"level",school:"school"},features:[M.Pb],decls:2,vars:1,template:function(e,t){1&e&&(M.jc(0,"mat-panel-description"),M.Xc(1),M.ic()),2&e&&(M.Rb(1),M.Yc(t.description))},directives:[F.f],encapsulation:2});var tt=a("d3UM"),ct=a("FKr1"),nt=a("bSwM");function it(e,t){if(1&e){var c=M.kc();M.jc(0,"mat-form-field",5),M.jc(1,"input",34),M.rc("change",(function(){return M.Mc(c),M.vc(2).emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc(2).spell.image=e})),M.ic(),M.ic()}if(2&e){var n=M.vc(2);M.Rb(1),M.Ac("ngModel",n.spell.image)}}function at(e,t){if(1&e){var c=M.kc();M.jc(0,"mat-select",9),M.rc("valueChange",(function(e){return M.Mc(c),M.vc(2).spell.school=e}))("selectionChange",(function(){return M.Mc(c),M.vc(2).emitChange()})),M.jc(1,"mat-option",35),M.Xc(2,"Abjuration"),M.ic(),M.jc(3,"mat-option",36),M.Xc(4,"Conjuration"),M.ic(),M.jc(5,"mat-option",37),M.Xc(6,"Divination"),M.ic(),M.jc(7,"mat-option",38),M.Xc(8,"Enchantment"),M.ic(),M.jc(9,"mat-option",39),M.Xc(10,"Evocation"),M.ic(),M.jc(11,"mat-option",40),M.Xc(12,"Illusion"),M.ic(),M.jc(13,"mat-option",41),M.Xc(14,"Necromancy"),M.ic(),M.jc(15,"mat-option",42),M.Xc(16,"Transmutation"),M.ic(),M.jc(17,"mat-option",43),M.rc("click",(function(){return M.Mc(c),M.vc(2).customSpellSchool=!0})),M.Xc(18,"Custom"),M.ic(),M.ic()}if(2&e){var n=M.vc(2);M.Ac("value",n.spell.school)}}function ot(e,t){if(1&e){var c=M.kc();M.jc(0,"input",44),M.rc("change",(function(){return M.Mc(c),M.vc(2).emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc(2).spell.school=e})),M.ic()}if(2&e){var n=M.vc(2);M.Ac("ngModel",n.spell.school)}}function lt(e,t){if(1&e){var c=M.kc();M.jc(0,"button",45),M.rc("click",(function(){return M.Mc(c),M.vc(2).customSpellSchool=!1})),M.jc(1,"mat-icon"),M.Xc(2,"remove_circle_outline"),M.ic(),M.ic()}}function rt(e,t){if(1&e){var c=M.kc();M.jc(0,"span",5),M.jc(1,"button",46),M.rc("click",(function(){M.Mc(c);var e=M.vc(2);return e.spell.image="",e.emitChange()})),M.jc(2,"mat-icon",47),M.Xc(3,"add_photo_alternate"),M.ic(),M.ic(),M.ic()}}function st(e,t){if(1&e){var c=M.kc();M.jc(0,"span",5),M.jc(1,"button",48),M.rc("click",(function(){return M.Mc(c),M.vc(2).moveUp.emit()})),M.jc(2,"mat-icon",49),M.Xc(3,"arrow_upward"),M.ic(),M.ic(),M.ic()}}function ut(e,t){if(1&e){var c=M.kc();M.jc(0,"span",5),M.jc(1,"button",50),M.rc("click",(function(){return M.Mc(c),M.vc(2).moveDown.emit()})),M.jc(2,"mat-icon",51),M.Xc(3,"arrow_downward"),M.ic(),M.ic(),M.ic()}}function dt(e,t){if(1&e){var c=M.kc();M.jc(0,"div",3),M.jc(1,"div",4),M.jc(2,"mat-form-field",5),M.jc(3,"input",6),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.name=e})),M.ic(),M.ic(),M.Wc(4,it,2,1,"mat-form-field",7),M.ic(),M.jc(5,"div",8),M.jc(6,"mat-form-field",5),M.jc(7,"mat-label"),M.Xc(8,"Level"),M.ic(),M.jc(9,"mat-select",9),M.rc("valueChange",(function(e){return M.Mc(c),M.vc().spell.level=e}))("selectionChange",(function(){return M.Mc(c),M.vc().emitChange()})),M.jc(10,"mat-option",10),M.Xc(11,"Cantrip"),M.ic(),M.jc(12,"mat-option",10),M.Xc(13,"1st Level"),M.ic(),M.jc(14,"mat-option",10),M.Xc(15,"2nd Level"),M.ic(),M.jc(16,"mat-option",10),M.Xc(17,"3rd Level"),M.ic(),M.jc(18,"mat-option",10),M.Xc(19,"4th Level"),M.ic(),M.jc(20,"mat-option",10),M.Xc(21,"5th Level"),M.ic(),M.jc(22,"mat-option",10),M.Xc(23,"6th Level"),M.ic(),M.jc(24,"mat-option",10),M.Xc(25,"7th Level"),M.ic(),M.jc(26,"mat-option",10),M.Xc(27,"8th Level"),M.ic(),M.jc(28,"mat-option",10),M.Xc(29,"9th Level"),M.ic(),M.ic(),M.ic(),M.jc(30,"mat-form-field",5),M.jc(31,"mat-label"),M.Xc(32,"School"),M.ic(),M.Wc(33,at,19,1,"mat-select",11),M.Wc(34,ot,1,1,"input",12),M.Wc(35,lt,3,0,"button",13),M.ic(),M.jc(36,"mat-checkbox",14),M.rc("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.ritual=e}))("change",(function(){return M.Mc(c),M.vc().emitChange()})),M.Xc(37,"Ritual"),M.ic(),M.ic(),M.jc(38,"div",15),M.jc(39,"mat-form-field",5),M.jc(40,"input",16),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.casttime=e})),M.ic(),M.ic(),M.jc(41,"mat-form-field",5),M.jc(42,"input",17),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.range=e})),M.ic(),M.ic(),M.ic(),M.jc(43,"div",8),M.jc(44,"mat-checkbox",14),M.rc("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.components.verbal=e}))("change",(function(){return M.Mc(c),M.vc().emitChange()})),M.Xc(45," Verbal "),M.ic(),M.jc(46,"mat-checkbox",14),M.rc("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.components.somatic=e}))("change",(function(){return M.Mc(c),M.vc().emitChange()})),M.Xc(47," Somatic "),M.ic(),M.jc(48,"mat-form-field",5),M.jc(49,"input",18),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.components.material=e})),M.ic(),M.ic(),M.ic(),M.jc(50,"div",8),M.jc(51,"mat-form-field",5),M.jc(52,"input",19),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.duration=e})),M.ic(),M.ic(),M.jc(53,"mat-checkbox",14),M.rc("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.concentration=e}))("change",(function(){return M.Mc(c),M.vc().emitChange()})),M.Xc(54," Concentration "),M.ic(),M.ic(),M.jc(55,"mat-form-field"),M.jc(56,"textarea",20),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.description=e})),M.ic(),M.ic(),M.jc(57,"mat-form-field"),M.jc(58,"textarea",21),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.higherlevels=e})),M.ic(),M.ic(),M.jc(59,"div",15),M.jc(60,"mat-form-field",22),M.jc(61,"input",23),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.classes=e})),M.ic(),M.ic(),M.jc(62,"mat-form-field",24),M.jc(63,"input",25),M.rc("change",(function(){return M.Mc(c),M.vc().emitChange()}))("ngModelChange",(function(e){return M.Mc(c),M.vc().spell.subclasses=e})),M.ic(),M.ic(),M.ic(),M.ic(),M.jc(64,"div",26),M.Wc(65,rt,4,0,"span",7),M.jc(66,"span",5),M.jc(67,"button",27),M.rc("click",(function(){return M.Mc(c),M.vc().beginJSONExport()})),M.jc(68,"mat-icon",28),M.Xc(69,"vertical_align_top"),M.ic(),M.ic(),M.ic(),M.jc(70,"span",5),M.jc(71,"button",29),M.rc("click",(function(){return M.Mc(c),M.vc().moveToEditor.emit()})),M.jc(72,"mat-icon",30),M.Xc(73,"build"),M.ic(),M.ic(),M.ic(),M.Wc(74,st,4,0,"span",7),M.Wc(75,ut,4,0,"span",7),M.ec(76,"span",31),M.jc(77,"span",5),M.jc(78,"button",32),M.rc("click",(function(){return M.Mc(c),M.vc().delete.emit()})),M.jc(79,"mat-icon",33),M.Xc(80,"delete"),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(3),M.Ac("ngModel",n.spell.name),M.Rb(1),M.Ac("ngIf",null!=n.spell.image),M.Rb(5),M.Ac("value",n.spell.level),M.Rb(1),M.Ac("value",0),M.Rb(2),M.Ac("value",1),M.Rb(2),M.Ac("value",2),M.Rb(2),M.Ac("value",3),M.Rb(2),M.Ac("value",4),M.Rb(2),M.Ac("value",5),M.Rb(2),M.Ac("value",6),M.Rb(2),M.Ac("value",7),M.Rb(2),M.Ac("value",8),M.Rb(2),M.Ac("value",9),M.Rb(5),M.Ac("ngIf",!n.customSpellSchool),M.Rb(1),M.Ac("ngIf",n.customSpellSchool),M.Rb(1),M.Ac("ngIf",n.customSpellSchool),M.Rb(1),M.Ac("ngModel",n.spell.ritual),M.Rb(4),M.Ac("ngModel",n.spell.casttime),M.Rb(2),M.Ac("ngModel",n.spell.range),M.Rb(2),M.Ac("ngModel",n.spell.components.verbal),M.Rb(2),M.Ac("ngModel",n.spell.components.somatic),M.Rb(3),M.Ac("ngModel",n.spell.components.material),M.Rb(3),M.Ac("ngModel",n.spell.duration),M.Rb(1),M.Ac("ngModel",n.spell.concentration),M.Rb(3),M.Ac("ngModel",n.spell.description),M.Rb(2),M.Ac("ngModel",n.spell.higherlevels),M.Rb(3),M.Ac("ngModel",n.spell.classes),M.Rb(2),M.Ac("ngModel",n.spell.subclasses),M.Rb(2),M.Ac("ngIf",void 0===n.spell.image),M.Rb(9),M.Ac("ngIf",!n.isFirst),M.Rb(1),M.Ac("ngIf",!n.isLast)}}var mt=function(){function e(t){i(this,e),this.dialog=t,this.moveUp=new M.u,this.moveDown=new M.u,this.changed=new M.u,this.opened=new M.u,this.delete=new M.u,this.moveToEditor=new M.u}return o(e,[{key:"ngOnInit",value:function(){this.customSpellSchool=!Ee.a.includes(this.spell.school)}},{key:"emitChange",value:function(){this.changed.emit()}},{key:"beginJSONExport",value:function(){this.dialog.open(D.a,{data:{name:this.spell.name,data:this.spell},width:"60%"})}}]),e}();function pt(e,t){if(1&e){var c=M.kc();M.jc(0,"avr-spell-detail",15),M.rc("moveUp",(function(){M.Mc(c);var e=t.$implicit;return M.vc(2).moveUp(e)}))("moveDown",(function(){M.Mc(c);var e=t.$implicit;return M.vc(2).moveDown(e)}))("changed",(function(){return M.Mc(c),M.vc(2).changed.emit()}))("opened",(function(){M.Mc(c);var e=t.$implicit,n=M.vc(2);return n.selectedSpell=e,n.selected.emit(e)}))("delete",(function(){M.Mc(c);var e=t.$implicit;return M.vc(2).deleteSpell(e)}))("moveToEditor",(function(){return M.Mc(c),M.vc(2).moveToEditor.emit()})),M.ic()}if(2&e){var n=t.$implicit,i=t.first,a=t.last;M.Ac("spell",n)("isFirst",i)("isLast",a)}}function gt(e,t){if(1&e){var c=M.kc();M.jc(0,"div",4),M.jc(1,"mat-accordion"),M.Wc(2,pt,1,3,"avr-spell-detail",5),M.jc(3,"mat-card",6),M.jc(4,"span",7),M.Xc(5,"New..."),M.ic(),M.ec(6,"span",8),M.jc(7,"span"),M.jc(8,"button",9),M.rc("click",(function(){return M.Mc(c),M.vc().newFromJSON()})),M.jc(9,"mat-icon",10),M.Xc(10,"vertical_align_bottom"),M.ic(),M.ic(),M.jc(11,"button",11),M.rc("click",(function(){return M.Mc(c),M.vc().newFromSRD()})),M.jc(12,"mat-icon",12),M.Xc(13,"scanner"),M.ic(),M.ic(),M.jc(14,"button",13),M.rc("click",(function(){return M.Mc(c),M.vc().newSpell()})),M.jc(15,"mat-icon",14),M.Xc(16,"add"),M.ic(),M.ic(),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(2),M.Ac("ngForOf",n.tome.spells)}}function ft(e,t){if(1&e){var c=M.kc();M.jc(0,"div",4),M.jc(1,"mat-card"),M.jc(2,"p"),M.Xc(3,"Looks like this tome is empty."),M.ic(),M.jc(4,"button",16),M.rc("click",(function(){return M.Mc(c),M.vc().newSpell()})),M.Xc(5,"Make a Spell"),M.ic(),M.jc(6,"button",9),M.rc("click",(function(){return M.Mc(c),M.vc().newFromJSON()})),M.jc(7,"mat-icon",10),M.Xc(8,"vertical_align_bottom"),M.ic(),M.ic(),M.jc(9,"button",11),M.rc("click",(function(){return M.Mc(c),M.vc().newFromSRD()})),M.jc(10,"mat-icon",12),M.Xc(11,"scanner"),M.ic(),M.ic(),M.ic(),M.ic()}}mt.\u0275fac=function(e){return new(e||mt)(M.dc(O.b))},mt.\u0275cmp=M.Xb({type:mt,selectors:[["avr-spell-detail"]],inputs:{spell:"spell",isFirst:"isFirst",isLast:"isLast"},outputs:{moveUp:"moveUp",moveDown:"moveDown",changed:"changed",opened:"opened",delete:"delete",moveToEditor:"moveToEditor"},decls:7,vars:3,consts:[[3,"opened"],[3,"level","school"],["matExpansionPanelContent",""],[1,"form-container"],["fxLayout","row","fxLayoutGap","4px"],["fxFlex",""],["matInput","","placeholder","Name",3,"ngModel","change","ngModelChange"],["fxFlex","",4,"ngIf"],["fxLayout","row","fxLayoutGap","6px","fxLayoutAlign","center center"],[3,"value","valueChange","selectionChange"],[3,"value"],[3,"value","valueChange","selectionChange",4,"ngIf"],["matInput","","placeholder","School",3,"ngModel","change","ngModelChange",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltip","Delete custom school",3,"click",4,"ngIf"],["fxFlex","nogrow",3,"ngModel","ngModelChange","change"],["fxLayout","row","fxLayoutGap","6px"],["matInput","","placeholder","Casting Time",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Range",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Material",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Duration",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Description","rows","7",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","At Higher Levels","rows","3",3,"ngModel","change","ngModelChange"],["fxFlex","","matTooltip","Separate classes with commas."],["matInput","","placeholder","Classes",3,"ngModel","change","ngModelChange"],["fxFlex","","matTooltip","Separate subclasses with commas."],["matInput","","placeholder","Subclasses",3,"ngModel","change","ngModelChange"],["fxLayout","row",1,"actions"],["mat-icon-button","","matTooltip","Export to JSON",3,"click"],["aria-label","Export to JSON"],["mat-icon-button","","matTooltip","Edit Automation",3,"click"],["aria-label","Edit Automation"],["fxFlex","grow"],["mat-icon-button","","color","warn",3,"click"],["aria-label","Delete"],["matInput","","placeholder","Image URL",3,"ngModel","change","ngModelChange"],["value","A"],["value","C"],["value","D"],["value","E"],["value","V"],["value","I"],["value","N"],["value","T"],["value","Custom",3,"click"],["matInput","","placeholder","School",3,"ngModel","change","ngModelChange"],["mat-icon-button","","matSuffix","","matTooltip","Delete custom school",3,"click"],["mat-icon-button","","matTooltip","Add image",3,"click"],["aria-label","Add image"],["mat-icon-button","","matTooltip","Move Up",3,"click"],["aria-label","Move Up"],["mat-icon-button","","matTooltip","Move Down",3,"click"],["aria-label","Move Down"]],template:function(e,t){1&e&&(M.jc(0,"mat-expansion-panel",0),M.rc("opened",(function(){return t.opened.emit()})),M.jc(1,"mat-expansion-panel-header"),M.jc(2,"mat-panel-title"),M.jc(3,"div"),M.Xc(4),M.ic(),M.ic(),M.ec(5,"avr-spell-panel-description",1),M.ic(),M.Wc(6,dt,81,31,"ng-template",2),M.ic()),2&e&&(M.Rb(4),M.Zc(" ",t.spell.name," "),M.Rb(1),M.Ac("level",t.spell.level)("school",t.spell.school))},directives:[F.c,F.g,F.h,et,F.e,H.f,H.g,S.c,H.b,x.a,s.c,s.n,s.q,l.t,H.e,S.g,tt.a,ct.j,nt.a,T.a,R.b,L.a,S.j],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}mat-panel-title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:auto 0}"]});var ht=function(){function t(e,c){i(this,t),this.dialog=e,this.hbService=c,this.selected=new M.u,this.changed=new M.u,this.moveToEditor=new M.u}return o(t,[{key:"ngOnInit",value:function(){}},{key:"newSpell",value:function(){this.tome.spells.push(new Ee.b),this.changed.emit()}},{key:"newFromJSON",value:function(){var t=this,c=this.dialog.open(ie.a,{width:"60%",disableClose:!0,data:{validator:function(e){return t.validateSpellJSON(c,e)}}});c.afterClosed().subscribe((function(c){if(c){var n,i=c;console.log(i),i instanceof Array?(n=t.tome.spells).push.apply(n,e(i)):t.tome.spells.push(i),t.changed.emit()}}))}},{key:"newFromSRD",value:function(){var e=this;this.dialog.open(ae.a,{width:"60%",disableClose:!0,data:{getter:function(){return e.hbService.getTemplateSpells()},namer:function(e){return e.name}}}).afterClosed().subscribe((function(t){t&&(e.tome.spells.push(t),e.changed.emit())}))}},{key:"deleteSpell",value:function(e){this.tome.spells=this.tome.spells.filter((function(t){return t!==e})),this.changed.emit()}},{key:"validateSpellJSON",value:function(e,t){var c=this;this.hbService.validateSpellJSON(t).subscribe((function(t){return c.onValidationReply(e,t)}))}},{key:"onValidationReply",value:function(e,t){console.log(t),e.componentInstance.loading=!1,t.success?e.close(JSON.parse(e.componentInstance.data)):e.componentInstance.error=t.result}},{key:"moveUp",value:function(e){var t=this.tome.spells.indexOf(e),c=t-1;c>-1&&(Object(ne.a)(this.tome.spells,t,c),this.changed.emit())}},{key:"moveDown",value:function(e){var t=this.tome.spells.indexOf(e),c=t+1;c<this.tome.spells.length&&(Object(ne.a)(this.tome.spells,t,c),this.changed.emit())}}]),t}();ht.\u0275fac=function(e){return new(e||ht)(M.dc(O.b),M.dc(X))},ht.\u0275cmp=M.Xb({type:ht,selectors:[["avr-spell-list"]],inputs:{tome:"tome",user:"user"},outputs:{selected:"selected",changed:"changed",moveToEditor:"moveToEditor"},decls:5,vars:19,consts:[["fxLayout","row","fxLayoutGap","8px",1,"container"],["class","spell-list","fxFlex","grow",4,"ngIf"],["fxFlex","grow",1,"spell-preview","mat-typography","mat-elevation-z3"],[3,"name","image","level","school","classes","subclasses","verbal","somatic","material","time","ritual","range","concentration","duration","description","higherlevels","user"],["fxFlex","grow",1,"spell-list"],[3,"spell","isFirst","isLast","moveUp","moveDown","changed","opened","delete","moveToEditor",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"new-spell-card"],[1,"no-text-cursor"],[1,"toolbar-spacer"],["mat-icon-button","","matTooltip","Import from JSON",3,"click"],["aria-label","Import from JSON"],["mat-icon-button","","matTooltip","Copy SRD spell",3,"click"],["aria-label","From existing spell"],["mat-icon-button","",3,"click"],["aria-label","New"],[3,"spell","isFirst","isLast","moveUp","moveDown","changed","opened","delete","moveToEditor"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(M.jc(0,"div",0),M.Wc(1,gt,17,1,"div",1),M.Wc(2,ft,12,0,"div",1),M.jc(3,"div",2),M.ec(4,"avr-spell-embed",3),M.ic(),M.ic()),2&e&&(M.Rb(1),M.Ac("ngIf",t.tome.spells.length),M.Rb(1),M.Ac("ngIf",!t.tome.spells.length),M.Rb(2),M.Ac("name",null==t.selectedSpell?null:t.selectedSpell.name)("image",null==t.selectedSpell?null:t.selectedSpell.image)("level",null==t.selectedSpell?null:t.selectedSpell.level)("school",null==t.selectedSpell?null:t.selectedSpell.school)("classes",null==t.selectedSpell?null:t.selectedSpell.classes)("subclasses",null==t.selectedSpell?null:t.selectedSpell.subclasses)("verbal",null==t.selectedSpell?null:t.selectedSpell.components.verbal)("somatic",null==t.selectedSpell?null:t.selectedSpell.components.somatic)("material",null==t.selectedSpell?null:t.selectedSpell.components.material)("time",null==t.selectedSpell?null:t.selectedSpell.casttime)("ritual",null==t.selectedSpell?null:t.selectedSpell.ritual)("range",null==t.selectedSpell?null:t.selectedSpell.range)("concentration",null==t.selectedSpell?null:t.selectedSpell.concentration)("duration",null==t.selectedSpell?null:t.selectedSpell.duration)("description",null==t.selectedSpell?null:t.selectedSpell.description)("higherlevels",null==t.selectedSpell?null:t.selectedSpell.higherlevels)("user",t.user))},directives:[H.f,H.g,l.t,H.b,Qe.a,F.a,l.s,V.a,H.e,R.b,T.a,L.a,mt],styles:[".container[_ngcontent-%COMP%]{margin:8px}.spell-list[_ngcontent-%COMP%], .spell-preview[_ngcontent-%COMP%]{max-height:calc(100vh - 240px);overflow-y:auto}.new-spell-card[_ngcontent-%COMP%]{height:48px;padding:0 24px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]});var vt=a("UgTo");function bt(e,t){if(1&e){var c=M.kc();M.jc(0,"div",1),M.jc(1,"mat-card"),M.jc(2,"p"),M.Xc(3),M.ic(),M.jc(4,"p"),M.Xc(5,"You can find help on how to use the spell editor "),M.jc(6,"a",2),M.Xc(7,"here"),M.ic(),M.Xc(8,"."),M.ic(),M.jc(9,"avr-automation-editor",3),M.rc("changed",(function(){return M.Mc(c),M.vc().changed.emit()})),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(3),M.Zc("Editing ",n.spell.name,"..."),M.Rb(6),M.Ac("automation",n.getAutomation(n.spell))("spell",n.spell)}}function jt(e,t){1&e&&(M.jc(0,"div",1),M.jc(1,"mat-card"),M.jc(2,"p"),M.Xc(3," No spell selected. "),M.ic(),M.ic(),M.ic())}var kt=function(){function e(){i(this,e),this.changed=new M.u}return o(e,[{key:"ngOnInit",value:function(){}},{key:"getAutomation",value:function(e){return null===e.automation&&(e.automation=[]),e.automation}}]),e}();function Mt(e,t){if(1&e){var c=M.kc();M.jc(0,"div"),M.jc(1,"mat-toolbar",1),M.jc(2,"span"),M.jc(3,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().back()})),M.jc(4,"mat-icon",3),M.Xc(5,"arrow_back"),M.ic(),M.ic(),M.ic(),M.jc(6,"span"),M.Xc(7),M.ic(),M.ec(8,"span",4),M.jc(9,"span"),M.jc(10,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().commit()})),M.jc(11,"mat-icon",5),M.Xc(12,"save"),M.ic(),M.ic(),M.jc(13,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().beginSettings()})),M.jc(14,"mat-icon",6),M.Xc(15,"settings"),M.ic(),M.ic(),M.jc(16,"button",2),M.rc("click",(function(){return M.Mc(c),M.vc().beginShare()})),M.jc(17,"mat-icon",7),M.Xc(18,"launch"),M.ic(),M.ic(),M.ic(),M.ic(),M.jc(19,"mat-tab-group",8,9),M.jc(21,"mat-tab",10),M.jc(22,"avr-spell-list",11),M.rc("selected",(function(e){return M.Mc(c),M.vc().selectedSpell=e}))("changed",(function(){return M.Mc(c),M.vc().ensureChangesNotif()}))("moveToEditor",(function(){return M.Mc(c),M.Jc(20).selectedIndex=1})),M.ic(),M.ic(),M.jc(23,"mat-tab",12),M.jc(24,"avr-spell-editor",13),M.rc("changed",(function(){return M.Mc(c),M.vc().ensureChangesNotif()})),M.ic(),M.ic(),M.ic(),M.ic()}if(2&e){var n=M.vc();M.Rb(7),M.Zc(" ",n.tome.name," "),M.Rb(15),M.Ac("tome",n.tome)("user",n.user),M.Rb(2),M.Ac("spell",n.selectedSpell)}}function wt(e,t){1&e&&(M.jc(0,"div"),M.jc(1,"div",14),M.jc(2,"mat-card"),M.ec(3,"mat-spinner",15),M.ic(),M.ic(),M.ic()),2&e&&(M.Rb(3),M.Ac("diameter",24))}function yt(e,t){if(1&e){var c=M.kc();M.jc(0,"div"),M.jc(1,"div",14),M.jc(2,"mat-card"),M.jc(3,"p"),M.Xc(4,"You do not have permission to edit this tome."),M.ic(),M.jc(5,"button",16),M.rc("click",(function(){return M.Mc(c),M.vc().back()})),M.Xc(6,"Go Back"),M.ic(),M.ic(),M.ic(),M.ic()}}kt.\u0275fac=function(e){return new(e||kt)},kt.\u0275cmp=M.Xb({type:kt,selectors:[["avr-spell-editor"]],inputs:{spell:"spell"},outputs:{changed:"changed"},decls:2,vars:2,consts:[["class","container",4,"ngIf"],[1,"container"],["target","_blank","href","https://avrae.readthedocs.io/en/latest/automation_ref.html"],[3,"automation","spell","changed"]],template:function(e,t){1&e&&(M.Wc(0,bt,10,3,"div",0),M.Wc(1,jt,4,0,"div",0)),2&e&&(M.Ac("ngIf",t.spell),M.Rb(1),M.Ac("ngIf",!t.spell))},directives:[l.t,V.a,vt.a],styles:[".container[_ngcontent-%COMP%]{margin:8px}"]});var Ct=function(){function e(t,c,n,a,o,l,r){i(this,e),this.route=t,this.homebrewService=c,this.dashboardService=n,this.location=a,this.dialog=o,this.router=l,this.snackBar=r,this.user=Object(j.d)(),this.changesOpen=!1}return o(e,[{key:"ngOnInit",value:function(){this.getTome()}},{key:"ngOnDestroy",value:function(){this.snackBar.dismiss()}},{key:"getTome",value:function(){var e=this,t=this.route.snapshot.paramMap.get("tome");this.homebrewService.getTome(t).subscribe((function(t){e.tome=t,e.calcCanEdit()}))}},{key:"calcCanEdit",value:function(){var e=this;if(this.tome&&this.user)if(this.isOwner=this.user.id===this.tome.owner,this.isOwner)this.canEdit=!0;else{var t=this.tome._id.$oid;this.homebrewService.getTomeEditors(t).subscribe((function(t){return e.canEdit=t.some((function(t){return t===e.user.id}))}))}}},{key:"ensureChangesNotif",value:function(){var e=this;this.changesOpen||(this.changesOpen=!0,this.snackBar.open("You have unsaved changes!","Save",{duration:-1,horizontalPosition:"right"}).onAction().subscribe((function(){e.commit()})))}},{key:"beginShare",value:function(){var e=this;this.dialog.open(Je,{data:this.tome,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),e.tome=Object.assign(e.tome,t),e.commit())}))}},{key:"beginSettings",value:function(){var e=this;this.dialog.open(Ve,{data:this.tome,width:"40%",disableClose:!0}).afterClosed().subscribe((function(t){t&&(console.log(t),t.delete?e.delete():(e.tome=Object.assign(e.tome,t),e.commit()))}))}},{key:"commit",value:function(){var e=this;this.homebrewService.putTome(this.tome).subscribe((function(t){console.log(t),e.changesOpen=!1,e.snackBar.open("".concat(t,' Use "!tome ').concat(e.tome.name,'" to activate the tome in Discord!'),null,{horizontalPosition:"right"})}))}},{key:"delete",value:function(){var e=this;this.homebrewService.deleteTome(this.tome).subscribe((function(t){console.log(t),e.router.navigate(["../"],{relativeTo:e.route})}))}},{key:"back",value:function(){this.location.back()}}]),e}();Ct.\u0275fac=function(e){return new(e||Ct)(M.dc(f.a),M.dc(X),M.dc(oe.a),M.dc(l.n),M.dc(O.b),M.dc(f.b),M.dc(de.b))},Ct.\u0275cmp=M.Xb({type:Ct,selectors:[["avr-tome-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["color","primary",1,"tome-toolbar"],["mat-icon-button","",3,"click"],["aria-label","Back"],[1,"toolbar-spacer"],["aria-label","Save"],["aria-label","Settings"],["aria-label","Share"],["backgroundColor","primary"],["tabGroup",""],["label","Spells"],[3,"tome","user","selected","changed","moveToEditor"],["label","Editor"],[3,"spell","changed"],[1,"container"],[3,"diameter"],["mat-raised-button","","color","accent",3,"click"]],template:function(e,t){1&e&&(M.Wc(0,Mt,25,4,"div",0),M.Wc(1,wt,4,1,"div",0),M.Wc(2,yt,7,0,"div",0)),2&e&&(M.Ac("ngIf",t.tome&&null!=t.canEdit),M.Rb(1),M.Ac("ngIf",!t.tome),M.Rb(1),M.Ac("ngIf",t.tome&&!t.canEdit))},directives:[l.t,z.a,R.b,L.a,Ke.c,Ke.a,ht,kt,V.a,U.c],styles:[".tome-toolbar[_ngcontent-%COMP%]{height:64px}mat-tab-header[_ngcontent-%COMP%]{height:48px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.no-text-cursor[_ngcontent-%COMP%]{cursor:default}"]});var Xt=[{path:"",children:[{path:"items",component:ce},{path:"items/:pack",component:Ae},{path:"spells",component:Ye},{path:"spells/:tome",component:Ct}]}],Ot=function e(){i(this,e)};Ot.\u0275mod=M.bc({type:Ot}),Ot.\u0275inj=M.ac({factory:function(e){return new(e||Ot)},imports:[[f.d.forChild(Xt)],f.d]});var St=function e(){i(this,e)};St.\u0275mod=M.bc({type:St}),St.\u0275inj=M.ac({factory:function(e){return new(e||St)},imports:[[l.c,d.a,s.h,r.a,u.b.forChild(),p.a,m.a,g.a,Ot]]})}}])}();
//# sourceMappingURL=11-es5.fdbecc0ea4e39c804a5c.js.map