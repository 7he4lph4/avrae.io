(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[225],{9225:(vt,K,f)=>{"use strict";f.r(K),f.d(K,{WorkshopModule:()=>X});var _=f(6362),x=f(587),p=f(5283),O=f(6218),xt=f(6774),t=f(3184);class E{}E.\u0275fac=function(o){return new(o||E)},E.\u0275mod=t.oAB({type:E}),E.\u0275inj=t.cJS({imports:[[_.ez]]});var T=f(9481),b=f(2251),L=f(4986),l=f(6488),a=f(5758),u=f(7597),r=f(4770),s=f(4683),d=f(7317),g=f(4742);function h(n,o){if(1&n&&(t.TgZ(0,"p"),t._uU(1," Note: Since your collection is published, you "),t.TgZ(2,"em"),t._uU(3,"cannot delete"),t.qZA(),t._uU(4),t.ALo(5,"lowercase"),t.qZA()),2&n){const e=t.oxw();t.xp6(4),t.hij(" this ",t.lcZ(5,1,e.collectableType)," once created. ")}}function Z(n,o){1&n&&(t.TgZ(0,"mat-hint"),t._uU(1," This will appear in your alias' help command. "),t.qZA())}function v(n,o){if(1&n&&(t.TgZ(0,"p",10),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function y(n,o){1&n&&t._UZ(0,"mat-spinner",11),2&n&&t.Q6J("diameter",24)}class k{constructor(o,e,i){this.data=o,this.dialogRef=e,this.workshopService=i,this.PublicationState=b.BL,this.CollectableType=b.v$,this.loading=!1,this.collection=o.collection,this.parent=o.parent,this.collectableType=o.collectableType}ngOnInit(){}onCreate(){switch(this.loading=!0,this.collectableType){case b.v$.ALIAS:return this.onCreateAlias();case b.v$.SNIPPET:return this.onCreateSnippet();case b.v$.SUBALIAS:return this.onCreateSubalias();default:this.error="Unknown collectable type (this is a bug)",this.loading=!1}}onCreateAlias(){this.workshopService.createAlias(this.collection._id,this.name,this.docs).subscribe(o=>this.handleCreateResponse(o))}onCreateSnippet(){this.workshopService.createSnippet(this.collection._id,this.name,this.docs).subscribe(o=>this.handleCreateResponse(o))}onCreateSubalias(){this.parent||(this.error="You are not in an alias context (this is a bug)",this.loading=!1),this.workshopService.createSubalias(this.parent._id,this.name,this.docs).subscribe(o=>this.handleCreateResponse(o))}handleCreateResponse(o){this.loading=!1,o.success?this.dialogRef.close(o.data):this.error=o.error}}k.\u0275fac=function(o){return new(o||k)(t.Y36(a.WI),t.Y36(a.so),t.Y36(u.a))},k.\u0275cmp=t.Xpm({type:k,selectors:[["avr-create-collectable-dialog"]],decls:24,vars:12,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"mat-typography"],[4,"ngIf"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","mat-autosize","",3,"ngModel","ngModelChange"],["class","mat-error",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],[3,"diameter",4,"ngIf"],[1,"mat-error"],[3,"diameter"]],template:function(o,e){1&o&&(t.TgZ(0,"h1",0),t._uU(1),t.ALo(2,"titlecase"),t.qZA(),t.TgZ(3,"div",1)(4,"p"),t._uU(5),t.ALo(6,"lowercase"),t.qZA(),t.YNc(7,h,6,3,"p",2),t.TgZ(8,"mat-form-field")(9,"mat-label"),t._uU(10,"Name"),t.qZA(),t.TgZ(11,"input",3),t.NdJ("ngModelChange",function(c){return e.name=c}),t.qZA()(),t.TgZ(12,"mat-form-field")(13,"mat-label"),t._uU(14,"Documentation (Markdown Supported)"),t.qZA(),t.TgZ(15,"textarea",4),t.NdJ("ngModelChange",function(c){return e.docs=c}),t.qZA(),t.YNc(16,Z,2,0,"mat-hint",2),t.qZA(),t.YNc(17,v,2,1,"p",5),t.qZA(),t.TgZ(18,"div",6)(19,"button",7),t._uU(20,"Cancel"),t.qZA(),t.TgZ(21,"button",8),t.NdJ("click",function(){return e.onCreate()}),t._uU(22,"Create"),t.qZA(),t.YNc(23,y,1,1,"mat-spinner",9),t.qZA()),2&o&&(t.xp6(1),t.hij("Create New ",t.lcZ(2,8,e.collectableType),""),t.xp6(4),t.hij(" First, give the new ",t.lcZ(6,10,e.collectableType)," a name and a description. You'll be able to edit the code after it's created. "),t.xp6(2),t.Q6J("ngIf",e.collection.publish_state===e.PublicationState.PUBLISHED&&e.collectableType!==e.CollectableType.SUBALIAS),t.xp6(4),t.Q6J("ngModel",e.name),t.xp6(4),t.Q6J("ngModel",e.docs),t.xp6(1),t.Q6J("ngIf",e.collectableType===e.CollectableType.ALIAS||e.collectableType===e.CollectableType.SUBALIAS),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(6),t.Q6J("ngIf",e.loading))},directives:[a.uh,a.xY,_.O5,r.KE,r.hX,s.Nt,x.Fj,x.JJ,x.On,r.bx,a.H8,d.lW,a.ZT,g.Ou],pipes:[_.rS,_.i8],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin-left:8px}"]});var U=f(4350),F=f(6942),A=f(205),S=f(1434),q=f(1130),Y=f(89);function yt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-select",14),t.NdJ("valueChange",function(c){t.CHM(e);return t.oxw().publishState=c}),t.TgZ(1,"mat-option",15),t._uU(2," Private (Only the owner and editors can subscribe) "),t.qZA(),t.TgZ(3,"mat-option",15),t._uU(4," Unlisted (Anyone with the link can subscribe) "),t.qZA(),t.TgZ(5,"mat-option",16),t._uU(6," Published (Anyone can find this collection in the workshop) "),t.qZA()()}if(2&n){const e=t.oxw();t.Q6J("value",e.publishState),t.xp6(1),t.Q6J("value",e.PublicationState.PRIVATE),t.xp6(2),t.Q6J("value",e.PublicationState.UNLISTED)}}function w(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-select",17),t.NdJ("valueChange",function(c){t.CHM(e);return t.oxw().publishState=c}),t.TgZ(1,"mat-option",15),t._uU(2," Published "),t.qZA()()}if(2&n){const e=t.oxw();t.Q6J("value",e.publishState),t.xp6(1),t.Q6J("value",e.PublicationState.PUBLISHED)}}function P(n,o){if(1&n&&(t.TgZ(0,"p",18),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function tt(n,o){1&n&&t._UZ(0,"mat-spinner",19),2&n&&t.Q6J("diameter",24)}function ht(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().onDelete()}),t._uU(1," Delete "),t.qZA()}}function N(n,o){1&n&&(t.TgZ(0,"div",21)(1,"button",22),t._uU(2," Delete "),t.qZA()())}class Q{constructor(o,e,i,c,m){this.data=o,this.dialogRef=e,this.dialog=i,this.router=c,this.workshopService=m,this.PublicationState=b.BL,this.loading=!1,this.collection=o.collection,this.name=o.collection.name,this.description=o.collection.description,this.imageUrl=o.collection.image,this.publishState=o.collection.publish_state}ngOnInit(){}onSaveAndExit(){this.error=null,this.loading=!0;let o,e=[];(this.name!==this.collection.name||this.description!==this.collection.description||this.imageUrl!==this.collection.image)&&e.push(this.workshopService.editCollection(this.collection._id,this.name,this.description,this.imageUrl).pipe((0,F.U)(i=>(i.success&&!o?o=i.data:i.success&&(o=Object.assign(Object.assign({},o),{name:i.data.name,description:i.data.description,image:i.data.image})),i)))),this.publishState!==this.collection.publish_state&&e.push(this.workshopService.editCollectionState(this.collection._id,this.publishState).pipe((0,F.U)(i=>(i.success&&!o?o=i.data:i.success&&(o=Object.assign(Object.assign({},o),{publish_state:i.data.publish_state})),i)))),e.length?(0,U.D)(e).subscribe(i=>{this.loading=!1,i.every(c=>c.success)?this.dialogRef.close(o):this.error=i.filter(c=>c.error).map(c=>c.error).join("\n\n")}):this.dialogRef.close()}onDelete(){this.dialog.open(A.h,{data:{name:this.collection.name,message:"Deleting this collection will remove it from all subscribers' collections and all servers. This is not reversible."}}).afterClosed().subscribe(e=>{e&&(this.error=null,this.loading=!0,this.workshopService.deleteCollection(this.collection._id).subscribe(i=>{this.loading=!1,i.success?(this.dialogRef.close(),this.router.navigate(["/dashboard/workshop/my-work"])):this.error=i.error}))})}}Q.\u0275fac=function(o){return new(o||Q)(t.Y36(a.WI),t.Y36(a.so),t.Y36(a.uw),t.Y36(T.F0),t.Y36(u.a))},Q.\u0275cmp=t.Xpm({type:Q,selectors:[["avr-edit-settings-dialog"]],decls:32,vars:10,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"mat-typography"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","mat-autosize","",3,"ngModel","ngModelChange"],[3,"value","valueChange",4,"ngIf"],["matTooltip","You cannot unpublish a collection.","disabled","",3,"value","valueChange",4,"ngIf"],["class","mat-error",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],[3,"diameter",4,"ngIf"],[1,"toolbar-spacer"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["matTooltip","You cannot delete a published collection.",4,"ngIf"],[3,"value","valueChange"],[3,"value"],["disabled","","matTooltip","To publish this collection, click Publish on the main edit page."],["matTooltip","You cannot unpublish a collection.","disabled","",3,"value","valueChange"],[1,"mat-error"],[3,"diameter"],["mat-flat-button","","color","warn",3,"click"],["matTooltip","You cannot delete a published collection."],["mat-flat-button","","color","warn","disabled",""]],template:function(o,e){1&o&&(t.TgZ(0,"h1",0),t._uU(1),t.qZA(),t.TgZ(2,"div",1)(3,"p"),t._uU(4,"This won't change how the collection appears for anyone else until you click Save."),t.qZA(),t.TgZ(5,"mat-form-field")(6,"mat-label"),t._uU(7,"Name"),t.qZA(),t.TgZ(8,"input",2),t.NdJ("ngModelChange",function(c){return e.name=c}),t.qZA()(),t.TgZ(9,"mat-form-field")(10,"mat-label"),t._uU(11,"Description (Markdown Supported)"),t.qZA(),t.TgZ(12,"textarea",3),t.NdJ("ngModelChange",function(c){return e.description=c}),t.qZA()(),t.TgZ(13,"mat-form-field")(14,"mat-label"),t._uU(15,"Image URL"),t.qZA(),t.TgZ(16,"input",2),t.NdJ("ngModelChange",function(c){return e.imageUrl=c}),t.qZA()(),t.TgZ(17,"mat-form-field")(18,"mat-label"),t._uU(19,"Sharing Settings"),t.qZA(),t.YNc(20,yt,7,3,"mat-select",4),t.YNc(21,w,3,2,"mat-select",5),t.qZA(),t.YNc(22,P,2,1,"p",6),t.qZA(),t.TgZ(23,"div",7)(24,"button",8),t._uU(25,"Cancel"),t.qZA(),t.TgZ(26,"button",9),t.NdJ("click",function(){return e.onSaveAndExit()}),t._uU(27,"Save"),t.qZA(),t.YNc(28,tt,1,1,"mat-spinner",10),t._UZ(29,"span",11),t.YNc(30,ht,2,0,"button",12),t.YNc(31,N,3,0,"div",13),t.qZA()),2&o&&(t.xp6(1),t.hij("Editing ",e.collection.name,"..."),t.xp6(7),t.Q6J("ngModel",e.name),t.xp6(4),t.Q6J("ngModel",e.description),t.xp6(4),t.Q6J("ngModel",e.imageUrl),t.xp6(4),t.Q6J("ngIf",e.publishState!==e.PublicationState.PUBLISHED),t.xp6(1),t.Q6J("ngIf",e.publishState===e.PublicationState.PUBLISHED),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(6),t.Q6J("ngIf",e.loading),t.xp6(2),t.Q6J("ngIf",e.publishState!==e.PublicationState.PUBLISHED),t.xp6(1),t.Q6J("ngIf",e.publishState===e.PublicationState.PUBLISHED))},directives:[a.uh,a.xY,r.KE,r.hX,s.Nt,x.Fj,x.JJ,x.On,_.O5,S.gD,q.ey,Y.gM,a.H8,d.lW,a.ZT,g.Ou],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin-left:8px}",".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}"]});var It=f(1534),B=f(9975);function Nt(n,o){1&n&&t._UZ(0,"mat-divider")}function Jt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"section",8)(2,"mat-checkbox",9),t.NdJ("ngModelChange",function(c){const C=t.CHM(e).index;return t.oxw().agreed[C]=c}),t._UZ(3,"div",10),t.qZA()(),t.YNc(4,Nt,1,0,"mat-divider",11),t.qZA()}if(2&n){const e=o.$implicit,i=o.last,c=o.index,m=t.oxw();t.xp6(2),t.Q6J("ngModel",m.agreed[c]),t.xp6(1),t.Q6J("innerHTML",e,t.oJD),t.xp6(1),t.Q6J("ngIf",!i)}}function Ft(n,o){if(1&n&&(t.TgZ(0,"p",12),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function Yt(n,o){1&n&&t._UZ(0,"mat-spinner",13),2&n&&t.Q6J("diameter",24)}const kt=["I understand that after publishing this collection, I <b>cannot delete or unpublish</b> it or any item contained in it.","If any item in this collection uses rules or data that is not in the System Reference Document, I have added the required license(s) to that item.","Aside from any data which I have added the license to use, I and/or this collection's editors am/are the sole owner(s) of the content in this collection.","The code contained in this collection is for anyone to use, and <b>not intended for one specific Discord server</b>.",'I agree to the <a href="https://github.com/avrae/.github/blob/master/community/alias-workshop-rules.md" target="_blank">Alias Workshop Rules & Guidelines</a>.'];class et{constructor(o,e,i){this.data=o,this.dialogRef=e,this.workshopService=i,this.PUBLISH_STEPS=kt,this.agreed=new Array(kt.length).fill(!1),this.loading=!1,this.collection=o.collection}ngOnInit(){}onPublish(){this.loading=!0,this.error=null,this.workshopService.editCollectionState(this.collection._id,b.BL.PUBLISHED).subscribe(o=>{this.loading=!1,o.success?this.dialogRef.close(o.data):this.error=o.error})}canPublish(){return this.agreed.every(o=>o)}}et.\u0275fac=function(o){return new(o||et)(t.Y36(a.WI),t.Y36(a.so),t.Y36(u.a))},et.\u0275cmp=t.Xpm({type:et,selectors:[["avr-publish-dialog"]],decls:13,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"mat-typography"],[4,"ngFor","ngForOf"],["class","mat-error",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"disabled","click"],[3,"diameter",4,"ngIf"],[1,"publish-agree"],[3,"ngModel","ngModelChange"],[3,"innerHTML"],[4,"ngIf"],[1,"mat-error"],[3,"diameter"]],template:function(o,e){1&o&&(t.TgZ(0,"h1",0),t._uU(1),t.qZA(),t.TgZ(2,"div",1)(3,"p"),t._uU(4," Make sure the name, description, and image of the collection are correct, then agree to the following to publish: "),t.qZA(),t.YNc(5,Jt,5,3,"div",2),t.YNc(6,Ft,2,1,"p",3),t.qZA(),t.TgZ(7,"div",4)(8,"button",5),t._uU(9,"Cancel"),t.qZA(),t.TgZ(10,"button",6),t.NdJ("click",function(){return e.onPublish()}),t._uU(11,"Publish"),t.qZA(),t.YNc(12,Yt,1,1,"mat-spinner",7),t.qZA()),2&o&&(t.xp6(1),t.hij("Publishing ",e.collection.name,"..."),t.xp6(4),t.Q6J("ngForOf",e.PUBLISH_STEPS),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(4),t.Q6J("disabled",!e.canPublish()),t.xp6(2),t.Q6J("ngIf",e.loading))},directives:[a.uh,a.xY,_.sg,It.oG,x.JJ,x.On,_.O5,B.d,a.H8,d.lW,a.ZT,g.Ou],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin-left:8px}",".publish-agree[_ngcontent-%COMP%]{margin:8px 0}\n/*# sourceMappingURL=publish-dialog.component.css.map*/"]});var ot=f(2528),$=f(7004),nt=f(9946),I=f(5590),it=f(2938),J=f(1196),D=f(2796);function Qt(n,o){1&n&&(t.TgZ(0,"mat-icon",6),t._uU(1,"cancel"),t.qZA())}function Dt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-chip",4),t.NdJ("removed",function(){const m=t.CHM(e).$implicit;return t.oxw(2).onTagRemoved(m)}),t._uU(1),t.YNc(2,Qt,2,0,"mat-icon",5),t.qZA()}if(2&n){const e=o.$implicit,i=t.oxw(2);t.Q6J("removable",i.showEdit),t.xp6(1),t.hij(" ",i.tagNameFromSlug(e)," "),t.xp6(1),t.Q6J("ngIf",i.showEdit)}}function Lt(n,o){if(1&n&&(t.TgZ(0,"mat-chip"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij("",e.collection.tags.length-e.limit," more...")}}function Bt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-option",12),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw(4).onTagAdd(m)}),t._uU(1),t.qZA()}if(2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function jt(n,o){if(1&n&&(t.TgZ(0,"mat-optgroup",10),t.YNc(1,Bt,2,1,"mat-option",11),t.qZA()),2&n){const e=o.$implicit;t.Q6J("label",e[0]),t.xp6(1),t.Q6J("ngForOf",e[1])}}function Rt(n,o){if(1&n&&(t.TgZ(0,"div")(1,"mat-chip",7),t._uU(2,"Add Tag..."),t.qZA(),t.TgZ(3,"mat-menu",null,8),t.YNc(5,jt,2,2,"mat-optgroup",9),t.qZA()()),2&n){const e=t.MAs(4),i=t.oxw(2);t.xp6(1),t.Q6J("matMenuTriggerFor",e),t.xp6(4),t.Q6J("ngForOf",i.addableTags)}}function Ht(n,o){if(1&n&&(t.TgZ(0,"mat-chip-list",1),t.YNc(1,Dt,3,3,"mat-chip",2),t.YNc(2,Lt,2,1,"mat-chip",3),t.YNc(3,Rt,6,2,"div",3),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.limit?e.collection.tags.slice(0,e.limit):e.collection.tags),t.xp6(1),t.Q6J("ngIf",e.limit&&e.collection.tags.length>e.limit),t.xp6(1),t.Q6J("ngIf",e.showEdit)}}class j{constructor(o){this.workshopService=o,this.showEdit=!1,this.tagRemove=new t.vpe,this.tagAdd=new t.vpe,this.addableTags=[]}ngOnInit(){this.loadTags()}onTagAdd(o){this.workshopService.addCollectionTag(this.collection._id,o.slug).subscribe(e=>{e.success&&(this.collection.tags=e.data,this.tagAdd.emit(o),this.updateAddableTags())})}onTagRemoved(o){this.workshopService.removeCollectionTag(this.collection._id,o).subscribe(e=>{e.success&&(this.collection.tags=e.data,this.tagRemove.emit(o),this.updateAddableTags())})}loadTags(){this.workshopService.getTags().subscribe(o=>{o.success&&(this.tags=o.data,this.updateAddableTags())})}tagNameFromSlug(o){return this.tags.map(e=>e.slug).includes(o)?this.tags.find(e=>e.slug===o).name:o}updateAddableTags(){this.addableTags=Object.entries((0,it.groupBy)(this.tags.filter(o=>!this.collection.tags.includes(o.slug)),o=>o.category))}}function Vt(n,o){if(1&n&&(t.TgZ(0,"div",1)(1,"div",2),t._UZ(2,"img",3),t.qZA(),t.TgZ(3,"div",4)(4,"strong"),t._uU(5),t.qZA()(),t.TgZ(6,"div",5),t.Hsn(7),t.qZA(),t.TgZ(8,"div",6),t._uU(9),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.MGl("alt","Avatar of ",e.user.username,""),t.Q6J("src",e.user.avatarUrl,t.LSH),t.xp6(3),t.Oqu(e.getUsername()),t.xp6(4),t.hij(" ",e.getDiscriminator()," ")}}j.\u0275fac=function(o){return new(o||j)(t.Y36(u.a))},j.\u0275cmp=t.Xpm({type:j,selectors:[["avr-tag-chip-list"]],inputs:{collection:"collection",limit:"limit",showEdit:"showEdit"},outputs:{tagRemove:"tagRemove",tagAdd:"tagAdd"},decls:1,vars:1,consts:[["aria-label","Tag list","class","collection-tags",4,"ngIf"],["aria-label","Tag list",1,"collection-tags"],[3,"removable","removed",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"matMenuTriggerFor"],["menu","matMenu"],[3,"label",4,"ngFor","ngForOf"],[3,"label"],[3,"click",4,"ngFor","ngForOf"],[3,"click"]],template:function(o,e){1&o&&t.YNc(0,Ht,4,3,"mat-chip-list",0),2&o&&t.Q6J("ngIf",(null==e.tags?null:e.tags.length)&&(e.collection.tags.length||e.showEdit))},directives:[_.O5,J.qn,_.sg,J.HS,I.Hw,J.qH,D.p6,D.VK,q.Nv,q.ey],encapsulation:2});class R{constructor(o){this.discordService=o}ngOnInit(){!this.user&&this.userId&&this.loadUser()}loadUser(){this.discordService.getUser(this.userId).subscribe(o=>{this.user=o})}getUsername(){return this.user.username.substring(0,this.user.username.lastIndexOf("#"))}getDiscriminator(){return this.user.username.substring(this.user.username.lastIndexOf("#"))}}R.\u0275fac=function(o){return new(o||R)(t.Y36($.h))},R.\u0275cmp=t.Xpm({type:R,selectors:[["avr-pretty-user"]],inputs:{userId:"userId",user:"user"},ngContentSelectors:["*"],decls:1,vars:1,consts:[["class","user-grid",4,"ngIf"],[1,"user-grid"],[1,"user-img"],[3,"src","alt"],[1,"user-username"],[1,"buttons"],[1,"user-discriminator"]],template:function(o,e){1&o&&(t.F$t(),t.YNc(0,Vt,10,4,"div",0)),2&o&&t.Q6J("ngIf",e.user)},directives:[_.O5],styles:[".user-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto;grid-template-rows:auto auto;grid-column-gap:8px;line-height:18px}.user-img[_ngcontent-%COMP%]{grid-row-start:span 2}.user-img[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:36px;width:36px;border-radius:100%}.user-username[_ngcontent-%COMP%]{grid-column-start:2}.user-discriminator[_ngcontent-%COMP%]{grid-column-start:2;color:#ffffff9e}.buttons[_ngcontent-%COMP%]{grid-column-start:3;grid-row-start:span 2}"]});var Wt=f(2218),Ut=f(823),zt=f(3298);function Gt(n,o){1&n&&t._UZ(0,"mat-spinner",4),2&n&&t.Q6J("diameter",16)}function Xt(n,o){if(1&n&&(t.TgZ(0,"div",5),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function Kt(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",6)(1,"avr-pretty-user",7)(2,"button",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().onAddEditor()}),t.TgZ(3,"mat-icon",9),t._uU(4,"add"),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("user",e.validEditor)}}class lt{constructor(o){this.discordService=o,this.editorSearch=new Wt.xQ,this.loading=!1,this.addEditor=new t.vpe}ngOnInit(){this.editorSearch.pipe((0,Ut.b)(750)).pipe((0,zt.x)()).subscribe(o=>this.onSearchUser(o))}onEditorSearch(o){this.editorSearch.next(o.target.value)}onSearchUser(o){this.validEditor=null,this.error=null,o.includes("#")&&(this.loading=!0,this.discordService.searchUser(o).subscribe(e=>{this.loading=!1,e.success?this.validEditor=e.data:404===e.status?this.error="No matching user found. Make sure the username is correct and that they have logged in here at least once!":this.error=e.error}))}onAddEditor(){this.addEditor.emit(this.validEditor)}}lt.\u0275fac=function(o){return new(o||lt)(t.Y36($.h))},lt.\u0275cmp=t.Xpm({type:lt,selectors:[["avr-add-editor"]],outputs:{addEditor:"addEditor"},decls:7,vars:3,consts:[["matInput","","placeholder","zhu.exe#4211",3,"keyup"],["matSuffix","",3,"diameter",4,"ngIf"],["class","mat-error",4,"ngIf"],["class","valid-user",4,"ngIf"],["matSuffix","",3,"diameter"],[1,"mat-error"],[1,"valid-user"],[3,"user"],["mat-icon-button","","matTooltip","Add editor",3,"click"],[1,"muted"]],template:function(o,e){1&o&&(t.TgZ(0,"mat-form-field")(1,"mat-label"),t._uU(2,"Add Editor"),t.qZA(),t.TgZ(3,"input",0),t.NdJ("keyup",function(c){return e.onEditorSearch(c)}),t.qZA(),t.YNc(4,Gt,1,1,"mat-spinner",1),t.qZA(),t.YNc(5,Xt,2,1,"div",2),t.YNc(6,Kt,5,1,"div",3)),2&o&&(t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(1),t.Q6J("ngIf",e.validEditor))},directives:[r.KE,r.hX,s.Nt,_.O5,g.Ou,r.R9,R,d.lW,Y.gM,I.Hw],styles:[".valid-user[_ngcontent-%COMP%]{margin-bottom:8px}\n/*# sourceMappingURL=add-editor.component.ts-angular-inline--3.css.map*/"]});var Tt=f(7963);function te(n,o){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.isOpen?"expand_less":"expand_more"," ")}}function ee(n,o){if(1&n&&(t.TgZ(0,"div",9),t._uU(1," Rebound from "),t.TgZ(2,"code"),t._uU(3),t.qZA()()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.getUnboundSignature())}}function oe(n,o){if(1&n&&(t.TgZ(0,"div",10)(1,"markdown"),t._uU(2),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(e.debrace(e.getShortDocs()))}}function ne(n,o){if(1&n&&(t.TgZ(0,"div",11)(1,"markdown"),t._uU(2),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(e.debrace(e.collectable.docs))}}function ie(n,o){if(1&n&&(t.TgZ(0,"div")(1,"a",17),t.ALo(2,"async"),t._uU(3),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()()),2&n){const e=o.$implicit,i=t.oxw(3);let c,m;t.xp6(1),t.Q6J("href",null==(c=t.lcZ(2,3,i.getEntity(e)))?null:c.marketplace_url,t.LSH),t.xp6(2),t.AsE(" ",null==(m=t.lcZ(4,5,i.getEntity(e)))?null:m.name," (",null==(m=t.lcZ(5,7,i.getEntity(e)))?null:m.source,") ")}}function le(n,o){if(1&n&&(t.TgZ(0,"div",15),t.YNc(1,ie,6,9,"div",16),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.collectable.entitlements)}}function ae(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",12)(1,"div",13),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleEntitlementsOpen()}),t._uU(2," Uses licensed data. "),t.TgZ(3,"mat-icon"),t._uU(4),t.qZA()(),t.YNc(5,le,2,1,"div",14),t.qZA()}if(2&n){const e=t.oxw();t.xp6(4),t.hij(" ",e.entitlementsIsOpen?"expand_less":"expand_more"," "),t.xp6(1),t.Q6J("ngIf",e.entitlementsIsOpen)}}function ce(n,o){if(1&n&&t._UZ(0,"avr-collectable-display",20),2&n){const e=o.$implicit,i=t.oxw(2);t.Q6J("alias",e)("parentComponent",i)}}function se(n,o){if(1&n&&(t.TgZ(0,"div",18)(1,"h4"),t._uU(2,"Subcommands"),t.qZA(),t.YNc(3,ce,1,2,"avr-collectable-display",19),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.alias.subcommands)}}class H{constructor(o,e){this.workshopService=o,this.gamedataService=e,this.debrace=L.$,this.isOpen=!1,this.entitlementsIsOpen=!1}ngOnInit(){}get collectable(){return this.alias||this.snippet}toggleOpen(){this.isOpen=!this.isOpen}toggleEntitlementsOpen(){this.entitlementsIsOpen=!this.entitlementsIsOpen}getBoundName(){var o,e;const i=this.alias?null===(o=this.bindings)||void 0===o?void 0:o.alias_bindings:null===(e=this.bindings)||void 0===e?void 0:e.snippet_bindings;return this.bindings&&i.some(c=>c.id===this.collectable._id)?i.find(c=>c.id===this.collectable._id).name:this.collectable.name}hasCustomBindings(){return this.getBoundName()!==this.collectable.name}getSignature(){const o=this.getBoundName();return this.alias?this.parentComponent?`${this.parentComponent.getSignature()} ${o}`:`!${o}`:o}getUnboundSignature(){return this.alias?this.parentComponent?`${this.parentComponent.getSignature()} ${this.collectable.name}`:`!${this.collectable.name}`:this.collectable.name}getShortDocs(){return this.collectable.docs.split("\n")[0]}canOpen(){return this.getShortDocs()!==this.collectable.docs||this.collectable.entitlements.length}getEntity(o){return this.gamedataService.entityFromEntitlement(o.entity_type,o.entity_id)}}H.\u0275fac=function(o){return new(o||H)(t.Y36(u.a),t.Y36(Tt.u))},H.\u0275cmp=t.Xpm({type:H,selectors:[["avr-collectable-display"]],inputs:{alias:"alias",snippet:"snippet",parentComponent:"parentComponent",bindings:"bindings"},decls:12,vars:7,consts:[[1,"command-display"],[1,"click-to-expand",3,"click"],[1,"command-header"],[4,"ngIf"],["class","command-messages",4,"ngIf"],["class","command-closed-desc",4,"ngIf"],["class","command-desc",4,"ngIf"],["class","command-entitlements",4,"ngIf"],["class","command-subcommands",4,"ngIf"],[1,"command-messages"],[1,"command-closed-desc"],[1,"command-desc"],[1,"command-entitlements"],[1,"entitlements-header",3,"click"],["class","entitlements-list",4,"ngIf"],[1,"entitlements-list"],[4,"ngFor","ngForOf"],["target","_blank",3,"href"],[1,"command-subcommands"],[3,"alias","parentComponent",4,"ngFor","ngForOf"],[3,"alias","parentComponent"]],template:function(o,e){1&o&&(t._UZ(0,"mat-divider"),t.TgZ(1,"div",0)(2,"div",1),t.NdJ("click",function(){return e.toggleOpen()}),t.TgZ(3,"p",2)(4,"code"),t._uU(5),t.qZA(),t.YNc(6,te,2,1,"mat-icon",3),t.qZA(),t.YNc(7,ee,4,1,"div",4),t.YNc(8,oe,3,1,"div",5),t.qZA(),t.YNc(9,ne,3,1,"div",6),t.YNc(10,ae,6,2,"div",7),t.YNc(11,se,4,1,"div",8),t.qZA()),2&o&&(t.xp6(5),t.Oqu(e.getSignature()),t.xp6(1),t.Q6J("ngIf",e.canOpen()),t.xp6(1),t.Q6J("ngIf",e.hasCustomBindings()),t.xp6(1),t.Q6J("ngIf",!e.isOpen),t.xp6(1),t.Q6J("ngIf",e.isOpen),t.xp6(1),t.Q6J("ngIf",e.collectable.entitlements.length&&e.isOpen),t.xp6(1),t.Q6J("ngIf",e.alias&&e.alias.subcommands.length))},directives:[B.d,_.O5,I.Hw,p.lF,_.sg,H],pipes:[_.Ov],styles:["mat-divider[_ngcontent-%COMP%]{margin:12px 0;border-top-color:#738694}.click-to-expand[_ngcontent-%COMP%]{cursor:pointer}.command-header[_ngcontent-%COMP%]{color:#fff}.command-header[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:16px}.command-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{float:right}.command-messages[_ngcontent-%COMP%]{color:#7077e5;font-size:12px;margin-top:-12px;margin-bottom:12px}.command-closed-desc[_ngcontent-%COMP%], .command-desc[_ngcontent-%COMP%]{color:#a7b6c2;font-size:16px}.command-subcommands[_ngcontent-%COMP%]{padding:0 20px}.command-subcommands[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#7077e5;font-weight:700}.entitlements-header[_ngcontent-%COMP%]{cursor:pointer}.entitlements-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px}"]});var re=f(7783),de=f(9910),pe=f(6623),ft=f(6131),bt=f(3188);function ue(n,o){1&n&&(t.TgZ(0,"mat-hint"),t._uU(1,"This will appear in your alias' help command."),t.qZA())}function me(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-slide-toggle",8),t.NdJ("change",function(){return t.CHM(e),t.oxw().toggleCodeVersions()}),t._uU(1,"Code Versions"),t.qZA()}}function ge(n,o){if(1&n&&(t.TgZ(0,"div",34),t._UZ(1,"ngx-monaco-editor",35),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("options",e.readonlyEditorOptions)("ngModel",e.selectedCodeVersion.content)}}function _e(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",34)(1,"ngx-monaco-editor",36),t.NdJ("ngModelChange",function(c){t.CHM(e);return t.oxw().newCodeVersionContent=c}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("options",e.editorOptions)("ngModel",e.newCodeVersionContent)}}function he(n,o){1&n&&(t.TgZ(0,"p",37),t._uU(1," Looks like this item doesn't have any code yet. Go ahead and create a new code version on the right or "),t.TgZ(2,"a",7),t._uU(3,"read the Draconic documentation"),t.qZA(),t._uU(4," to get started! "),t.qZA())}function fe(n,o){1&n&&(t.TgZ(0,"em"),t._uU(1," (active)"),t.qZA())}function be(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw().onViewCodeVersion(m)}),t.TgZ(1,"p",38),t._uU(2),t.YNc(3,fe,2,0,"em",4),t.qZA(),t.TgZ(4,"p",38),t._uU(5),t.ALo(6,"date"),t.qZA()()}if(2&n){const e=o.$implicit,i=t.oxw();t.ekj("active",i.selectedCodeVersion===e),t.xp6(2),t.hij(" Version ",e.version," "),t.xp6(1),t.Q6J("ngIf",e.is_current),t.xp6(2),t.Oqu(t.lcZ(6,5,e.created_at))}}function Ce(n,o){1&n&&(t.TgZ(0,"mat-list-item"),t._uU(1," Loading... "),t._UZ(2,"mat-spinner",39),t.qZA())}function ve(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",40),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSetCurrentAsActive()}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.hij(" Set Version ",e.selectedCodeVersion.version," as Active Code Version ")}}function xe(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",41),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSaveNewCodeVersion()}),t._uU(1," Save New Code Version "),t.qZA()}}function Te(n,o){1&n&&(t.TgZ(0,"mat-icon",44),t._uU(1,"cancel"),t.qZA())}function Ze(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-chip",42),t.NdJ("removed",function(){const m=t.CHM(e).$implicit;return t.oxw().onRemoveEntitlement(m)}),t._uU(1),t.ALo(2,"async"),t.YNc(3,Te,2,0,"mat-icon",43),t.qZA()}if(2&n){const e=o.$implicit,i=t.oxw();let c;t.Q6J("removable",!e.required),t.xp6(1),t.hij(" ",null==(c=t.lcZ(2,3,i.getEntity(e)))?null:c.name," "),t.xp6(2),t.Q6J("ngIf",!e.required)}}function we(n,o){if(1&n&&(t.TgZ(0,"mat-option",47),t._uU(1),t.qZA()),2&n){const e=o.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e.name," ")}}function Oe(n,o){if(1&n&&(t.TgZ(0,"mat-optgroup",45),t.ALo(1,"titlecase"),t.YNc(2,we,2,2,"mat-option",46),t.qZA()),2&n){const e=o.$implicit;t.Q6J("label",t.lcZ(1,2,e[0])),t.xp6(2),t.Q6J("ngForOf",e[1])}}function Ae(n,o){if(1&n&&(t.TgZ(0,"p",48),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function Me(n,o){1&n&&t._UZ(0,"mat-spinner",49),2&n&&t.Q6J("diameter",24)}function ye(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",50),t.NdJ("click",function(){return t.CHM(e),t.oxw().onDelete()}),t._uU(1," Delete "),t.qZA()}}function ke(n,o){1&n&&(t.TgZ(0,"div",51)(1,"button",52),t._uU(2,"Delete"),t.qZA()())}const Ue=function(n){return{"mobile-code-version":n}};class at extends re.t{constructor(o,e,i,c,m,C,M){super(M),this.data=o,this.dialogRef=e,this.workshopService=i,this.gamedataService=c,this.dialog=m,this.snackBar=C,this.bp=M,this.PublicationState=b.BL,this.wordWrap="off",this.mobileCodeVersion=!1,this.editorOptions={theme:"draconicTheme",language:"draconic",scrollBeyondLastLine:!1,wordWrap:this.wordWrap},this.readonlyEditorOptions=Object.assign(Object.assign({},this.editorOptions),{readOnly:!0}),this.loadingCodeVersions=!0,this.loading=!1,this.entitlementsControl=new x.NI(""),this.collection=o.collection,this.alias=o.alias,this.parent=o.parent,this.snippet=o.snippet,this.name=this.collectable.name,this.docs=this.collectable.docs,this.selectedCodeVersion=this.collectable.versions.length?this.collectable.versions.find(Ct=>Ct.is_current):null}toggleWordWrap(){this.wordWrap="on"===this.wordWrap?"off":"on",this.editorOptions=Object.assign({},this.editorOptions,{wordWrap:this.wordWrap}),this.readonlyEditorOptions=Object.assign({},this.readonlyEditorOptions,{wordWrap:this.wordWrap})}toggleCodeVersions(){this.mobileCodeVersion=!this.mobileCodeVersion}ngOnInit(){this.updateAddableEntitlements(),this.loadCodeVersions()}get collectable(){return this.alias||this.snippet}onSave(){(this.name!==this.collectable.name||this.docs!==this.collectable.docs)&&(this.error=null,this.loading=!0,(this.alias?this.workshopService.editAlias(this.alias._id,this.name,this.docs):this.workshopService.editSnippet(this.snippet._id,this.name,this.docs)).subscribe(e=>{this.loading=!1,e.success?Object.assign(this.collectable,e.data):this.error=e.error}))}onDelete(){this.dialog.open(A.h,{data:{name:this.collectable.name}}).afterClosed().subscribe(e=>{e&&(this.error=null,this.loading=!0,(this.alias?this.workshopService.deleteAlias(this.alias._id):this.workshopService.deleteSnippet(this.snippet._id)).subscribe(c=>{this.loading=!1,c.success?(this.parent?this.parent.subcommands.splice(this.parent.subcommands.indexOf(this.alias),1):this.alias?this.collection.aliases.splice(this.collection.aliases.indexOf(this.alias),1):this.snippet&&this.collection.snippets.splice(this.collection.snippets.indexOf(this.snippet),1),this.dialogRef.close()):this.error=c.error}))})}onDone(){this.name!==this.collectable.name||this.docs!==this.collectable.docs||this.creatingNewCodeVersion&&this.newCodeVersionContent?this.snackBar.open("You have unsaved changes. Do you want to discard them?","Discard",{duration:5e3}).afterDismissed().subscribe(o=>{o.dismissedByAction&&this.dialogRef.close(this.collectable)}):this.dialogRef.close(this.collectable)}onViewCodeVersion(o){this.selectedCodeVersion=o,this.creatingNewCodeVersion=!1}onStartCreatingCodeVersion(){this.creatingNewCodeVersion||(this.selectedCodeVersion=null,this.creatingNewCodeVersion=!0,this.newCodeVersionContent=this.newCodeVersionContent||"")}onSaveNewCodeVersion(){let o;this.error=null,this.loading=!0,o=this.alias?this.workshopService.createAliasCodeVersion(this.alias._id,this.newCodeVersionContent):this.workshopService.createSnippetCodeVersion(this.snippet._id,this.newCodeVersionContent),o.subscribe(e=>{this.loading=!1,e.success?(this.collectable.versions.push(e.data),this.onViewCodeVersion(e.data),this.newCodeVersionContent=""):this.error=e.error})}onSetCurrentAsActive(){if(!this.selectedCodeVersion)return void console.error("tried to set null code version as active");let o;this.error=null,this.loading=!0,o=this.alias?this.workshopService.setActiveAliasCodeVersion(this.alias._id,this.selectedCodeVersion.version):this.workshopService.setActiveSnippetCodeVersion(this.snippet._id,this.selectedCodeVersion.version),o.subscribe(e=>{this.updateCollectableFromResponse(e)})}onRemoveEntitlement(o){let e;this.loading=!0,this.error=null,e=this.alias?this.workshopService.removeAliasEntitlement(this.alias._id,o):this.workshopService.removeSnippetEntitlement(this.snippet._id,o),e.subscribe(i=>{this.loading=!1,i.success?this.collectable.entitlements=i.data:this.error=i.error})}onAddEntitlement(o){let e;this.loading=!0,this.error=null,this.entitlementsControl.setValue(""),e=this.alias?this.workshopService.addAliasEntitlement(this.alias._id,o):this.workshopService.addSnippetEntitlement(this.snippet._id,o),e.subscribe(i=>{this.loading=!1,i.success?this.collectable.entitlements=i.data:this.error=i.error})}refreshCollectable(){let o;o=this.alias?this.workshopService.getAlias(this.alias._id):this.workshopService.getSnippet(this.snippet._id),o.subscribe(e=>{this.updateCollectableFromResponse(e)})}loadCodeVersions(o=0,e=10){let i;i=this.alias?this.workshopService.getAliasCodeVersions(this.alias._id,o,e):this.workshopService.getSnippetCodeVersions(this.snippet._id,o,e),i.subscribe(c=>{if(!c.success)return;const m=c.data.filter(C=>!this.collectable.versions.some(M=>M.version===C.version));this.collectable.versions.push(...m),this.collectable.versions.length&&null===this.selectedCodeVersion&&(this.selectedCodeVersion=this.collectable.versions.find(C=>C.is_current)),!m.length||c.data.length<e||1===Math.min(...c.data.map(C=>C.version))?this.loadingCodeVersions=!1:this.loadCodeVersions(o+c.data.length,e)})}updateCollectableFromResponse(o){this.loading=!1,o.success?(Object.assign(this.collectable,o.data),this.selectedCodeVersion=this.collectable.versions.find(e=>e.version===this.selectedCodeVersion.version)):this.error=o.error}getSortedVersions(){return this.collectable.versions.sort((o,e)=>e.version-o.version)}getEntity(o){return this.gamedataService.entityFromEntitlement(o.entity_type,o.entity_id)}updateAddableEntitlements(){this.gamedataService.getEntitlements().subscribe(o=>{this.allEntities=Array.from(o.data.values()),this.entitlementsControl.setValue("")}),this.addableEntitlements=this.entitlementsControl.valueChanges.pipe((0,Ut.b)(500)).pipe((0,F.U)(o=>{let e=o&&"string"==typeof o?o:"";const i=this.allEntities.filter(c=>!this.collectable.entitlements.find(m=>m.entity_type===c.entitlement_entity_type&&m.entity_id===c.entitlement_entity_id)).filter(c=>c.name.toLowerCase().includes(e.toLowerCase())).sort((c,m)=>c.name.localeCompare(m.name));return Object.entries((0,it.groupBy)(i,c=>c.entity_type)).sort(([c,m],[C,M])=>c.localeCompare(C))}))}}function Se(n,o){if(1&n&&(t.TgZ(0,"mat-icon"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.isOpen?"expand_less":"expand_more"," ")}}function Ee(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"markdown",8),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleOpen()}),t._uU(2),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t.TgZ(4,"mat-icon"),t._uU(5," edit "),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(2),t.hij(" ",e.debrace(e.getShortDocs())," ")}}function Pe(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",10)(1,"markdown"),t._uU(2),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEdit()}),t.TgZ(4,"mat-icon"),t._uU(5," edit "),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(e.debrace(e.collectable.docs))}}function qe(n,o){if(1&n&&(t.TgZ(0,"div")(1,"a",16),t.ALo(2,"async"),t._uU(3),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()()),2&n){const e=o.$implicit,i=t.oxw(3);let c,m;t.xp6(1),t.Q6J("href",null==(c=t.lcZ(2,3,i.getEntity(e)))?null:c.marketplace_url,t.LSH),t.xp6(2),t.AsE(" ",null==(m=t.lcZ(4,5,i.getEntity(e)))?null:m.name," (",null==(m=t.lcZ(5,7,i.getEntity(e)))?null:m.source,") ")}}function Ie(n,o){if(1&n&&(t.TgZ(0,"div",14),t.YNc(1,qe,6,9,"div",15),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.collectable.entitlements)}}function Ne(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",11)(1,"div",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleEntitlementsOpen()}),t._uU(2," Uses licensed data. "),t.TgZ(3,"mat-icon"),t._uU(4),t.qZA()(),t.YNc(5,Ie,2,1,"div",13),t.qZA()}if(2&n){const e=t.oxw();t.xp6(4),t.hij(" ",e.entitlementsIsOpen?"expand_less":"expand_more"," "),t.xp6(1),t.Q6J("ngIf",e.entitlementsIsOpen)}}function Je(n,o){if(1&n&&t._UZ(0,"avr-collectable-edit",20),2&n){const e=o.$implicit,i=t.oxw(2);t.Q6J("collection",i.collection)("alias",e)("parentComponent",i)}}function Fe(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",17)(1,"h4"),t._uU(2,"Subcommands"),t.qZA(),t.YNc(3,Je,1,3,"avr-collectable-edit",18),t._UZ(4,"mat-divider"),t.TgZ(5,"div",19),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCreateSubalias()}),t.TgZ(6,"div"),t._uU(7,"Create New Subalias..."),t.qZA(),t.TgZ(8,"mat-icon"),t._uU(9,"add"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngForOf",e.alias.subcommands)}}at.\u0275fac=function(o){return new(o||at)(t.Y36(a.WI),t.Y36(a.so),t.Y36(u.a),t.Y36(Tt.u),t.Y36(a.uw),t.Y36(ot.ux),t.Y36(de.Yg))},at.\u0275cmp=t.Xpm({type:at,selectors:[["avr-collectable-edit-dialog"]],features:[t.qOj],decls:71,vars:28,consts:[["mat-dialog-title",""],["mat-dialog-content","",1,"mat-typography"],["matInput","",3,"ngModel","ngModelChange"],["matInput","","mat-autosize","",3,"ngModel","ngModelChange"],[4,"ngIf"],["mat-flat-button","","color","primary",1,"spaced-button",3,"click"],[1,"section"],["href","https://avrae.readthedocs.io/en/stable/aliasing/api.html","target","_blank"],[3,"change"],[3,"change",4,"ngIf"],[1,"code-versions-container","ignore-theme"],[1,"code-editor"],["class","monaco-editor-container",4,"ngIf"],["class","no-code-version",4,"ngIf"],[1,"code-versions-list",3,"ngClass"],["mat-list-item","",1,"ignore-theme",3,"click"],["mat-list-item","","class","ignore-theme",3,"active","click",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent","class","code-versions-button",3,"click",4,"ngIf"],["mat-raised-button","","color","accent","class","spaced-button",3,"click",4,"ngIf"],[1,"entitlements-list"],["aria-label","Entitlements selection"],["chipList",""],[3,"removable","removed",4,"ngFor","ngForOf"],["placeholder","Search for licenses...",3,"matAutocomplete","matChipInputFor","formControl"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"label",4,"ngFor","ngForOf"],["class","mat-error",4,"ngIf"],["mat-dialog-actions",""],["mat-flat-button","",3,"click"],[3,"diameter",4,"ngIf"],[1,"toolbar-spacer"],["mat-flat-button","","color","warn",3,"click",4,"ngIf"],["matTooltip","You cannot delete a top-level item of a published collection.",4,"ngIf"],[1,"monaco-editor-container"],[3,"options","ngModel"],[3,"options","ngModel","ngModelChange"],[1,"no-code-version"],["matLine",""],["diameter","24"],["mat-raised-button","","color","accent",1,"code-versions-button",3,"click"],["mat-raised-button","","color","accent",1,"spaced-button",3,"click"],[3,"removable","removed"],["matChipRemove","",4,"ngIf"],["matChipRemove",""],[3,"label"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"mat-error"],[3,"diameter"],["mat-flat-button","","color","warn",3,"click"],["matTooltip","You cannot delete a top-level item of a published collection."],["mat-flat-button","","disabled","","color","warn"]],template:function(o,e){if(1&o&&(t.TgZ(0,"h1",0),t._uU(1),t.qZA(),t.TgZ(2,"div",1)(3,"h3"),t._uU(4,"Name & Description"),t.qZA(),t.TgZ(5,"p"),t._uU(6," You can edit the collectible's name, documentation, licenses, and code here. "),t.qZA(),t.TgZ(7,"mat-form-field")(8,"mat-label"),t._uU(9,"Name"),t.qZA(),t.TgZ(10,"input",2),t.NdJ("ngModelChange",function(c){return e.name=c}),t.qZA(),t.TgZ(11,"mat-hint"),t._uU(12,"This won't change the name of the item for current subscribers."),t.qZA()(),t.TgZ(13,"mat-form-field")(14,"mat-label"),t._uU(15,"Documentation (Markdown Supported)"),t.qZA(),t.TgZ(16,"textarea",3),t.NdJ("ngModelChange",function(c){return e.docs=c}),t.qZA(),t.YNc(17,ue,2,0,"mat-hint",4),t.qZA(),t.TgZ(18,"button",5),t.NdJ("click",function(){return e.onSave()}),t._uU(19,"Save"),t.qZA(),t._UZ(20,"mat-divider"),t.TgZ(21,"div",6)(22,"h3"),t._uU(23,"Code Versions"),t.qZA(),t.TgZ(24,"p"),t._uU(25," You can view the code version and set the active code version here. To edit the code, create a new code version. It is recommended to test code in a personal alias before publishing a code version, as code versions cannot be edited or deleted. "),t.qZA(),t.TgZ(26,"p"),t._uU(27," Need some references? You can "),t.TgZ(28,"a",7),t._uU(29," find the Draconic documentation here"),t.qZA(),t._uU(30,". "),t.qZA(),t.TgZ(31,"mat-slide-toggle",8),t.NdJ("change",function(){return e.toggleWordWrap()}),t._uU(32,"Word Wrap"),t.qZA(),t.YNc(33,me,2,0,"mat-slide-toggle",9),t.TgZ(34,"div",10)(35,"div",11),t.YNc(36,ge,2,2,"div",12),t.YNc(37,_e,2,2,"div",12),t.YNc(38,he,5,0,"p",13),t.qZA(),t.TgZ(39,"div",14)(40,"mat-action-list")(41,"button",15),t.NdJ("click",function(){return e.onStartCreatingCodeVersion()}),t._uU(42," Create New Version "),t.qZA(),t.YNc(43,be,7,7,"button",16),t.YNc(44,Ce,3,0,"mat-list-item",4),t.qZA()()(),t.YNc(45,ve,2,1,"button",17),t.YNc(46,xe,2,0,"button",18),t.qZA(),t._UZ(47,"mat-divider"),t.TgZ(48,"div",6)(49,"h3"),t._uU(50,"Licenses"),t.qZA(),t.TgZ(51,"p"),t._uU(52," If you plan on publishing this collection, make sure to search for and add the relevant licenses if this item uses any licensed rules or data. You don't have to add licenses here for data that is free on D&D Beyond. "),t.qZA(),t.TgZ(53,"mat-form-field",19)(54,"mat-chip-list",20,21),t.YNc(56,Ze,4,5,"mat-chip",22),t._UZ(57,"input",23),t.qZA(),t.TgZ(58,"mat-autocomplete",24,25),t.NdJ("optionSelected",function(c){return e.onAddEntitlement(c.option.value)}),t.YNc(60,Oe,3,4,"mat-optgroup",26),t.ALo(61,"async"),t.qZA()()(),t._UZ(62,"mat-divider"),t.YNc(63,Ae,2,1,"p",27),t.qZA(),t.TgZ(64,"div",28)(65,"button",29),t.NdJ("click",function(){return e.onDone()}),t._uU(66,"Done"),t.qZA(),t.YNc(67,Me,1,1,"mat-spinner",30),t._UZ(68,"span",31),t.YNc(69,ye,2,0,"button",32),t.YNc(70,ke,3,0,"div",33),t.qZA()),2&o){const i=t.MAs(55),c=t.MAs(59);t.xp6(1),t.hij("Editing ",e.collectable.name,"..."),t.xp6(9),t.Q6J("ngModel",e.name),t.xp6(6),t.Q6J("ngModel",e.docs),t.xp6(1),t.Q6J("ngIf",e.alias),t.xp6(16),t.Q6J("ngIf",e.mobile),t.xp6(3),t.Q6J("ngIf",e.selectedCodeVersion),t.xp6(1),t.Q6J("ngIf",e.creatingNewCodeVersion),t.xp6(1),t.Q6J("ngIf",!(e.selectedCodeVersion||e.creatingNewCodeVersion)),t.xp6(1),t.Q6J("ngClass",t.VKq(26,Ue,e.mobileCodeVersion)),t.xp6(2),t.ekj("active",e.creatingNewCodeVersion),t.xp6(2),t.Q6J("ngForOf",e.getSortedVersions()),t.xp6(1),t.Q6J("ngIf",e.loadingCodeVersions),t.xp6(1),t.Q6J("ngIf",e.selectedCodeVersion&&!e.selectedCodeVersion.is_current),t.xp6(1),t.Q6J("ngIf",e.creatingNewCodeVersion),t.xp6(10),t.Q6J("ngForOf",e.collectable.entitlements),t.xp6(1),t.Q6J("matAutocomplete",c)("matChipInputFor",i)("formControl",e.entitlementsControl),t.xp6(3),t.Q6J("ngForOf",t.lcZ(61,24,e.addableEntitlements)),t.xp6(3),t.Q6J("ngIf",e.error),t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(2),t.Q6J("ngIf",e.collection.publish_state!==e.PublicationState.PUBLISHED||e.parent),t.xp6(1),t.Q6J("ngIf",e.collection.publish_state===e.PublicationState.PUBLISHED&&!e.parent)}},directives:[a.uh,a.xY,r.KE,r.hX,s.Nt,x.Fj,x.JJ,x.On,r.bx,_.O5,d.lW,B.d,pe.Rr,O.PG,_.mk,ft.i$,ft.Tg,_.sg,q.X2,g.Ou,J.qn,J.HS,I.Hw,J.qH,bt.ZL,J.oH,x.oH,bt.XC,q.Nv,q.ey,a.H8,Y.gM],pipes:[_.uU,_.Ov,_.rS],styles:["mat-form-field[_ngcontent-%COMP%]{margin-bottom:8px}.section[_ngcontent-%COMP%]{margin:8px 0}.code-versions-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;background:#182026;border-radius:4px;height:55vh}.code-versions-container[_ngcontent-%COMP%]   .no-code-version[_ngcontent-%COMP%]{padding:8px}.code-editor[_ngcontent-%COMP%], .monaco-editor-container[_ngcontent-%COMP%]{height:55vh}.monaco-editor-container[_ngcontent-%COMP%]   ngx-monaco-editor[_ngcontent-%COMP%]{height:102.0408163265%}.code-versions-list[_ngcontent-%COMP%]{border-left:1px solid rgba(115,134,148,.3);height:55vh;overflow:auto}.code-versions-list[_ngcontent-%COMP%]   mat-action-list[_ngcontent-%COMP%]{margin-top:-8px}.spaced-button[_ngcontent-%COMP%]{margin:8px 0}.active[_ngcontent-%COMP%]{background:rgba(255,255,255,.05)}@media (max-width: 600px){.code-versions-list[_ngcontent-%COMP%]{display:none;background:#182026;right:0;position:absolute;z-index:20}.code-versions-container[_ngcontent-%COMP%]{position:relative}.mobile-code-version[_ngcontent-%COMP%]{display:block}}","mat-form-field[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin-left:8px}",".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}"]});class W extends H{constructor(o,e,i){super(o,e),this.workshopService=o,this.gamedataService=e,this.dialog=i}ngOnInit(){}onEdit(){var o;this.dialog.open(at,{disableClose:!0,minWidth:"70%",panelClass:"collectable-overlay",data:{collection:this.collection,alias:this.alias,snippet:this.snippet,parent:null===(o=this.parentComponent)||void 0===o?void 0:o.alias}}).afterClosed().subscribe(i=>{i&&(this.alias?Object.assign(this.alias,i):Object.assign(this.snippet,i))})}onCreateSubalias(){this.dialog.open(k,{disableClose:!0,data:{collection:this.collection,collectableType:b.v$.SUBALIAS,parent:this.alias}}).afterClosed().subscribe(e=>{e&&this.alias.subcommands.push(e)})}canOpen(){return super.canOpen()||this.alias&&!this.alias.subcommands.length}}function Ye(n,o){1&n&&t._UZ(0,"mat-spinner",7)}function Qe(n,o){if(1&n&&t._UZ(0,"img",30),2&n){const e=t.oxw(2);t.Q6J("src",e.collection.image,t.LSH)}}function De(n,o){if(1&n&&(t.TgZ(0,"div",34),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.error," ")}}function Le(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",31)(1,"div")(2,"b"),t._uU(3),t.qZA(),t._uU(4),t.TgZ(5,"b"),t._uU(6),t.qZA(),t._uU(7," with the world? Publish it to let anyone add it to their own collection or server! "),t.qZA(),t.TgZ(8,"div",32)(9,"button",25),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onEditSettings()}),t.TgZ(10,"mat-icon"),t._uU(11,"share"),t.qZA(),t._uU(12," Sharing Settings "),t.qZA(),t.TgZ(13,"button",25),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onPublish()}),t.TgZ(14,"mat-icon"),t._uU(15,"publish"),t.qZA(),t._uU(16," Publish "),t.qZA()(),t.YNc(17,De,2,1,"div",33),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.collection.name),t.xp6(1),t.hij(" is currently ",e.collection.publish_state.toLowerCase(),". Ready to share "),t.xp6(2),t.Oqu(e.collection.name),t.xp6(11),t.Q6J("ngIf",e.error)}}function Be(n,o){if(1&n&&(t.TgZ(0,"div",34),t._uU(1),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.error," ")}}function je(n,o){if(1&n&&(t.TgZ(0,"div",31)(1,"div")(2,"b"),t._uU(3),t.qZA(),t._uU(4," is published! Everyone who has added it to a personal or server collection will automatically receive the latest updates. "),t.qZA(),t.TgZ(5,"div",32)(6,"a",35),t._uU(7," View on Workshop "),t.qZA()(),t.YNc(8,Be,2,1,"div",33),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Oqu(e.collection.name),t.xp6(3),t.Q6J("routerLink","../")("skipLocationChange",!0),t.xp6(2),t.Q6J("ngIf",e.error)}}function Re(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",19)(1,"avr-pretty-user",20)(2,"button",36),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw(2).onRemoveEditor(m)}),t.TgZ(3,"mat-icon",37),t._uU(4,"clear"),t.qZA()()()()}if(2&n){const e=o.$implicit;t.xp6(1),t.Q6J("user",e)}}function He(n,o){if(1&n&&t._UZ(0,"avr-collectable-edit",38),2&n){const e=o.$implicit,i=t.oxw(2);t.Q6J("collection",i.collection)("alias",e)}}function Ve(n,o){if(1&n&&t._UZ(0,"avr-collectable-edit",39),2&n){const e=o.$implicit,i=t.oxw(2);t.Q6J("collection",i.collection)("snippet",e)}}W.\u0275fac=function(o){return new(o||W)(t.Y36(u.a),t.Y36(Tt.u),t.Y36(a.uw))},W.\u0275cmp=t.Xpm({type:W,selectors:[["avr-collectable-edit"]],inputs:{collection:"collection"},features:[t.qOj],decls:11,vars:6,consts:[[1,"command-display"],[1,"command-header","click-to-expand",3,"click"],[4,"ngIf"],["class","command-closed-desc",4,"ngIf"],["class","command-desc",4,"ngIf"],["class","command-entitlements",4,"ngIf"],["class","command-subcommands",4,"ngIf"],[1,"command-closed-desc"],[1,"click-to-expand",3,"click"],["mat-icon-button","",1,"edit-button",3,"click"],[1,"command-desc"],[1,"command-entitlements"],[1,"entitlements-header",3,"click"],["class","entitlements-list",4,"ngIf"],[1,"entitlements-list"],[4,"ngFor","ngForOf"],["target","_blank",3,"href"],[1,"command-subcommands"],[3,"collection","alias","parentComponent",4,"ngFor","ngForOf"],[1,"create-new","click-to-expand",3,"click"],[3,"collection","alias","parentComponent"]],template:function(o,e){1&o&&(t._UZ(0,"mat-divider"),t.TgZ(1,"div",0)(2,"div")(3,"p",1),t.NdJ("click",function(){return e.toggleOpen()}),t.TgZ(4,"code"),t._uU(5),t.qZA(),t.YNc(6,Se,2,1,"mat-icon",2),t.qZA(),t.YNc(7,Ee,6,1,"div",3),t.qZA(),t.YNc(8,Pe,6,1,"div",4),t.YNc(9,Ne,6,2,"div",5),t.YNc(10,Fe,10,1,"div",6),t.qZA()),2&o&&(t.xp6(5),t.Oqu(e.getSignature()),t.xp6(1),t.Q6J("ngIf",e.canOpen()),t.xp6(1),t.Q6J("ngIf",!e.isOpen),t.xp6(1),t.Q6J("ngIf",e.isOpen),t.xp6(1),t.Q6J("ngIf",e.collectable.entitlements.length&&e.isOpen),t.xp6(1),t.Q6J("ngIf",e.alias&&(e.alias.subcommands.length||e.isOpen)))},directives:[B.d,_.O5,I.Hw,p.lF,d.lW,_.sg,W],pipes:[_.Ov],styles:[".command-closed-desc[_ngcontent-%COMP%], .command-desc[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto}.edit-button[_ngcontent-%COMP%]{height:18px;margin-top:-12px}.create-new[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto}","mat-divider[_ngcontent-%COMP%]{margin:12px 0;border-top-color:#738694}.click-to-expand[_ngcontent-%COMP%]{cursor:pointer}.command-header[_ngcontent-%COMP%]{color:#fff}.command-header[_ngcontent-%COMP%]   code[_ngcontent-%COMP%]{font-size:16px}.command-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{float:right}.command-messages[_ngcontent-%COMP%]{color:#7077e5;font-size:12px;margin-top:-12px;margin-bottom:12px}.command-closed-desc[_ngcontent-%COMP%], .command-desc[_ngcontent-%COMP%]{color:#a7b6c2;font-size:16px}.command-subcommands[_ngcontent-%COMP%]{padding:0 20px}.command-subcommands[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#7077e5;font-weight:700}.entitlements-header[_ngcontent-%COMP%]{cursor:pointer}.entitlements-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:14px}"]});const $e=function(){return[]};function We(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"div",8)(1,"div",9)(2,"div",10),t.YNc(3,Qe,1,1,"img",11),t.YNc(4,Le,18,4,"div",12),t.YNc(5,je,9,4,"div",12),t.TgZ(6,"div",13),t._UZ(7,"avr-tag-chip-list",14),t.qZA(),t.TgZ(8,"p",15),t._UZ(9,"markdown",16),t.qZA()(),t.TgZ(10,"div",17)(11,"div",18)(12,"div",19),t._UZ(13,"avr-pretty-user",20),t.qZA(),t.YNc(14,Re,5,1,"div",21),t._UZ(15,"mat-divider"),t.TgZ(16,"div",22)(17,"avr-add-editor",23),t.NdJ("addEditor",function(c){return t.CHM(e),t.oxw().onAddEditor(c)}),t.qZA()(),t.TgZ(18,"div",24)(19,"button",25),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEditSettings()}),t._uU(20," Edit Settings "),t.qZA()()()()(),t._UZ(21,"mat-divider"),t.TgZ(22,"div",26)(23,"h2"),t._uU(24,"Aliases"),t.qZA(),t.YNc(25,He,1,2,"avr-collectable-edit",27),t._UZ(26,"mat-divider"),t.TgZ(27,"div",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCreateNewAlias()}),t.TgZ(28,"div"),t._uU(29,"Create New Alias..."),t.qZA(),t.TgZ(30,"mat-icon"),t._uU(31,"add"),t.qZA()()(),t.TgZ(32,"div",26)(33,"h2"),t._uU(34,"Snippets"),t.qZA(),t.YNc(35,Ve,1,2,"avr-collectable-edit",29),t._UZ(36,"mat-divider"),t.TgZ(37,"div",28),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCreateNewSnippet()}),t.TgZ(38,"div"),t._uU(39,"Create New Snippet..."),t.qZA(),t.TgZ(40,"mat-icon"),t._uU(41,"add"),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",e.collection.image),t.xp6(1),t.Q6J("ngIf",e.collection.publish_state!==e.PublicationState.PUBLISHED),t.xp6(1),t.Q6J("ngIf",e.collection.publish_state===e.PublicationState.PUBLISHED),t.xp6(2),t.Q6J("collection",e.collection)("showEdit",!0),t.xp6(2),t.Q6J("data",e.debrace(e.collection.description)),t.xp6(4),t.Q6J("user",e.owner),t.xp6(1),t.Q6J("ngForOf",e.editors||t.DdM(12,$e)),t.xp6(11),t.Q6J("ngForOf",e.collection.aliases),t.xp6(2),t.Q6J("matTooltip",e.collection.publish_state===e.PublicationState.PUBLISHED?"An alias cannot be deleted once created in a published collection.":null),t.xp6(8),t.Q6J("ngForOf",e.collection.snippets),t.xp6(2),t.Q6J("matTooltip",e.collection.publish_state===e.PublicationState.PUBLISHED?"A snippet cannot be deleted once created in a published collection.":null)}}function ze(n,o){1&n&&t._UZ(0,"mat-spinner",42),2&n&&t.Q6J("diameter",24)}function Ge(n,o){if(1&n&&(t.TgZ(0,"p",43),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.error," ")}}function Xe(n,o){if(1&n&&(t.TgZ(0,"div",8),t.YNc(1,ze,1,1,"mat-spinner",40),t.YNc(2,Ge,2,1,"p",41),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.error),t.xp6(1),t.Q6J("ngIf",e.error)}}class ct{constructor(o,e,i,c,m,C,M){this.route=o,this.router=e,this.snackBar=i,this.dialog=c,this.location=m,this.workshopService=C,this.discordService=M,this.PublicationState=b.BL,this.debrace=L.$,this.loading=!0}ngOnInit(){this.route.paramMap.subscribe(o=>this.loadCollection(o.get("id")))}onCollectionInit(o){this.collection=o,this.loadOwner(),this.loadEditors()}onAddEditor(o){this.workshopService.addCollectionEditor(this.collection._id,o.id).subscribe(e=>{e.success?this.editors=e.data:this.snackBar.open(e.error)})}onRemoveEditor(o){this.workshopService.removeCollectionEditor(this.collection._id,o.id).subscribe(e=>{e.success?this.editors=e.data:this.snackBar.open(e.error)})}onEditSettings(){this.dialog.open(Q,{disableClose:!0,data:{collection:this.collection}}).afterClosed().subscribe(e=>{e&&(this.collection=Object.assign(Object.assign({},this.collection),e))})}onPublish(){this.dialog.open(et,{disableClose:!0,maxWidth:"max(50%, 350px)",data:{collection:this.collection}}).afterClosed().subscribe(e=>{e&&(this.collection=Object.assign(Object.assign({},this.collection),e))})}onCreateNewAlias(){this.dialog.open(k,{disableClose:!0,data:{collection:this.collection,collectableType:b.v$.ALIAS}}).afterClosed().subscribe(e=>{e&&this.collection.aliases.push(e)})}onCreateNewSnippet(){this.dialog.open(k,{disableClose:!0,data:{collection:this.collection,collectableType:b.v$.SNIPPET}}).afterClosed().subscribe(e=>{e&&this.collection.snippets.push(e)})}loadCollection(o){this.workshopService.getCollectionFull(o).subscribe(e=>{this.loading=!1,e.success?this.onCollectionInit(e.data):this.error=e.error})}loadOwner(){this.discordService.getUser(this.collection.owner).subscribe(o=>{this.owner=o,this.maybeDoRedirect()})}loadEditors(){this.workshopService.getCollectionEditors(this.collection._id).subscribe(o=>{o.success&&(this.editors=o.data,this.maybeDoRedirect())})}canEdit(){var o;return null===(o=this.editors)||void 0===o?void 0:o.some(e=>e.id===(0,l.PR)().id)}goBack(){this.location.back()}maybeDoRedirect(){if(void 0===this.owner||void 0===this.editors)return;let o=(0,l.PR)();this.owner.id!==o.id&&!this.canEdit()&&this.router.navigate([".."],{skipLocationChange:!0})}}ct.\u0275fac=function(o){return new(o||ct)(t.Y36(T.gz),t.Y36(T.F0),t.Y36(ot.ux),t.Y36(a.uw),t.Y36(_.Ye),t.Y36(u.a),t.Y36($.h))},ct.\u0275cmp=t.Xpm({type:ct,selectors:[["avr-collection-edit"]],decls:16,vars:6,consts:[["color","primary"],["mat-icon-button","","aria-label","Back",3,"click"],[1,"toolbar-spacer"],["mat-icon-button","","aria-label","Done Editing Button","matTooltip","Done Editing",3,"routerLink","skipLocationChange"],["mat-icon-button","","aria-label","Edit Button","matTooltip","Edit Settings",3,"click"],["color","accent","diameter","24","class","toolbar-spinner",4,"ngIf"],["class","content mat-typography",4,"ngIf"],["color","accent","diameter","24",1,"toolbar-spinner"],[1,"content","mat-typography"],[1,"metadata-grid"],[1,"description-etc"],["alt","Collection Image","class","desc-image",3,"src",4,"ngIf"],["class","desc-subscribe-container",4,"ngIf"],[1,"desc-tags"],[3,"collection","showEdit"],[1,"desc-text"],[3,"data"],[1,"metadata-container"],[1,"metadata"],[1,"meta-author"],[3,"user"],["class","meta-author",4,"ngFor","ngForOf"],[1,"add-editor"],[3,"addEditor"],[1,"meta-buttons"],["mat-raised-button","","color","accent",3,"click"],[1,"collectable-container"],[3,"collection","alias",4,"ngFor","ngForOf"],[1,"create-new","clickable",3,"matTooltip","click"],[3,"collection","snippet",4,"ngFor","ngForOf"],["alt","Collection Image",1,"desc-image",3,"src"],[1,"desc-subscribe-container"],[1,"desc-subscribe-buttons"],["class","desc-error mat-error",4,"ngIf"],[1,"desc-error","mat-error"],["mat-raised-button","","color","accent",3,"routerLink","skipLocationChange"],["mat-icon-button","","matTooltip","Remove editor",3,"click"],[1,"muted"],[3,"collection","alias"],[3,"collection","snippet"],[3,"diameter",4,"ngIf"],["class","mat-error",4,"ngIf"],[3,"diameter"],[1,"mat-error"]],template:function(o,e){1&o&&(t.TgZ(0,"mat-toolbar",0)(1,"button",1),t.NdJ("click",function(){return e.goBack()}),t.TgZ(2,"mat-icon"),t._uU(3,"arrow_back"),t.qZA()(),t.TgZ(4,"span"),t._uU(5),t.qZA(),t._UZ(6,"span",2),t.TgZ(7,"a",3)(8,"mat-icon"),t._uU(9,"check"),t.qZA()(),t.TgZ(10,"button",4),t.NdJ("click",function(){return e.onEditSettings()}),t.TgZ(11,"mat-icon"),t._uU(12,"settings"),t.qZA()(),t.YNc(13,Ye,1,0,"mat-spinner",5),t.qZA(),t.YNc(14,We,42,13,"div",6),t.YNc(15,Xe,3,2,"div",6)),2&o&&(t.xp6(5),t.Oqu((null==e.collection?null:e.collection.name)||"Loading..."),t.xp6(2),t.Q6J("routerLink","../")("skipLocationChange",!0),t.xp6(6),t.Q6J("ngIf",e.loading),t.xp6(1),t.Q6J("ngIf",e.collection),t.xp6(1),t.Q6J("ngIf",!e.collection))},directives:[nt.Ye,d.lW,I.Hw,d.zs,T.yS,Y.gM,_.O5,g.Ou,j,p.lF,R,_.sg,B.d,lt,W],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}",".collectable-container[_ngcontent-%COMP%]{color:#fff;font-size:16px}.collectable-container[_ngcontent-%COMP%]   mat-divider[_ngcontent-%COMP%]{margin:12px 0;border-top-color:#738694}.create-new[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto}.clickable[_ngcontent-%COMP%]{cursor:pointer}@media (max-width: 960px){  .collectable-overlay{max-width:95vw!important;width:95%!important}}",".toolbar-search-form[_ngcontent-%COMP%]{margin-left:8px}.content[_ngcontent-%COMP%]{color:#ced9e0;background:#10161a;padding:8px;min-height:calc(100vh - 192px)}.metadata-grid[_ngcontent-%COMP%]{display:flex;grid-template-columns:minmax(275px,1fr) 275px;gap:1rem}.metadata-grid[_ngcontent-%COMP%]   .metadata[_ngcontent-%COMP%]{background:#182026;padding:8px;border-radius:8px}.meta-author[_ngcontent-%COMP%]{margin-bottom:8px}.desc-image[_ngcontent-%COMP%]{width:100%;border-radius:8px}.desc-subscribe-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;background:#182026;padding:8px}.desc-subscribe-container[_ngcontent-%COMP%]   .desc-subscribe-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 8px}.desc-subscribe-container[_ngcontent-%COMP%]   .desc-subscribe-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-top:-2px;margin-left:-6px}.desc-tags[_ngcontent-%COMP%], .desc-text[_ngcontent-%COMP%]{margin-top:8px}.collectable-container[_ngcontent-%COMP%]{background:#182026;padding:16px 24px;margin:12px 0}.collectable-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#7077e5;margin-bottom:8px;font-weight:700}.collection-name[_ngcontent-%COMP%]{max-width:80vw;overflow:hidden;text-overflow:ellipsis}mat-toolbar[_ngcontent-%COMP%]{justify-content:space-between}@media (max-width: 960px){.metadata-container[_ngcontent-%COMP%]{width:65%}.desc-subscribe-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.desc-subscribe-buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center}}@media (max-width: 600px){mat-toolbar[_ngcontent-%COMP%]{display:flex;height:120px;flex-wrap:wrap;justify-content:center}mat-toolbar[_ngcontent-%COMP%]   .toolbar-title[_ngcontent-%COMP%]{max-width:100%;display:flex}.toolbar-select[_ngcontent-%COMP%]{align-content:center}.metadata-grid[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center;margin-bottom:10px}.metadata-container[_ngcontent-%COMP%]{width:100%}}"]});var Zt=f(4043);class St{constructor(o,e,i){this._snackBar=o,this._workshopService=e,this._discordService=i,this._workshopService.loadPersonalSubscribedIds()}onSubscribe(){this.doSubscribe()}onUnsubscribe(){this.doUnsubscribe()}onGuildSubscribe(o){this.doGuildSubscribe(o)}doSubscribe(){const o=this._workshopService.personalSubscribe(this.collection._id).pipe((0,Zt.B)());return o.subscribe(e=>{e.success?this._snackBar.open(`Subscribed to ${this.collection.name}!`):this._snackBar.open(e.error)}),o}doUnsubscribe(){const o=this._workshopService.personalUnsubscribe(this.collection._id).pipe((0,Zt.B)());return o.subscribe(e=>{e.success?this._snackBar.open(`Unsubscribed from ${this.collection.name}!`):this._snackBar.open(e.error)}),o}doGuildSubscribe(o){const e=this._workshopService.guildSubscribe(this.collection._id,o.id).pipe((0,Zt.B)());return e.subscribe(i=>{i.success?i.data.new_subscription?this._snackBar.open(`Subscribed to ${this.collection.name} on ${o.name}!`):this._snackBar.open(`${o.name} is already subscribed to ${this.collection.name}. You can manage\n          server subscriptions in My Subscriptions!`,null,{duration:5e3}):this._snackBar.open(i.error,null,{duration:5e3})}),e}getGuilds(){return this._discordService.getUserGuilds()}isSubscribed(){var o;return null===(o=this._workshopService.personalSubscribedIds)||void 0===o?void 0:o.includes(this.collection._id)}}function Ke(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-list-item")(1,"code"),t._uU(2),t.qZA(),t.TgZ(3,"mat-icon",8),t._uU(4,"east"),t.qZA(),t.TgZ(5,"mat-form-field")(6,"span",9),t._uU(7,"!"),t.qZA(),t.TgZ(8,"input",10),t.NdJ("ngModelChange",function(c){const C=t.CHM(e).$implicit;return t.oxw(2).findBinding(!0,C).name=c}),t.qZA()()()}if(2&n){const e=o.$implicit,i=t.oxw(2);t.xp6(2),t.hij("!",e.name,""),t.xp6(6),t.Q6J("ngModel",i.findBinding(!0,e).name)}}function to(n,o){if(1&n&&(t.TgZ(0,"div")(1,"h3"),t._uU(2,"Aliases"),t.qZA(),t.TgZ(3,"mat-list"),t.YNc(4,Ke,9,2,"mat-list-item",7),t.qZA()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("ngForOf",e.collection.aliases)}}function eo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-list-item")(1,"code"),t._uU(2),t.qZA(),t.TgZ(3,"mat-icon",8),t._uU(4,"east"),t.qZA(),t.TgZ(5,"mat-form-field")(6,"input",10),t.NdJ("ngModelChange",function(c){const C=t.CHM(e).$implicit;return t.oxw(2).findBinding(!1,C).name=c}),t.qZA()()()}if(2&n){const e=o.$implicit,i=t.oxw(2);t.xp6(2),t.Oqu(e.name),t.xp6(4),t.Q6J("ngModel",i.findBinding(!1,e).name)}}function oo(n,o){if(1&n&&(t.TgZ(0,"div")(1,"h3"),t._uU(2,"Snippets"),t.qZA(),t.TgZ(3,"mat-list"),t.YNc(4,eo,7,2,"mat-list-item",7),t.qZA()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("ngForOf",e.collection.snippets)}}function no(n,o){if(1&n&&(t.TgZ(0,"p",11),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function io(n,o){1&n&&t._UZ(0,"mat-spinner",12),2&n&&t.Q6J("diameter",24)}class st{constructor(o,e,i){this.data=o,this.workshopService=e,this.dialogRef=i,this.loading=!1,this.collection=o.collection,this.guildContext=o.guildContext,this.bindings=(0,it.cloneDeep)(o.bindings)}ngOnInit(){}onSave(){let o;this.loading=!0,o=this.guildContext?this.workshopService.guildSubscribe(this.collection._id,this.guildContext.id,this.bindings):this.workshopService.personalSubscribe(this.collection._id,this.bindings),o.subscribe(e=>{this.loading=!1,e.success?this.dialogRef.close(this.bindings):this.error=e.error})}findBinding(o,e){return(o?this.bindings.alias_bindings:this.bindings.snippet_bindings).find(c=>c.id===e._id)}}st.\u0275fac=function(o){return new(o||st)(t.Y36(a.WI),t.Y36(u.a),t.Y36(a.so))},st.\u0275cmp=t.Xpm({type:st,selectors:[["avr-edit-bindings-dialog"]],decls:14,vars:4,consts:[["mat-dialog-title",""],[1,"mat-typography"],[4,"ngIf"],["class","mat-error",4,"ngIf"],[3,"diameter",4,"ngIf"],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],[4,"ngFor","ngForOf"],[1,"collectable-binding-arrow"],["matPrefix",""],["matInput","",3,"ngModel","ngModelChange"],[1,"mat-error"],[3,"diameter"]],template:function(o,e){1&o&&(t.TgZ(0,"h2",0),t._uU(1,"Editing Bindings"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"p"),t._uU(4," Editing bindings allows you to give custom names to aliases and snippets. "),t.qZA(),t.YNc(5,to,5,1,"div",2),t.YNc(6,oo,5,1,"div",2),t.YNc(7,no,2,1,"p",3),t.qZA(),t.TgZ(8,"mat-dialog-actions"),t.YNc(9,io,1,1,"mat-spinner",4),t.TgZ(10,"button",5),t._uU(11,"Cancel"),t.qZA(),t.TgZ(12,"button",6),t.NdJ("click",function(){return e.onSave()}),t._uU(13,"Save"),t.qZA()()),2&o&&(t.xp6(5),t.Q6J("ngIf",e.collection.aliases.length),t.xp6(1),t.Q6J("ngIf",e.collection.snippets.length),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(2),t.Q6J("ngIf",e.loading))},directives:[a.uh,a.xY,_.O5,ft.i$,_.sg,ft.Tg,I.Hw,r.KE,r.qo,s.Nt,x.Fj,x.JJ,x.On,a.H8,g.Ou,d.lW,a.ZT],styles:["h3[_ngcontent-%COMP%]{color:#7077e5;margin:0;font-weight:700}.collectable-binding-arrow[_ngcontent-%COMP%]{margin:0 4px}mat-spinner[_ngcontent-%COMP%]{margin-right:8px}"]});var lo=f(318),Et=f(4540);function ao(n,o){if(1&n&&t._UZ(0,"img",5),2&n){const e=t.oxw().$implicit,i=t.oxw();t.Q6J("src",i.getGuildAvatarUrl(e),t.LSH)}}function co(n,o){if(1&n&&(t.TgZ(0,"mat-option",2),t.YNc(1,ao,1,1,"img",4),t._uU(2),t.qZA()),2&n){const e=o.$implicit,i=t.oxw();t.Q6J("value",e),t.xp6(1),t.Q6J("ngIf",i.getGuildAvatarUrl(e)),t.xp6(1),t.hij(" ",e.name," ")}}const wt=new Et.Of;class z{constructor(o){this.discordService=o,this.sentinel=wt,this.label="Server",this.defaultLabel="Me",this.guildChange=new t.vpe,this.guildContext=wt}ngOnInit(){}onGuildContextChange(){this.guildChange.emit(this.guildContext===wt?null:this.guildContext)}getUserGuilds(){return this.discordService.getUserGuilds()}getGuildAvatarUrl(o){return(0,Et.cm)(o,32)}}z.\u0275fac=function(o){return new(o||z)(t.Y36($.h))},z.\u0275cmp=t.Xpm({type:z,selectors:[["avr-guild-select-field"]],inputs:{label:"label",defaultLabel:"defaultLabel"},outputs:{guildChange:"guildChange"},decls:8,vars:7,consts:[["appearance","fill",1,"toolbar-search-form-guild-context"],[3,"value","valueChange","selectionChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["alt","Guild icon","class","guild-icon",3,"src",4,"ngIf"],["alt","Guild icon",1,"guild-icon",3,"src"]],template:function(o,e){1&o&&(t.TgZ(0,"mat-form-field",0)(1,"mat-label"),t._uU(2),t.qZA(),t.TgZ(3,"mat-select",1),t.NdJ("valueChange",function(c){return e.guildContext=c})("selectionChange",function(){return e.onGuildContextChange()}),t.TgZ(4,"mat-option",2),t._uU(5),t.qZA(),t.YNc(6,co,3,3,"mat-option",3),t.ALo(7,"async"),t.qZA()()),2&o&&(t.xp6(2),t.Oqu(e.label),t.xp6(1),t.Q6J("value",e.guildContext),t.xp6(1),t.Q6J("value",e.sentinel),t.xp6(1),t.Oqu(e.defaultLabel),t.xp6(1),t.Q6J("ngForOf",t.lcZ(7,5,e.getUserGuilds())))},directives:[r.KE,r.hX,S.gD,q.ey,_.sg,_.O5],pipes:[_.Ov],styles:[".guild-icon[_ngcontent-%COMP%]{border-radius:100%;width:24px;height:24px;margin-bottom:-6px;margin-right:4px}\n/*# sourceMappingURL=guild-select-field.component.ts-angular-inline--4.css.map*/"]});const Pt={year:31536e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};class rt{transform(o,...e){if(o){const i=Math.floor((+new Date-+new Date(o))/1e3);if(i<29)return"just now";let c;for(const m in Pt)if(c=Math.floor(i/Pt[m]),c>0){return`${c} ${c>1?`${m}s`:m} ago`}}return o}}function so(n,o){1&n&&(t.TgZ(0,"a",12)(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()),2&n&&t.Q6J("routerLink","./edit")("skipLocationChange",!0)}function ro(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){return t.CHM(e),t.oxw().onEditBindings()}),t.TgZ(1,"mat-icon"),t._uU(2,"handyman"),t.qZA()()}}function po(n,o){1&n&&t._UZ(0,"mat-spinner",14)}function uo(n,o){if(1&n&&t._UZ(0,"img",36),2&n){const e=t.oxw(2);t.Q6J("src",e.collection.image,t.LSH)}}function mo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",37),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw(2).onGuildSubscribe(m)}),t._uU(1),t.qZA()}if(2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function go(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onSubscribe()}),t.TgZ(1,"mat-icon"),t._uU(2,"add"),t.qZA(),t._uU(3," Subscribe "),t.qZA()}}function _o(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",38),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onUnsubscribe()}),t.TgZ(1,"mat-icon"),t._uU(2,"check"),t.qZA(),t._uU(3," Subscribed! "),t.qZA()}}function ho(n,o){if(1&n&&(t.TgZ(0,"div",39),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.error," ")}}function fo(n,o){if(1&n&&(t.TgZ(0,"div",40),t._UZ(1,"avr-pretty-user",41),t.qZA()),2&n){const e=o.$implicit;t.xp6(1),t.Q6J("user",e)}}function bo(n,o){if(1&n&&t._UZ(0,"avr-collectable-display",44),2&n){const e=o.$implicit,i=t.oxw(3);t.Q6J("alias",e)("bindings",i.bindings)}}function Co(n,o){if(1&n&&(t.TgZ(0,"div",42)(1,"h2"),t._uU(2,"Aliases"),t.qZA(),t.YNc(3,bo,1,2,"avr-collectable-display",43),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.collection.aliases)}}function vo(n,o){if(1&n&&t._UZ(0,"avr-collectable-display",46),2&n){const e=o.$implicit,i=t.oxw(3);t.Q6J("snippet",e)("bindings",i.bindings)}}function xo(n,o){if(1&n&&(t.TgZ(0,"div",42)(1,"h2"),t._uU(2,"Snippets"),t.qZA(),t.YNc(3,vo,1,2,"avr-collectable-display",45),t.qZA()),2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngForOf",e.collection.snippets)}}function To(n,o){if(1&n&&(t.TgZ(0,"div",15)(1,"div",16)(2,"div",17),t.YNc(3,uo,1,1,"img",18),t.TgZ(4,"div",19)(5,"div"),t._uU(6," Subscribe or add "),t.TgZ(7,"b"),t._uU(8),t.qZA(),t._uU(9," to a server to instantly gain access to "),t.TgZ(10,"b"),t._uU(11),t.qZA(),t._uU(12),t.TgZ(13,"b"),t._uU(14),t.qZA(),t._uU(15),t.qZA(),t.TgZ(16,"div",20)(17,"button",21)(18,"mat-icon"),t._uU(19,"post_add"),t.qZA(),t._uU(20," Add to Server "),t.qZA(),t.TgZ(21,"mat-menu",null,22),t.YNc(23,mo,2,1,"button",23),t.ALo(24,"async"),t.qZA(),t.YNc(25,go,4,0,"button",24),t.YNc(26,_o,4,0,"button",24),t.qZA(),t.YNc(27,ho,2,1,"div",25),t.qZA(),t.TgZ(28,"div",26),t._UZ(29,"avr-tag-chip-list",27),t.qZA(),t.TgZ(30,"p",28)(31,"markdown"),t._uU(32),t.qZA()()(),t.TgZ(33,"div",29)(34,"div",30),t.YNc(35,fo,2,1,"div",31),t.TgZ(36,"div",32)(37,"p"),t._uU(38),t.ALo(39,"dateAgoLong"),t._UZ(40,"br"),t._uU(41),t.ALo(42,"dateAgoLong"),t.qZA()(),t.TgZ(43,"div",33)(44,"p"),t._uU(45," Added by "),t.TgZ(46,"b"),t._uU(47),t.qZA(),t._uU(48),t.TgZ(49,"b"),t._uU(50),t.qZA(),t._uU(51),t.qZA()(),t.TgZ(52,"div",34)(53,"p")(54,"b"),t._uU(55),t.qZA(),t._uU(56),t._UZ(57,"br"),t.TgZ(58,"b"),t._uU(59),t.qZA(),t._uU(60),t.qZA()()()()(),t._UZ(61,"mat-divider"),t.YNc(62,Co,4,1,"div",35),t.YNc(63,xo,4,1,"div",35),t.qZA()),2&n){const e=t.MAs(22),i=t.oxw();t.xp6(3),t.Q6J("ngIf",i.collection.image),t.xp6(5),t.Oqu(i.collection.name),t.xp6(3),t.Oqu(i.collection.alias_ids.length),t.xp6(1),t.hij(" ",1===i.collection.alias_ids.length?"alias":"aliases"," and "),t.xp6(2),t.Oqu(i.collection.snippet_ids.length),t.xp6(1),t.hij(" ",1===i.collection.snippet_ids.length?"snippet":"snippets",". "),t.xp6(2),t.Q6J("matMenuTriggerFor",e),t.xp6(6),t.Q6J("ngForOf",t.lcZ(24,26,i.getGuilds())),t.xp6(2),t.Q6J("ngIf",!i.isSubscribed()),t.xp6(1),t.Q6J("ngIf",i.isSubscribed()),t.xp6(1),t.Q6J("ngIf",i.error),t.xp6(2),t.Q6J("collection",i.collection),t.xp6(3),t.Oqu(i.debrace(i.collection.description)),t.xp6(3),t.Q6J("ngForOf",i.editors),t.xp6(3),t.hij(" Last Edited: ",t.lcZ(39,28,i.collection.last_edited)," "),t.xp6(3),t.hij(" Created: ",t.lcZ(42,30,i.collection.created_at)," "),t.xp6(6),t.Oqu(i.collection.num_subscribers),t.xp6(1),t.hij(" ",1===i.collection.num_subscribers?"person":"people"," and "),t.xp6(2),t.Oqu(i.collection.num_guild_subscribers),t.xp6(1),t.hij(" ",1===i.collection.num_guild_subscribers?"server":"servers"," "),t.xp6(4),t.Oqu(i.collection.alias_ids.length),t.xp6(1),t.hij(" ",1===i.collection.alias_ids.length?"alias":"aliases"," "),t.xp6(3),t.Oqu(i.collection.snippet_ids.length),t.xp6(1),t.hij(" ",1===i.collection.snippet_ids.length?"snippet":"snippets"," "),t.xp6(2),t.Q6J("ngIf",i.collection.alias_ids.length),t.xp6(1),t.Q6J("ngIf",i.collection.snippet_ids.length)}}function Zo(n,o){1&n&&t._UZ(0,"mat-spinner",49),2&n&&t.Q6J("diameter",24)}function wo(n,o){if(1&n&&(t.TgZ(0,"p",50),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.error," ")}}function Oo(n,o){if(1&n&&(t.TgZ(0,"div",15),t.YNc(1,Zo,1,1,"mat-spinner",47),t.YNc(2,wo,2,1,"p",48),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",!e.error),t.xp6(1),t.Q6J("ngIf",e.error)}}rt.\u0275fac=function(o){return new(o||rt)},rt.\u0275pipe=t.Yjl({name:"dateAgoLong",type:rt,pure:!0});class dt extends St{constructor(o,e,i,c,m,C,M,Ct){super(i,M,Ct),this.route=o,this.router=e,this.snackBar=i,this.dialog=c,this.location=m,this.meta=C,this.workshopService=M,this.discordService=Ct,this.debrace=L.$,this.loading=!0}ngOnInit(){this.route.paramMap.subscribe(o=>this.loadCollection(o.get("id")))}onGuildContextChange(o){this.guildContext=o,this.error=null,this.loadBindings(),this.guildContext&&this.workshopService.getGuildPermissionCheck(this.guildContext.id).subscribe(e=>{e.success&&!e.data.can_edit&&(this.error=`You do not have permission to edit server collections on ${this.guildContext.name}.\n          You will be unable to change subscriptions or edit bindings.`)})}onCollectionInit(o){this.collection=o,this.editors=[],this.loadOwner(),this.loadEditors(),this.loadBindings()}onEditBindings(){this.dialog.open(st,{disableClose:!0,data:{collection:this.collection,guildContext:this.guildContext,bindings:this.bindings}}).afterClosed().subscribe(e=>{e&&(this.bindings=e,this.snackBar.open("Updated bindings!"))})}onSubscribe(){this.doSubscribe().subscribe(o=>{o.success&&!this.guildContext&&(this.bindings=o.data)})}onUnsubscribe(){this.doUnsubscribe().subscribe(o=>{o.success&&!this.guildContext&&(this.bindings=null)})}onGuildSubscribe(o){this.doGuildSubscribe(o).subscribe(e=>{var i;e.success&&(null===(i=this.guildContext)||void 0===i?void 0:i.id)===o.id&&(this.bindings=e.data)})}loadCollection(o){this.workshopService.getCollectionFull(o).subscribe(e=>{this.loading=!1,e.success?this.onCollectionInit(e.data):this.error=e.error})}loadOwner(){this.discordService.getUser(this.collection.owner).subscribe(o=>{this.editors.unshift(o)})}loadEditors(){this.workshopService.getCollectionEditors(this.collection._id).subscribe(o=>{o.success&&this.editors.push(...o.data)})}loadBindings(){let o;this.bindings=null,o=this.guildContext?this.workshopService.getGuildSubscription(this.collection._id,this.guildContext.id):this.workshopService.getMySubscription(this.collection._id),o.subscribe(e=>{e.success&&(this.bindings=e.data)})}canEdit(){var o;return null===(o=this.editors)||void 0===o?void 0:o.some(e=>e.id===(0,l.PR)().id)}goBack(){this.location.back()}}dt.\u0275fac=function(o){return new(o||dt)(t.Y36(T.gz),t.Y36(T.F0),t.Y36(ot.ux),t.Y36(a.uw),t.Y36(_.Ye),t.Y36(lo.h_),t.Y36(u.a),t.Y36($.h))},dt.\u0275cmp=t.Xpm({type:dt,selectors:[["avr-collection"]],features:[t.qOj],decls:16,vars:6,consts:[["color","primary"],[1,"toolbar-title"],["mat-icon-button","","aria-label","Back",3,"click"],[1,"collection-name"],[1,"toolbar-spacer"],["mat-icon-button","","aria-label","Edit Collection Button","matTooltip","Edit Collection",3,"routerLink","skipLocationChange",4,"ngIf"],["mat-icon-button","","aria-label","Edit Bindings Button","matTooltip","Edit Bindings",3,"click",4,"ngIf"],[1,"toolbar-select"],["color","accent","diameter","24","class","toolbar-spinner",4,"ngIf"],[1,"toolbar-search-form"],["label","View As",1,"toolbar-search-form-guild-context",3,"guildChange"],["class","content mat-typography",4,"ngIf"],["mat-icon-button","","aria-label","Edit Collection Button","matTooltip","Edit Collection",3,"routerLink","skipLocationChange"],["mat-icon-button","","aria-label","Edit Bindings Button","matTooltip","Edit Bindings",3,"click"],["color","accent","diameter","24",1,"toolbar-spinner"],[1,"content","mat-typography"],[1,"metadata-grid"],[1,"description-etc"],["alt","Collection Image","class","desc-image",3,"src",4,"ngIf"],[1,"desc-subscribe-container"],[1,"desc-subscribe-buttons"],["mat-raised-button","","color","accent",3,"matMenuTriggerFor"],["serverSubMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],["class","desc-error mat-error",4,"ngIf"],[1,"desc-tags"],[3,"collection"],[1,"desc-text"],[1,"metadata-container"],[1,"metadata"],["class","meta-author",4,"ngFor","ngForOf"],[1,"meta-times"],[1,"meta-subscriptions"],[1,"meta-numbers"],["class","collectable-container",4,"ngIf"],["alt","Collection Image",1,"desc-image",3,"src"],["mat-menu-item","",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"desc-error","mat-error"],[1,"meta-author"],[3,"user"],[1,"collectable-container"],[3,"alias","bindings",4,"ngFor","ngForOf"],[3,"alias","bindings"],[3,"snippet","bindings",4,"ngFor","ngForOf"],[3,"snippet","bindings"],[3,"diameter",4,"ngIf"],["class","mat-error",4,"ngIf"],[3,"diameter"],[1,"mat-error"]],template:function(o,e){1&o&&(t.TgZ(0,"mat-toolbar",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return e.goBack()}),t.TgZ(3,"mat-icon"),t._uU(4,"arrow_back"),t.qZA()(),t.TgZ(5,"span",3),t._uU(6),t.qZA(),t._UZ(7,"span",4),t.YNc(8,so,3,2,"a",5),t.YNc(9,ro,3,0,"button",6),t.qZA(),t.TgZ(10,"div",7),t.YNc(11,po,1,0,"mat-spinner",8),t.TgZ(12,"div",9)(13,"avr-guild-select-field",10),t.NdJ("guildChange",function(c){return e.onGuildContextChange(c)}),t.qZA()()()(),t.YNc(14,To,64,32,"div",11),t.YNc(15,Oo,3,2,"div",11)),2&o&&(t.xp6(6),t.Oqu((null==e.collection?null:e.collection.name)||"Loading..."),t.xp6(2),t.Q6J("ngIf",e.canEdit()),t.xp6(1),t.Q6J("ngIf",e.bindings),t.xp6(2),t.Q6J("ngIf",e.loading),t.xp6(3),t.Q6J("ngIf",e.collection),t.xp6(1),t.Q6J("ngIf",!e.collection))},directives:[nt.Ye,d.lW,I.Hw,_.O5,d.zs,T.yS,Y.gM,g.Ou,z,D.p6,D.VK,_.sg,D.OP,j,p.lF,R,B.d,H],pipes:[_.Ov,rt],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}",".toolbar-search-form[_ngcontent-%COMP%]{margin-left:8px}.content[_ngcontent-%COMP%]{color:#ced9e0;background:#10161a;padding:8px;min-height:calc(100vh - 192px)}.metadata-grid[_ngcontent-%COMP%]{display:flex;grid-template-columns:minmax(275px,1fr) 275px;gap:1rem}.metadata-grid[_ngcontent-%COMP%]   .metadata[_ngcontent-%COMP%]{background:#182026;padding:8px;border-radius:8px}.meta-author[_ngcontent-%COMP%]{margin-bottom:8px}.desc-image[_ngcontent-%COMP%]{width:100%;border-radius:8px}.desc-subscribe-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;background:#182026;padding:8px}.desc-subscribe-container[_ngcontent-%COMP%]   .desc-subscribe-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0 8px}.desc-subscribe-container[_ngcontent-%COMP%]   .desc-subscribe-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-top:-2px;margin-left:-6px}.desc-tags[_ngcontent-%COMP%], .desc-text[_ngcontent-%COMP%]{margin-top:8px}.collectable-container[_ngcontent-%COMP%]{background:#182026;padding:16px 24px;margin:12px 0}.collectable-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#7077e5;margin-bottom:8px;font-weight:700}.collection-name[_ngcontent-%COMP%]{max-width:80vw;overflow:hidden;text-overflow:ellipsis}mat-toolbar[_ngcontent-%COMP%]{justify-content:space-between}@media (max-width: 960px){.metadata-container[_ngcontent-%COMP%]{width:65%}.desc-subscribe-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.desc-subscribe-buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:center}}@media (max-width: 600px){mat-toolbar[_ngcontent-%COMP%]{display:flex;height:120px;flex-wrap:wrap;justify-content:center}mat-toolbar[_ngcontent-%COMP%]   .toolbar-title[_ngcontent-%COMP%]{max-width:100%;display:flex}.toolbar-select[_ngcontent-%COMP%]{align-content:center}.metadata-grid[_ngcontent-%COMP%]{flex-wrap:wrap;justify-content:center;margin-bottom:10px}.metadata-container[_ngcontent-%COMP%]{width:100%}}"]});var Ot=f(1961),Ao=f(2529);const qt={y:31536e3,mo:2592e3,w:604800,d:86400,h:3600,m:60,s:1};class pt{transform(o,...e){if(o){const i=Math.floor((+new Date-+new Date(o))/1e3);if(i<29)return"now";let c;for(const m in qt)if(c=Math.floor(i/qt[m]),c>0)return c+m}return o}}function Mo(n,o){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.getInitials(e.collection.name)," ")}}function yo(n,o){if(1&n&&t._UZ(0,"img",25),2&n){const e=t.oxw();t.Q6J("src",e.collection.image,t.LSH)("alt","Image for "+e.collection.name)}}function ko(n,o){if(1&n&&(t.TgZ(0,"i",26),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" (",e.collection.publish_state.toLowerCase(),") ")}}pt.\u0275fac=function(o){return new(o||pt)},pt.\u0275pipe=t.Yjl({name:"dateAgo",type:pt,pure:!0});const At=function(n){return["/dashboard/workshop/",n]};function Uo(n,o){if(1&n&&(t.TgZ(0,"a",27)(1,"mat-icon"),t._uU(2,"read_more"),t.qZA()()),2&n){const e=t.oxw();t.Q6J("routerLink",t.VKq(1,At,e.collection._id))}}const Mt=function(n){return["/dashboard/workshop/",n,"edit"]};function So(n,o){if(1&n&&(t.TgZ(0,"a",28)(1,"mat-icon"),t._uU(2,"edit"),t.qZA()()),2&n){const e=t.oxw();t.Q6J("routerLink",t.VKq(1,Mt,e.collection._id))}}function Eo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw().onGuildSubscribe(m)}),t._uU(1),t.qZA()}if(2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function Po(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSubscribe()}),t.TgZ(1,"mat-icon"),t._uU(2,"add"),t.qZA()()}}function qo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",31),t.NdJ("click",function(){return t.CHM(e),t.oxw().onUnsubscribe()}),t.TgZ(1,"mat-icon"),t._uU(2,"check"),t.qZA()()}}class V extends St{constructor(o,e,i){super(i,e,o),this.discord=o,this.workshopService=e,this.snackBar=i,this.showEdit=!1}ngOnInit(){this.author={id:this.collection.owner,username:"Loading...",avatarUrl:"../../../../assets/img/AvraeSquare.jpg"},this.loadAuthor()}getInitials(o){return(o.match(/\b\w/g)||[]).join("").toUpperCase()}getNumberString(o){return Ao(o).format("0.[0]a")}isSubscribed(){var o;return null===(o=this.workshopService.personalSubscribedIds)||void 0===o?void 0:o.includes(this.collection._id)}loadAuthor(){this.discord.getUser(this.collection.owner).subscribe(o=>this.author=o)}}function No(n,o){1&n&&t._UZ(0,"mat-spinner",16)}function Jo(n,o){1&n&&(t.TgZ(0,"p"),t._uU(1," Here are all the collections you're subscribed to. You can view them or unsubscribe from them here! "),t.qZA())}function Fo(n,o){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" Here are all the collections on ",e.guildContext.name,". You can view them or unsubscribe from them here! ")}}function Yo(n,o){if(1&n&&(t.TgZ(0,"p",17),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function Qo(n,o){1&n&&(t.TgZ(0,"mat-card")(1,"p"),t._uU(2," You have not subscribed to any collections. Try switching server contexts in the top right or exploring collections in the workshop! "),t.qZA()())}function Do(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",20),t.NdJ("click",function(){t.CHM(e);const c=t.oxw().$implicit;return t.oxw().onGuildRemove(c)}),t.TgZ(1,"mat-icon"),t._uU(2,"link_off"),t.qZA()()}}function Lo(n,o){if(1&n&&(t.TgZ(0,"avr-collection-tile",18),t.YNc(1,Do,3,0,"button",19),t.qZA()),2&n){const e=o.$implicit,i=t.oxw();t.Q6J("collection",e),t.xp6(1),t.Q6J("ngIf",i.guildContext&&i.guildSubscribedIds.includes(e._id))}}V.\u0275fac=function(o){return new(o||V)(t.Y36($.h),t.Y36(u.a),t.Y36(ot.ux))},V.\u0275cmp=t.Xpm({type:V,selectors:[["avr-collection-tile"]],inputs:{collection:"collection",showEdit:"showEdit"},features:[t.qOj],ngContentSelectors:["*"],decls:41,vars:31,consts:[[1,"tile","mat-elevation-z3","ignore-theme"],[1,"ignore-theme",3,"routerLink"],[1,"collection-image-container"],[1,"collection-name-underlay","mat-typography","collection-image"],[4,"ngIf"],["class","collection-image",3,"src","alt",4,"ngIf"],[1,"collection-meta","mat-typography"],[1,"collection-author"],["alt","avatar",1,"collection-author-avatar",3,"src"],[1,"collection-author-username"],[1,"collection-edit-date"],["class","collection-publication-state",4,"ngIf"],[3,"collection","limit"],[1,"description"],[1,"hover-meta-grid"],[1,"hover-subscriptions-number"],[1,"hover-subscriptions-icon"],[1,"hover-buttons"],["mat-icon-button","","aria-label","More details","matTooltip","More details",3,"routerLink",4,"ngIf"],["mat-icon-button","","aria-label","Edit","matTooltip","Edit",3,"routerLink",4,"ngIf"],["mat-icon-button","","aria-label","Server subscribe","matTooltip","Add to server",3,"matMenuTriggerFor"],["serverSubMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-icon-button","","aria-label","Personal subscribe","matTooltip","Add to personal collection",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Personal unsubscribe","matTooltip","Remove from personal collection",3,"click",4,"ngIf"],[1,"collection-image",3,"src","alt"],[1,"collection-publication-state"],["mat-icon-button","","aria-label","More details","matTooltip","More details",3,"routerLink"],["mat-icon-button","","aria-label","Edit","matTooltip","Edit",3,"routerLink"],["mat-menu-item","",3,"click"],["mat-icon-button","","aria-label","Personal subscribe","matTooltip","Add to personal collection",3,"click"],["mat-icon-button","","aria-label","Personal unsubscribe","matTooltip","Remove from personal collection",3,"click"]],template:function(o,e){if(1&o&&(t.F$t(),t.TgZ(0,"div",0)(1,"a",1)(2,"div",2)(3,"div",3),t.YNc(4,Mo,2,1,"p",4),t.qZA(),t.YNc(5,yo,1,2,"img",5),t.qZA()(),t.TgZ(6,"div",6),t._UZ(7,"mat-divider"),t.TgZ(8,"a",1)(9,"h2"),t._uU(10),t.qZA()(),t.TgZ(11,"div",7),t._UZ(12,"img",8),t.TgZ(13,"span",9),t._uU(14),t.TgZ(15,"span",10),t._uU(16),t.ALo(17,"dateAgo"),t.qZA(),t.YNc(18,ko,2,1,"i",11),t.qZA()(),t._UZ(19,"avr-tag-chip-list",12),t.TgZ(20,"p",13),t._uU(21),t.qZA(),t.TgZ(22,"div",14)(23,"div",15),t._uU(24),t.qZA(),t.TgZ(25,"div",16)(26,"mat-icon"),t._uU(27,"get_app"),t.qZA()(),t.TgZ(28,"div",17),t.Hsn(29),t.YNc(30,Uo,3,3,"a",18),t.YNc(31,So,3,3,"a",19),t.TgZ(32,"button",20)(33,"mat-icon"),t._uU(34,"post_add"),t.qZA()(),t.TgZ(35,"mat-menu",null,21),t.YNc(37,Eo,2,1,"button",22),t.ALo(38,"async"),t.qZA(),t.YNc(39,Po,3,0,"button",23),t.YNc(40,qo,3,0,"button",24),t.qZA()()()()),2&o){const i=t.MAs(36);t.xp6(1),t.Q6J("routerLink",e.showEdit?t.VKq(23,Mt,e.collection._id):t.VKq(25,At,e.collection._id)),t.xp6(3),t.Q6J("ngIf",!e.collection.image),t.xp6(1),t.Q6J("ngIf",e.collection.image),t.xp6(3),t.Q6J("routerLink",e.showEdit?t.VKq(27,Mt,e.collection._id):t.VKq(29,At,e.collection._id)),t.xp6(2),t.hij(" ",e.collection.name," "),t.xp6(2),t.Q6J("src",e.author.avatarUrl,t.LSH),t.xp6(2),t.hij(" by ",e.author.username," "),t.xp6(2),t.hij(" \u2022 ",t.lcZ(17,19,e.collection.last_edited)," "),t.xp6(2),t.Q6J("ngIf","PUBLISHED"!==e.collection.publish_state),t.xp6(1),t.Q6J("collection",e.collection)("limit",5),t.xp6(2),t.hij(" ",e.collection.description," "),t.xp6(3),t.hij(" ",e.getNumberString(e.collection.num_subscribers+e.collection.num_guild_subscribers)," "),t.xp6(6),t.Q6J("ngIf",!e.showEdit),t.xp6(1),t.Q6J("ngIf",e.showEdit),t.xp6(1),t.Q6J("matMenuTriggerFor",i),t.xp6(5),t.Q6J("ngForOf",t.lcZ(38,21,e.getGuilds())),t.xp6(2),t.Q6J("ngIf",!e.isSubscribed()),t.xp6(1),t.Q6J("ngIf",e.isSubscribed())}},directives:[T.yS,_.O5,B.d,j,I.Hw,d.zs,Y.gM,d.lW,D.p6,D.VK,_.sg,D.OP],pipes:[pt,_.Ov],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}",".tile[_ngcontent-%COMP%]{position:relative;background:#182026;border-radius:8px}.collection-image-container[_ngcontent-%COMP%]{padding-top:56.25%;position:relative}.collection-image[_ngcontent-%COMP%]{position:absolute;top:0;width:100%;height:100%;border-radius:4px;-o-object-fit:cover;object-fit:cover}.collection-name-underlay[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:xx-large}.collection-meta[_ngcontent-%COMP%]{margin:0 8px;padding-bottom:8px}.collection-meta[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.collection-author[_ngcontent-%COMP%]{height:24px;width:100%;position:relative;margin-bottom:8px}.collection-author[_ngcontent-%COMP%]   .collection-author-avatar[_ngcontent-%COMP%]{width:24px;height:24px;border-radius:50%;margin-right:4px}.collection-author[_ngcontent-%COMP%]   .collection-author-username[_ngcontent-%COMP%]{position:absolute;top:50%;transform:translateY(-50%)}.description[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;line-clamp:4;display:-webkit-box;-webkit-line-clamp:4;-webkit-box-orient:vertical;margin:4px 0}.hover-meta-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr auto}.hover-meta-grid[_ngcontent-%COMP%]   .hover-subscriptions-number[_ngcontent-%COMP%]{height:24px;grid-column-start:1;margin:auto 0 auto auto;padding-top:4px}.hover-meta-grid[_ngcontent-%COMP%]   .hover-subscriptions-icon[_ngcontent-%COMP%]{height:24px;grid-column-start:2;margin:auto auto auto 0}.hover-meta-grid[_ngcontent-%COMP%]   .hover-buttons[_ngcontent-%COMP%]{grid-column-start:3}"]});class ut{constructor(o,e,i,c){this.route=o,this.router=e,this.snackBar=i,this.workshopService=c,this.loading=!0,this.collections=[],this.order="edittime",this.guildSubscribedIds=[]}ngOnInit(){this.loadCollections()}onOrderChange(){this.sortCollections()}onGuildContextChange(o){this.guildContext=o,this.loadCollections(),this.guildContext&&this.workshopService.getGuildPermissionCheck(this.guildContext.id).subscribe(e=>{e.success&&!e.data.can_edit&&(this.error=`You do not have permission to edit server collections on ${this.guildContext.name}.\n          You can view the subscribed collections here, but you will be unable to remove them.`)})}onGuildRemove(o){this.workshopService.guildUnsubscribe(o._id,this.guildContext.id).subscribe(e=>{e.success?(this.guildSubscribedIds.splice(this.guildSubscribedIds.indexOf(o._id),1),this.snackBar.open(`Removed ${o.name} from ${this.guildContext.name}.`)):this.snackBar.open(e.error,null,{duration:5e3})})}loadCollections(){this.error=null,this.loading=!0,this.collections=[],this.guildContext?this.workshopService.getGuildSubscriptions(this.guildContext.id).subscribe(o=>{o.success?(this.loadCollectionsFromIds(o.data),this.guildSubscribedIds=o.data):this.error=o.error}):this.workshopService.getMySubscriptions().subscribe(o=>{o.success?(this.loadCollectionsFromIds(o.data),this.guildSubscribedIds=[]):this.error=o.error})}loadCollectionsFromIds(o){0===o.length?this.loading=!1:this.workshopService.getCollectionsBatched(o).subscribe(e=>{e.success?(this.collections.push(...e.data),this.sortCollections(),this.loading=!1,this.collections.length!=o.length&&(this.error="One or more collections were hidden because they are private.")):this.error=e.error})}sortCollections(){let o;switch(this.order){case"alphabetical":o=(e,i)=>e.name.localeCompare(i.name);break;case"newest":o=(e,i)=>i.created_at.localeCompare(e.created_at);break;default:o=(e,i)=>i.last_edited.localeCompare(e.last_edited)}this.collections.sort(o)}}function Bo(n,o){if(1&n&&(t.TgZ(0,"p",9),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function jo(n,o){1&n&&t._UZ(0,"mat-spinner",10),2&n&&t.Q6J("diameter",24)}ut.\u0275fac=function(o){return new(o||ut)(t.Y36(T.gz),t.Y36(T.F0),t.Y36(ot.ux),t.Y36(u.a))},ut.\u0275cmp=t.Xpm({type:ut,selectors:[["avr-my-subscriptions"]],decls:25,vars:7,consts:[["color","primary"],[1,"toolbar-spacer"],["color","accent","diameter","24",4,"ngIf"],[1,"toolbar-search-form"],["appearance","fill",1,"toolbar-search-form-order"],[3,"value","valueChange","selectionChange"],["value","edittime"],["value","newest"],["value","alphabetical"],["defaultLabel","Personal Collection",1,"toolbar-search-form-guild-context",3,"guildChange"],[1,"container"],[1,"workshop-header"],[4,"ngIf"],["class","mat-error",4,"ngIf"],[1,"collections-grid"],[3,"collection",4,"ngFor","ngForOf"],["color","accent","diameter","24"],[1,"mat-error"],[3,"collection"],["mat-icon-button","","aria-label","Remove from server","matTooltip","Remove from server",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Remove from server","matTooltip","Remove from server",3,"click"]],template:function(o,e){1&o&&(t.TgZ(0,"mat-toolbar",0)(1,"span"),t._uU(2,"My Subscriptions"),t.qZA(),t._UZ(3,"span",1),t.YNc(4,No,1,0,"mat-spinner",2),t.TgZ(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),t._uU(8,"Order"),t.qZA(),t.TgZ(9,"mat-select",5),t.NdJ("valueChange",function(c){return e.order=c})("selectionChange",function(){return e.onOrderChange()}),t.TgZ(10,"mat-option",6),t._uU(11,"Last Updated"),t.qZA(),t.TgZ(12,"mat-option",7),t._uU(13,"Creation Time"),t.qZA(),t.TgZ(14,"mat-option",8),t._uU(15,"Alphabetical"),t.qZA()()(),t.TgZ(16,"avr-guild-select-field",9),t.NdJ("guildChange",function(c){return e.onGuildContextChange(c)}),t.qZA()()(),t.TgZ(17,"div",10)(18,"mat-card",11),t.YNc(19,Jo,2,0,"p",12),t.YNc(20,Fo,2,1,"p",12),t.YNc(21,Yo,2,1,"p",13),t.qZA(),t.YNc(22,Qo,3,0,"mat-card",12),t.TgZ(23,"div",14),t.YNc(24,Lo,2,2,"avr-collection-tile",15),t.qZA()()),2&o&&(t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(5),t.Q6J("value",e.order),t.xp6(10),t.Q6J("ngIf",!e.guildContext),t.xp6(1),t.Q6J("ngIf",e.guildContext),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(1),t.Q6J("ngIf",!e.loading&&0===e.collections.length),t.xp6(2),t.Q6J("ngForOf",e.collections))},directives:[nt.Ye,_.O5,g.Ou,r.KE,r.hX,S.gD,q.ey,z,Ot.a8,_.sg,V,d.lW,Y.gM,I.Hw],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}",".toolbar-search-form-guild-context[_ngcontent-%COMP%]{margin-left:8px}"]});class mt{constructor(o,e){this.dialogRef=o,this.workshopService=e,this.loading=!1}ngOnInit(){}onCreate(){this.loading=!0,this.workshopService.createCollection(this.name,this.description,this.imageUrl||null).subscribe(o=>{this.loading=!1,o.success?this.dialogRef.close(o.data):this.error=o.error})}}function Ro(n,o){1&n&&t._UZ(0,"mat-spinner",16)}function Ho(n,o){if(1&n&&(t.TgZ(0,"p",17),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.error," ")}}function Vo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-card")(1,"p"),t._uU(2,"You have no collections. Create one to share your aliases and snippets!"),t.qZA(),t.TgZ(3,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().onCreateCollection()}),t._uU(4," Create Collection "),t.qZA()()}}function $o(n,o){if(1&n&&t._UZ(0,"avr-collection-tile",19),2&n){const e=o.$implicit;t.Q6J("collection",e)("showEdit",!0)}}mt.\u0275fac=function(o){return new(o||mt)(t.Y36(a.so),t.Y36(u.a))},mt.\u0275cmp=t.Xpm({type:mt,selectors:[["avr-new-collection-dialog"]],decls:24,vars:5,consts:[["mat-dialog-title",""],[1,"mat-typography"],["matInput","","placeholder","Collection Name","required","",3,"ngModel","ngModelChange"],["matInput","","placeholder","What is this collection about?","required","",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["class","mat-error",4,"ngIf"],[3,"diameter",4,"ngIf"],["mat-flat-button","","mat-dialog-close",""],["mat-flat-button","","color","primary",3,"click"],[1,"mat-error"],[3,"diameter"]],template:function(o,e){1&o&&(t.TgZ(0,"h2",0),t._uU(1,"Creating Collection"),t.qZA(),t.TgZ(2,"mat-dialog-content",1)(3,"p"),t._uU(4," Start by giving your collection a name, description, and optionally an image! These can be changed at any time after your collection is created. "),t.qZA(),t.TgZ(5,"mat-form-field")(6,"mat-label"),t._uU(7,"Name"),t.qZA(),t.TgZ(8,"input",2),t.NdJ("ngModelChange",function(c){return e.name=c}),t.qZA()(),t.TgZ(9,"mat-form-field")(10,"mat-label"),t._uU(11,"Description"),t.qZA(),t.TgZ(12,"textarea",3),t.NdJ("ngModelChange",function(c){return e.description=c}),t.qZA()(),t.TgZ(13,"mat-form-field")(14,"mat-label"),t._uU(15,"Image URL"),t.qZA(),t.TgZ(16,"input",4),t.NdJ("ngModelChange",function(c){return e.imageUrl=c}),t.qZA()(),t.YNc(17,Bo,2,1,"p",5),t.qZA(),t.TgZ(18,"mat-dialog-actions"),t.YNc(19,jo,1,1,"mat-spinner",6),t.TgZ(20,"button",7),t._uU(21,"Cancel"),t.qZA(),t.TgZ(22,"button",8),t.NdJ("click",function(){return e.onCreate()}),t._uU(23,"Create"),t.qZA()()),2&o&&(t.xp6(8),t.Q6J("ngModel",e.name),t.xp6(4),t.Q6J("ngModel",e.description),t.xp6(4),t.Q6J("ngModel",e.imageUrl),t.xp6(1),t.Q6J("ngIf",e.error),t.xp6(2),t.Q6J("ngIf",e.loading))},directives:[a.uh,a.xY,r.KE,r.hX,s.Nt,x.Fj,x.Q7,x.JJ,x.On,_.O5,a.H8,g.Ou,d.lW,a.ZT],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin-left:8px}"]});class gt{constructor(o,e,i,c){this.route=o,this.router=e,this.dialog=i,this.workshopService=c,this.loadingOwned=!0,this.loadingEditable=!0,this.collections=[],this.order="edittime"}ngOnInit(){this.loadCollections()}onOrderChange(){this.sortCollections()}onCreateCollection(){this.dialog.open(mt,{disableClose:!0}).afterClosed().subscribe(e=>{null!==e&&this.router.navigate(["dashboard","workshop",e._id,"edit"])})}loadCollections(){this.error=null,this.loadingOwned=!0,this.loadingEditable=!0,this.collections=[],this.workshopService.getOwnedCollectionIds().subscribe(o=>{o.success?this.loadCollectionsFromIds(o.data,!0):this.error=o.error}),this.workshopService.getEditableCollectionIds().subscribe(o=>{o.success?this.loadCollectionsFromIds(o.data,!1):this.error=o.error})}loadCollectionsFromIds(o,e){0===o.length?e?this.loadingOwned=!1:this.loadingEditable=!1:this.workshopService.getCollectionsBatched(o).subscribe(i=>{i.success?(this.collections.push(...i.data),this.sortCollections(),e?this.loadingOwned=!1:this.loadingEditable=!1):this.error=i.error})}sortCollections(){let o;switch(this.order){case"alphabetical":o=(e,i)=>e.name.localeCompare(i.name);break;case"newest":o=(e,i)=>i.created_at.localeCompare(e.created_at);break;default:o=(e,i)=>i.last_edited.localeCompare(e.last_edited)}this.collections.sort(o)}}function Wo(n,o){1&n&&t._UZ(0,"mat-spinner",27)}function zo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-chip",28),t.NdJ("removed",function(){const m=t.CHM(e).$implicit;return t.oxw().onTagRemove(m)}),t._uU(1),t.TgZ(2,"mat-icon",29),t._uU(3,"cancel"),t.qZA()()}if(2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function Go(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){return t.CHM(e),t.oxw().onSearchClear()}),t.TgZ(1,"mat-icon"),t._uU(2,"cancel"),t.qZA()()}}function Xo(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"mat-option",33),t.NdJ("click",function(){const m=t.CHM(e).$implicit;return t.oxw(2).onTagAdd(m)}),t._uU(1),t.qZA()}if(2&n){const e=o.$implicit;t.xp6(1),t.hij(" ",e.name," ")}}function Ko(n,o){if(1&n&&(t.TgZ(0,"mat-optgroup",31),t.YNc(1,Xo,2,1,"mat-option",32),t.qZA()),2&n){const e=o.$implicit;t.Q6J("label",e[0]),t.xp6(1),t.Q6J("ngForOf",e[1])}}function tn(n,o){1&n&&(t.TgZ(0,"div")(1,"h3",36),t._uU(2,"Welcome to the Alias Workshop!"),t.qZA(),t.TgZ(3,"p"),t._uU(4," Here you can find user-made extensions to Avrae to make playing D&D over Discord even easier. Subscribe to a collection to use aliases (commands) and snippets (argument shortcuts) on any server Avrae is in, or add a collection to a server to let anyone in the server use it! "),t.qZA()())}function en(n,o){if(1&n&&(t.TgZ(0,"p",37),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.error," ")}}function on(n,o){if(1&n&&(t.TgZ(0,"mat-card",34),t.YNc(1,tn,5,0,"div",23),t.YNc(2,en,2,1,"p",35),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",1===e.page),t.xp6(1),t.Q6J("ngIf",e.error)}}function nn(n,o){1&n&&(t.TgZ(0,"mat-card")(1,"p"),t._uU(2,"There are no results. Try a different search!"),t.qZA()())}function ln(n,o){if(1&n&&t._UZ(0,"avr-collection-tile",38),2&n){const e=o.$implicit;t.Q6J("collection",e)}}function an(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",43),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onPreviousPage()}),t.TgZ(1,"mat-icon"),t._uU(2,"chevron_left"),t.qZA()()}}function cn(n,o){if(1&n){const e=t.EpF();t.TgZ(0,"button",44),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).onNextPage()}),t.TgZ(1,"mat-icon"),t._uU(2,"chevron_right"),t.qZA()()}}function sn(n,o){if(1&n&&(t.TgZ(0,"div",39)(1,"div",40),t.YNc(2,an,3,0,"button",41),t.TgZ(3,"span"),t._uU(4),t.qZA(),t.YNc(5,cn,3,0,"button",42),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",e.page>1),t.xp6(2),t.hij("Page ",e.page,""),t.xp6(1),t.Q6J("ngIf",(null==e.expectedCollectionIds?null:e.expectedCollectionIds.length)===e.COLLECTIONS_PER_PAGE)}}gt.\u0275fac=function(o){return new(o||gt)(t.Y36(T.gz),t.Y36(T.F0),t.Y36(a.uw),t.Y36(u.a))},gt.\u0275cmp=t.Xpm({type:gt,selectors:[["avr-my-work"]],decls:26,vars:5,consts:[["color","primary",1,"toolbar"],[1,"toolbar-spacer"],["color","accent","diameter","24",4,"ngIf"],["mat-icon-button","","matTooltip","Create New Collection",1,"toolbar-add-button",3,"click"],[1,"toolbar-search-form"],["appearance","fill",1,"toolbar-search-form-order"],[3,"value","valueChange","selectionChange"],["value","edittime"],["value","newest"],["value","alphabetical"],[1,"container"],[1,"workshop-header"],["class","mat-error",4,"ngIf"],[4,"ngIf"],[1,"collections-grid"],[3,"collection","showEdit",4,"ngFor","ngForOf"],["color","accent","diameter","24"],[1,"mat-error"],["mat-raised-button","","color","primary",3,"click"],[3,"collection","showEdit"]],template:function(o,e){1&o&&(t.TgZ(0,"mat-toolbar",0)(1,"span"),t._uU(2,"My Work"),t.qZA(),t._UZ(3,"span",1),t.YNc(4,Ro,1,0,"mat-spinner",2),t.TgZ(5,"button",3),t.NdJ("click",function(){return e.onCreateCollection()}),t.TgZ(6,"mat-icon"),t._uU(7,"add"),t.qZA()(),t.TgZ(8,"div",4)(9,"mat-form-field",5)(10,"mat-label"),t._uU(11,"Order"),t.qZA(),t.TgZ(12,"mat-select",6),t.NdJ("valueChange",function(c){return e.order=c})("selectionChange",function(){return e.onOrderChange()}),t.TgZ(13,"mat-option",7),t._uU(14,"Last Updated"),t.qZA(),t.TgZ(15,"mat-option",8),t._uU(16,"Creation Time"),t.qZA(),t.TgZ(17,"mat-option",9),t._uU(18,"Alphabetical"),t.qZA()()()()(),t.TgZ(19,"div",10)(20,"mat-card",11),t._uU(21," Here are all the collections you own or have access to. You can subscribe to your own work to use it on Avrae, or click on a collection to edit it. "),t.YNc(22,Ho,2,1,"p",12),t.qZA(),t.YNc(23,Vo,5,0,"mat-card",13),t.TgZ(24,"div",14),t.YNc(25,$o,1,2,"avr-collection-tile",15),t.qZA()()),2&o&&(t.xp6(4),t.Q6J("ngIf",e.loadingOwned||e.loadingEditable),t.xp6(8),t.Q6J("value",e.order),t.xp6(10),t.Q6J("ngIf",e.error),t.xp6(1),t.Q6J("ngIf",!(e.loadingOwned||e.loadingEditable)&&0===e.collections.length),t.xp6(2),t.Q6J("ngForOf",e.collections))},directives:[nt.Ye,_.O5,g.Ou,d.lW,Y.gM,I.Hw,r.KE,r.hX,S.gD,q.ey,Ot.a8,_.sg,V],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}",".toolbar-add-button[_ngcontent-%COMP%]{margin:0 8px}"]});class _t{constructor(o,e,i){this.route=o,this.router=e,this.workshopService=i,this.COLLECTIONS_PER_PAGE=48,this.tags=[],this.loading=!0,this.expectedCollectionIds=[],this.collections=[],this.filteredTags=[]}ngOnInit(){this.order=this.route.snapshot.queryParamMap.get("order")||"popular-1w",this.q=this.route.snapshot.queryParamMap.get("q"),this.page=parseInt(this.route.snapshot.queryParamMap.get("page")||"1"),this.loadValidTags()}onOrderChange(){this.refresh()}onSearch(o){this.q=o,o?this.order="relevance":"relevance"===this.order&&(this.order="popular-1w"),this.refresh()}onSearchClear(){this.tags=[],this.onSearch(null)}onTagAdd(o){this.tags.includes(o)||(this.tags.push(o),this.refresh())}onTagRemove(o){this.tags.includes(o)&&(this.tags.splice(this.tags.indexOf(o),1),this.refresh())}onPreviousPage(){this.page--,this.refresh()}onNextPage(){this.page++,this.refresh()}refresh(){this.error=null,this.addQueryParams({order:this.order,q:this.q||null,tags:this.tags.map(e=>e.slug).join(",")||null,page:this.page}),this.loading=!0;const o=this.tags.map(e=>e.slug);this.workshopService.getWorkshopExplore(this.order,o,this.q,this.page).subscribe(e=>{e.success?(this.collections=[],this.loadCollectionsFromIds(e.data)):this.error=e.error})}loadCollectionsFromIds(o){this.expectedCollectionIds=o,0===o.length?this.loading=!1:this.workshopService.getCollectionsBatched(o).subscribe(e=>{e.success?(this.collections.push(...e.data),this.loading=!1,this.collections.length!=this.expectedCollectionIds.length&&(this.error="One or more collections were hidden because they are private.")):this.error=e.error})}loadValidTags(){this.workshopService.getTags().subscribe(o=>{var e;if(o.success){this.validTags=o.data.sort((c,m)=>c.name.localeCompare(m.name));const i=(null===(e=this.route.snapshot.queryParamMap.get("tags"))||void 0===e?void 0:e.split(","))||[];this.tags.push(...this.validTags.filter(c=>i.includes(c.slug))),this.filterTags(this.q),this.refresh()}else this.error=o.error})}filterTags(o){this.validTags?this.filteredTags=o?Object.entries((0,it.groupBy)(this.validTags.filter(e=>e.name.toLowerCase().startsWith(o.toLowerCase())),e=>e.category)):Object.entries((0,it.groupBy)(this.validTags,e=>e.category)):this.filteredTags=[]}addQueryParams(o){this.router.navigate([],{relativeTo:this.route,queryParams:o,queryParamsHandling:"merge",replaceUrl:!0})}}_t.\u0275fac=function(o){return new(o||_t)(t.Y36(T.gz),t.Y36(T.F0),t.Y36(u.a))},_t.\u0275cmp=t.Xpm({type:_t,selectors:[["avr-workshop"]],decls:42,vars:12,consts:[["color","primary"],[1,"toolbar-spacer"],["color","accent","diameter","24",4,"ngIf"],[1,"toolbar-search-form"],["appearance","fill",1,"toolbar-search-form-order"],[3,"value","valueChange","selectionChange"],["value","popular-1w"],["value","popular-1m"],["value","popular-6m"],["value","popular-all"],["value","relevance"],["value","newest"],["value","edittime"],[1,"toolbar-search-form-search"],["chipList",""],["removable","",3,"removed",4,"ngFor","ngForOf"],["type","text","matInput","","autocomplete","off",3,"matAutocomplete","value","matChipInputFor","keyup","keyup.enter"],["search",""],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["auto","matAutocomplete"],[3,"label",4,"ngFor","ngForOf"],[1,"container"],["class","workshop-header",4,"ngIf"],[4,"ngIf"],[1,"collections-grid"],[3,"collection",4,"ngFor","ngForOf"],["class","paginator-container mat-typography ignore-theme",4,"ngIf"],["color","accent","diameter","24"],["removable","",3,"removed"],["matChipRemove",""],["mat-icon-button","","matSuffix","",3,"click"],[3,"label"],[3,"value","click",4,"ngFor","ngForOf"],[3,"value","click"],[1,"workshop-header"],["class","mat-error",4,"ngIf"],[1,"welcome-header"],[1,"mat-error"],[3,"collection"],[1,"paginator-container","mat-typography","ignore-theme"],[1,"paginator","mat-elevation-z3"],["mat-icon-button","","aria-label","Previous page button",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Next page button",3,"click",4,"ngIf"],["mat-icon-button","","aria-label","Previous page button",3,"click"],["mat-icon-button","","aria-label","Next page button",3,"click"]],template:function(o,e){if(1&o){const i=t.EpF();t.TgZ(0,"mat-toolbar",0)(1,"span"),t._uU(2,"Explore Aliases"),t.qZA(),t._UZ(3,"span",1),t.YNc(4,Wo,1,0,"mat-spinner",2),t.TgZ(5,"div",3)(6,"mat-form-field",4)(7,"mat-label"),t._uU(8,"Order"),t.qZA(),t.TgZ(9,"mat-select",5),t.NdJ("valueChange",function(m){return e.order=m})("selectionChange",function(){return e.onOrderChange()}),t.TgZ(10,"mat-option",6),t._uU(11,"Most Popular (1 week)"),t.qZA(),t.TgZ(12,"mat-option",7),t._uU(13,"Most Popular (1 month)"),t.qZA(),t.TgZ(14,"mat-option",8),t._uU(15,"Most Popular (6 months)"),t.qZA(),t.TgZ(16,"mat-option",9),t._uU(17,"Most Popular (all time)"),t.qZA(),t.TgZ(18,"mat-option",10),t._uU(19,"Relevance"),t.qZA(),t.TgZ(20,"mat-option",11),t._uU(21,"Newest"),t.qZA(),t.TgZ(22,"mat-option",12),t._uU(23,"Recently Updated"),t.qZA()()(),t.TgZ(24,"mat-form-field",13)(25,"mat-label"),t._uU(26,"Search..."),t.qZA(),t.TgZ(27,"mat-chip-list",null,14),t.YNc(29,zo,4,1,"mat-chip",15),t.TgZ(30,"input",16,17),t.NdJ("keyup",function(){t.CHM(i);const m=t.MAs(31);return e.filterTags(m.value)})("keyup.enter",function(){t.CHM(i);const m=t.MAs(31);return e.onSearch(m.value)}),t.qZA()(),t.YNc(32,Go,3,0,"button",18),t.TgZ(33,"mat-autocomplete",null,19),t.YNc(35,Ko,2,2,"mat-optgroup",20),t.qZA()()()(),t.TgZ(36,"div",21),t.YNc(37,on,3,2,"mat-card",22),t.YNc(38,nn,3,0,"mat-card",23),t.TgZ(39,"div",24),t.YNc(40,ln,1,1,"avr-collection-tile",25),t.qZA(),t.YNc(41,sn,6,3,"div",26),t.qZA()}if(2&o){const i=t.MAs(28),c=t.MAs(34);t.xp6(4),t.Q6J("ngIf",e.loading),t.xp6(5),t.Q6J("value",e.order),t.xp6(20),t.Q6J("ngForOf",e.tags),t.xp6(1),t.Q6J("matAutocomplete",c)("value",e.q)("matChipInputFor",i),t.xp6(2),t.Q6J("ngIf",e.q||(null==e.tags?null:e.tags.length)),t.xp6(3),t.Q6J("ngForOf",e.filteredTags),t.xp6(2),t.Q6J("ngIf",1===e.page||e.error),t.xp6(1),t.Q6J("ngIf",!e.loading&&0===e.collections.length),t.xp6(2),t.Q6J("ngForOf",e.collections),t.xp6(1),t.Q6J("ngIf",(null==e.expectedCollectionIds?null:e.expectedCollectionIds.length)===e.COLLECTIONS_PER_PAGE||e.page>1)}},directives:[nt.Ye,_.O5,g.Ou,r.KE,r.hX,S.gD,q.ey,J.qn,_.sg,J.HS,I.Hw,J.qH,s.Nt,bt.ZL,J.oH,d.lW,r.R9,bt.XC,q.Nv,Ot.a8,V],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.toolbar-search-form[_ngcontent-%COMP%]{font-size:16px;padding-top:8px}.workshop-header[_ngcontent-%COMP%]{margin-bottom:8px}.container[_ngcontent-%COMP%]{margin:8px}.collections-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));grid-gap:1rem}.ignore-theme[_ngcontent-%COMP%]{color:#fff}",".toolbar-search-form-order[_ngcontent-%COMP%]{margin:0 8px}.toolbar-search-form-search[_ngcontent-%COMP%]{width:25vw}.welcome-header[_ngcontent-%COMP%]{margin:8px 0}.paginator[_ngcontent-%COMP%]{background:#182026;border-radius:4px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin:0 auto}.paginator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0 4px}"]});const rn=[{path:"",component:_t,pathMatch:"full"},{path:"my-subscriptions",component:ut},{path:"my-work",component:gt},{path:":id",component:dt},{path:":id/edit",component:ct}];class G{}G.\u0275fac=function(o){return new(o||G)},G.\u0275mod=t.oAB({type:G}),G.\u0275inj=t.cJS({imports:[[T.Bz.forChild(rn)],T.Bz]});class X{}X.\u0275fac=function(o){return new(o||X)},X.\u0275mod=t.oAB({type:X}),X.\u0275inj=t.cJS({imports:[[_.ez,G,xt.q,x.u5,x.UX,E,p.JP,O.nm]]})},2529:function(vt,K,f){var _,x;_=function(){var p,O,l,a,r,xt="2.0.6",t={},E={},T={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},b={currentLocale:T.currentLocale,zeroFormat:T.zeroFormat,nullFormat:T.nullFormat,defaultFormat:T.defaultFormat,scalePercentBy100:T.scalePercentBy100};function L(l,a){this._input=l,this._value=a}return(p=function(l){var a,u,r,s;if(p.isNumeral(l))a=l.value();else if(0===l||void 0===l)a=0;else if(null===l||O.isNaN(l))a=null;else if("string"==typeof l)if(b.zeroFormat&&l===b.zeroFormat)a=0;else if(b.nullFormat&&l===b.nullFormat||!l.replace(/[^0-9]+/g,"").length)a=null;else{for(u in t)if((s="function"==typeof t[u].regexps.unformat?t[u].regexps.unformat():t[u].regexps.unformat)&&l.match(s)){r=t[u].unformat;break}a=(r=r||p._.stringToNumber)(l)}else a=Number(l)||null;return new L(l,a)}).version=xt,p.isNumeral=function(l){return l instanceof L},p._=O={numberToFormat:function(l,a,u){var A,S,w,P,tt,ht,N,r=E[p.options.currentLocale],s=!1,d=!1,g=0,h="",Z=1e12,v=1e9,y=1e6,k=1e3,U="",F=!1;if(l=l||0,S=Math.abs(l),p._.includes(a,"(")?(s=!0,a=a.replace(/[\(|\)]/g,"")):(p._.includes(a,"+")||p._.includes(a,"-"))&&(tt=p._.includes(a,"+")?a.indexOf("+"):l<0?a.indexOf("-"):-1,a=a.replace(/[\+|\-]/g,"")),p._.includes(a,"a")&&(A=!!(A=a.match(/a(k|m|b|t)?/))&&A[1],p._.includes(a," a")&&(h=" "),a=a.replace(new RegExp(h+"a[kmbt]?"),""),S>=Z&&!A||"t"===A?(h+=r.abbreviations.trillion,l/=Z):S<Z&&S>=v&&!A||"b"===A?(h+=r.abbreviations.billion,l/=v):S<v&&S>=y&&!A||"m"===A?(h+=r.abbreviations.million,l/=y):(S<y&&S>=k&&!A||"k"===A)&&(h+=r.abbreviations.thousand,l/=k)),p._.includes(a,"[.]")&&(d=!0,a=a.replace("[.]",".")),w=l.toString().split(".")[0],P=a.split(".")[1],ht=a.indexOf(","),g=(a.split(".")[0].split(",")[0].match(/0/g)||[]).length,P?(p._.includes(P,"[")?(P=(P=P.replace("]","")).split("["),U=p._.toFixed(l,P[0].length+P[1].length,u,P[1].length)):U=p._.toFixed(l,P.length,u),w=U.split(".")[0],U=p._.includes(U,".")?r.delimiters.decimal+U.split(".")[1]:"",d&&0===Number(U.slice(1))&&(U="")):w=p._.toFixed(l,0,u),h&&!A&&Number(w)>=1e3&&h!==r.abbreviations.trillion)switch(w=String(Number(w)/1e3),h){case r.abbreviations.thousand:h=r.abbreviations.million;break;case r.abbreviations.million:h=r.abbreviations.billion;break;case r.abbreviations.billion:h=r.abbreviations.trillion}if(p._.includes(w,"-")&&(w=w.slice(1),F=!0),w.length<g)for(var Q=g-w.length;Q>0;Q--)w="0"+w;return ht>-1&&(w=w.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+r.delimiters.thousands)),0===a.indexOf(".")&&(w=""),N=w+U+(h||""),s?N=(s&&F?"(":"")+N+(s&&F?")":""):tt>=0?N=0===tt?(F?"-":"+")+N:N+(F?"-":"+"):F&&(N="-"+N),N},stringToNumber:function(l){var s,d,h,a=E[b.currentLocale],u=l,r={thousand:3,million:6,billion:9,trillion:12};if(b.zeroFormat&&l===b.zeroFormat)d=0;else if(b.nullFormat&&l===b.nullFormat||!l.replace(/[^0-9]+/g,"").length)d=null;else{for(s in d=1,"."!==a.delimiters.decimal&&(l=l.replace(/\./g,"").replace(a.delimiters.decimal,".")),r)if(h=new RegExp("[^a-zA-Z]"+a.abbreviations[s]+"(?:\\)|(\\"+a.currency.symbol+")?(?:\\))?)?$"),u.match(h)){d*=Math.pow(10,r[s]);break}d*=(l.split("-").length+Math.min(l.split("(").length-1,l.split(")").length-1))%2?1:-1,l=l.replace(/[^0-9\.]+/g,""),d*=Number(l)}return d},isNaN:function(l){return"number"==typeof l&&isNaN(l)},includes:function(l,a){return-1!==l.indexOf(a)},insert:function(l,a,u){return l.slice(0,u)+a+l.slice(u)},reduce:function(l,a){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof a)throw new TypeError(a+" is not a function");var d,u=Object(l),r=u.length>>>0,s=0;if(3===arguments.length)d=arguments[2];else{for(;s<r&&!(s in u);)s++;if(s>=r)throw new TypeError("Reduce of empty array with no initial value");d=u[s++]}for(;s<r;s++)s in u&&(d=a(d,u[s],s,u));return d},multiplier:function(l){var a=l.toString().split(".");return a.length<2?1:Math.pow(10,a[1].length)},correctionFactor:function(){return Array.prototype.slice.call(arguments).reduce(function(a,u){var r=O.multiplier(u);return a>r?a:r},1)},toFixed:function(l,a,u,r){var g,h,Z,v,s=l.toString().split("."),d=a-(r||0);return g=2===s.length?Math.min(Math.max(s[1].length,d),a):d,Z=Math.pow(10,g),v=(u(l+"e+"+g)/Z).toFixed(g),r>a-g&&(h=new RegExp("\\.?0{1,"+(r-(a-g))+"}$"),v=v.replace(h,"")),v}},p.options=b,p.formats=t,p.locales=E,p.locale=function(l){return l&&(b.currentLocale=l.toLowerCase()),b.currentLocale},p.localeData=function(l){if(!l)return E[b.currentLocale];if(l=l.toLowerCase(),!E[l])throw new Error("Unknown locale : "+l);return E[l]},p.reset=function(){for(var l in T)b[l]=T[l]},p.zeroFormat=function(l){b.zeroFormat="string"==typeof l?l:null},p.nullFormat=function(l){b.nullFormat="string"==typeof l?l:null},p.defaultFormat=function(l){b.defaultFormat="string"==typeof l?l:"0.0"},p.register=function(l,a,u){if(a=a.toLowerCase(),this[l+"s"][a])throw new TypeError(a+" "+l+" already registered.");return this[l+"s"][a]=u,u},p.validate=function(l,a){var u,r,s,d,g,h,Z,v;if("string"!=typeof l&&(l+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",l)),(l=l.trim()).match(/^\d+$/))return!0;if(""===l)return!1;try{Z=p.localeData(a)}catch(y){Z=p.localeData(p.locale())}return s=Z.currency.symbol,g=Z.abbreviations,u=Z.delimiters.decimal,r="."===Z.delimiters.thousands?"\\.":Z.delimiters.thousands,!(null!==(v=l.match(/^[^\d]+/))&&(l=l.substr(1),v[0]!==s)||null!==(v=l.match(/[^\d]+$/))&&(l=l.slice(0,-1),v[0]!==g.thousand&&v[0]!==g.million&&v[0]!==g.billion&&v[0]!==g.trillion)||(h=new RegExp(r+"{2}"),l.match(/[^\d.,]/g)||(d=l.split(u)).length>2||(d.length<2?!d[0].match(/^\d+.*\d$/)||d[0].match(h):1===d[0].length?!d[0].match(/^\d+$/)||d[0].match(h)||!d[1].match(/^\d+$/):!d[0].match(/^\d+.*\d$/)||d[0].match(h)||!d[1].match(/^\d+$/))))},p.fn=L.prototype={clone:function(){return p(this)},format:function(l,a){var s,d,g,u=this._value,r=l||b.defaultFormat;if(a=a||Math.round,0===u&&null!==b.zeroFormat)d=b.zeroFormat;else if(null===u&&null!==b.nullFormat)d=b.nullFormat;else{for(s in t)if(r.match(t[s].regexps.format)){g=t[s].format;break}d=(g=g||p._.numberToFormat)(u,r,a)}return d},value:function(){return this._value},input:function(){return this._input},set:function(l){return this._value=Number(l),this},add:function(l){var a=O.correctionFactor.call(null,this._value,l);function u(r,s,d,g){return r+Math.round(a*s)}return this._value=O.reduce([this._value,l],u,0)/a,this},subtract:function(l){var a=O.correctionFactor.call(null,this._value,l);function u(r,s,d,g){return r-Math.round(a*s)}return this._value=O.reduce([l],u,Math.round(this._value*a))/a,this},multiply:function(l){function a(u,r,s,d){var g=O.correctionFactor(u,r);return Math.round(u*g)*Math.round(r*g)/Math.round(g*g)}return this._value=O.reduce([this._value,l],a,1),this},divide:function(l){function a(u,r,s,d){var g=O.correctionFactor(u,r);return Math.round(u*g)/Math.round(r*g)}return this._value=O.reduce([this._value,l],a),this},difference:function(l){return Math.abs(p(this._value).subtract(l).value())}},p.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(l){var a=l%10;return 1==~~(l%100/10)?"th":1===a?"st":2===a?"nd":3===a?"rd":"th"},currency:{symbol:"$"}}),p.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(l,a,u){var s,r=p._.includes(a," BPS")?" ":"";return l*=1e4,a=a.replace(/\s?BPS/,""),s=p._.numberToFormat(l,a,u),p._.includes(s,")")?((s=s.split("")).splice(-1,0,r+"BPS"),s=s.join("")):s=s+r+"BPS",s},unformat:function(l){return+(1e-4*p._.stringToNumber(l)).toFixed(15)}}),a={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},r="("+(r=(l={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}).suffixes.concat(a.suffixes.filter(function(s){return l.suffixes.indexOf(s)<0})).join("|")).replace("B","B(?!PS)")+")",p.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(r)},format:function(s,d,g){var y,k,U,Z=p._.includes(d,"ib")?a:l,v=p._.includes(d," b")||p._.includes(d," ib")?" ":"";for(d=d.replace(/\s?i?b/,""),y=0;y<=Z.suffixes.length;y++)if(k=Math.pow(Z.base,y),U=Math.pow(Z.base,y+1),null===s||0===s||s>=k&&s<U){v+=Z.suffixes[y],k>0&&(s/=k);break}return p._.numberToFormat(s,d,g)+v},unformat:function(s){var g,h,d=p._.stringToNumber(s);if(d){for(g=l.suffixes.length-1;g>=0;g--){if(p._.includes(s,l.suffixes[g])){h=Math.pow(l.base,g);break}if(p._.includes(s,a.suffixes[g])){h=Math.pow(a.base,g);break}}d*=h||1}return d}}),p.register("format","currency",{regexps:{format:/(\$)/},format:function(l,a,u){var d,g,h,r=p.locales[p.options.currentLocale],s={before:a.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:a.match(/([\+|\-|\)|\s|\$]*)$/)[0]};for(a=a.replace(/\s?\$\s?/,""),d=p._.numberToFormat(l,a,u),l>=0?(s.before=s.before.replace(/[\-\(]/,""),s.after=s.after.replace(/[\-\)]/,"")):l<0&&!p._.includes(s.before,"-")&&!p._.includes(s.before,"(")&&(s.before="-"+s.before),h=0;h<s.before.length;h++)switch(g=s.before[h],g){case"$":d=p._.insert(d,r.currency.symbol,h);break;case" ":d=p._.insert(d," ",h+r.currency.symbol.length-1)}for(h=s.after.length-1;h>=0;h--)switch(g=s.after[h],g){case"$":d=h===s.after.length-1?d+r.currency.symbol:p._.insert(d,r.currency.symbol,-(s.after.length-(1+h)));break;case" ":d=h===s.after.length-1?d+" ":p._.insert(d," ",-(s.after.length-(1+h)+r.currency.symbol.length-1))}return d}}),p.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(l,a,u){var d=("number"!=typeof l||p._.isNaN(l)?"0e+0":l.toExponential()).split("e");return a=a.replace(/e[\+|\-]{1}0/,""),p._.numberToFormat(Number(d[0]),a,u)+"e"+d[1]},unformat:function(l){var a=p._.includes(l,"e+")?l.split("e+"):l.split("e-"),u=Number(a[0]),r=Number(a[1]);function s(d,g,h,Z){var v=p._.correctionFactor(d,g);return d*v*(g*v)/(v*v)}return r=p._.includes(l,"e-")?r*=-1:r,p._.reduce([u,Math.pow(10,r)],s,1)}}),p.register("format","ordinal",{regexps:{format:/(o)/},format:function(l,a,u){var r=p.locales[p.options.currentLocale],d=p._.includes(a," o")?" ":"";return a=a.replace(/\s?o/,""),d+=r.ordinal(l),p._.numberToFormat(l,a,u)+d}}),p.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(l,a,u){var s,r=p._.includes(a," %")?" ":"";return p.options.scalePercentBy100&&(l*=100),a=a.replace(/\s?\%/,""),s=p._.numberToFormat(l,a,u),p._.includes(s,")")?((s=s.split("")).splice(-1,0,r+"%"),s=s.join("")):s=s+r+"%",s},unformat:function(l){var a=p._.stringToNumber(l);return p.options.scalePercentBy100?.01*a:a}}),p.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(l,a,u){var r=Math.floor(l/60/60),s=Math.floor((l-60*r*60)/60),d=Math.round(l-60*r*60-60*s);return r+":"+(s<10?"0"+s:s)+":"+(d<10?"0"+d:d)},unformat:function(l){var a=l.split(":"),u=0;return 3===a.length?(u+=60*Number(a[0])*60,u+=60*Number(a[1]),u+=Number(a[2])):2===a.length&&(u+=60*Number(a[0]),u+=Number(a[1])),Number(u)}}),p},void 0!==(x="function"==typeof _?_.call(K,f,K,vt):_)&&(vt.exports=x)}}]);
//# sourceMappingURL=225.880827eff8b9117b.js.map