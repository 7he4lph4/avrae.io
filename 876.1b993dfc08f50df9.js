"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[876],{7876:(Ot,ae,s)=>{s.r(ae),s.d(ae,{HomebrewModule:()=>J});var m=s(6362),ue=s(7224),p=s(587),ie=s(5283),he=s(6774),fe=s(9394),xe=s(1129),ve=s(3134),v=s(9481),e=s(3184),c=s(5758),x=s(4770),Z=s(4683),K=s(6623),g=s(7317);const Ce=function(a,n,t,o){return{name:a,public:n,image:t,desc:o}};class A{constructor(){this.public=!1,this.desc="",this.image=""}ngOnInit(){}}A.\u0275fac=function(n){return new(n||A)},A.\u0275cmp=e.Xpm({type:A,selectors:[["avr-new-pack-dialog"]],decls:19,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],[1,"mat-small"],["mat-button","","mat-dialog-close","","tabindex","1"],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"New Pack..."),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"mat-form-field")(5,"input",3),e.NdJ("ngModelChange",function(i){return t.name=i}),e.qZA()(),e.TgZ(6,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(i){return t.public=i}),e._uU(7,"Allow public to view"),e.qZA(),e.TgZ(8,"mat-form-field")(9,"input",5),e.NdJ("ngModelChange",function(i){return t.image=i}),e.qZA()(),e.TgZ(10,"mat-form-field")(11,"textarea",6),e.NdJ("ngModelChange",function(i){return t.desc=i}),e.qZA()()(),e.TgZ(12,"p",7),e._uU(13," These settings can be changed at any time. "),e.qZA()(),e.TgZ(14,"mat-dialog-actions")(15,"button",8),e._uU(16,"Cancel"),e.qZA(),e.TgZ(17,"button",9),e._uU(18," Create "),e.qZA()()),2&n&&(e.xp6(5),e.Q6J("ngModel",t.name),e.xp6(1),e.Q6J("ngModel",t.public),e.xp6(3),e.Q6J("ngModel",t.image),e.xp6(2),e.Q6J("ngModel",t.desc),e.xp6(6),e.Q6J("mat-dialog-close",e.l5B(6,Ce,t.name,t.public,t.image,t.desc))("disabled",!t.name))},directives:[c.uh,c.xY,x.KE,Z.Nt,p.Fj,p.JJ,p.On,K.Rr,c.H8,g.lW,c.ZT],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}\n/*# sourceMappingURL=new-pack-dialog.component.css.map*/"]});var z=s(4936),M=s(89),T=s(5590);class N{constructor(n){this.data=n,this.generateMD(this.data.data)}ngOnInit(){}generateMD(n){let t="";t+=`${`# ${n.name}`}\n${n.desc||""}\n\n`;for(let l of n.items)t+=`#### ${l.name}\n${l.meta}\n___\n${l.desc}\n\n`;t=t.replace("\n","\n  "),this.mdData=t}copy(n){n.select(),document.execCommand("copy"),n.setSelectionRange(0,0)}}N.\u0275fac=function(n){return new(n||N)(e.Y36(c.WI))},N.\u0275cmp=e.Xpm({type:N,selectors:[["avr-pack-markdown-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","readonly","","placeholder","Markdown","rows","10",3,"value"],["mdElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e._uU(2,"\n"),e.TgZ(3,"mat-dialog-content",1),e._uU(4,"\n  "),e.TgZ(5,"div",2),e._uU(6,"\n    "),e.TgZ(7,"mat-form-field"),e._uU(8,"\n      "),e._UZ(9,"textarea",3,4),e._uU(11,"\n      "),e.TgZ(12,"button",5),e.NdJ("click",function(){e.CHM(o);const l=e.MAs(10);return t.copy(l)}),e._uU(13,"\n        "),e.TgZ(14,"mat-icon"),e._uU(15,"file_copy"),e.qZA(),e._uU(16,"\n      "),e.qZA(),e._uU(17,"\n    "),e.qZA(),e._uU(18,"\n  "),e.qZA(),e._uU(19,"\n"),e.qZA(),e._uU(20,"\n"),e.TgZ(21,"mat-dialog-actions"),e._uU(22,"\n  "),e.TgZ(23,"button",6),e._uU(24,"Done"),e.qZA(),e._uU(25,"\n"),e.qZA(),e._uU(26,"\n")}2&n&&(e.xp6(1),e.hij("Markdown - ",t.data.name,""),e.xp6(8),e.Q6J("value",t.mdData))},directives:[c.uh,c.xY,x.KE,Z.Nt,g.lW,x.R9,M.gM,T.Hw,c.H8,c.ZT],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}\n/*# sourceMappingURL=pack-markdown-dialog.component.css.map*/"]});var f=s(7418),le=s(4766),r=s(6488),Te=s(8784);const k=`${le.N.apiURL}/homebrew/items`,w=`${le.N.apiURL}/homebrew/spells`;class C{constructor(n){this.http=n}getUserPacks(){return this.http.get(`${k}/me`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}newPack(n){return this.http.post(`${k}`,n,(0,r.vC)()).pipe((0,f.K)(r.Vm))}getPack(n){return this.http.get(`${k}/${n}`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}putPack(n){return this.http.put(`${k}/${n._id}`,n,(0,r.vC)()).pipe((0,f.K)(r.Vm))}deletePack(n){return this.http.delete(`${k}/${n._id}`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}updatePackSharing(n,t){return this.http.patch(`${k}/${n}/sharing`,{public:t},(0,r.vC)()).pipe((0,f.K)(r.Vm))}getPackEditors(n){return this.http.get(`${k}/${n}/editors`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}getTemplateItems(){return this.http.get(`${k}/srd`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}getUserTomes(){return this.http.get(`${w}/me`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}newTome(n){return this.http.post(`${w}`,n,(0,r.vC)()).pipe((0,f.K)(r.Vm))}getTome(n){return this.http.get(`${w}/${n}`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}putTome(n){return this.http.put(`${w}/${n._id}`,n,(0,r.vC)()).pipe((0,f.K)(r.Vm))}deleteTome(n){return this.http.delete(`${w}/${n._id}`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}updateTomeSharing(n,t){return this.http.patch(`${w}/${n}/sharing`,{public:t},(0,r.vC)()).pipe((0,f.K)(r.Vm))}getTomeEditors(n){return this.http.get(`${w}/${n}/editors`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}getTemplateSpells(){return this.http.get(`${w}/srd`,(0,r.vC)()).pipe((0,f.K)(r.Vm))}validateSpellJSON(n){return this.http.post(`${w}/validate`,n,(0,r.vC)()).pipe((0,f.K)(r.Vm))}}C.\u0275fac=function(n){return new(n||C)(e.LFG(Te.eN))},C.\u0275prov=e.Yz7({token:C,factory:C.\u0275fac,providedIn:"root"});var W=s(7004),u=s(6531),V=s(6131),X=s(4742);function be(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field"),e._UZ(1,"input",9,10),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(2);return e.oxw().copy(i)}),e.TgZ(4,"mat-icon"),e._uU(5,"file_copy"),e.qZA()()()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("value",t.shareLink)}}function Ze(a,n){if(1&a&&(e.TgZ(0,"mat-list-item"),e._uU(1),e.ALo(2,"async"),e.qZA()),2&a){const t=n.$implicit;let o;e.xp6(1),e.Oqu(null==(o=e.lcZ(2,1,t))?null:o.username)}}function we(a,n){if(1&a&&(e.TgZ(0,"mat-list"),e.YNc(1,Ze,3,3,"mat-list-item",12),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.editors)}}function Me(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginJSONExport()}),e._uU(2,"Export to JSON "),e.qZA(),e.TgZ(3,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginMDExport()}),e._uU(4,"Export to Homebrewery "),e.qZA()()}}function ke(a,n){1&a&&(e.TgZ(0,"div"),e._UZ(1,"mat-spinner",15),e.qZA()),2&a&&(e.xp6(1),e.Q6J("diameter",24))}const Se=function(a){return{public:a}};class S{constructor(n,t,o,i){this.data=n,this.dialog=t,this.hbService=o,this.discord=i,this.public=n.public,this.shareLink=`https://avrae.io/homebrew/items/${n._id}`,this.loaded=void 0!==n.items}ngOnInit(){this.owner=this.discord.getUser(this.data.owner),this.loadEditors(),this.loaded||this.loadItems()}loadItems(){const n=this.data._id;this.hbService.getPack(n).subscribe(t=>{!t.success||(this.data=t.data,this.loaded=!0)})}loadEditors(){const n=this.data._id;this.hbService.getPackEditors(n).subscribe(t=>{if(!t.success)return;const o=[];t.data.forEach(i=>o.push(this.discord.getUser(i))),this.editors=o})}copy(n){n.select(),document.execCommand("copy"),n.setSelectionRange(0,0)}beginJSONExport(){this.dialog.open(z.m,{data:{name:this.data.name,data:this.data.items},width:"60%"})}beginMDExport(){this.dialog.open(N,{data:{name:this.data.name,data:this.data},width:"60%"})}}S.\u0275fac=function(n){return new(n||S)(e.Y36(c.WI),e.Y36(c.uw),e.Y36(C),e.Y36(W.h))},S.\u0275cmp=e.Xpm({type:S,selectors:[["avr-pack-share-dialog"]],decls:31,vars:12,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],[3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"mat-elevation-z0"],["class","button-row",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["matInput","","readonly","","placeholder","View Link",3,"value"],["shareLinkElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],[4,"ngFor","ngForOf"],[1,"button-row"],["mat-raised-button","","color","primary",3,"click"],[3,"diameter"]],template:function(n,t){if(1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"p"),e._uU(5),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"mat-slide-toggle",3),e.NdJ("ngModelChange",function(i){return t.public=i}),e._uU(8,"Allow public to view"),e.qZA(),e.YNc(9,be,6,1,"mat-form-field",4),e.TgZ(10,"mat-expansion-panel",5)(11,"mat-expansion-panel-header")(12,"mat-panel-title"),e._uU(13," Editors "),e.qZA()(),e.TgZ(14,"p"),e._uU(15,"To add or remove an editor, run the command "),e.TgZ(16,"kbd"),e._uU(17,"!pack editor @user"),e.qZA(),e._uU(18," in Discord!"),e.qZA(),e.YNc(19,we,2,1,"mat-list",4),e.qZA(),e.TgZ(20,"mat-expansion-panel",5)(21,"mat-expansion-panel-header")(22,"mat-panel-title"),e._uU(23," Export "),e.qZA()(),e.YNc(24,Me,5,0,"div",6),e.YNc(25,ke,2,1,"div",4),e.qZA()()(),e.TgZ(26,"mat-dialog-actions")(27,"button",7),e._uU(28,"Cancel"),e.qZA(),e.TgZ(29,"button",8),e._uU(30," Done "),e.qZA()()),2&n){let o;e.xp6(1),e.hij("Share ",t.data.name,""),e.xp6(4),e.hij(" Owner: ",null==(o=e.lcZ(6,8,t.owner))?null:o.username," "),e.xp6(2),e.Q6J("ngModel",t.public),e.xp6(2),e.Q6J("ngIf",t.public),e.xp6(10),e.Q6J("ngIf",null==t.editors?null:t.editors.length),e.xp6(5),e.Q6J("ngIf",t.loaded),e.xp6(1),e.Q6J("ngIf",!t.loaded),e.xp6(4),e.Q6J("mat-dialog-close",e.VKq(10,Se,t.public))}},directives:[c.uh,c.xY,K.Rr,p.JJ,p.On,m.O5,x.KE,Z.Nt,g.lW,x.R9,M.gM,T.Hw,u.ib,u.yz,u.yK,V.i$,m.sg,V.Tg,X.Ou,c.H8,c.ZT],pipes:[m.Ov],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.button-row[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:4px}\n/*# sourceMappingURL=pack-share-dialog.component.css.map*/"]});var G=s(2528),ee=s(9946),_=s(5434),h=s(1961);function De(a,n){if(1&a&&(e.TgZ(0,"mat-card-content")(1,"p"),e._uU(2),e.qZA()()),2&a){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.desc," ")}}function Ue(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",8)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),e._uU(4),e.qZA(),e.TgZ(5,"mat-card-subtitle"),e._uU(6),e.qZA()(),e._UZ(7,"img",9),e.YNc(8,De,3,1,"mat-card-content",10),e.TgZ(9,"mat-card-actions")(10,"a",11),e._uU(11,"EDIT"),e.qZA(),e.TgZ(12,"button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).beginShare(l)}),e._uU(13,"SHARE"),e.qZA()()()()}if(2&a){const t=n.$implicit,o=e.oxw(2);let i;e.xp6(4),e.Oqu(t.name),e.xp6(2),e.AsE("By ",(null==(i=o.owners.get(t.owner))?null:i.username)||"loading..."," - ",t.numItems," items "),e.xp6(1),e.Q6J("src",t.image||"../../../../assets/img/pack.png",e.LSH),e.xp6(1),e.Q6J("ngIf",t.desc),e.xp6(2),e.s9C("routerLink",t._id)}}function Je(a,n){if(1&a&&(e.TgZ(0,"div",6),e.YNc(1,Ue,14,6,"div",7),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.packs)}}function Ae(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"mat-card")(2,"p"),e._uU(3,"Looks like you don't have any packs yet."),e.qZA(),e.TgZ(4,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginNew()}),e._uU(5,"Create One"),e.qZA()()()}}class I{constructor(n,t,o,i,l,d){this.homebrewService=n,this.discord=t,this.dialog=o,this.router=i,this.route=l,this.snackBar=d,this.owners=new Map}ngOnInit(){this.getPacks()}getPacks(){this.homebrewService.getUserPacks().subscribe(n=>{if(!n.success)return;this.packs=n.data;const t=new Set;for(const o of n.data)t.has(o.owner)||(t.add(o.owner),this.discord.getUser(o.owner).subscribe(i=>this.owners.set(o.owner,i)))})}beginNew(){this.dialog.open(A,{width:"60%",disableClose:!0}).afterClosed().subscribe(t=>{if(t){let o={name:t.name,public:t.public,desc:t.desc,image:t.image};this.new(o)}})}beginShare(n){this.dialog.open(S,{data:n,width:"40%",disableClose:!0}).afterClosed().subscribe(o=>{o&&(console.log(o),n=Object.assign(n,o),this.commit(n))})}new(n){this.homebrewService.newPack(n).subscribe(t=>{t.success&&this.router.navigate([t.data.packId],{relativeTo:this.route})})}commit(n){this.homebrewService.updatePackSharing(n._id,n.public).subscribe(t=>{t.success?this.snackBar.open("Pack sharing options updated.",null,{horizontalPosition:"right"}):this.snackBar.open(`Error: ${t.error}`,"Close",{horizontalPosition:"right",duration:-1,panelClass:"preserve-whitespace"})})}}I.\u0275fac=function(n){return new(n||I)(e.Y36(C),e.Y36(W.h),e.Y36(c.uw),e.Y36(v.F0),e.Y36(v.gz),e.Y36(G.ux))},I.\u0275cmp=e.Xpm({type:I,selectors:[["avr-items"]],decls:10,vars:2,consts:[["color","primary",1,"mat-elevation-z2"],[1,"toolbar-spacer"],["mat-icon-button","",3,"click"],["aria-label","New Pack"],["class","container","fxLayout","row wrap","fxLayoutAlign","space-around",4,"ngIf"],["class","container",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","space-around",1,"container"],["class","pack-tile","fxFlex","32%",4,"ngFor","ngForOf"],["fxFlex","32%",1,"pack-tile"],["mat-card-image","","alt","Pack Image",3,"src"],[4,"ngIf"],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],[1,"container"],["mat-raised-button","","color","accent",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-toolbar",0)(1,"span"),e._uU(2,"Your Packs"),e.qZA(),e._UZ(3,"span",1),e.TgZ(4,"span")(5,"button",2),e.NdJ("click",function(){return t.beginNew()}),e.TgZ(6,"mat-icon",3),e._uU(7,"add"),e.qZA()()()(),e.YNc(8,Je,2,1,"div",4),e.YNc(9,Ae,6,0,"div",5)),2&n&&(e.xp6(8),e.Q6J("ngIf",t.packs&&t.packs.length),e.xp6(1),e.Q6J("ngIf",t.packs&&!t.packs.length))},directives:[ee.Ye,g.lW,T.Hw,m.O5,_.xw,_.Wh,m.sg,_.yH,h.a8,h.dk,h.n5,h.$j,h.G2,h.dn,h.hq,g.zs,v.yS],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%], .pack-tile[_ngcontent-%COMP%]{margin:4px}\n/*# sourceMappingURL=items.component.css.map*/"]});var te=s(8595),ce=s(6942);const Ne=["name"];class Ie{constructor(){this.name="New Item",this.meta="",this.desc=""}}var se=s(3538),re=s(1734),ne=s(9163);class y{constructor(n){this.data=n}ngOnInit(){}}function ye(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginDelete()}),e._uU(1,"Delete"),e.qZA()}}y.\u0275fac=function(n){return new(n||y)(e.Y36(c.WI))},y.\u0275cmp=e.Xpm({type:y,selectors:[["avr-pack-delete-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["mat-button","","mat-dialog-close",""],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"p"),e._uU(4),e.TgZ(5,"b"),e._uU(6,"This cannot be undone."),e.qZA()()(),e.TgZ(7,"mat-dialog-actions")(8,"button",2),e._uU(9,"Cancel"),e.qZA(),e.TgZ(10,"button",3),e._uU(11," Delete "),e.qZA()()),2&n&&(e.xp6(1),e.hij("Deleting ",t.data.name,"..."),e.xp6(3),e.hij(" Are you sure you want to delete ",t.data.name,"? This will remove the pack from all editors' libraries, and invalidate any sharing links. "),e.xp6(6),e.Q6J("mat-dialog-close",!0))},directives:[c.uh,c.xY,c.H8,g.lW,c.ZT],styles:[""]});const Oe=function(a,n,t){return{name:a,image:n,desc:t}};class O{constructor(n,t,o){this.data=n,this.dialog=t,this.dialogRef=o,this.name=n.name,this.image=n.image,this.desc=n.desc,this.isOwner=(0,r.PR)().id===n.owner}ngOnInit(){}beginDelete(){this.dialog.open(y,{data:this.data,width:"40%"}).afterClosed().subscribe(t=>{t&&this.dialogRef.close({delete:!0})})}}O.\u0275fac=function(n){return new(n||O)(e.Y36(c.WI),e.Y36(c.uw),e.Y36(c.so))},O.\u0275cmp=e.Xpm({type:O,selectors:[["avr-pack-options-dialog"]],decls:16,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"mat-form-field")(5,"input",3),e.NdJ("ngModelChange",function(i){return t.name=i}),e.qZA()(),e.TgZ(6,"mat-form-field")(7,"input",4),e.NdJ("ngModelChange",function(i){return t.image=i}),e.qZA()(),e.TgZ(8,"mat-form-field")(9,"textarea",5),e.NdJ("ngModelChange",function(i){return t.desc=i}),e.qZA()()()(),e.TgZ(10,"mat-dialog-actions")(11,"button",6),e._uU(12,"Cancel"),e.qZA(),e.TgZ(13,"button",7),e._uU(14," Save "),e.qZA(),e.YNc(15,ye,2,0,"button",8),e.qZA()),2&n&&(e.xp6(1),e.Oqu(t.data.name),e.xp6(4),e.Q6J("ngModel",t.name),e.xp6(2),e.Q6J("ngModel",t.image),e.xp6(2),e.Q6J("ngModel",t.desc),e.xp6(4),e.Q6J("mat-dialog-close",e.kEZ(7,Oe,t.name,t.image,t.desc))("disabled",!t.name),e.xp6(2),e.Q6J("ngIf",t.isOwner))},directives:[c.uh,c.xY,x.KE,Z.Nt,p.Fj,p.JJ,p.On,c.H8,g.lW,c.ZT,m.O5],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}\n/*# sourceMappingURL=pack-options-dialog.component.css.map*/"]});var me=s(4453);function qe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",5)(1,"input",16),e.NdJ("change",function(){return e.CHM(t),e.oxw(2).emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw(2).item.image=i}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.item.image)}}function Pe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"span",5)(1,"button",17),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return i.item.image="",i.emitChange()}),e.TgZ(2,"mat-icon",18),e._uU(3,"add_photo_alternate"),e.qZA()()()}}function He(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"span",5)(1,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).moveUp.emit()}),e.TgZ(2,"mat-icon",20),e._uU(3,"arrow_upward"),e.qZA()()()}}function Fe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"span",5)(1,"button",21),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).moveDown.emit()}),e.TgZ(2,"mat-icon",22),e._uU(3,"arrow_downward"),e.qZA()()()}}function Ee(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"mat-form-field",5)(3,"input",6),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().item.name=i}),e.qZA()(),e.YNc(4,qe,2,1,"mat-form-field",7),e.qZA(),e.TgZ(5,"mat-form-field")(6,"textarea",8),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().item.meta=i}),e.qZA()(),e.TgZ(7,"mat-form-field")(8,"textarea",9),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().item.desc=i}),e.qZA()()(),e.TgZ(9,"div",10),e.YNc(10,Pe,4,0,"span",7),e.TgZ(11,"span",5)(12,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginJSONExport()}),e.TgZ(13,"mat-icon",12),e._uU(14,"vertical_align_top"),e.qZA()()(),e.YNc(15,He,4,0,"span",7),e.YNc(16,Fe,4,0,"span",7),e._UZ(17,"span",13),e.TgZ(18,"span",5)(19,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().delete.emit()}),e.TgZ(20,"mat-icon",15),e._uU(21,"delete"),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.item.name),e.xp6(1),e.Q6J("ngIf",null!=t.item.image),e.xp6(2),e.Q6J("ngModel",t.item.meta),e.xp6(2),e.Q6J("ngModel",t.item.desc),e.xp6(2),e.Q6J("ngIf",void 0===t.item.image),e.xp6(5),e.Q6J("ngIf",!t.isFirst),e.xp6(1),e.Q6J("ngIf",!t.isLast)}}class q{constructor(n){this.dialog=n,this.moveUp=new e.vpe,this.moveDown=new e.vpe,this.changed=new e.vpe,this.opened=new e.vpe,this.delete=new e.vpe}ngOnInit(){}emitChange(){this.changed.emit()}beginJSONExport(){this.dialog.open(z.m,{data:{name:this.item.name,data:this.item},width:"60%"})}}q.\u0275fac=function(n){return new(n||q)(e.Y36(c.uw))},q.\u0275cmp=e.Xpm({type:q,selectors:[["avr-item-detail"]],inputs:{item:"item",isFirst:"isFirst",isLast:"isLast"},outputs:{moveUp:"moveUp",moveDown:"moveDown",changed:"changed",opened:"opened",delete:"delete"},decls:7,vars:2,consts:[[3,"opened"],["markdown","",3,"data"],["matExpansionPanelContent",""],[1,"form-container"],["fxLayout","row","fxLayoutGap","4px"],["fxFlex",""],["matInput","","placeholder","Name",3,"ngModel","change","ngModelChange"],["fxFlex","",4,"ngIf"],["matInput","","placeholder","Meta","rows","3",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Description","rows","7",3,"ngModel","change","ngModelChange"],["fxLayout","row",1,"actions"],["mat-icon-button","","matTooltip","Export to JSON",3,"click"],["aria-label","Export to JSON"],["fxFlex","grow"],["mat-icon-button","","color","warn",3,"click"],["aria-label","Delete"],["matInput","","placeholder","Image URL",3,"ngModel","change","ngModelChange"],["mat-icon-button","","matTooltip","Add image",3,"click"],["aria-label","Add image"],["mat-icon-button","","matTooltip","Move Up",3,"click"],["aria-label","Move Up"],["mat-icon-button","","matTooltip","Move Down",3,"click"],["aria-label","Move Down"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-expansion-panel",0),e.NdJ("opened",function(){return t.opened.emit()}),e.TgZ(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div"),e._uU(4),e.qZA()(),e._UZ(5,"mat-panel-description",1),e.qZA(),e.YNc(6,Ee,22,7,"ng-template",2),e.qZA()),2&n&&(e.xp6(4),e.hij(" ",t.item.name," "),e.xp6(1),e.Q6J("data",t.item.meta.split("\n")[0]))},directives:[u.ib,u.yz,u.yK,u.u4,ie.lF,u.HS,_.xw,_.SQ,x.KE,_.yH,Z.Nt,p.Fj,p.JJ,p.On,m.O5,g.lW,M.gM,T.Hw],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}mat-panel-title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:auto 0}\n/*# sourceMappingURL=item-detail.component.css.map*/"]});var pe=s(3338),Qe=s(5259);function Ye(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"avr-item-detail",22),e.NdJ("moveUp",function(){const l=e.CHM(t).$implicit;return e.oxw(3).moveUp(l)})("moveDown",function(){const l=e.CHM(t).$implicit;return e.oxw(3).moveDown(l)})("changed",function(){return e.CHM(t),e.oxw(3).ensureChangesNotif()})("opened",function(){const l=e.CHM(t).$implicit;return e.oxw(3).selectedItem=l})("delete",function(){const l=e.CHM(t).$implicit;return e.oxw(3).deleteItem(l)}),e.qZA()}if(2&a){const t=n.$implicit,o=n.first,i=n.last;e.Q6J("item",t)("isFirst",o)("isLast",i)}}function Le(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"mat-accordion"),e.YNc(2,Ye,1,3,"avr-item-detail",14),e.TgZ(3,"mat-card",15)(4,"span",16),e._uU(5,"New..."),e.qZA(),e._UZ(6,"span",4),e.TgZ(7,"span")(8,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).beginNewFromJSON()}),e.TgZ(9,"mat-icon",18),e._uU(10,"vertical_align_bottom"),e.qZA()(),e.TgZ(11,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).beginNewFromSRD()}),e.TgZ(12,"mat-icon",20),e._uU(13,"scanner"),e.qZA()(),e.TgZ(14,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).newLooseItem()}),e.TgZ(15,"mat-icon",21),e._uU(16,"add"),e.qZA()()()()()()}if(2&a){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",t.pack.items)}}function $e(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"mat-card")(2,"p"),e._uU(3,"Looks like this pack is empty."),e.qZA(),e.TgZ(4,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).newLooseItem()}),e._uU(5,"Make an Item"),e.qZA(),e.TgZ(6,"button",17),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).beginNewFromJSON()}),e.TgZ(7,"mat-icon",18),e._uU(8,"vertical_align_bottom"),e.qZA()(),e.TgZ(9,"button",19),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).beginNewFromSRD()}),e.TgZ(10,"mat-icon",20),e._uU(11,"scanner"),e.qZA()()()()}}const _e=function(a,n){return{name:a,icon_url:n}},Re=function(a){return{name:"Description",value:a}},je=function(a){return[a]},de=function(){return{text:"Homebrew content.",icon_url:"../../../../assets/img/homebrew.png"}};function Be(a,n){if(1&a&&e._UZ(0,"avr-discord-embed",24),2&a){const t=e.oxw(2);e.Q6J("author",e.WLB(6,_e,t.user.username,t.user.avatarUrl))("title",t.selectedItem.name)("description",t.selectedItem.meta)("fields",e.VKq(11,je,e.VKq(9,Re,t.selectedItem.desc)))("thumbnail",t.selectedItem.image)("footer",e.DdM(13,de))}}function Ke(a,n){if(1&a&&e._UZ(0,"avr-discord-embed",25),2&a){const t=e.oxw(2);e.Q6J("author",e.WLB(2,_e,t.user.username,t.user.avatarUrl))("footer",e.DdM(5,de))}}function ze(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div")(1,"mat-toolbar",1)(2,"span")(3,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().back()}),e.TgZ(4,"mat-icon",3),e._uU(5,"arrow_back"),e.qZA()()(),e.TgZ(6,"span"),e._uU(7),e.qZA(),e._UZ(8,"span",4),e.TgZ(9,"span")(10,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().commit()}),e.TgZ(11,"mat-icon",5),e._uU(12,"save"),e.qZA()(),e.TgZ(13,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginSettings()}),e.TgZ(14,"mat-icon",6),e._uU(15,"settings"),e.qZA()(),e.TgZ(16,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginShare()}),e.TgZ(17,"mat-icon",7),e._uU(18,"launch"),e.qZA()()()(),e.TgZ(19,"div",8),e.YNc(20,Le,17,1,"div",9),e.YNc(21,$e,12,0,"div",9),e.TgZ(22,"div",10),e.YNc(23,Be,1,14,"avr-discord-embed",11),e.YNc(24,Ke,1,6,"avr-discord-embed",12),e.qZA()()()}if(2&a){const t=e.oxw();e.xp6(7),e.hij(" ",t.pack.name," "),e.xp6(13),e.Q6J("ngIf",t.pack.items.length),e.xp6(1),e.Q6J("ngIf",!t.pack.items.length),e.xp6(2),e.Q6J("ngIf",t.selectedItem),e.xp6(1),e.Q6J("ngIf",!t.selectedItem)}}function We(a,n){if(1&a&&(e.TgZ(0,"p",29),e._uU(1),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.error," ")}}function Ve(a,n){if(1&a&&(e.TgZ(0,"div")(1,"div",26)(2,"mat-card"),e._UZ(3,"mat-spinner",27),e.YNc(4,We,2,1,"p",28),e.qZA()()()),2&a){const t=e.oxw();e.xp6(3),e.Q6J("diameter",24),e.xp6(1),e.Q6J("ngIf",t.error)}}function Xe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div")(1,"div",26)(2,"mat-card")(3,"p"),e._uU(4,"You do not have permission to edit this pack."),e.qZA(),e.TgZ(5,"button",23),e.NdJ("click",function(){return e.CHM(t),e.oxw().back()}),e._uU(6,"Go Back"),e.qZA()()()()}}class P{constructor(n,t,o,i,l,d,oe){this.route=n,this.homebrewService=t,this.dashboardService=o,this.location=i,this.dialog=l,this.router=d,this.snackBar=oe,this.user=(0,r.PR)(),this.changesOpen=!1}ngOnInit(){this.getPack()}ngOnDestroy(){this.snackBar.dismiss()}getPack(){const n=this.route.snapshot.paramMap.get("pack");this.homebrewService.getPack(n).subscribe(t=>{t.success?(this.pack=t.data,this.calcCanEdit()):this.error=t.error})}calcCanEdit(){if(this.pack&&this.user)if(this.isOwner=this.user.id===this.pack.owner,this.isOwner)this.canEdit=!0;else{const n=this.pack._id;this.homebrewService.getPackEditors(n).subscribe(t=>{t.success?this.canEdit=t.data.some(o=>o===this.user.id):this.error=t.error})}}newLooseItem(){this.pack.items.push(new Ie),this.ensureChangesNotif()}deleteItem(n){this.pack.items=this.pack.items.filter(t=>t!==n),this.ensureChangesNotif()}ensureChangesNotif(){this.changesOpen||(this.changesOpen=!0,this.snackBar.open("You have unsaved changes!","Save",{duration:-1,horizontalPosition:"right"}).onAction().subscribe(()=>{this.commit()}))}beginShare(){this.dialog.open(S,{data:this.pack,width:"40%",disableClose:!0}).afterClosed().subscribe(t=>{t&&(console.log(t),this.pack=Object.assign(this.pack,t),this.commit())})}beginSettings(){this.dialog.open(O,{data:this.pack,width:"40%",disableClose:!0}).afterClosed().subscribe(t=>{t&&(console.log(t),t.delete?this.delete():(this.pack=Object.assign(this.pack,t),this.commit()))})}beginNewFromJSON(){const n=this.dialog.open(se.Q,{width:"60%",disableClose:!0,data:{validator:t=>this.validatePackJSON(n,t)}});n.afterClosed().subscribe(t=>{if(t){const o=t;console.log(o),o instanceof Array?this.pack.items.push(...o):this.pack.items.push(o),this.ensureChangesNotif()}})}beginNewFromSRD(){this.dialog.open(re.b,{width:"60%",disableClose:!0,data:{getter:()=>this.homebrewService.getTemplateItems().pipe((0,ce.U)(t=>t.data)),namer:t=>t.name}}).afterClosed().subscribe(t=>{t&&(this.pack.items.push(t),this.ensureChangesNotif())})}packIsValid(n){return n instanceof Array?Boolean(n.length)&&n.every(t=>this.objectIsItem(t)):!!n&&this.objectIsItem(n)}validatePackJSON(n,t){n.componentInstance.loading=!1,this.packIsValid(t)?n.close(JSON.parse(n.componentInstance.data)):n.componentInstance.error="Invalid pack data"}objectIsItem(n){return Ne.every(t=>t in n)}commit(){this.homebrewService.putPack(this.pack).subscribe(n=>{this.changesOpen=!1,n.success?this.snackBar.open(`${n.data} Use "!pack ${this.pack.name}" to activate the pack in Discord!`,null,{horizontalPosition:"right"}):this.snackBar.openFromComponent(ne.U,{data:{html:`${n.error}`},horizontalPosition:"right",duration:-1})})}delete(){this.homebrewService.deletePack(this.pack).subscribe(n=>{n.success?this.router.navigate(["../"],{relativeTo:this.route}):this.snackBar.openFromComponent(ne.U,{data:{html:`${n.error}`},horizontalPosition:"right",duration:-1})})}back(){this.location.back()}moveUp(n){const t=this.pack.items.indexOf(n),o=t-1;o>-1&&((0,te.bA)(this.pack.items,t,o),this.ensureChangesNotif())}moveDown(n){const t=this.pack.items.indexOf(n),o=t+1;o<this.pack.items.length&&((0,te.bA)(this.pack.items,t,o),this.ensureChangesNotif())}}P.\u0275fac=function(n){return new(n||P)(e.Y36(v.gz),e.Y36(C),e.Y36(me.s),e.Y36(m.Ye),e.Y36(c.uw),e.Y36(v.F0),e.Y36(G.ux))},P.\u0275cmp=e.Xpm({type:P,selectors:[["avr-pack-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["color","primary",1,"pack-toolbar"],["mat-icon-button","",3,"click"],["aria-label","Back"],[1,"toolbar-spacer"],["aria-label","Save"],["aria-label","Settings"],["aria-label","Share"],["fxLayout","row","fxLayoutGap","8px",1,"container"],["class","item-list","fxFlex","grow",4,"ngIf"],["fxFlex","grow","fxHide","","fxShow.gt-xs","true",1,"item-preview","mat-typography","mat-elevation-z3"],[3,"author","title","description","fields","thumbnail","footer",4,"ngIf"],["title","No item selected.","description","Click on an item on the left to see a preview!",3,"author","footer",4,"ngIf"],["fxFlex","grow",1,"item-list"],[3,"item","isFirst","isLast","moveUp","moveDown","changed","opened","delete",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"new-item-card"],[1,"no-text-cursor"],["mat-icon-button","","matTooltip","Import from JSON",3,"click"],["aria-label","Import from JSON"],["mat-icon-button","","matTooltip","Copy SRD item",3,"click"],["aria-label","From existing item"],["aria-label","New"],[3,"item","isFirst","isLast","moveUp","moveDown","changed","opened","delete"],["mat-raised-button","","color","accent",3,"click"],[3,"author","title","description","fields","thumbnail","footer"],["title","No item selected.","description","Click on an item on the left to see a preview!",3,"author","footer"],[1,"container"],[3,"diameter"],["class","mat-error",4,"ngIf"],[1,"mat-error"]],template:function(n,t){1&n&&(e.YNc(0,ze,25,5,"div",0),e.YNc(1,Ve,5,2,"div",0),e.YNc(2,Xe,7,0,"div",0)),2&n&&(e.Q6J("ngIf",t.pack&&null!=t.canEdit),e.xp6(1),e.Q6J("ngIf",!t.pack),e.xp6(1),e.Q6J("ngIf",t.pack&&!t.canEdit))},directives:[m.O5,ee.Ye,g.lW,T.Hw,_.xw,_.SQ,_.yH,u.pp,m.sg,q,h.a8,_.Wh,M.gM,pe.b8,Qe.G,X.Ou],styles:[".pack-toolbar[_ngcontent-%COMP%]{height:64px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.item-list[_ngcontent-%COMP%], .item-preview[_ngcontent-%COMP%]{max-height:calc(100vh - 192px);overflow-y:auto}.container[_ngcontent-%COMP%]{margin:8px}.new-item-card[_ngcontent-%COMP%]{height:48px;padding:0 24px;margin-top:8px}.no-text-cursor[_ngcontent-%COMP%]{cursor:default}"]});const Ge=function(a,n,t,o){return{name:a,public:n,image:t,desc:o}};class H{constructor(){this.public=!1,this.desc="",this.image=""}ngOnInit(){}}H.\u0275fac=function(n){return new(n||H)},H.\u0275cmp=e.Xpm({type:H,selectors:[["avr-new-pack-dialog"]],decls:19,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],[1,"mat-small"],["mat-button","","mat-dialog-close","","tabindex","1"],["mat-button","",3,"mat-dialog-close","disabled"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1,"New Tome..."),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"mat-form-field")(5,"input",3),e.NdJ("ngModelChange",function(i){return t.name=i}),e.qZA()(),e.TgZ(6,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(i){return t.public=i}),e._uU(7,"Allow public to view"),e.qZA(),e.TgZ(8,"mat-form-field")(9,"input",5),e.NdJ("ngModelChange",function(i){return t.image=i}),e.qZA()(),e.TgZ(10,"mat-form-field")(11,"textarea",6),e.NdJ("ngModelChange",function(i){return t.desc=i}),e.qZA()()(),e.TgZ(12,"p",7),e._uU(13," These settings can be changed at any time. "),e.qZA()(),e.TgZ(14,"mat-dialog-actions")(15,"button",8),e._uU(16,"Cancel"),e.qZA(),e.TgZ(17,"button",9),e._uU(18," Create "),e.qZA()()),2&n&&(e.xp6(5),e.Q6J("ngModel",t.name),e.xp6(1),e.Q6J("ngModel",t.public),e.xp6(3),e.Q6J("ngModel",t.image),e.xp6(2),e.Q6J("ngModel",t.desc),e.xp6(6),e.Q6J("mat-dialog-close",e.l5B(6,Ge,t.name,t.public,t.image,t.desc))("disabled",!t.name))},directives:[c.uh,c.xY,x.KE,Z.Nt,p.Fj,p.JJ,p.On,K.Rr,c.H8,g.lW,c.ZT],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}\n/*# sourceMappingURL=new-tome-dialog.component.css.map*/"]});var b=s(8879);class F{constructor(n){this.data=n,this.generateMD(this.data.data)}ngOnInit(){}generateMD(n){let t="";t+=`${`# ${n.name}`}\n${n.desc||""}\n\n`;for(const l of n.spells)t+=this.generateSpellMD(l);t=t.replace("\n","\n  "),this.mdData=t}generateSpellMD(n){const t=`#### ${n.name}`,o=n.level?`${(0,b.jM)(n.level)} ${(0,b.mN)(n.school)}`:`${(0,b.mN)(n.school)} ${(0,b.jM)(n.level)}`,i=`- **Casting Time:** ${n.casttime+(n.ritual?" (ritual)":"")}\n- **Range:** ${n.range}\n- **Components:** ${(0,b.tQ)(n)}\n- **Duration:** ${(n.concentration?"Concentration, up to ":"")+n.duration}`;let l=n.description;return n.higherlevels&&(l=`${l}\n\n**At Higher Levels:** ${n.higherlevels}`),`${t}\n*${o}*\n___\n${i}\n\n${l}\n\n`}copy(n){n.select(),document.execCommand("copy"),n.setSelectionRange(0,0)}}function et(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field"),e._UZ(1,"input",9,10),e.TgZ(3,"button",11),e.NdJ("click",function(){e.CHM(t);const i=e.MAs(2);return e.oxw().copy(i)}),e.TgZ(4,"mat-icon"),e._uU(5,"file_copy"),e.qZA()()()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("value",t.shareLink)}}function tt(a,n){if(1&a&&(e.TgZ(0,"mat-list-item"),e._uU(1),e.ALo(2,"async"),e.qZA()),2&a){const t=n.$implicit;let o;e.xp6(1),e.Oqu(null==(o=e.lcZ(2,1,t))?null:o.username)}}function nt(a,n){if(1&a&&(e.TgZ(0,"mat-list"),e.YNc(1,tt,3,3,"mat-list-item",12),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.editors)}}function ot(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginJSONExport()}),e._uU(2,"Export to JSON "),e.qZA(),e.TgZ(3,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginMDExport()}),e._uU(4,"Export to Homebrewery "),e.qZA()()}}function at(a,n){1&a&&(e.TgZ(0,"div"),e._UZ(1,"mat-spinner",15),e.qZA()),2&a&&(e.xp6(1),e.Q6J("diameter",24))}F.\u0275fac=function(n){return new(n||F)(e.Y36(c.WI))},F.\u0275cmp=e.Xpm({type:F,selectors:[["avr-tome-markdown-dialog"]],decls:27,vars:2,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","readonly","","placeholder","Markdown","rows","10",3,"value"],["mdElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],["mat-button","","mat-dialog-close",""]],template:function(n,t){if(1&n){const o=e.EpF();e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e._uU(2,"\n"),e.TgZ(3,"mat-dialog-content",1),e._uU(4,"\n  "),e.TgZ(5,"div",2),e._uU(6,"\n    "),e.TgZ(7,"mat-form-field"),e._uU(8,"\n      "),e._UZ(9,"textarea",3,4),e._uU(11,"\n      "),e.TgZ(12,"button",5),e.NdJ("click",function(){e.CHM(o);const l=e.MAs(10);return t.copy(l)}),e._uU(13,"\n        "),e.TgZ(14,"mat-icon"),e._uU(15,"file_copy"),e.qZA(),e._uU(16,"\n      "),e.qZA(),e._uU(17,"\n    "),e.qZA(),e._uU(18,"\n  "),e.qZA(),e._uU(19,"\n"),e.qZA(),e._uU(20,"\n"),e.TgZ(21,"mat-dialog-actions"),e._uU(22,"\n  "),e.TgZ(23,"button",6),e._uU(24,"Done"),e.qZA(),e._uU(25,"\n"),e.qZA(),e._uU(26,"\n")}2&n&&(e.xp6(1),e.hij("Markdown - ",t.data.name,""),e.xp6(8),e.Q6J("value",t.mdData))},directives:[c.uh,c.xY,x.KE,Z.Nt,g.lW,x.R9,M.gM,T.Hw,c.H8,c.ZT],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}\n/*# sourceMappingURL=tome-markdown-dialog.component.css.map*/"]});const it=function(a){return{public:a}};class D{constructor(n,t,o,i){this.data=n,this.dialog=t,this.hbService=o,this.discord=i,this.public=n.public,this.shareLink=`https://avrae.io/homebrew/spells/${n._id}`,this.loaded=void 0!==n.spells}ngOnInit(){this.owner=this.discord.getUser(this.data.owner),this.loadEditors(),this.loaded||this.loadSpells()}loadEditors(){const n=this.data._id;this.hbService.getTomeEditors(n).subscribe(t=>{const o=[];t.data.forEach(i=>o.push(this.discord.getUser(i))),this.editors=o})}loadSpells(){const n=this.data._id;this.hbService.getTome(n).subscribe(t=>{!t.success||(this.data=t.data,this.loaded=!0)})}copy(n){n.select(),document.execCommand("copy"),n.setSelectionRange(0,0)}beginJSONExport(){this.dialog.open(z.m,{data:{name:this.data.name,data:this.data.spells},width:"60%"})}beginMDExport(){this.dialog.open(F,{data:{name:this.data.name,data:this.data},width:"60%"})}}function lt(a,n){if(1&a&&(e.TgZ(0,"mat-card-content")(1,"p"),e._uU(2),e.qZA()()),2&a){const t=e.oxw().$implicit;e.xp6(2),e.hij(" ",t.desc," ")}}function ct(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",8)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),e._uU(4),e.qZA(),e.TgZ(5,"mat-card-subtitle"),e._uU(6),e.qZA()(),e._UZ(7,"img",9),e.YNc(8,lt,3,1,"mat-card-content",10),e.TgZ(9,"mat-card-actions")(10,"a",11),e._uU(11,"EDIT"),e.qZA(),e.TgZ(12,"button",12),e.NdJ("click",function(){const l=e.CHM(t).$implicit;return e.oxw(2).beginShare(l)}),e._uU(13,"SHARE"),e.qZA()()()()}if(2&a){const t=n.$implicit,o=e.oxw(2);let i;e.xp6(4),e.Oqu(t.name),e.xp6(2),e.AsE("By ",(null==(i=o.owners.get(t.owner))?null:i.username)||"loading..."," - ",t.numSpells," spells "),e.xp6(1),e.Q6J("src",t.image||"../../../../assets/img/tome.png",e.LSH),e.xp6(1),e.Q6J("ngIf",t.desc),e.xp6(2),e.s9C("routerLink",t._id)}}function st(a,n){if(1&a&&(e.TgZ(0,"div",6),e.YNc(1,ct,14,6,"div",7),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.tomes)}}function rt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"mat-card")(2,"p"),e._uU(3,"Looks like you don't have any tomes yet."),e.qZA(),e.TgZ(4,"button",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginNew()}),e._uU(5,"Create One"),e.qZA()()()}}D.\u0275fac=function(n){return new(n||D)(e.Y36(c.WI),e.Y36(c.uw),e.Y36(C),e.Y36(W.h))},D.\u0275cmp=e.Xpm({type:D,selectors:[["avr-pack-share-dialog"]],decls:31,vars:12,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],[3,"ngModel","ngModelChange"],[4,"ngIf"],[1,"mat-elevation-z0"],["class","button-row",4,"ngIf"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close"],["matInput","","readonly","","placeholder","View Link",3,"value"],["shareLinkElem",""],["mat-button","","matSuffix","","mat-icon-button","","aria-label","Copy","matTooltip","Copy to clipboard",3,"click"],[4,"ngFor","ngForOf"],[1,"button-row"],["mat-raised-button","","color","primary",3,"click"],[3,"diameter"]],template:function(n,t){if(1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"p"),e._uU(5),e.ALo(6,"async"),e.qZA(),e.TgZ(7,"mat-slide-toggle",3),e.NdJ("ngModelChange",function(i){return t.public=i}),e._uU(8,"Allow public to view"),e.qZA(),e.YNc(9,et,6,1,"mat-form-field",4),e.TgZ(10,"mat-expansion-panel",5)(11,"mat-expansion-panel-header")(12,"mat-panel-title"),e._uU(13," Editors "),e.qZA()(),e.TgZ(14,"p"),e._uU(15,"To add or remove an editor, run the command "),e.TgZ(16,"kbd"),e._uU(17,"!tome editor @user"),e.qZA(),e._uU(18," in Discord!"),e.qZA(),e.YNc(19,nt,2,1,"mat-list",4),e.qZA(),e.TgZ(20,"mat-expansion-panel",5)(21,"mat-expansion-panel-header")(22,"mat-panel-title"),e._uU(23," Export "),e.qZA()(),e.YNc(24,ot,5,0,"div",6),e.YNc(25,at,2,1,"div",4),e.qZA()()(),e.TgZ(26,"mat-dialog-actions")(27,"button",7),e._uU(28,"Cancel"),e.qZA(),e.TgZ(29,"button",8),e._uU(30," Done "),e.qZA()()),2&n){let o;e.xp6(1),e.hij("Share ",t.data.name,""),e.xp6(4),e.hij(" Owner: ",null==(o=e.lcZ(6,8,t.owner))?null:o.username," "),e.xp6(2),e.Q6J("ngModel",t.public),e.xp6(2),e.Q6J("ngIf",t.public),e.xp6(10),e.Q6J("ngIf",null==t.editors?null:t.editors.length),e.xp6(5),e.Q6J("ngIf",t.loaded),e.xp6(1),e.Q6J("ngIf",!t.loaded),e.xp6(4),e.Q6J("mat-dialog-close",e.VKq(10,it,t.public))}},directives:[c.uh,c.xY,K.Rr,p.JJ,p.On,m.O5,x.KE,Z.Nt,g.lW,x.R9,M.gM,T.Hw,u.ib,u.yz,u.yK,V.i$,m.sg,V.Tg,X.Ou,c.H8,c.ZT],pipes:[m.Ov],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.button-row[_ngcontent-%COMP%] > button[_ngcontent-%COMP%]{margin-right:4px}\n/*# sourceMappingURL=tome-share-dialog.component.css.map*/"]});class E{constructor(n,t,o,i,l,d){this.homebrewService=n,this.discord=t,this.dialog=o,this.router=i,this.route=l,this.snackBar=d,this.owners=new Map}ngOnInit(){this.getTomes()}getTomes(){this.homebrewService.getUserTomes().subscribe(n=>{if(console.log(n),!n.success)return;this.tomes=n.data;const t=new Set;for(const o of n.data)t.has(o.owner)||(t.add(o.owner),this.discord.getUser(o.owner).subscribe(i=>this.owners.set(o.owner,i)))})}beginNew(){this.dialog.open(H,{width:"60%",disableClose:!0}).afterClosed().subscribe(t=>{if(t){let o={name:t.name,public:t.public,desc:t.desc,image:t.image};this.new(o)}})}beginShare(n){this.dialog.open(D,{data:n,width:"40%",disableClose:!0}).afterClosed().subscribe(o=>{o&&(console.log(o),n=Object.assign(n,o),this.commit(n))})}new(n){this.homebrewService.newTome(n).subscribe(t=>{t.success&&this.router.navigate([t.data.tomeId],{relativeTo:this.route})})}commit(n){this.homebrewService.updateTomeSharing(n._id,n.public).subscribe(t=>{t.success?this.snackBar.open("Tome sharing options updated.",null,{horizontalPosition:"right"}):(console.log(t),this.snackBar.open(`Error: ${t.error}`,"Close",{horizontalPosition:"right",duration:-1,panelClass:"preserve-whitespace"}))})}}E.\u0275fac=function(n){return new(n||E)(e.Y36(C),e.Y36(W.h),e.Y36(c.uw),e.Y36(v.F0),e.Y36(v.gz),e.Y36(G.ux))},E.\u0275cmp=e.Xpm({type:E,selectors:[["avr-spells"]],decls:10,vars:2,consts:[["color","primary",1,"mat-elevation-z2"],[1,"toolbar-spacer"],["mat-icon-button","",3,"click"],["aria-label","New Tome"],["class","container","fxLayout","row wrap","fxLayoutAlign","space-around",4,"ngIf"],["class","container",4,"ngIf"],["fxLayout","row wrap","fxLayoutAlign","space-around",1,"container"],["class","tome-tile","fxFlex","32%",4,"ngFor","ngForOf"],["fxFlex","32%",1,"tome-tile"],["mat-card-image","","alt","Tome Image",3,"src"],[4,"ngIf"],["mat-button","",3,"routerLink"],["mat-button","",3,"click"],[1,"container"],["mat-raised-button","","color","accent",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-toolbar",0)(1,"span"),e._uU(2,"Your Tomes"),e.qZA(),e._UZ(3,"span",1),e.TgZ(4,"span")(5,"button",2),e.NdJ("click",function(){return t.beginNew()}),e.TgZ(6,"mat-icon",3),e._uU(7,"add"),e.qZA()()()(),e.YNc(8,st,2,1,"div",4),e.YNc(9,rt,6,0,"div",5)),2&n&&(e.xp6(8),e.Q6J("ngIf",t.tomes&&t.tomes.length),e.xp6(1),e.Q6J("ngIf",t.tomes&&!t.tomes.length))},directives:[ee.Ye,g.lW,T.Hw,m.O5,_.xw,_.Wh,m.sg,_.yH,h.a8,h.dk,h.n5,h.$j,h.G2,h.dn,h.hq,g.zs,v.yS],styles:[".toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.container[_ngcontent-%COMP%], .pack-tile[_ngcontent-%COMP%]{margin:4px}\n/*# sourceMappingURL=spells.component.css.map*/"]});class Q{constructor(n){this.data=n}ngOnInit(){}}function mt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginDelete()}),e._uU(1,"Delete"),e.qZA()}}Q.\u0275fac=function(n){return new(n||Q)(e.Y36(c.WI))},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["avr-tome-delete-dialog"]],decls:12,vars:3,consts:[["mat-dialog-title",""],[1,"mat-typography"],["mat-button","","mat-dialog-close",""],["mat-button","","color","warn",3,"mat-dialog-close"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"p"),e._uU(4),e.TgZ(5,"b"),e._uU(6,"This cannot be undone."),e.qZA()()(),e.TgZ(7,"mat-dialog-actions")(8,"button",2),e._uU(9,"Cancel"),e.qZA(),e.TgZ(10,"button",3),e._uU(11," Delete "),e.qZA()()),2&n&&(e.xp6(1),e.hij("Deleting ",t.data.name,"..."),e.xp6(3),e.hij(" Are you sure you want to delete ",t.data.name,"? This will remove the tome from all editors' libraries, and invalidate any sharing links. "),e.xp6(6),e.Q6J("mat-dialog-close",!0))},directives:[c.uh,c.xY,c.H8,g.lW,c.ZT],encapsulation:2});const pt=function(a,n,t){return{name:a,image:n,desc:t}};class Y{constructor(n,t,o){this.data=n,this.dialog=t,this.dialogRef=o,this.name=n.name,this.image=n.image,this.desc=n.desc,this.isOwner=(0,r.PR)().id===n.owner}ngOnInit(){}beginDelete(){this.dialog.open(Q,{data:this.data,width:"40%"}).afterClosed().subscribe(t=>{t&&this.dialogRef.close({delete:!0})})}}Y.\u0275fac=function(n){return new(n||Y)(e.Y36(c.WI),e.Y36(c.uw),e.Y36(c.so))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["avr-tome-options-dialog"]],decls:16,vars:11,consts:[["mat-dialog-title",""],[1,"mat-typography"],[1,"form-container"],["matInput","","placeholder","Name",3,"ngModel","ngModelChange"],["matInput","","placeholder","Image URL",3,"ngModel","ngModelChange"],["matInput","","placeholder","Description",3,"ngModel","ngModelChange"],["mat-button","","mat-dialog-close",""],["mat-button","",3,"mat-dialog-close","disabled"],["mat-raised-button","","color","warn",3,"click",4,"ngIf"],["mat-raised-button","","color","warn",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"h2",0),e._uU(1),e.qZA(),e.TgZ(2,"mat-dialog-content",1)(3,"div",2)(4,"mat-form-field")(5,"input",3),e.NdJ("ngModelChange",function(i){return t.name=i}),e.qZA()(),e.TgZ(6,"mat-form-field")(7,"input",4),e.NdJ("ngModelChange",function(i){return t.image=i}),e.qZA()(),e.TgZ(8,"mat-form-field")(9,"textarea",5),e.NdJ("ngModelChange",function(i){return t.desc=i}),e.qZA()()()(),e.TgZ(10,"mat-dialog-actions")(11,"button",6),e._uU(12,"Cancel"),e.qZA(),e.TgZ(13,"button",7),e._uU(14," Save "),e.qZA(),e.YNc(15,mt,2,0,"button",8),e.qZA()),2&n&&(e.xp6(1),e.Oqu(t.data.name),e.xp6(4),e.Q6J("ngModel",t.name),e.xp6(2),e.Q6J("ngModel",t.image),e.xp6(2),e.Q6J("ngModel",t.desc),e.xp6(4),e.Q6J("mat-dialog-close",e.kEZ(7,pt,t.name,t.image,t.desc))("disabled",!t.name),e.xp6(2),e.Q6J("ngIf",t.isOwner))},directives:[c.uh,c.xY,x.KE,Z.Nt,p.Fj,p.JJ,p.On,c.H8,g.lW,c.ZT,m.O5],styles:[".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}\n/*# sourceMappingURL=tome-options-dialog.component.css.map*/"]});var ge=s(2379);class L{constructor(){}genDesc(){this.description=this.level?`${(0,b.jM)(this.level)} ${(0,b.mN)(this.school)}`:`${(0,b.mN)(this.school)} ${(0,b.jM)(this.level)}`}ngOnInit(){this.genDesc()}ngOnChanges(n){this.genDesc()}}L.\u0275fac=function(n){return new(n||L)},L.\u0275cmp=e.Xpm({type:L,selectors:[["avr-spell-panel-description"]],inputs:{level:"level",school:"school"},features:[e.TTD],decls:2,vars:1,template:function(n,t){1&n&&(e.TgZ(0,"mat-panel-description"),e._uU(1),e.qZA()),2&n&&(e.xp6(1),e.Oqu(t.description))},directives:[u.u4],encapsulation:2});var _t=s(1434),dt=s(1130),gt=s(1534);function ut(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",5)(1,"input",37),e.NdJ("change",function(){return e.CHM(t),e.oxw(2).emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw(2).spell.image=i}),e.qZA()()}if(2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("ngModel",t.spell.image)}}function ht(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"mat-select",9),e.NdJ("valueChange",function(i){e.CHM(t);return e.oxw(2).spell.school=i})("selectionChange",function(){return e.CHM(t),e.oxw(2).emitChange()}),e.TgZ(1,"mat-option",38),e._uU(2,"Abjuration"),e.qZA(),e.TgZ(3,"mat-option",39),e._uU(4,"Conjuration"),e.qZA(),e.TgZ(5,"mat-option",40),e._uU(6,"Divination"),e.qZA(),e.TgZ(7,"mat-option",41),e._uU(8,"Enchantment"),e.qZA(),e.TgZ(9,"mat-option",42),e._uU(10,"Evocation"),e.qZA(),e.TgZ(11,"mat-option",43),e._uU(12,"Illusion"),e.qZA(),e.TgZ(13,"mat-option",44),e._uU(14,"Necromancy"),e.qZA(),e.TgZ(15,"mat-option",45),e._uU(16,"Transmutation"),e.qZA(),e.TgZ(17,"mat-option",46),e.NdJ("click",function(){e.CHM(t);return e.oxw(2).customSpellSchool=!0}),e._uU(18,"Custom"),e.qZA()()}if(2&a){const t=e.oxw(2);e.Q6J("value",t.spell.school)}}function ft(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"input",47),e.NdJ("change",function(){return e.CHM(t),e.oxw(2).emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw(2).spell.school=i}),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("ngModel",t.spell.school)}}function xt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",48),e.NdJ("click",function(){e.CHM(t);return e.oxw(2).customSpellSchool=!1}),e.TgZ(1,"mat-icon"),e._uU(2,"remove_circle_outline"),e.qZA()()}}function vt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"span",5)(1,"button",49),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return i.spell.image="",i.emitChange()}),e.TgZ(2,"mat-icon",50),e._uU(3,"add_photo_alternate"),e.qZA()()()}}function Ct(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"span",5)(1,"button",51),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).moveUp.emit()}),e.TgZ(2,"mat-icon",52),e._uU(3,"arrow_upward"),e.qZA()()()}}function Tt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"span",5)(1,"button",53),e.NdJ("click",function(){return e.CHM(t),e.oxw(2).moveDown.emit()}),e.TgZ(2,"mat-icon",54),e._uU(3,"arrow_downward"),e.qZA()()()}}function bt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",3)(1,"div",4)(2,"mat-form-field",5)(3,"input",6),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.name=i}),e.qZA()(),e.YNc(4,ut,2,1,"mat-form-field",7),e.qZA(),e.TgZ(5,"div",8)(6,"mat-form-field",5)(7,"mat-label"),e._uU(8,"Level"),e.qZA(),e.TgZ(9,"mat-select",9),e.NdJ("valueChange",function(i){e.CHM(t);return e.oxw().spell.level=i})("selectionChange",function(){return e.CHM(t),e.oxw().emitChange()}),e.TgZ(10,"mat-option",10),e._uU(11,"Cantrip"),e.qZA(),e.TgZ(12,"mat-option",10),e._uU(13,"1st Level"),e.qZA(),e.TgZ(14,"mat-option",10),e._uU(15,"2nd Level"),e.qZA(),e.TgZ(16,"mat-option",10),e._uU(17,"3rd Level"),e.qZA(),e.TgZ(18,"mat-option",10),e._uU(19,"4th Level"),e.qZA(),e.TgZ(20,"mat-option",10),e._uU(21,"5th Level"),e.qZA(),e.TgZ(22,"mat-option",10),e._uU(23,"6th Level"),e.qZA(),e.TgZ(24,"mat-option",10),e._uU(25,"7th Level"),e.qZA(),e.TgZ(26,"mat-option",10),e._uU(27,"8th Level"),e.qZA(),e.TgZ(28,"mat-option",10),e._uU(29,"9th Level"),e.qZA()()(),e.TgZ(30,"mat-form-field",5)(31,"mat-label"),e._uU(32,"School"),e.qZA(),e.YNc(33,ht,19,1,"mat-select",11),e.YNc(34,ft,1,1,"input",12),e.YNc(35,xt,3,0,"button",13),e.qZA(),e.TgZ(36,"mat-checkbox",14),e.NdJ("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.ritual=i})("change",function(){return e.CHM(t),e.oxw().emitChange()}),e._uU(37,"Ritual"),e.qZA()(),e.TgZ(38,"div",15)(39,"mat-form-field",16)(40,"input",17),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.casttime=i}),e.qZA()(),e.TgZ(41,"mat-form-field",16)(42,"input",18),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.range=i}),e.qZA()()(),e.TgZ(43,"div",8)(44,"mat-checkbox",19),e.NdJ("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.components.verbal=i})("change",function(){return e.CHM(t),e.oxw().emitChange()}),e._uU(45," Verbal "),e.qZA(),e.TgZ(46,"mat-checkbox",19),e.NdJ("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.components.somatic=i})("change",function(){return e.CHM(t),e.oxw().emitChange()}),e._uU(47," Somatic "),e.qZA(),e.TgZ(48,"mat-form-field",5)(49,"input",20),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.components.material=i}),e.qZA()()(),e.TgZ(50,"div",8)(51,"mat-form-field",5)(52,"input",21),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.duration=i}),e.qZA()(),e.TgZ(53,"mat-checkbox",19),e.NdJ("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.concentration=i})("change",function(){return e.CHM(t),e.oxw().emitChange()}),e._uU(54," Concentration "),e.qZA()(),e.TgZ(55,"mat-form-field")(56,"textarea",22),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.description=i}),e.qZA()(),e.TgZ(57,"mat-form-field")(58,"textarea",23),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.higherlevels=i}),e.qZA()(),e.TgZ(59,"div",24)(60,"mat-form-field",25)(61,"input",26),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.classes=i}),e.qZA()(),e.TgZ(62,"mat-form-field",27)(63,"input",28),e.NdJ("change",function(){return e.CHM(t),e.oxw().emitChange()})("ngModelChange",function(i){e.CHM(t);return e.oxw().spell.subclasses=i}),e.qZA()()()(),e.TgZ(64,"div",29),e.YNc(65,vt,4,0,"span",7),e.TgZ(66,"span",5)(67,"button",30),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginJSONExport()}),e.TgZ(68,"mat-icon",31),e._uU(69,"vertical_align_top"),e.qZA()()(),e.TgZ(70,"span",5)(71,"button",32),e.NdJ("click",function(){return e.CHM(t),e.oxw().moveToEditor.emit()}),e.TgZ(72,"mat-icon",33),e._uU(73,"build"),e.qZA()()(),e.YNc(74,Ct,4,0,"span",7),e.YNc(75,Tt,4,0,"span",7),e._UZ(76,"span",34),e.TgZ(77,"span",5)(78,"button",35),e.NdJ("click",function(){return e.CHM(t),e.oxw().delete.emit()}),e.TgZ(79,"mat-icon",36),e._uU(80,"delete"),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.spell.name),e.xp6(1),e.Q6J("ngIf",null!=t.spell.image),e.xp6(5),e.Q6J("value",t.spell.level),e.xp6(1),e.Q6J("value",0),e.xp6(2),e.Q6J("value",1),e.xp6(2),e.Q6J("value",2),e.xp6(2),e.Q6J("value",3),e.xp6(2),e.Q6J("value",4),e.xp6(2),e.Q6J("value",5),e.xp6(2),e.Q6J("value",6),e.xp6(2),e.Q6J("value",7),e.xp6(2),e.Q6J("value",8),e.xp6(2),e.Q6J("value",9),e.xp6(5),e.Q6J("ngIf",!t.customSpellSchool),e.xp6(1),e.Q6J("ngIf",t.customSpellSchool),e.xp6(1),e.Q6J("ngIf",t.customSpellSchool),e.xp6(1),e.Q6J("ngModel",t.spell.ritual),e.xp6(4),e.Q6J("ngModel",t.spell.casttime),e.xp6(2),e.Q6J("ngModel",t.spell.range),e.xp6(2),e.Q6J("ngModel",t.spell.components.verbal),e.xp6(2),e.Q6J("ngModel",t.spell.components.somatic),e.xp6(3),e.Q6J("ngModel",t.spell.components.material),e.xp6(3),e.Q6J("ngModel",t.spell.duration),e.xp6(1),e.Q6J("ngModel",t.spell.concentration),e.xp6(3),e.Q6J("ngModel",t.spell.description),e.xp6(2),e.Q6J("ngModel",t.spell.higherlevels),e.xp6(3),e.Q6J("ngModel",t.spell.classes),e.xp6(2),e.Q6J("ngModel",t.spell.subclasses),e.xp6(2),e.Q6J("ngIf",void 0===t.spell.image),e.xp6(9),e.Q6J("ngIf",!t.isFirst),e.xp6(1),e.Q6J("ngIf",!t.isLast)}}class ${constructor(n){this.dialog=n,this.moveUp=new e.vpe,this.moveDown=new e.vpe,this.changed=new e.vpe,this.opened=new e.vpe,this.delete=new e.vpe,this.moveToEditor=new e.vpe}ngOnInit(){this.customSpellSchool=!b.Lc.includes(this.spell.school)}emitChange(){this.changed.emit()}beginJSONExport(){this.dialog.open(z.m,{data:{name:this.spell.name,data:this.spell},width:"60%"})}}$.\u0275fac=function(n){return new(n||$)(e.Y36(c.uw))},$.\u0275cmp=e.Xpm({type:$,selectors:[["avr-spell-detail"]],inputs:{spell:"spell",isFirst:"isFirst",isLast:"isLast"},outputs:{moveUp:"moveUp",moveDown:"moveDown",changed:"changed",opened:"opened",delete:"delete",moveToEditor:"moveToEditor"},decls:7,vars:3,consts:[[3,"opened"],[3,"level","school"],["matExpansionPanelContent",""],[1,"form-container"],["fxLayout","row","fxLayoutGap","4px"],["fxFlex",""],["matInput","","placeholder","Name",3,"ngModel","change","ngModelChange"],["fxFlex","",4,"ngIf"],["fxLayout","row wrap","fxLayoutGap","6px","fxLayoutAlign","center center"],[3,"value","valueChange","selectionChange"],[3,"value"],[3,"value","valueChange","selectionChange",4,"ngIf"],["matInput","","placeholder","School",3,"ngModel","change","ngModelChange",4,"ngIf"],["mat-icon-button","","matSuffix","","matTooltip","Delete custom school",3,"click",4,"ngIf"],["fxFlex","nogrow",2,"padding-right","4px",3,"ngModel","ngModelChange","change"],["fxLayout","row wrap",2,"gap","6px"],["fxFlex","",2,"max-width","calc(50%-3px)"],["matInput","","placeholder","Casting Time",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Range",3,"ngModel","change","ngModelChange"],["fxFlex","nogrow",3,"ngModel","ngModelChange","change"],["matInput","","placeholder","Material",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Duration",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","Description","rows","7",3,"ngModel","change","ngModelChange"],["matInput","","placeholder","At Higher Levels","rows","3",3,"ngModel","change","ngModelChange"],["fxLayout","row wrap","fxLayoutGap","6px"],["fxFlex","","matTooltip","Separate classes with commas."],["matInput","","placeholder","Classes",3,"ngModel","change","ngModelChange"],["fxFlex","","matTooltip","Separate subclasses with commas."],["matInput","","placeholder","Subclasses",3,"ngModel","change","ngModelChange"],["fxLayout","row",1,"actions"],["mat-icon-button","","matTooltip","Export to JSON",3,"click"],["aria-label","Export to JSON"],["mat-icon-button","","matTooltip","Edit Automation",3,"click"],["aria-label","Edit Automation"],["fxFlex","grow"],["mat-icon-button","","color","warn",3,"click"],["aria-label","Delete"],["matInput","","placeholder","Image URL",3,"ngModel","change","ngModelChange"],["value","A"],["value","C"],["value","D"],["value","E"],["value","V"],["value","I"],["value","N"],["value","T"],["value","Custom",3,"click"],["matInput","","placeholder","School",3,"ngModel","change","ngModelChange"],["mat-icon-button","","matSuffix","","matTooltip","Delete custom school",3,"click"],["mat-icon-button","","matTooltip","Add image",3,"click"],["aria-label","Add image"],["mat-icon-button","","matTooltip","Move Up",3,"click"],["aria-label","Move Up"],["mat-icon-button","","matTooltip","Move Down",3,"click"],["aria-label","Move Down"]],template:function(n,t){1&n&&(e.TgZ(0,"mat-expansion-panel",0),e.NdJ("opened",function(){return t.opened.emit()}),e.TgZ(1,"mat-expansion-panel-header")(2,"mat-panel-title")(3,"div"),e._uU(4),e.qZA()(),e._UZ(5,"avr-spell-panel-description",1),e.qZA(),e.YNc(6,bt,81,31,"ng-template",2),e.qZA()),2&n&&(e.xp6(4),e.hij(" ",t.spell.name," "),e.xp6(1),e.Q6J("level",t.spell.level)("school",t.spell.school))},directives:[u.ib,u.yz,u.yK,L,u.HS,_.xw,_.SQ,x.KE,_.yH,Z.Nt,p.Fj,p.JJ,p.On,m.O5,_.Wh,x.hX,_t.gD,dt.ey,g.lW,x.R9,M.gM,T.Hw,gt.oG],styles:[".form-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}mat-panel-title[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{margin:auto 0}\n/*# sourceMappingURL=spell-detail.component.css.map*/"]});var Zt=s(813);function wt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"avr-spell-detail",15),e.NdJ("moveUp",function(){const l=e.CHM(t).$implicit;return e.oxw(2).moveUp(l)})("moveDown",function(){const l=e.CHM(t).$implicit;return e.oxw(2).moveDown(l)})("changed",function(){return e.CHM(t),e.oxw(2).changed.emit()})("opened",function(){const l=e.CHM(t).$implicit,d=e.oxw(2);return d.selectedSpell=l,d.selected.emit(l)})("delete",function(){const l=e.CHM(t).$implicit;return e.oxw(2).deleteSpell(l)})("moveToEditor",function(){return e.CHM(t),e.oxw(2).moveToEditor.emit()}),e.qZA()}if(2&a){const t=n.$implicit,o=n.first,i=n.last;e.Q6J("spell",t)("isFirst",o)("isLast",i)}}function Mt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",4)(1,"mat-accordion"),e.YNc(2,wt,1,3,"avr-spell-detail",5),e.TgZ(3,"mat-card",6)(4,"span",7),e._uU(5,"New..."),e.qZA(),e._UZ(6,"span",8),e.TgZ(7,"span")(8,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().newFromJSON()}),e.TgZ(9,"mat-icon",10),e._uU(10,"vertical_align_bottom"),e.qZA()(),e.TgZ(11,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().newFromSRD()}),e.TgZ(12,"mat-icon",12),e._uU(13,"scanner"),e.qZA()(),e.TgZ(14,"button",13),e.NdJ("click",function(){return e.CHM(t),e.oxw().newSpell()}),e.TgZ(15,"mat-icon",14),e._uU(16,"add"),e.qZA()()()()()()}if(2&a){const t=e.oxw();e.xp6(2),e.Q6J("ngForOf",t.tome.spells)}}function kt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",4)(1,"mat-card")(2,"p"),e._uU(3,"Looks like this tome is empty."),e.qZA(),e.TgZ(4,"button",16),e.NdJ("click",function(){return e.CHM(t),e.oxw().newSpell()}),e._uU(5,"Make a Spell"),e.qZA(),e.TgZ(6,"button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().newFromJSON()}),e.TgZ(7,"mat-icon",10),e._uU(8,"vertical_align_bottom"),e.qZA()(),e.TgZ(9,"button",11),e.NdJ("click",function(){return e.CHM(t),e.oxw().newFromSRD()}),e.TgZ(10,"mat-icon",12),e._uU(11,"scanner"),e.qZA()()()()}}class R{constructor(n,t){this.dialog=n,this.hbService=t,this.selected=new e.vpe,this.changed=new e.vpe,this.moveToEditor=new e.vpe}ngOnInit(){}newSpell(){this.tome.spells.push(new b.j_),this.changed.emit()}newFromJSON(){const n=this.dialog.open(se.Q,{width:"60%",disableClose:!0,data:{validator:t=>this.validateSpellJSON(n,t)}});n.afterClosed().subscribe(t=>{if(t){let o=t;console.log(o),o instanceof Array?this.tome.spells.push(...o):this.tome.spells.push(o),this.changed.emit()}})}newFromSRD(){this.dialog.open(re.b,{width:"60%",disableClose:!0,data:{getter:()=>this.hbService.getTemplateSpells().pipe((0,ce.U)(t=>t.data)),namer:t=>t.name}}).afterClosed().subscribe(t=>{t&&(this.tome.spells.push(t),this.changed.emit())})}deleteSpell(n){this.tome.spells=this.tome.spells.filter(t=>t!==n),this.changed.emit()}validateSpellJSON(n,t){this.hbService.validateSpellJSON(t).subscribe(o=>{n.componentInstance.loading=!1,o.success?n.close(t):n.componentInstance.error=o.error})}moveUp(n){const t=this.tome.spells.indexOf(n),o=t-1;o>-1&&((0,te.bA)(this.tome.spells,t,o),this.changed.emit())}moveDown(n){const t=this.tome.spells.indexOf(n),o=t+1;o<this.tome.spells.length&&((0,te.bA)(this.tome.spells,t,o),this.changed.emit())}}R.\u0275fac=function(n){return new(n||R)(e.Y36(c.uw),e.Y36(C))},R.\u0275cmp=e.Xpm({type:R,selectors:[["avr-spell-list"]],inputs:{tome:"tome",user:"user"},outputs:{selected:"selected",changed:"changed",moveToEditor:"moveToEditor"},decls:5,vars:19,consts:[["fxLayout","row","fxLayoutGap","8px",1,"container"],["class","spell-list","fxFlex","grow",4,"ngIf"],["fxFlex","grow","fxHide","","fxShow.gt-xs","true",1,"spell-preview","mat-typography","mat-elevation-z3"],[3,"name","image","level","school","classes","subclasses","verbal","somatic","material","time","ritual","range","concentration","duration","description","higherlevels","user"],["fxFlex","grow",1,"spell-list"],[3,"spell","isFirst","isLast","moveUp","moveDown","changed","opened","delete","moveToEditor",4,"ngFor","ngForOf"],["fxLayout","row","fxLayoutAlign","start center",1,"new-spell-card"],[1,"no-text-cursor"],[1,"toolbar-spacer"],["mat-icon-button","","matTooltip","Import from JSON",3,"click"],["aria-label","Import from JSON"],["mat-icon-button","","matTooltip","Copy SRD spell",3,"click"],["aria-label","From existing spell"],["mat-icon-button","",3,"click"],["aria-label","New"],[3,"spell","isFirst","isLast","moveUp","moveDown","changed","opened","delete","moveToEditor"],["mat-raised-button","","color","accent",3,"click"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.YNc(1,Mt,17,1,"div",1),e.YNc(2,kt,12,0,"div",1),e.TgZ(3,"div",2),e._UZ(4,"avr-spell-embed",3),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.tome.spells.length),e.xp6(1),e.Q6J("ngIf",!t.tome.spells.length),e.xp6(2),e.Q6J("name",null==t.selectedSpell?null:t.selectedSpell.name)("image",null==t.selectedSpell?null:t.selectedSpell.image)("level",null==t.selectedSpell?null:t.selectedSpell.level)("school",null==t.selectedSpell?null:t.selectedSpell.school)("classes",null==t.selectedSpell?null:t.selectedSpell.classes)("subclasses",null==t.selectedSpell?null:t.selectedSpell.subclasses)("verbal",null==t.selectedSpell?null:t.selectedSpell.components.verbal)("somatic",null==t.selectedSpell?null:t.selectedSpell.components.somatic)("material",null==t.selectedSpell?null:t.selectedSpell.components.material)("time",null==t.selectedSpell?null:t.selectedSpell.casttime)("ritual",null==t.selectedSpell?null:t.selectedSpell.ritual)("range",null==t.selectedSpell?null:t.selectedSpell.range)("concentration",null==t.selectedSpell?null:t.selectedSpell.concentration)("duration",null==t.selectedSpell?null:t.selectedSpell.duration)("description",null==t.selectedSpell?null:t.selectedSpell.description)("higherlevels",null==t.selectedSpell?null:t.selectedSpell.higherlevels)("user",t.user))},directives:[_.xw,_.SQ,m.O5,_.yH,u.pp,m.sg,$,h.a8,_.Wh,g.lW,M.gM,T.Hw,pe.b8,Zt.r],styles:[".container[_ngcontent-%COMP%]{margin:8px}.spell-list[_ngcontent-%COMP%], .spell-preview[_ngcontent-%COMP%]{max-height:calc(100vh - 240px);overflow-y:auto}.new-spell-card[_ngcontent-%COMP%]{height:48px;padding:0 24px;margin-top:8px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}"]});var St=s(2914);function Dt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",1)(1,"mat-card")(2,"p"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5,"You can find help on how to use the spell editor "),e.TgZ(6,"a",2),e._uU(7,"here"),e.qZA(),e._uU(8,"."),e.qZA(),e.TgZ(9,"avr-automation-editor",3),e.NdJ("changed",function(){return e.CHM(t),e.oxw().changed.emit()}),e.qZA()()()}if(2&a){const t=e.oxw();e.xp6(3),e.hij("Editing ",t.spell.name,"..."),e.xp6(6),e.Q6J("automation",t.getAutomation(t.spell))("spell",t.spell)}}function Ut(a,n){1&a&&(e.TgZ(0,"div",1)(1,"mat-card")(2,"p"),e._uU(3," No spell selected. "),e.qZA()()())}class j{constructor(){this.changed=new e.vpe}ngOnInit(){}getAutomation(n){return null===n.automation&&(n.automation=[]),n.automation}}function Jt(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div")(1,"mat-toolbar",1)(2,"span")(3,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().back()}),e.TgZ(4,"mat-icon",3),e._uU(5,"arrow_back"),e.qZA()()(),e.TgZ(6,"span"),e._uU(7),e.qZA(),e._UZ(8,"span",4),e.TgZ(9,"span")(10,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().commit()}),e.TgZ(11,"mat-icon",5),e._uU(12,"save"),e.qZA()(),e.TgZ(13,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginSettings()}),e.TgZ(14,"mat-icon",6),e._uU(15,"settings"),e.qZA()(),e.TgZ(16,"button",2),e.NdJ("click",function(){return e.CHM(t),e.oxw().beginShare()}),e.TgZ(17,"mat-icon",7),e._uU(18,"launch"),e.qZA()()()(),e.TgZ(19,"mat-tab-group",8,9)(21,"mat-tab",10)(22,"avr-spell-list",11),e.NdJ("selected",function(i){e.CHM(t);return e.oxw().selectedSpell=i})("changed",function(){return e.CHM(t),e.oxw().ensureChangesNotif()})("moveToEditor",function(){e.CHM(t);return e.MAs(20).selectedIndex=1}),e.qZA()(),e.TgZ(23,"mat-tab",12)(24,"avr-spell-editor",13),e.NdJ("changed",function(){return e.CHM(t),e.oxw().ensureChangesNotif()}),e.qZA()()()()}if(2&a){const t=e.oxw();e.xp6(7),e.hij(" ",t.tome.name," "),e.xp6(15),e.Q6J("tome",t.tome)("user",t.user),e.xp6(2),e.Q6J("spell",t.selectedSpell)}}function At(a,n){if(1&a&&(e.TgZ(0,"p",17),e._uU(1),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.error," ")}}function Nt(a,n){if(1&a&&(e.TgZ(0,"div")(1,"div",14)(2,"mat-card"),e._UZ(3,"mat-spinner",15),e.YNc(4,At,2,1,"p",16),e.qZA()()()),2&a){const t=e.oxw();e.xp6(3),e.Q6J("diameter",24),e.xp6(1),e.Q6J("ngIf",t.error)}}function It(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div")(1,"div",14)(2,"mat-card")(3,"p"),e._uU(4,"You do not have permission to edit this tome."),e.qZA(),e.TgZ(5,"button",18),e.NdJ("click",function(){return e.CHM(t),e.oxw().back()}),e._uU(6,"Go Back"),e.qZA()()()()}}j.\u0275fac=function(n){return new(n||j)},j.\u0275cmp=e.Xpm({type:j,selectors:[["avr-spell-editor"]],inputs:{spell:"spell"},outputs:{changed:"changed"},decls:2,vars:2,consts:[["class","container",4,"ngIf"],[1,"container"],["target","_blank","href","https://avrae.readthedocs.io/en/stable/automation_ref.html"],[3,"automation","spell","changed"]],template:function(n,t){1&n&&(e.YNc(0,Dt,10,3,"div",0),e.YNc(1,Ut,4,0,"div",0)),2&n&&(e.Q6J("ngIf",t.spell),e.xp6(1),e.Q6J("ngIf",!t.spell))},directives:[m.O5,h.a8,St._],styles:[".container[_ngcontent-%COMP%]{margin:8px}\n/*# sourceMappingURL=spell-editor.component.css.map*/"]});class B{constructor(n,t,o,i,l,d,oe){this.route=n,this.homebrewService=t,this.dashboardService=o,this.location=i,this.dialog=l,this.router=d,this.snackBar=oe,this.user=(0,r.PR)(),this.changesOpen=!1}ngOnInit(){this.getTome()}ngOnDestroy(){this.snackBar.dismiss()}getTome(){const n=this.route.snapshot.paramMap.get("tome");this.homebrewService.getTome(n).subscribe(t=>{t.success?(this.tome=t.data,this.calcCanEdit()):this.error=t.error})}calcCanEdit(){if(this.tome&&this.user)if(this.isOwner=this.user.id===this.tome.owner,this.isOwner)this.canEdit=!0;else{const n=this.tome._id;this.homebrewService.getTomeEditors(n).subscribe(t=>this.canEdit=t.data.some(o=>o===this.user.id))}}ensureChangesNotif(){this.changesOpen||(this.changesOpen=!0,this.snackBar.open("You have unsaved changes!","Save",{duration:-1,horizontalPosition:"right"}).onAction().subscribe(()=>{this.commit()}))}beginShare(){this.dialog.open(D,{data:this.tome,width:"40%",disableClose:!0}).afterClosed().subscribe(t=>{t&&(console.log(t),this.tome=Object.assign(this.tome,t),this.commit())})}beginSettings(){this.dialog.open(Y,{data:this.tome,width:"40%",disableClose:!0}).afterClosed().subscribe(t=>{t&&(console.log(t),t.delete?this.delete():(this.tome=Object.assign(this.tome,t),this.commit()))})}commit(){this.homebrewService.putTome(this.tome).subscribe(n=>{this.changesOpen=!1,n.success?this.snackBar.open(`${n.data} Use "!tome ${this.tome.name}" to activate the pack in Discord!`,null,{horizontalPosition:"right"}):this.snackBar.openFromComponent(ne.U,{data:{html:`${n.error}`},horizontalPosition:"right",duration:-1})})}delete(){this.homebrewService.deleteTome(this.tome).subscribe(n=>{n.success?this.router.navigate(["../"],{relativeTo:this.route}):this.snackBar.openFromComponent(ne.U,{data:{html:`${n.error}`},horizontalPosition:"right",duration:-1,panelClass:["mat-simple-snackbar"]})})}back(){this.location.back()}}B.\u0275fac=function(n){return new(n||B)(e.Y36(v.gz),e.Y36(C),e.Y36(me.s),e.Y36(m.Ye),e.Y36(c.uw),e.Y36(v.F0),e.Y36(G.ux))},B.\u0275cmp=e.Xpm({type:B,selectors:[["avr-tome-detail"]],decls:3,vars:3,consts:[[4,"ngIf"],["color","primary",1,"tome-toolbar"],["mat-icon-button","",3,"click"],["aria-label","Back"],[1,"toolbar-spacer"],["aria-label","Save"],["aria-label","Settings"],["aria-label","Share"],["backgroundColor","primary"],["tabGroup",""],["label","Spells"],[3,"tome","user","selected","changed","moveToEditor"],["label","Editor"],[3,"spell","changed"],[1,"container"],[3,"diameter"],["class","mat-error",4,"ngIf"],[1,"mat-error"],["mat-raised-button","","color","accent",3,"click"]],template:function(n,t){1&n&&(e.YNc(0,Jt,25,4,"div",0),e.YNc(1,Nt,5,2,"div",0),e.YNc(2,It,7,0,"div",0)),2&n&&(e.Q6J("ngIf",t.tome&&null!=t.canEdit),e.xp6(1),e.Q6J("ngIf",!t.tome),e.xp6(1),e.Q6J("ngIf",t.tome&&!t.canEdit))},directives:[m.O5,ee.Ye,g.lW,T.Hw,ge.SP,ge.uX,R,j,h.a8,X.Ou],styles:[".tome-toolbar[_ngcontent-%COMP%]{height:64px}mat-tab-header[_ngcontent-%COMP%]{height:48px}.toolbar-spacer[_ngcontent-%COMP%]{flex:1 1 auto}.no-text-cursor[_ngcontent-%COMP%]{cursor:default}"]});const yt=[{path:"",children:[{path:"items",component:I},{path:"items/:pack",component:P},{path:"spells",component:E},{path:"spells/:tome",component:B}]}];class U{}U.\u0275fac=function(n){return new(n||U)},U.\u0275mod=e.oAB({type:U}),U.\u0275inj=e.cJS({imports:[[v.Bz.forChild(yt)],v.Bz]});class J{}J.\u0275fac=function(n){return new(n||J)},J.\u0275mod=e.oAB({type:J}),J.\u0275inj=e.cJS({imports:[[m.ez,he.q,p.u5,ue.o9,ie.JP.forChild(),xe.A,fe.l,ve.d,U]]})}}]);
//# sourceMappingURL=876.1b993dfc08f50df9.js.map